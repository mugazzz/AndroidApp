"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.setupNewChromedriver = exports.helpers = exports.commands = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

var _appiumChromedriver = _interopRequireDefault(require("appium-chromedriver"));

var _portfinder = _interopRequireDefault(require("portfinder"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumBaseDriver = require("appium-base-driver");

var _webviewHelpers = _interopRequireWildcard(require("../webview-helpers"));

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;
commands.getCurrentContext = (0, _asyncToGenerator2.default)(function* () {
  return this.curContext || this.defaultContextName();
});
commands.getContexts = (0, _asyncToGenerator2.default)(function* () {
  let webviews;

  if (this.isChromeSession) {
    webviews = [_webviewHelpers.CHROMIUM_WIN];
  } else {
    webviews = yield _webviewHelpers.default.getWebviews(this.adb, this.opts.androidDeviceSocket);
  }

  this.contexts = _lodash.default.union([_webviewHelpers.NATIVE_WIN], webviews);

  _logger.default.debug(`Available contexts: ${JSON.stringify(this.contexts)}`);

  return this.contexts;
});

commands.setContext = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (name) {
    if (name === null) {
      name = this.defaultContextName();
    } else if (name === _webviewHelpers.WEBVIEW_WIN) {
      name = this.defaultWebviewName();
    }

    let contexts = yield this.getContexts();

    if (!_lodash.default.includes(contexts, name)) {
      throw new _appiumBaseDriver.errors.NoSuchContextError();
    }

    if (name === this.curContext) {
      return;
    }

    yield this.switchContext(name);
    this.curContext = name;
  });

  return function (_x) {
    return _ref3.apply(this, arguments);
  };
}();

helpers.switchContext = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (name) {
    if (this.isChromedriverContext(name)) {
      yield this.startChromedriverProxy(name);
    } else if (this.isChromedriverContext(this.curContext)) {
      if (this.opts.recreateChromeDriverSessions) {
        _logger.default.debug("recreateChromeDriverSessions set to true; killing existing chromedrivers");

        yield this.stopChromedriverProxies();
      } else {
        yield this.suspendChromedriverProxy();
      }
    } else {
      throw new Error(`Didn't know how to handle switching to context '${name}'`);
    }
  });

  return function (_x2) {
    return _ref4.apply(this, arguments);
  };
}();

helpers.defaultContextName = function () {
  return _webviewHelpers.NATIVE_WIN;
};

helpers.defaultWebviewName = function () {
  return _webviewHelpers.WEBVIEW_BASE + this.opts.appPackage;
};

helpers.isWebContext = function () {
  return this.curContext !== null && this.curContext !== _webviewHelpers.NATIVE_WIN;
};

helpers.startChromedriverProxy = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (context) {
    _logger.default.debug(`Connecting to chrome-backed webview context '${context}'`);

    let cd;

    if (this.sessionChromedrivers[context]) {
      _logger.default.debug(`Found existing Chromedriver for context '${context}'. Using it.`);

      cd = this.sessionChromedrivers[context];
      yield setupExistingChromedriver(cd);
    } else {
      let opts = _lodash.default.cloneDeep(this.opts);

      opts.chromeUseRunningApp = true;

      if (opts.extractChromeAndroidPackageFromContextName) {
        let androidPackage = context.match(`${_webviewHelpers.WEBVIEW_BASE}(.+)`);

        if (androidPackage && androidPackage.length > 0) {
          opts.chromeAndroidPackage = androidPackage[1];
        }
      }

      cd = yield this.setupNewChromedriver(opts, this.adb.curDeviceId, this.adb);
      cd.on(_appiumChromedriver.default.EVENT_CHANGED, msg => {
        if (msg.state === _appiumChromedriver.default.STATE_STOPPED) {
          this.onChromedriverStop(context);
        }
      });
      this.sessionChromedrivers[context] = cd;
    }

    this.chromedriver = cd;
    this.proxyReqRes = this.chromedriver.proxyReq.bind(this.chromedriver);
    this.jwpProxyActive = true;
  });

  return function (_x3) {
    return _ref5.apply(this, arguments);
  };
}();

helpers.suspendChromedriverProxy = function () {
  this.chromedriver = null;
  this.proxyReqRes = null;
  this.jwpProxyActive = false;
};

helpers.onChromedriverStop = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (context) {
    _logger.default.warn(`Chromedriver for context ${context} stopped unexpectedly`);

    if (context === this.curContext) {
      let err = new Error("Chromedriver quit unexpectedly during session");
      yield this.startUnexpectedShutdown(err);
    } else {
      _logger.default.warn("Chromedriver quit unexpectedly, but it wasn't the active " + "context, ignoring");

      delete this.sessionChromedrivers[context];
    }
  });

  return function (_x4) {
    return _ref6.apply(this, arguments);
  };
}();

helpers.stopChromedriverProxies = (0, _asyncToGenerator2.default)(function* () {
  this.suspendChromedriverProxy();
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = _lodash.default.keys(this.sessionChromedrivers)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      let context = _step.value;
      let cd = this.sessionChromedrivers[context];

      _logger.default.debug(`Stopping chromedriver for context ${context}`);

      cd.removeAllListeners(_appiumChromedriver.default.EVENT_CHANGED);

      try {
        yield cd.stop();
      } catch (err) {
        _logger.default.warn(`Error stopping Chromedriver: ${err.message}`);
      }

      delete this.sessionChromedrivers[context];
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }
});

helpers.isChromedriverContext = function (viewName) {
  return _lodash.default.includes(viewName, _webviewHelpers.WEBVIEW_WIN) || viewName === _webviewHelpers.CHROMIUM_WIN;
};

helpers.shouldDismissChromeWelcome = function shouldDismissChromeWelcome() {
  return !!this.opts.chromeOptions && _lodash.default.isArray(this.opts.chromeOptions.args) && this.opts.chromeOptions.args.includes('--no-first-run');
};

helpers.dismissChromeWelcome = function () {
  var _dismissChromeWelcome = (0, _asyncToGenerator2.default)(function* () {
    _logger.default.info("Trying to dismiss Chrome welcome");

    let activity = yield this.getCurrentActivity();

    if (activity !== "org.chromium.chrome.browser.firstrun.FirstRunActivity") {
      _logger.default.info("Chrome welcome dialog never showed up! Continuing");

      return;
    }

    let el = yield this.findElOrEls('id', 'com.android.chrome:id/terms_accept', false);
    yield this.click(el.ELEMENT);

    try {
      let el = yield this.findElOrEls('id', 'com.android.chrome:id/negative_button', false);
      yield this.click(el.ELEMENT);
    } catch (e) {
      _logger.default.warn(`This device did not show Chrome SignIn dialog, ${e.message}`);
    }
  });

  return function dismissChromeWelcome() {
    return _dismissChromeWelcome.apply(this, arguments);
  };
}();

helpers.startChromeSession = function () {
  var _startChromeSession = (0, _asyncToGenerator2.default)(function* () {
    _logger.default.info("Starting a chrome-based browser session");

    let opts = _lodash.default.cloneDeep(this.opts);

    opts.chromeUseRunningApp = false;
    const knownPackages = ['org.chromium.chrome.shell', 'com.android.chrome', 'com.chrome.beta', 'org.chromium.chrome', 'org.chromium.webview_shell'];

    if (_lodash.default.includes(knownPackages, this.opts.appPackage)) {
      opts.chromeBundleId = this.opts.appPackage;
    } else {
      opts.chromeAndroidActivity = this.opts.appActivity;
    }

    this.chromedriver = yield this.setupNewChromedriver(opts, this.adb.curDeviceId, this.adb);
    this.chromedriver.on(_appiumChromedriver.default.EVENT_CHANGED, msg => {
      if (msg.state === _appiumChromedriver.default.STATE_STOPPED) {
        this.onChromedriverStop(_webviewHelpers.CHROMIUM_WIN);
      }
    });
    this.curContext = _webviewHelpers.CHROMIUM_WIN;
    this.sessionChromedrivers[_webviewHelpers.CHROMIUM_WIN] = this.chromedriver;
    this.proxyReqRes = this.chromedriver.proxyReq.bind(this.chromedriver);
    this.jwpProxyActive = true;

    if (this.shouldDismissChromeWelcome()) {
      yield this.dismissChromeWelcome();
    }
  });

  return function startChromeSession() {
    return _startChromeSession.apply(this, arguments);
  };
}();

function setupExistingChromedriver(_x5) {
  return _setupExistingChromedriver.apply(this, arguments);
}

function _setupExistingChromedriver() {
  _setupExistingChromedriver = (0, _asyncToGenerator2.default)(function* (chromedriver) {
    if (!(yield chromedriver.hasWorkingWebview())) {
      _logger.default.debug("ChromeDriver is not associated with a window. " + "Re-initializing the session.");

      yield chromedriver.restart();
    }

    return chromedriver;
  });
  return _setupExistingChromedriver.apply(this, arguments);
}

helpers.setupNewChromedriver = function () {
  var _setupNewChromedriver = (0, _asyncToGenerator2.default)(function* (opts, curDeviceId, adb) {
    if (!opts.chromeDriverPort) {
      const getPort = _bluebird.default.promisify(_portfinder.default.getPort, {
        context: _portfinder.default
      });

      opts.chromeDriverPort = yield getPort();

      _logger.default.debug(`A port was not given, using random port: ${opts.chromeDriverPort}`);
    }

    const chromedriver = new _appiumChromedriver.default({
      port: opts.chromeDriverPort,
      executable: opts.chromedriverExecutable,
      adb,
      verbose: !!opts.showChromedriverLog,
      executableDir: opts.chromedriverExecutableDir,
      mappingPath: opts.chromedriverChromeMappingFile,
      bundleId: opts.chromeBundleId,
      useSystemExecutable: opts.chromedriverUseSystemExecutable
    });
    opts.chromeOptions = opts.chromeOptions || {};
    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = _lodash.default.keys(opts)[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        const opt = _step2.value;

        if (opt.endsWith(':chromeOptions')) {
          _logger.default.warn(`Merging '${opt}' into 'chromeOptions'. This may cause unexpected behavior`);

          _lodash.default.merge(opts.chromeOptions, opts[opt]);
        }
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    let caps = {
      chromeOptions: {
        androidPackage: opts.chromeOptions.androidPackage || opts.appPackage
      }
    };

    if (opts.chromeUseRunningApp) {
      caps.chromeOptions.androidUseRunningApp = opts.chromeUseRunningApp;
    }

    if (opts.chromeAndroidPackage) {
      caps.chromeOptions.androidPackage = opts.chromeAndroidPackage;
    }

    if (opts.chromeAndroidActivity) {
      caps.chromeOptions.androidActivity = opts.chromeAndroidActivity;
    }

    if (opts.chromeAndroidProcess) {
      caps.chromeOptions.androidProcess = opts.chromeAndroidProcess;
    }

    if (opts.loggingPrefs) {
      caps.loggingPrefs = opts.loggingPrefs;
    }

    if (opts.enablePerformanceLogging) {
      _logger.default.warn(`The 'enablePerformanceLogging' cap is deprecated; simply use ` + `the 'loggingPrefs' cap instead, with a 'performance' key set to 'ALL'`);

      const newPref = {
        performance: 'ALL'
      };
      caps.loggingPrefs = caps.loggingPrefs ? Object.assign({}, caps.loggingPrefs, newPref) : newPref;
    }

    if (opts.browserName === 'chromium-webview') {
      caps.chromeOptions.androidActivity = opts.appActivity;
    }

    if (opts.pageLoadStrategy) {
      caps.pageLoadStrategy = opts.pageLoadStrategy;
    }

    caps = _webviewHelpers.default.decorateChromeOptions(caps, opts, curDeviceId);
    yield chromedriver.start(caps);
    return chromedriver;
  });

  return function setupNewChromedriver(_x6, _x7, _x8) {
    return _setupNewChromedriver.apply(this, arguments);
  };
}();

const setupNewChromedriver = helpers.setupNewChromedriver;
exports.setupNewChromedriver = setupNewChromedriver;
Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJkZWZhdWx0Q29udGV4dE5hbWUiLCJnZXRDb250ZXh0cyIsIndlYnZpZXdzIiwiaXNDaHJvbWVTZXNzaW9uIiwiQ0hST01JVU1fV0lOIiwid2Vidmlld0hlbHBlcnMiLCJnZXRXZWJ2aWV3cyIsImFkYiIsIm9wdHMiLCJhbmRyb2lkRGV2aWNlU29ja2V0IiwiY29udGV4dHMiLCJfIiwidW5pb24iLCJOQVRJVkVfV0lOIiwibG9nIiwiZGVidWciLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0Q29udGV4dCIsIm5hbWUiLCJXRUJWSUVXX1dJTiIsImRlZmF1bHRXZWJ2aWV3TmFtZSIsImluY2x1ZGVzIiwiZXJyb3JzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwic3dpdGNoQ29udGV4dCIsImlzQ2hyb21lZHJpdmVyQ29udGV4dCIsInN0YXJ0Q2hyb21lZHJpdmVyUHJveHkiLCJyZWNyZWF0ZUNocm9tZURyaXZlclNlc3Npb25zIiwic3RvcENocm9tZWRyaXZlclByb3hpZXMiLCJzdXNwZW5kQ2hyb21lZHJpdmVyUHJveHkiLCJFcnJvciIsIldFQlZJRVdfQkFTRSIsImFwcFBhY2thZ2UiLCJpc1dlYkNvbnRleHQiLCJjb250ZXh0IiwiY2QiLCJzZXNzaW9uQ2hyb21lZHJpdmVycyIsInNldHVwRXhpc3RpbmdDaHJvbWVkcml2ZXIiLCJjbG9uZURlZXAiLCJjaHJvbWVVc2VSdW5uaW5nQXBwIiwiZXh0cmFjdENocm9tZUFuZHJvaWRQYWNrYWdlRnJvbUNvbnRleHROYW1lIiwiYW5kcm9pZFBhY2thZ2UiLCJtYXRjaCIsImxlbmd0aCIsImNocm9tZUFuZHJvaWRQYWNrYWdlIiwic2V0dXBOZXdDaHJvbWVkcml2ZXIiLCJjdXJEZXZpY2VJZCIsIm9uIiwiQ2hyb21lZHJpdmVyIiwiRVZFTlRfQ0hBTkdFRCIsIm1zZyIsInN0YXRlIiwiU1RBVEVfU1RPUFBFRCIsIm9uQ2hyb21lZHJpdmVyU3RvcCIsImNocm9tZWRyaXZlciIsInByb3h5UmVxUmVzIiwicHJveHlSZXEiLCJiaW5kIiwiandwUHJveHlBY3RpdmUiLCJ3YXJuIiwiZXJyIiwic3RhcnRVbmV4cGVjdGVkU2h1dGRvd24iLCJrZXlzIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwic3RvcCIsIm1lc3NhZ2UiLCJ2aWV3TmFtZSIsInNob3VsZERpc21pc3NDaHJvbWVXZWxjb21lIiwiY2hyb21lT3B0aW9ucyIsImlzQXJyYXkiLCJhcmdzIiwiZGlzbWlzc0Nocm9tZVdlbGNvbWUiLCJpbmZvIiwiYWN0aXZpdHkiLCJnZXRDdXJyZW50QWN0aXZpdHkiLCJlbCIsImZpbmRFbE9yRWxzIiwiY2xpY2siLCJFTEVNRU5UIiwiZSIsInN0YXJ0Q2hyb21lU2Vzc2lvbiIsImtub3duUGFja2FnZXMiLCJjaHJvbWVCdW5kbGVJZCIsImNocm9tZUFuZHJvaWRBY3Rpdml0eSIsImFwcEFjdGl2aXR5IiwiaGFzV29ya2luZ1dlYnZpZXciLCJyZXN0YXJ0IiwiY2hyb21lRHJpdmVyUG9ydCIsImdldFBvcnQiLCJCIiwicHJvbWlzaWZ5IiwiUG9ydEZpbmRlciIsInBvcnQiLCJleGVjdXRhYmxlIiwiY2hyb21lZHJpdmVyRXhlY3V0YWJsZSIsInZlcmJvc2UiLCJzaG93Q2hyb21lZHJpdmVyTG9nIiwiZXhlY3V0YWJsZURpciIsImNocm9tZWRyaXZlckV4ZWN1dGFibGVEaXIiLCJtYXBwaW5nUGF0aCIsImNocm9tZWRyaXZlckNocm9tZU1hcHBpbmdGaWxlIiwiYnVuZGxlSWQiLCJ1c2VTeXN0ZW1FeGVjdXRhYmxlIiwiY2hyb21lZHJpdmVyVXNlU3lzdGVtRXhlY3V0YWJsZSIsIm9wdCIsImVuZHNXaXRoIiwibWVyZ2UiLCJjYXBzIiwiYW5kcm9pZFVzZVJ1bm5pbmdBcHAiLCJhbmRyb2lkQWN0aXZpdHkiLCJjaHJvbWVBbmRyb2lkUHJvY2VzcyIsImFuZHJvaWRQcm9jZXNzIiwibG9nZ2luZ1ByZWZzIiwiZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nIiwibmV3UHJlZiIsInBlcmZvcm1hbmNlIiwiT2JqZWN0IiwiYXNzaWduIiwiYnJvd3Nlck5hbWUiLCJwYWdlTG9hZFN0cmF0ZWd5IiwiZGVjb3JhdGVDaHJvbWVPcHRpb25zIiwic3RhcnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFJQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7QUFNQUYsUUFBUSxDQUFDRyxpQkFBVCxtQ0FBNkIsYUFBa0I7QUFHN0MsU0FBTyxLQUFLQyxVQUFMLElBQW1CLEtBQUtDLGtCQUFMLEVBQTFCO0FBQ0QsQ0FKRDtBQU1BTCxRQUFRLENBQUNNLFdBQVQsbUNBQXVCLGFBQWtCO0FBQ3ZDLE1BQUlDLFFBQUo7O0FBQ0EsTUFBSSxLQUFLQyxlQUFULEVBQTBCO0FBR3hCRCxJQUFBQSxRQUFRLEdBQUcsQ0FBQ0UsNEJBQUQsQ0FBWDtBQUNELEdBSkQsTUFJTztBQUVMRixJQUFBQSxRQUFRLFNBQVNHLHdCQUFlQyxXQUFmLENBQTJCLEtBQUtDLEdBQWhDLEVBQ2YsS0FBS0MsSUFBTCxDQUFVQyxtQkFESyxDQUFqQjtBQUVEOztBQUNELE9BQUtDLFFBQUwsR0FBZ0JDLGdCQUFFQyxLQUFGLENBQVEsQ0FBQ0MsMEJBQUQsQ0FBUixFQUFzQlgsUUFBdEIsQ0FBaEI7O0FBQ0FZLGtCQUFJQyxLQUFKLENBQVcsdUJBQXNCQyxJQUFJLENBQUNDLFNBQUwsQ0FBZSxLQUFLUCxRQUFwQixDQUE4QixFQUEvRDs7QUFDQSxTQUFPLEtBQUtBLFFBQVo7QUFDRCxDQWREOztBQWdCQWYsUUFBUSxDQUFDdUIsVUFBVDtBQUFBLDhDQUFzQixXQUFnQkMsSUFBaEIsRUFBc0I7QUFDMUMsUUFBSUEsSUFBSSxLQUFLLElB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LFdBQU9yRCxZQUFQO0FBQ0QsR0FyRUQ7O0FBQUEsa0JBQThDVCxvQkFBOUM7QUFBQTtBQUFBO0FBQUE7O0FBc0VBLE1BQU1BLG9CQUFvQixHQUFHbEQsT0FBTyxDQUFDa0Qsb0JBQXJDOztBQUVBdUUsTUFBTSxDQUFDQyxNQUFQLENBQWN6SCxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgQ2hyb21lZHJpdmVyIGZyb20gJ2FwcGl1bS1jaHJvbWVkcml2ZXInO1xuaW1wb3J0IFBvcnRGaW5kZXIgZnJvbSAncG9ydGZpbmRlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyB3ZWJ2aWV3SGVscGVycyxcbiAgICAgICAgIE5BVElWRV9XSU4sIFdFQlZJRVdfQkFTRSwgV0VCVklFV19XSU4sIENIUk9NSVVNX1dJTiB9IGZyb20gJy4uL3dlYnZpZXctaGVscGVycyc7XG5cblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEFjdHVhbCBNSlNPTldQIGNvbW1hbmQgaGFuZGxlcnNcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbmNvbW1hbmRzLmdldEN1cnJlbnRDb250ZXh0ID0gYXN5bmMgZnVuY3Rpb24gKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgLy8gaWYgdGhlIGN1cnJlbnQgY29udGV4dCBpcyBgbnVsbGAsIGluZGljYXRpbmcgbm8gY29udGV4dFxuICAvLyBleHBsaWNpdGx5IHNldCwgaXQgaXMgdGhlIGRlZmF1bHQgY29udGV4dFxuICByZXR1cm4gdGhpcy5jdXJDb250ZXh0IHx8IHRoaXMuZGVmYXVsdENvbnRleHROYW1lKCk7XG59O1xuXG5jb21tYW5kcy5nZXRDb250ZXh0cyA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHdlYnZpZXdzO1xuICBpZiAodGhpcy5pc0Nocm9tZVNlc3Npb24pIHtcbiAgICAvLyBpZiB3ZSBoYXZlIGEgQ2hyb21lIGJyb3dzZXIgc2Vzc2lvbiwgd2Ugb25seSBjYXJlIGFib3V0IHRoZSBDaHJvbWVcbiAgICAvLyBjb250ZXh0IGFuZCB0aGUgbmF0aXZlIGNvbnRleHRcbiAgICB3ZWJ2aWV3cyA9IFtDSFJPTUlVTV9XSU5dO1xuICB9IGVsc2Uge1xuICAgIC8vIG90aGVyd2lzZSB3ZSB1c2UgQURCIHRvIGZpZ3VyZSBvdXQgd2hpY2ggd2Vidmlld3MgYXJlIGF2YWlsYWJsZVxuICAgIHdlYnZpZXdzID0gYXdhaXQgd2Vidmlld0hlbHBlcnMuZ2V0V2Vidmlld3ModGhpcy5hZGIsXG4gICAgICB0aGlzLm9wdHMuYW5kcm9pZERldmljZVNvY2tldCk7XG4gIH1cbiAgdGhpcy5jb250ZXh0cyA9IF8udW5pb24oW05BVElWRV9XSU5dLCB3ZWJ2aWV3cyk7XG4gIGxvZy5kZWJ1ZyhgQXZhaWxhYmxlIGNvbnRleHRzOiAke0pTT04uc3RyaW5naWZ5KHRoaXMuY29udGV4dHMpfWApO1xuICByZXR1cm4gdGhpcy5jb250ZXh0cztcbn07XG5cbmNvbW1hbmRzLnNldENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiAobmFtZSkge1xuICBpZiAobmFtZSA9PT0gbnVsbCkge1xuICAgIG5hbWUgPSB0aGlzLmRlZmF1bHRDb250ZXh0TmFtZSgpO1xuICB9IGVsc2UgaWYgKG5hbWUgPT09IFdFQlZJRVdfV0lOKSB7XG4gICAgLy8gaGFuZGxlIHNldENvbnRleHQgXCJXRUJWSUVXXCJcbiAgICBuYW1lID0gdGhpcy5kZWZhdWx0V2Vidmlld05hbWUoKTtcbiAgfVxuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzKCk7XG4gIC8vIGlmIHRoZSBjb250ZXh0IHdlIHdhbnQgZG9lc24ndCBleGlzdCwgZmFpbFxuICBpZiAoIV8uaW5jbHVkZXMoY29udGV4dHMsIG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IoKTtcbiAgfVxuICAvLyBpZiB3ZSdyZSBhbHJlYWR5IGluIHRoZSBjb250ZXh0IHdlIHdhbnQsIGRvIG5vdGhpbmdcbiAgaWYgKG5hbWUgPT09IHRoaXMuY3VyQ29udGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF3YWl0IHRoaXMuc3dpdGNoQ29udGV4dChuYW1lKTtcbiAgdGhpcy5jdXJDb250ZXh0ID0gbmFtZTtcbn07XG5cbmhlbHBlcnMuc3dpdGNoQ29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChuYW1lKSB7XG4gIC8vIFdlIGhhdmUgc29tZSBvcHRpb25zIHdoZW4gaXQgY29tZXMgdG8gd2Vidmlld3MuIElmIHdlIHdhbnQgYVxuICAvLyBDaHJvbWVkcml2ZXIgd2Vidmlldywgd2UgY2FuIG9ubHkgY29udHJvbCBvbmUgYXQgYSB0aW1lLlxuICBpZiAodGhpcy5pc0Nocm9tZWRyaXZlckNvbnRleHQobmFtZSkpIHtcbiAgICAvLyBzdGFydCBwcm94eWluZyBjb21tYW5kcyBkaXJlY3RseSB0byBjaHJvbWVkcml2ZXJcbiAgICBhd2FpdCB0aGlzLnN0YXJ0Q2hyb21lZHJpdmVyUHJveHkobmFtZSk7XG4gIH0gZWxzZSBpZiAodGhpcy5pc0Nocm9tZWRyaXZlckNvbnRleHQodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIC8vIGlmIHdlJ3JlIG1vdmluZyB0byBhIG5vbi1jaHJvbWVkcml2ZXIgd2VidmlldywgYW5kIG91ciBjdXJyZW50IGNvbnRleHRcbiAgICAvLyBfaXNfIGEgY2hyb21lZHJpdmVyIHdlYnZpZXcsIGlmIGNhcHMgcmVjcmVhdGVDaHJvbWVEcml2ZXJTZXNzaW9ucyBpcyBzZXRcbiAgICAvLyB0byB0cnVlIHRoZW4ga2lsbCBjaHJvbWVkcml2ZXIgc2Vzc2lvbiB1c2luZyBzdG9wQ2hyb21lZHJpdmVyUHJveGllcyBvclxuICAgIC8vIGVsc2Ugc2ltcGx5IHN1c3BlbmQgcHJveHlpbmcgdG8gdGhlIGxhdHRlclxuICAgIGlmICh0aGlzLm9wdHMucmVjcmVhdGVDaHJvbWVEcml2ZXJTZXNzaW9ucykge1xuICAgICAgbG9nLmRlYnVnKFwicmVjcmVhdGVDaHJvbWVEcml2ZXJTZXNzaW9ucyBzZXQgdG8gdHJ1ZTsga2lsbGluZyBleGlzdGluZyBjaHJvbWVkcml2ZXJzXCIpO1xuICAgICAgYXdhaXQgdGhpcy5zdG9wQ2hyb21lZHJpdmVyUHJveGllcygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLnN1c3BlbmRDaHJvbWVkcml2ZXJQcm94eSgpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYERpZG4ndCBrbm93IGhvdyB0byBoYW5kbGUgc3dpdGNoaW5nIHRvIGNvbnRleHQgJyR7bmFtZX0nYCk7XG4gIH1cbn07XG5cblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBPbi1vYmplY3QgY29udGV4dC1yZWxhdGVkIGhlbHBlcnNcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG4vLyBUaGUgcmVhc29uIHRoaXMgaXMgYSBmdW5jdGlvbiBhbmQgbm90IGp1c3QgYSBjb25zdGFudCBpcyB0aGF0IGJvdGggYW5kcm9pZC1cbi8vIGRyaXZlciBhbmQgc2VsZW5kcm9pZC1kcml2ZXIgdXNlIHRoaXMgbG9naWMsIGFuZCBlYWNoIG9uZSByZXR1cm5zXG4vLyBhIGRpZmZlcmVudCBkZWZhdWx0IGNvbnRleHQgbmFtZVxuaGVscGVycy5kZWZhdWx0Q29udGV4dE5hbWUgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBOQVRJVkVfV0lOO1xufTtcblxuaGVscGVycy5kZWZhdWx0V2Vidmlld05hbWUgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBXRUJWSUVXX0JBU0UgKyB0aGlzLm9wdHMuYXBwUGFja2FnZTtcbn07XG5cbmhlbHBlcnMuaXNXZWJDb250ZXh0ID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gdGhpcy5jdXJDb250ZXh0ICE9PSBudWxsICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTjtcbn07XG5cbi8vIFR1cm4gb24gcHJveHlpbmcgdG8gYW4gZXhpc3RpbmcgQ2hyb21lZHJpdmVyIHNlc3Npb24gb3IgYSBuZXcgb25lXG5oZWxwZXJzLnN0YXJ0Q2hyb21lZHJpdmVyUHJveHkgPSBhc3luYyBmdW5jdGlvbiAoY29udGV4dCkge1xuICBsb2cuZGVidWcoYENvbm5lY3RpbmcgdG8gY2hyb21lLWJhY2tlZCB3ZWJ2aWV3IGNvbnRleHQgJyR7Y29udGV4dH0nYCk7XG5cbiAgbGV0IGNkO1xuICBpZiAodGhpcy5zZXNzaW9uQ2hyb21lZHJpdmVyc1tjb250ZXh0XSkge1xuICAgIC8vIGluIHRoZSBjYXNlIHdoZXJlIHdlJ3ZlIGFscmVhZHkgc2V0IHVwIGEgY2hyb21lZHJpdmVyIGZvciBhIGNvbnRleHQsXG4gICAgLy8gd2Ugd2FudCB0byByZWNvbm5lY3QgdG8gaXQsIG5vdCBjcmVhdGUgYSB3aG9sZSBuZXcgb25lXG4gICAgbG9nLmRlYnVnKGBGb3VuZCBleGlzdGluZyBDaHJvbWVkcml2ZXIgZm9yIGNvbnRleHQgJyR7Y29udGV4dH0nLiBVc2luZyBpdC5gKTtcbiAgICBjZCA9IHRoaXMuc2Vzc2lvbkNocm9tZWRyaXZlcnNbY29udGV4dF07XG4gICAgYXdhaXQgc2V0dXBFeGlzdGluZ0Nocm9tZWRyaXZlcihjZCk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IG9wdHMgPSBfLmNsb25lRGVlcCh0aGlzLm9wdHMpO1xuICAgIG9wdHMuY2hyb21lVXNlUnVubmluZ0FwcCA9IHRydWU7XG4gICAgaWYgKG9wdHMuZXh0cmFjdENocm9tZUFuZHJvaWRQYWNrYWdlRnJvbUNvbnRleHROYW1lKSB7XG4gICAgICBsZXQgYW5kcm9pZFBhY2thZ2UgPSBjb250ZXh0Lm1hdGNoKGAke1dFQlZJRVdfQkFTRX0oLispYCk7XG4gICAgICBpZiAoYW5kcm9pZFBhY2thZ2UgJiYgYW5kcm9pZFBhY2thZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICBvcHRzLmNocm9tZUFuZHJvaWRQYWNrYWdlID0gYW5kcm9pZFBhY2thZ2VbMV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgY2QgPSBhd2FpdCB0aGlzLnNldHVwTmV3Q2hyb21lZHJpdmVyKG9wdHMsIHRoaXMuYWRiLmN1ckRldmljZUlkLCB0aGlzLmFkYik7XG4gICAgLy8gYmluZCBvdXIgc3RvcC9leGl0IGhhbmRsZXIsIHBhc3NpbmcgaW4gY29udGV4dCBzbyB3ZSBrbm93IHdoaWNoXG4gICAgLy8gb25lIHN0b3BwZWQgdW5leHBlY3RlZGx5XG4gICAgY2Qub24oQ2hyb21lZHJpdmVyLkVWRU5UX0NIQU5HRUQsIChtc2cpID0+IHtcbiAgICAgIGlmIChtc2cuc3RhdGUgPT09IENocm9tZWRyaXZlci5TVEFURV9TVE9QUEVEKSB7XG4gICAgICAgIHRoaXMub25DaHJvbWVkcml2ZXJTdG9wKGNvbnRleHQpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIHNhdmUgdGhlIGNocm9tZWRyaXZlciBvYmplY3QgdW5kZXIgdGhlIGNvbnRleHRcbiAgICB0aGlzLnNlc3Npb25DaHJvbWVkcml2ZXJzW2NvbnRleHRdID0gY2Q7XG4gIH1cbiAgLy8gaG9vayB1cCB0aGUgbG9jYWwgdmFyaWFibGVzIHNvIHdlIGNhbiBwcm94eSB0aGlzIGJpelxuICB0aGlzLmNocm9tZWRyaXZlciA9IGNkO1xuICB0aGlzLnByb3h5UmVxUmVzID0gdGhpcy5jaHJvbWVkcml2ZXIucHJveHlSZXEuYmluZCh0aGlzLmNocm9tZWRyaXZlcik7XG4gIHRoaXMuandwUHJveHlBY3RpdmUgPSB0cnVlO1xufTtcblxuLy8gU3RvcCBwcm94eWluZyB0byBhbnkgQ2hyb21lZHJpdmVyXG5oZWxwZXJzLnN1c3BlbmRDaHJvbWVkcml2ZXJQcm94eSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5jaHJvbWVkcml2ZXIgPSBudWxsO1xuICB0aGlzLnByb3h5UmVxUmVzID0gbnVsbDtcbiAgdGhpcy5qd3BQcm94eUFjdGl2ZSA9IGZhbHNlO1xufTtcblxuLy8gSGFuZGxlIGFuIG91dC1vZi1iYW5kIENocm9tZWRyaXZlciBzdG9wIGV2ZW50XG5oZWxwZXJzLm9uQ2hyb21lZHJpdmVyU3RvcCA9IGFzeW5jIGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gIGxvZy53YXJuKGBDaHJvbWVkcml2ZXIgZm9yIGNvbnRleHQgJHtjb250ZXh0fSBzdG9wcGVkIHVuZXhwZWN0ZWRseWApO1xuICBpZiAoY29udGV4dCA9PT0gdGhpcy5jdXJDb250ZXh0KSB7XG4gICAgLy8gd2UgZXhpdGVkIHVuZXhwZWN0ZWRseSB3aGlsZSBhdXRvbWF0aW5nIHRoZSBjdXJyZW50IGNvbnRleHQgYW5kIHNvIHdhbnRcbiAgICAvLyB0byBzaHV0IGRvd24gdGhlIHNlc3Npb24gYW5kIHJlc3BvbmQgd2l0aCBhbiBlcnJvclxuICAgIGxldCBlcnIgPSBuZXcgRXJyb3IoXCJDaHJvbWVkcml2ZXIgcXVpdCB1bmV4cGVjdGVkbHkgZHVyaW5nIHNlc3Npb25cIik7XG4gICAgYXdhaXQgdGhpcy5zdGFydFVuZXhwZWN0ZWRTaHV0ZG93bihlcnIpO1xuICB9IGVsc2Uge1xuICAgIC8vIGlmIGEgQ2hyb21lZHJpdmVyIGluIHRoZSBub24tYWN0aXZlIGNvbnRleHQgYmFyZnMsIHdlIGRvbid0IHJlYWxseVxuICAgIC8vIGNhcmUsIHdlJ2xsIGp1c3QgbWFrZSBhIG5ldyBvbmUgbmV4dCB0aW1lIHdlIG5lZWQgdGhlIGNvbnRleHQuXG4gICAgbG9nLndhcm4oXCJDaHJvbWVkcml2ZXIgcXVpdCB1bmV4cGVjdGVkbHksIGJ1dCBpdCB3YXNuJ3QgdGhlIGFjdGl2ZSBcIiArXG4gICAgICAgICAgICAgICAgXCJjb250ZXh0LCBpZ25vcmluZ1wiKTtcbiAgICBkZWxldGUgdGhpcy5zZXNzaW9uQ2hyb21lZHJpdmVyc1tjb250ZXh0XTtcbiAgfVxufTtcblxuLy8gSW50ZW50aW9uYWxseSBzdG9wIGFsbCB0aGUgY2hyb21lZHJpdmVycyBjdXJyZW50bHkgYWN0aXZlLCBhbmQgaWdub3JlXG4vLyB0aGVpciBleGl0IGV2ZW50c1xuaGVscGVycy5zdG9wQ2hyb21lZHJpdmVyUHJveGllcyA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5zdXNwZW5kQ2hyb21lZHJpdmVyUHJveHkoKTsgLy8gbWFrZSBzdXJlIHdlIHR1cm4gb2ZmIHRoZSBwcm94eSBmbGFnXG4gIGZvciAobGV0IGNvbnRleHQgb2YgXy5rZXlzKHRoaXMuc2Vzc2lvbkNocm9tZWRyaXZlcnMpKSB7XG4gICAgbGV0IGNkID0gdGhpcy5zZXNzaW9uQ2hyb21lZHJpdmVyc1tjb250ZXh0XTtcbiAgICBsb2cuZGVidWcoYFN0b3BwaW5nIGNocm9tZWRyaXZlciBmb3IgY29udGV4dCAke2NvbnRleHR9YCk7XG4gICAgLy8gc3RvcCBsaXN0ZW5pbmcgZm9yIHRoZSBzdG9wcGVkIHN0YXRlIGV2ZW50XG4gICAgY2QucmVtb3ZlQWxsTGlzdGVuZXJzKENocm9tZWRyaXZlci5FVkVOVF9DSEFOR0VEKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgY2Quc3RvcCgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYEVycm9yIHN0b3BwaW5nIENocm9tZWRyaXZlcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMuc2Vzc2lvbkNocm9tZWRyaXZlcnNbY29udGV4dF07XG4gIH1cbn07XG5cbmhlbHBlcnMuaXNDaHJvbWVkcml2ZXJDb250ZXh0ID0gZnVuY3Rpb24gKHZpZXdOYW1lKSB7XG4gIHJldHVybiBfLmluY2x1ZGVzKHZpZXdOYW1lLCBXRUJWSUVXX1dJTikgfHwgdmlld05hbWUgPT09IENIUk9NSVVNX1dJTjtcbn07XG5cbmhlbHBlcnMuc2hvdWxkRGlzbWlzc0Nocm9tZVdlbGNvbWUgPSBmdW5jdGlvbiBzaG91bGREaXNtaXNzQ2hyb21lV2VsY29tZSAoKSB7XG4gIHJldHVybiAhIXRoaXMub3B0cy5jaHJvbWVPcHRpb25zICYmXG4gICAgICAgICBfLmlzQXJyYXkodGhpcy5vcHRzLmNocm9tZU9wdGlvbnMuYXJncykgJiZcbiAgICAgICAgIHRoaXMub3B0cy5jaHJvbWVPcHRpb25zLmFyZ3MuaW5jbHVkZXMoJy0tbm8tZmlyc3QtcnVuJyk7XG59O1xuXG5oZWxwZXJzLmRpc21pc3NDaHJvbWVXZWxjb21lID0gYXN5bmMgZnVuY3Rpb24gZGlzbWlzc0Nocm9tZVdlbGNvbWUgKCkge1xuICBsb2cuaW5mbyhcIlRyeWluZyB0byBkaXNtaXNzIENocm9tZSB3ZWxjb21lXCIpO1xuICBsZXQgYWN0aXZpdHkgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRBY3Rpdml0eSgpO1xuICBpZiAoYWN0aXZpdHkgIT09IFwib3JnLmNocm9taXVtLmNocm9tZS5icm93c2VyLmZpcnN0cnVuLkZpcnN0UnVuQWN0aXZpdHlcIikge1xuICAgIGxvZy5pbmZvKFwiQ2hyb21lIHdlbGNvbWUgZGlhbG9nIG5ldmVyIHNob3dlZCB1cCEgQ29udGludWluZ1wiKTtcbiAgICByZXR1cm47XG4gIH1cbiAgbGV0IGVsID0gYXdhaXQgdGhpcy5maW5kRWxPckVscygnaWQnLCAnY29tLmFuZHJvaWQuY2hyb21lOmlkL3Rlcm1zX2FjY2VwdCcsIGZhbHNlKTtcbiAgYXdhaXQgdGhpcy5jbGljayhlbC5FTEVNRU5UKTtcbiAgdHJ5IHtcbiAgICBsZXQgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbE9yRWxzKCdpZCcsICdjb20uYW5kcm9pZC5jaHJvbWU6aWQvbmVnYXRpdmVfYnV0dG9uJywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuY2xpY2soZWwuRUxFTUVOVCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBETyBOT1RISU5HLCBUSElTIERFVklDRSBESUROVCBMQVVOQ0ggVEhFIFNJR05JTiBESUFMT0dcbiAgICAvLyBJVCBNVVNUIEJFIEEgTk9OIEdNUyBERVZJQ0VcbiAgICBsb2cud2FybihgVGhpcyBkZXZpY2UgZGlkIG5vdCBzaG93IENocm9tZSBTaWduSW4gZGlhbG9nLCAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuaGVscGVycy5zdGFydENocm9tZVNlc3Npb24gPSBhc3luYyBmdW5jdGlvbiBzdGFydENocm9tZVNlc3Npb24gKCkge1xuICBsb2cuaW5mbyhcIlN0YXJ0aW5nIGEgY2hyb21lLWJhc2VkIGJyb3dzZXIgc2Vzc2lvblwiKTtcbiAgbGV0IG9wdHMgPSBfLmNsb25lRGVlcCh0aGlzLm9wdHMpO1xuICBvcHRzLmNocm9tZVVzZVJ1bm5pbmdBcHAgPSBmYWxzZTtcblxuICBjb25zdCBrbm93blBhY2thZ2VzID0gW1xuICAgICdvcmcuY2hyb21pdW0uY2hyb21lLnNoZWxsJyxcbiAgICAnY29tLmFuZHJvaWQuY2hyb21lJyxcbiAgICAnY29tLmNocm9tZS5iZXRhJyxcbiAgICAnb3JnLmNocm9taXVtLmNocm9tZScsXG4gICAgJ29yZy5jaHJvbWl1bS53ZWJ2aWV3X3NoZWxsJyxcbiAgXTtcblxuICBpZiAoXy5pbmNsdWRlcyhrbm93blBhY2thZ2VzLCB0aGlzLm9wdHMuYXBwUGFja2FnZSkpIHtcbiAgICBvcHRzLmNocm9tZUJ1bmRsZUlkID0gdGhpcy5vcHRzLmFwcFBhY2thZ2U7XG4gIH0gZWxzZSB7XG4gICAgb3B0cy5jaHJvbWVBbmRyb2lkQWN0aXZpdHkgPSB0aGlzLm9wdHMuYXBwQWN0aXZpdHk7XG4gIH1cbiAgdGhpcy5jaHJvbWVkcml2ZXIgPSBhd2FpdCB0aGlzLnNldHVwTmV3Q2hyb21lZHJpdmVyKG9wdHMsIHRoaXMuYWRiLmN1ckRldmljZUlkLCB0aGlzLmFkYik7XG4gIHRoaXMuY2hyb21lZHJpdmVyLm9uKENocm9tZWRyaXZlci5FVkVOVF9DSEFOR0VELCAobXNnKSA9PiB7XG4gICAgaWYgKG1zZy5zdGF0ZSA9PT0gQ2hyb21lZHJpdmVyLlNUQVRFX1NUT1BQRUQpIHtcbiAgICAgIHRoaXMub25DaHJvbWVkcml2ZXJTdG9wKENIUk9NSVVNX1dJTik7XG4gICAgfVxuICB9KTtcblxuICAvLyBOb3cgdGhhdCB3ZSBoYXZlIGEgQ2hyb21lIHNlc3Npb24sIHdlIGVuc3VyZSB0aGF0IHRoZSBjb250ZXh0IGlzXG4gIC8vIGFwcHJvcHJpYXRlbHkgc2V0IGFuZCB0aGF0IHRoaXMgY2hyb21lZHJpdmVyIGlzIGFkZGVkIHRvIHRoZSBsaXN0XG4gIC8vIG9mIHNlc3Npb24gY2hyb21lZHJpdmVycyBzbyB3ZSBjYW4gc3dpdGNoIGJhY2sgYW5kIGZvcnRoXG4gIHRoaXMuY3VyQ29udGV4dCA9IENIUk9NSVVNX1dJTjtcbiAgdGhpcy5zZXNzaW9uQ2hyb21lZHJpdmVyc1tDSFJPTUlVTV9XSU5dID0gdGhpcy5jaHJvbWVkcml2ZXI7XG4gIHRoaXMucHJveHlSZXFSZXMgPSB0aGlzLmNocm9tZWRyaXZlci5wcm94eVJlcS5iaW5kKHRoaXMuY2hyb21lZHJpdmVyKTtcbiAgdGhpcy5qd3BQcm94eUFjdGl2ZSA9IHRydWU7XG5cbiAgaWYgKHRoaXMuc2hvdWxkRGlzbWlzc0Nocm9tZVdlbGNvbWUoKSkge1xuICAgIC8vIGRpc21pc3MgQ2hyb21lIHdlbGNvbWUgZGlhbG9nXG4gICAgYXdhaXQgdGhpcy5kaXNtaXNzQ2hyb21lV2VsY29tZSgpO1xuICB9XG59O1xuXG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBJbnRlcm5hbCBsaWJyYXJ5IGZ1bmN0aW9uc1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXN5bmMgZnVuY3Rpb24gc2V0dXBFeGlzdGluZ0Nocm9tZWRyaXZlciAoY2hyb21lZHJpdmVyKSB7XG4gIC8vIGNoZWNrIHRoZSBzdGF0dXMgYnkgc2VuZGluZyBhIHNpbXBsZSB3aW5kb3ctYmFzZWQgY29tbWFuZCB0byBDaHJvbWVEcml2ZXJcbiAgLy8gaWYgdGhlcmUgaXMgYW4gZXJyb3IsIHdlIHdhbnQgdG8gcmVjcmVhdGUgdGhlIENocm9tZURyaXZlciBzZXNzaW9uXG4gIGlmICghYXdhaXQgY2hyb21lZHJpdmVyLmhhc1dvcmtpbmdXZWJ2aWV3KCkpIHtcbiAgICBsb2cuZGVidWcoXCJDaHJvbWVEcml2ZXIgaXMgbm90IGFzc29jaWF0ZWQgd2l0aCBhIHdpbmRvdy4gXCIgK1xuICAgICAgICAgICAgICAgICBcIlJlLWluaXRpYWxpemluZyB0aGUgc2Vzc2lvbi5cIik7XG4gICAgYXdhaXQgY2hyb21lZHJpdmVyLnJlc3RhcnQoKTtcbiAgfVxuICByZXR1cm4gY2hyb21lZHJpdmVyO1xufVxuXG5oZWxwZXJzLnNldHVwTmV3Q2hyb21lZHJpdmVyID0gYXN5bmMgZnVuY3Rpb24gc2V0dXBOZXdDaHJvbWVkcml2ZXIgKG9wdHMsIGN1ckRldmljZUlkLCBhZGIpIHtcbiAgLy8gaWYgYSBwb3J0IHdhc24ndCBnaXZlbiwgcGljayBhIHJhbmRvbSBhdmFpbGFibGUgb25lXG4gIGlmICghb3B0cy5jaHJvbWVEcml2ZXJQb3J0KSB7XG4gICAgY29uc3QgZ2V0UG9ydCA9IEIucHJvbWlzaWZ5KFBvcnRGaW5kZXIuZ2V0UG9ydCwge2NvbnRleHQ6IFBvcnRGaW5kZXJ9KTtcbiAgICBvcHRzLmNocm9tZURyaXZlclBvcnQgPSBhd2FpdCBnZXRQb3J0KCk7XG4gICAgbG9nLmRlYnVnKGBBIHBvcnQgd2FzIG5vdCBnaXZlbiwgdXNpbmcgcmFuZG9tIHBvcnQ6ICR7b3B0cy5jaHJvbWVEcml2ZXJQb3J0fWApO1xuICB9XG5cbiAgY29uc3QgY2hyb21lZHJpdmVyID0gbmV3IENocm9tZWRyaXZlcih7XG4gICAgcG9ydDogb3B0cy5jaHJvbWVEcml2ZXJQb3J0LFxuICAgIGV4ZWN1dGFibGU6IG9wdHMuY2hyb21lZHJpdmVyRXhlY3V0YWJsZSxcbiAgICBhZGIsXG4gICAgdmVyYm9zZTogISFvcHRzLnNob3dDaHJvbWVkcml2ZXJMb2csXG4gICAgZXhlY3V0YWJsZURpcjogb3B0cy5jaHJvbWVkcml2ZXJFeGVjdXRhYmxlRGlyLFxuICAgIG1hcHBpbmdQYXRoOiBvcHRzLmNocm9tZWRyaXZlckNocm9tZU1hcHBpbmdGaWxlLFxuICAgIGJ1bmRsZUlkOiBvcHRzLmNocm9tZUJ1bmRsZUlkLFxuICAgIHVzZVN5c3RlbUV4ZWN1dGFibGU6IG9wdHMuY2hyb21lZHJpdmVyVXNlU3lzdGVtRXhlY3V0YWJsZSxcbiAgfSk7XG5cbiAgLy8gbWFrZSBzdXJlIHRoZXJlIGFyZSBjaHJvbWVPcHRpb25zXG4gIG9wdHMuY2hyb21lT3B0aW9ucyA9IG9wdHMuY2hyb21lT3B0aW9ucyB8fCB7fTtcbiAgLy8gdHJ5IG91dCBhbnkgcHJlZml4ZWQgY2hyb21lT3B0aW9ucyxcbiAgLy8gYW5kIHN0cmlwIHRoZSBwcmVmaXhcbiAgZm9yIChjb25zdCBvcHQgb2YgXy5rZXlzKG9wdHMpKSB7XG4gICAgaWYgKG9wdC5lbmRzV2l0aCgnOmNocm9tZU9wdGlvbnMnKSkge1xuICAgICAgbG9nLndhcm4oYE1lcmdpbmcgJyR7b3B0fScgaW50byAnY2hyb21lT3B0aW9ucycuIFRoaXMgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3JgKTtcbiAgICAgIF8ubWVyZ2Uob3B0cy5jaHJvbWVPcHRpb25zLCBvcHRzW29wdF0pO1xuICAgIH1cbiAgfVxuXG4gIGxldCBjYXBzID0ge1xuICAgIGNocm9tZU9wdGlvbnM6IHtcbiAgICAgIGFuZHJvaWRQYWNrYWdlOiBvcHRzLmNocm9tZU9wdGlvbnMuYW5kcm9pZFBhY2thZ2UgfHwgb3B0cy5hcHBQYWNrYWdlLFxuICAgIH1cbiAgfTtcbiAgaWYgKG9wdHMuY2hyb21lVXNlUnVubmluZ0FwcCkge1xuICAgIGNhcHMuY2hyb21lT3B0aW9ucy5hbmRyb2lkVXNlUnVubmluZ0FwcCA9IG9wdHMuY2hyb21lVXNlUnVubmluZ0FwcDtcbiAgfVxuICBpZiAob3B0cy5jaHJvbWVBbmRyb2lkUGFja2FnZSkge1xuICAgIGNhcHMuY2hyb21lT3B0aW9ucy5hbmRyb2lkUGFja2FnZSA9IG9wdHMuY2hyb21lQW5kcm9pZFBhY2thZ2U7XG4gIH1cbiAgaWYgKG9wdHMuY2hyb21lQW5kcm9pZEFjdGl2aXR5KSB7XG4gICAgY2Fwcy5jaHJvbWVPcHRpb25zLmFuZHJvaWRBY3Rpdml0eSA9IG9wdHMuY2hyb21lQW5kcm9pZEFjdGl2aXR5O1xuICB9XG4gIGlmIChvcHRzLmNocm9tZUFuZHJvaWRQcm9jZXNzKSB7XG4gICAgY2Fwcy5jaHJvbWVPcHRpb25zLmFuZHJvaWRQcm9jZXNzID0gb3B0cy5jaHJvbWVBbmRyb2lkUHJvY2VzcztcbiAgfVxuICBpZiAob3B0cy5sb2dnaW5nUHJlZnMpIHtcbiAgICBjYXBzLmxvZ2dpbmdQcmVmcyA9IG9wdHMubG9nZ2luZ1ByZWZzO1xuICB9XG4gIGlmIChvcHRzLmVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZykge1xuICAgIGxvZy53YXJuKGBUaGUgJ2VuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZycgY2FwIGlzIGRlcHJlY2F0ZWQ7IHNpbXBseSB1c2UgYCArXG4gICAgICAgICAgICAgYHRoZSAnbG9nZ2luZ1ByZWZzJyBjYXAgaW5zdGVhZCwgd2l0aCBhICdwZXJmb3JtYW5jZScga2V5IHNldCB0byAnQUxMJ2ApO1xuICAgIGNvbnN0IG5ld1ByZWYgPSB7cGVyZm9ybWFuY2U6ICdBTEwnfTtcblxuICAgIC8vIGRvbid0IG92ZXJ3cml0ZSBvdGhlciBsb2dnaW5nIHByZWZzIHRoYXQgaGF2ZSBiZWVuIHNlbnQgaW4gaWYgdGhleSBleGlzdFxuICAgIGNhcHMubG9nZ2luZ1ByZWZzID0gY2Fwcy5sb2dnaW5nUHJlZnMgP1xuICAgICAgT2JqZWN0LmFzc2lnbih7fSwgY2Fwcy5sb2dnaW5nUHJlZnMsIG5ld1ByZWYpIDpcbiAgICAgIG5ld1ByZWY7XG4gIH1cbiAgaWYgKG9wdHMuYnJvd3Nlck5hbWUgPT09ICdjaHJvbWl1bS13ZWJ2aWV3Jykge1xuICAgIGNhcHMuY2hyb21lT3B0aW9ucy5hbmRyb2lkQWN0aXZpdHkgPSBvcHRzLmFwcEFjdGl2aXR5O1xuICB9XG4gIGlmIChvcHRzLnBhZ2VMb2FkU3RyYXRlZ3kpIHtcbiAgICBjYXBzLnBhZ2VMb2FkU3RyYXRlZ3kgPSBvcHRzLnBhZ2VMb2FkU3RyYXRlZ3k7XG4gIH1cbiAgY2FwcyA9IHdlYnZpZXdIZWxwZXJzLmRlY29yYXRlQ2hyb21lT3B0aW9ucyhjYXBzLCBvcHRzLCBjdXJEZXZpY2VJZCk7XG4gIGF3YWl0IGNocm9tZWRyaXZlci5zdGFydChjYXBzKTtcbiAgcmV0dXJuIGNocm9tZWRyaXZlcjtcbn07XG5jb25zdCBzZXR1cE5ld0Nocm9tZWRyaXZlciA9IGhlbHBlcnMuc2V0dXBOZXdDaHJvbWVkcml2ZXI7XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMsIHNldHVwTmV3Q2hyb21lZHJpdmVyIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
