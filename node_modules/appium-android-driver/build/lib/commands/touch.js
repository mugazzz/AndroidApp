"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumBaseDriver = require("appium-base-driver");

var _asyncbox = require("asyncbox");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.doTouchAction = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (action, opts) {
    switch (action) {
      case 'tap':
        return yield this.tap(opts.element, opts.x, opts.y, opts.count);

      case 'press':
        return yield this.touchDown(opts.element, opts.x, opts.y);

      case 'release':
        return yield this.touchUp(opts.element, opts.x, opts.y);

      case 'moveTo':
        return yield this.touchMove(opts.element, opts.x, opts.y);

      case 'wait':
        return yield _bluebird.default.delay(opts.ms);

      case 'longPress':
        if (typeof opts.duration === 'undefined' || !opts.duration) {
          opts.duration = 1000;
        }

        return yield this.touchLongClick(opts.element, opts.x, opts.y, opts.duration);

      case 'cancel':
        _logger.default.warn("Cancel action currently has no effect");

        break;

      default:
        _logger.default.errorAndThrow(`unknown action ${action}`);

    }
  });

  return function (_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

helpers.doTouchDrag = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (gestures) {
    let longPress = gestures[0];
    let moveTo = gestures[1];
    let startX = longPress.options.x || 0,
        startY = longPress.options.y || 0,
        endX = moveTo.options.x || 0,
        endY = moveTo.options.y || 0;

    if (longPress.options.element) {
      let _ref3 = yield this.getLocationInView(longPress.options.element),
          x = _ref3.x,
          y = _ref3.y;

      startX += x || 0;
      startY += y || 0;
    }

    if (moveTo.options.element) {
      let _ref4 = yield this.getLocationInView(moveTo.options.element),
          x = _ref4.x,
          y = _ref4.y;

      endX += x || 0;
      endY += y || 0;
    }

    let apiLevel = yield this.adb.getApiLevel();
    let duration = apiLevel >= 5 ? 2 : 1;

    if (longPress.options && longPress.options.duration) {
      duration = Math.max(longPress.options.duration / 1000, duration);
    }

    return yield this.drag(startX, startY, endX, endY, duration, 1, longPress.options.element, moveTo.options.element);
  });

  return function (_x3) {
    return _ref2.apply(this, arguments);
  };
}();

helpers.fixRelease = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (gestures) {
    let release = _lodash.default.last(gestures);

    release.options = release.options || {};

    if (release.options.element || release.options.x && release.options.y) {
      return;
    }

    gestures = _lodash.default.clone(gestures);
    let ref = null;
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = gestures.reverse()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let gesture = _step.value;
        let opts = gesture.options;

        if (opts.element || opts.x && opts.y) {
          ref = gesture;
          break;
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    if (ref) {
      let opts = ref.options;

      if (opts.element) {
        let loc = yield this.getLocationInView(opts.element);

        if (opts.x && opts.y) {
          release.options = {
            x: loc.x + opts.x,
            y: loc.y + opts.y
          };
        } else {
          let size = yield this.getSize(opts.element);
          release.options = {
            x: loc.x + size.width / 2,
            y: loc.y + size.height / 2
          };
        }
      } else {
        release.options = _lodash.default.pick(opts, 'x', 'y');
      }
    }

    return release;
  });

  return function (_x4) {
    return _ref5.apply(this, arguments);
  };
}();

helpers.performGesture = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (gesture) {
    try {
      return yield this.doTouchAction(gesture.action, gesture.options || {});
    } catch (e) {
      if ((0, _appiumBaseDriver.isErrorType)(e, _appiumBaseDriver.errors.NoSuchElementError) && gesture.action === 'release' && gesture.options.element) {
        delete gesture.options.element;

        _logger.default.debug(`retrying release without element opts: ${gesture.options}.`);

        return yield this.doTouchAction(gesture.action, gesture.options || {});
      }

      throw e;
    }
  });

  return function (_x5) {
    return _ref6.apply(this, arguments);
  };
}();

commands.performTouch = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (gestures) {
    if (this.isWebContext()) {
      throw new _appiumBaseDriver.errors.NotYetImplementedError();
    }

    if (gestures.length === 4 && gestures[0].action === 'press' && gestures[1].action === 'wait' && gestures[2].action === 'moveTo' && gestures[3].action === 'release') {
      let swipeOpts = yield this.getSwipeOptions(gestures);
      return yield this.swipe(swipeOpts.startX, swipeOpts.startY, swipeOpts.endX, swipeOpts.endY, swipeOpts.duration, swipeOpts.touchCount, swipeOpts.element);
    }

    let actions = _lodash.default.map(gestures, "action");

    if (actions[0] === 'longPress' && actions[1] === 'moveTo' && actions[2] === 'release') {
      return yield this.doTouchDrag(gestures);
    } else {
      if (actions.length === 2) {
        if (_lodash.default.head(actions) === 'press' && _lodash.default.last(actions) === 'release') {
          actions[0] = 'tap';
          gestures[0].action = 'tap';
        }

        if ((_lodash.default.head(actions) === 'tap' || _lodash.default.head(actions) === 'longPress') && _lodash.default.last(actions) === 'release') {
          gestures.pop();
          actions.pop();
        }
      } else {
        if (actions[0] === 'longPress') {
          actions = ['press', 'wait', ...actions.slice(1)];
          let press = gestures.shift();
          press.action = 'press';
          let wait = {
            action: 'wait',
            options: {
              ms: press.options.duration || 1000
            }
          };
          delete press.options.duration;
          gestures = [press, wait, ...gestures];
        }
      }

      let fixedGestures = yield this.parseTouch(gestures, false);

      if (actions[actions.length - 1] === 'release') {
        actions[actions.length - 1] = yield this.fixRelease(gestures);
      }

      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        for (var _iterator2 = fixedGestures[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          let g = _step2.value;
          yield this.performGesture(g);
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
            _iterator2.return();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }
    }
  });

  return function (_x6) {
    return _ref7.apply(this, arguments);
  };
}();

helpers.parseTouch = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (gestures, multi) {
    var _this = this;

    if (multi && _lodash.default.last(gestures).action === 'release') {
      gestures.pop();
    }

    let touchStateObjects = yield (0, _asyncbox.asyncmap)(gestures, function () {
      var _ref9 = (0, _asyncToGenerator2.default)(function* (gesture) {
        let options = gesture.options || {};

        if (_lodash.default.includes(['press', 'moveTo', 'tap', 'longPress'], gesture.action)) {
          options.offset = false;
          let elementId = gesture.options.element;

          if (elementId) {
            let pos = yield _this.getLocationInView(elementId);

            if (gesture.options.x || gesture.options.y) {
              options.x = pos.x + (gesture.options.x || 0);
              options.y = pos.y + (gesture.options.y || 0);
            } else {
              const _ref10 = yield _this.getSize(elementId),
                    width = _ref10.width,
                    height = _ref10.height;

              options.x = pos.x + width / 2;
              options.y = pos.y + height / 2;
            }

            let touchStateObject = {
              action: gesture.action,
              options,
              timeOffset: 0.005
            };
            return touchStateObject;
          } else {
            options.x = gesture.options.x || 0;
            options.y = gesture.options.y || 0;
            let touchStateObject = {
              action: gesture.action,
              options,
              timeOffset: 0.005
            };
            return touchStateObject;
          }
        } else {
          let offset = 0.005;

          if (gesture.action === 'wait') {
            options = gesture.options;
            offset = parseInt(gesture.options.ms, 10) / 1000;
          }

          let touchStateObject = {
            action: gesture.action,
            options,
            timeOffset: offset
          };
          return touchStateObject;
        }
      });

      return function (_x9) {
        return _ref9.apply(this, arguments);
      };
    }(), false);
    let prevPos = null,
        time = 0;
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = touchStateObjects[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        let state = _step3.value;

        if (_lodash.default.isUndefined(state.options.x) && _lodash.default.isUndefined(state.options.y) && prevPos !== null) {
          state.options.x = prevPos.x;
          state.options.y = prevPos.y;
        }

        if (state.options.offset && prevPos) {
          state.options.x += prevPos.x;
          state.options.y += prevPos.y;
        }

        delete state.options.offset;

        if (!_lodash.default.isUndefined(state.options.x) && !_lodash.default.isUndefined(state.options.y)) {
          prevPos = state.options;
        }

        if (multi) {
          let timeOffset = state.timeOffset;
          time += timeOffset;
          state.time = _androidHelpers.default.truncateDecimals(time, 3);

          if (!_lodash.default.isUndefined(state.options.x) && !_lodash.default.isUndefined(state.options.y)) {
            state.touch = {
              x: state.options.x,
              y: state.options.y
            };
          }

          delete state.options;
        }

        delete state.timeOffset;
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    return touchStateObjects;
  });

  return function (_x7, _x8) {
    return _ref8.apply(this, arguments);
  };
}();

commands.performMultiAction = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (actions, elementId) {
    var _this2 = this;

    if (this.isWebContext()) {
      throw new _appiumBaseDriver.errors.NotYetImplementedError();
    }

    if (actions.length === 1) {
      throw new Error("Multi Pointer Gestures need at least two actions. " + "Use Touch Actions for a single action.");
    }

    let states = yield (0, _asyncbox.asyncmap)(actions, function () {
      var _ref12 = (0, _asyncToGenerator2.default)(function* (action) {
        return yield _this2.parseTouch(action, true);
      });

      return function (_x12) {
        return _ref12.apply(this, arguments);
      };
    }(), false);
    return yield this.doPerformMultiAction(elementId, states);
  });

  return function (_x10, _x11) {
    return _ref11.apply(this, arguments);
  };
}();

commands.doPerformMultiAction = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (elementId, states) {
    let opts;

    if (elementId) {
      opts = {
        elementId,
        actions: states
      };
      return yield this.bootstrap.sendAction("element:performMultiPointerGesture", opts);
    } else {
      opts = {
        actions: states
      };
      return yield this.bootstrap.sendAction("performMultiPointerGesture", opts);
    }
  });

  return function (_x13, _x14) {
    return _ref13.apply(this, arguments);
  };
}();

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy90b3VjaC5qcyJdLCJuYW1lcyI6WyJjb21tYW5kcyIsImhlbHBlcnMiLCJleHRlbnNpb25zIiwiZG9Ub3VjaEFjdGlvbiIsImFjdGlvbiIsIm9wdHMiLCJ0YXAiLCJlbGVtZW50IiwieCIsInkiLCJjb3VudCIsInRvdWNoRG93biIsInRvdWNoVXAiLCJ0b3VjaE1vdmUiLCJCIiwiZGVsYXkiLCJtcyIsImR1cmF0aW9uIiwidG91Y2hMb25nQ2xpY2siLCJsb2ciLCJ3YXJuIiwiZXJyb3JBbmRUaHJvdyIsImRvVG91Y2hEcmFnIiwiZ2VzdHVyZXMiLCJsb25nUHJlc3MiLCJtb3ZlVG8iLCJzdGFydFgiLCJvcHRpb25zIiwic3RhcnRZIiwiZW5kWCIsImVuZFkiLCJnZXRMb2NhdGlvbkluVmlldyIsImFwaUxldmVsIiwiYWRiIiwiZ2V0QXBpTGV2ZWwiLCJNYXRoIiwibWF4IiwiZHJhZyIsImZpeFJlbGVhc2UiLCJyZWxlYXNlIiwiXyIsImxhc3QiLCJjbG9uZSIsInJlZiIsInJldmVyc2UiLCJnZXN0dXJlIiwibG9jIiwic2l6ZSIsImdldFNpemUiLCJ3aWR0aCIsImhlaWdodCIsInBpY2siLCJwZXJmb3JtR2VzdHVyZSIsImUiLCJlcnJvcnMiLCJOb1N1Y2hFbGVtZW50RXJyb3IiLCJkZWJ1ZyIsInBlcmZvcm1Ub3VjaCIsImlzV2ViQ29udGV4dCIsIk5vdFlldEltcGxlbWVudGVkRXJyb3IiLCJsZW5ndGgiLCJzd2lwZU9wdHMiLCJnZXRTd2lwZU9wdGlvbnMiLCJzd2lwZSIsInRvdWNoQ291bnQiLCJhY3Rpb25zIiwibWFwIiwiaGVhZCIsInBvcCIsInNsaWNlIiwicHJlc3MiLCJzaGlmdCIsIndhaXQiLCJmaXhlZEdlc3R1cmVzIiwicGFyc2VUb3VjaCIsImciLCJtdWx0aSIsInRvdWNoU3RhdGVPYmplY3RzIiwiaW5jbHVkZXMiLCJvZmZzZXQiLCJlbGVtZW50SWQiLCJwb3MiLCJ0b3VjaFN0YXRlT2JqZWN0IiwidGltZU9mZnNldCIsInBhcnNlSW50IiwicHJldlBvcyIsInRpbWUiLCJzdGF0ZSIsImlzVW5kZWZpbmVkIiwiYW5kcm9pZEhlbHBlcnMiLCJ0cnVuY2F0ZURlY2ltYWxzIiwidG91Y2giLCJwZXJmb3JtTXVsdGlBY3Rpb24iLCJFcnJvciIsInN0YXRlcyIsImRvUGVyZm9ybU11bHRpQWN0aW9uIiwiYm9vdHN0cmFwIiwic2VuZEFjdGlvbiIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7O0FBRUFGLFFBQVEsQ0FBQ0csYUFBVDtBQUFBLDZDQUF5QixXQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCO0FBQ3JELFlBQVFELE1BQVI7QUFDRSxXQUFLLEtBQUw7QUFDRSxxQkFBYSxLQUFLRSxHQUFMLENBQVNELElBQUksQ0FBQ0UsT0FBZCxFQUF1QkYsSUFBSSxDQUFDRyxDQUE1QixFQUErQkgsSUFBSSxDQUFDSSxDQUFwQyxFQUF1Q0osSUFBSSxDQUFDSyxLQUE1QyxDQUFiOztBQUNGLFdBQUssT0FBTDtBQUNFLHFCQUFhLEtBQUtDLFNBQUwsQ0FBZU4sSUFBSSxDQUFDRSxPQUFwQixFQUE2QkYsSUFBSSxDQUFDRyxDQUFsQyxFQUFxQ0gsSUFBSSxDQUFDSSxDQUExQyxDQUFiOztBQUNGLFdBQUssU0FBTDtBQUNFLHFCQUFhLEtBQUtHLE9BQUwsQ0FBYVAsSUFBSSxDQUFDRSxPQUFsQixFQUEyQkYsSUFBSSxDQUFDRyxDQUFoQyxFQUFtQ0gsSUFBSSxDQUFDSSxDQUF4QyxDQUFiOztBQUNGLFdBQUssUUFBTDtBQUNFLHFCQUFhLEtBQUtJLFNBQUwsQ0FBZVIsSUFBSSxDQUFDRSxPQUFwQixFQUE2QkYsSUFBSSxDQUFDRyxDQUFsQyxFQUFxQ0gsSUFBSSxDQUFDSSxDQUEx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LG1CQUFhLEtBQUtFLFNBQUwsQ0FBZUMsVUFBZixDQUEwQiw0QkFBMUIsRUFBd0Q1RixJQUF4RCxDQUFiO0FBQ0Q7QUFDRixHQWREOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWdCQTZGLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjakcsVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBRWVDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGFuZHJvaWRIZWxwZXJzIGZyb20gJy4uL2FuZHJvaWQtaGVscGVycyc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBlcnJvcnMsIGlzRXJyb3JUeXBlIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IGFzeW5jbWFwIH0gZnJvbSAnYXN5bmNib3gnO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmRvVG91Y2hBY3Rpb24gPSBhc3luYyBmdW5jdGlvbiAoYWN0aW9uLCBvcHRzKSB7XG4gIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgY2FzZSAndGFwJzpcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnRhcChvcHRzLmVsZW1lbnQsIG9wdHMueCwgb3B0cy55LCBvcHRzLmNvdW50KTtcbiAgICBjYXNlICdwcmVzcyc6XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50b3VjaERvd24ob3B0cy5lbGVtZW50LCBvcHRzLngsIG9wdHMueSk7XG4gICAgY2FzZSAncmVsZWFzZSc6XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50b3VjaFVwKG9wdHMuZWxlbWVudCwgb3B0cy54LCBvcHRzLnkpO1xuICAgIGNhc2UgJ21vdmVUbyc6XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50b3VjaE1vdmUob3B0cy5lbGVtZW50LCBvcHRzLngsIG9wdHMueSk7XG4gICAgY2FzZSAnd2FpdCc6XG4gICAgICByZXR1cm4gYXdhaXQgQi5kZWxheShvcHRzLm1zKTtcbiAgICBjYXNlICdsb25nUHJlc3MnOlxuICAgICAgaWYgKHR5cGVvZiBvcHRzLmR1cmF0aW9uID09PSAndW5kZWZpbmVkJyB8fCAhb3B0cy5kdXJhdGlvbikge1xuICAgICAgICBvcHRzLmR1cmF0aW9uID0gMTAwMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnRvdWNoTG9uZ0NsaWNrKG9wdHMuZWxlbWVudCwgb3B0cy54LCBvcHRzLnksIG9wdHMuZHVyYXRpb24pO1xuICAgIGNhc2UgJ2NhbmNlbCc6XG4gICAgICAvLyBUT0RPOiBjbGFyaWZ5IGJlaGF2aW9yIG9mICdjYW5jZWwnIGFjdGlvbiBhbmQgZml4IHRoaXNcbiAgICAgIGxvZy53YXJuKFwiQ2FuY2VsIGFjdGlvbiBjdXJyZW50bHkgaGFzIG5vIGVmZmVjdFwiKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgdW5rbm93biBhY3Rpb24gJHthY3Rpb259YCk7XG4gIH1cbn07XG5cblxuLy8gZHJhZyBpcyAqbm90KiBwcmVzcy1tb3ZlLXJlbGVhc2UsIHNvIHdlIG5lZWQgdG8gdHJhbnNsYXRlXG4vLyBkcmFnIHdvcmtzIGZpbmUgZm9yIHNjcm9sbCwgYXMgd2VsbFxuaGVscGVycy5kb1RvdWNoRHJhZyA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcykge1xuICBsZXQgbG9uZ1ByZXNzID0gZ2VzdHVyZXNbMF07XG4gIGxldCBtb3ZlVG8gPSBnZXN0dXJlc1sxXTtcbiAgbGV0IHN0YXJ0WCA9IGxvbmdQcmVzcy5vcHRpb25zLnggfHwgMCxcbiAgICAgIHN0YXJ0WSA9IGxvbmdQcmVzcy5vcHRpb25zLnkgfHwgMCxcbiAgICAgIGVuZFggPSBtb3ZlVG8ub3B0aW9ucy54IHx8IDAsXG4gICAgICBlbmRZID0gbW92ZVRvLm9wdGlvbnMueSB8fCAwO1xuICBpZiAobG9uZ1ByZXNzLm9wdGlvbnMuZWxlbWVudCkge1xuICAgIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uSW5WaWV3KGxvbmdQcmVzcy5vcHRpb25zLmVsZW1lbnQpO1xuICAgIHN0YXJ0WCArPSB4IHx8IDA7XG4gICAgc3RhcnRZICs9IHkgfHwgMDtcbiAgfVxuICBpZiAobW92ZVRvLm9wdGlvbnMuZWxlbWVudCkge1xuICAgIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uSW5WaWV3KG1vdmVUby5vcHRpb25zLmVsZW1lbnQpO1xuICAgIGVuZFggKz0geCB8fCAwO1xuICAgIGVuZFkgKz0geSB8fCAwO1xuICB9XG5cbiAgbGV0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5hZGIuZ2V0QXBpTGV2ZWwoKTtcbiAgLy8gbG9sbGlwb3AgdGFrZXMgYSBsaXR0bGUgbG9uZ2VyIHRvIGdldCB0aGluZ3Mgcm9sbGluZ1xuICBsZXQgZHVyYXRpb24gPSBhcGlMZXZlbCA+PSA1ID8gMiA6IDE7XG4gIC8vIG1ha2Ugc3VyZSB0aGF0IGlmIHRoZSBsb25nIHByZXNzIGhhcyBhIGR1cmF0aW9uLCB3ZSB1c2UgaXQuXG4gIGlmIChsb25nUHJlc3Mub3B0aW9ucyAmJiBsb25nUHJlc3Mub3B0aW9ucy5kdXJhdGlvbikge1xuICAgIGR1cmF0aW9uID0gTWF0aC5tYXgobG9uZ1ByZXNzLm9wdGlvbnMuZHVyYXRpb24gLyAxMDAwLCBkdXJhdGlvbik7XG4gIH1cblxuICAvLyBgZHJhZ2Agd2lsbCB0YWtlIGNhcmUgb2Ygd2hldGhlciB0aGVyZSBpcyBhbiBlbGVtZW50IG9yIG5vdCBhdCB0aGF0IGxldmVsXG4gIHJldHVybiBhd2FpdCB0aGlzLmRyYWcoc3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksIGR1cmF0aW9uLCAxLCBsb25nUHJlc3Mub3B0aW9ucy5lbGVtZW50LCBtb3ZlVG8ub3B0aW9ucy5lbGVtZW50KTtcbn07XG5cbi8vIFJlbGVhc2UgZ2VzdHVyZSBuZWVkcyBlbGVtZW50IG9yIGNvLW9yZGluYXRlcyB0byByZWxlYXNlIGl0IGZyb20gdGhhdCBwb3NpdGlvblxuLy8gb3IgZWxzZSByZWxlYXNlIGdlc3R1cmUgaXMgcGVyZm9ybWVkIGZyb20gY2VudGVyIG9mIHRoZSBzY3JlZW4sIHNvIHRvIGZpeCBpdFxuLy8gVGhpcyBtZXRob2Qgc2V0cyBjby1vcmRpbmF0ZXMvZWxlbWVudCB0byByZWxlYXNlIGdlc3R1cmUgaWYgaXQgaGFzIG5vIG9wdGlvbnMgc2V0IGFscmVhZHkuXG5oZWxwZXJzLmZpeFJlbGVhc2UgPSBhc3luYyBmdW5jdGlvbiAoZ2VzdHVyZXMpIHtcbiAgbGV0IHJlbGVhc2UgPSBfLmxhc3QoZ2VzdHVyZXMpO1xuICAvLyBzb21ldGltZXMgdGhlcmUgYXJlIG5vIG9wdGlvbnNcbiAgcmVsZWFzZS5vcHRpb25zID0gcmVsZWFzZS5vcHRpb25zIHx8IHt9O1xuICAvLyBub3RoaW5nIHRvIGRvIGlmIHJlbGVhc2Ugb3B0aW9ucyBhcmUgYWxyZWFkeSBzZXRcbiAgaWYgKHJlbGVhc2Uub3B0aW9ucy5lbGVtZW50IHx8IChyZWxlYXNlLm9wdGlvbnMueCAmJiByZWxlYXNlLm9wdGlvbnMueSkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gd2l0aG91dCBjb29yZGluYXRlcywgYHJlbGVhc2VgIHVzZXMgdGhlIGNlbnRlciBvZiB0aGUgc2NyZWVuLCB3aGljaCxcbiAgLy8gZ2VuZXJhbGx5IHNwZWFraW5nLCBpcyBub3Qgd2hhdCB3ZSB3YW50XG4gIC8vIHRoZXJlZm9yZTogbG9vcCBiYWNrd2FyZHMgYW5kIHVzZSB0aGUgbGFzdCBjb21tYW5kIHdpdGggYW4gZWxlbWVudCBhbmQvb3JcbiAgLy8gb2Zmc2V0IGNvb3JkaW5hdGVzXG4gIGdlc3R1cmVzID0gXy5jbG9uZShnZXN0dXJlcyk7XG4gIGxldCByZWYgPSBudWxsO1xuICBmb3IgKGxldCBnZXN0dXJlIG9mIGdlc3R1cmVzLnJldmVyc2UoKSkge1xuICAgIGxldCBvcHRzID0gZ2VzdHVyZS5vcHRpb25zO1xuICAgIGlmIChvcHRzLmVsZW1lbnQgfHwgKG9wdHMueCAmJiBvcHRzLnkpKSB7XG4gICAgICByZWYgPSBnZXN0dXJlO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIGlmIChyZWYpIHtcbiAgICBsZXQgb3B0cyA9IHJlZi5vcHRpb25zO1xuICAgIGlmIChvcHRzLmVsZW1lbnQpIHtcbiAgICAgIGxldCBsb2MgPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uSW5WaWV3KG9wdHMuZWxlbWVudCk7XG4gICAgICBpZiAob3B0cy54ICYmIG9wdHMueSkge1xuICAgICAgICAvLyB0aGlzIGlzIGFuIG9mZnNldCBmcm9tIHRoZSBlbGVtZW50XG4gICAgICAgIHJlbGVhc2Uub3B0aW9ucyA9IHtcbiAgICAgICAgICB4OiBsb2MueCArIG9wdHMueCxcbiAgICAgICAgICB5OiBsb2MueSArIG9wdHMueVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gdGhpcyBpcyB0aGUgY2VudGVyIG9mIHRoZSBlbGVtZW50XG4gICAgICAgIGxldCBzaXplID0gYXdhaXQgdGhpcy5nZXRTaXplKG9wdHMuZWxlbWVudCk7XG4gICAgICAgIHJlbGVhc2Uub3B0aW9ucyA9IHtcbiAgICAgICAgICB4OiBsb2MueCArIHNpemUud2lkdGggLyAyLFxuICAgICAgICAgIHk6IGxvYy55ICsgc2l6ZS5oZWlnaHQgLyAyXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbGVhc2Uub3B0aW9ucyA9IF8ucGljayhvcHRzLCAneCcsICd5Jyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZWxlYXNlO1xufTtcblxuLy8gUGVyZm9ybSBvbmUgZ2VzdHVyZVxuaGVscGVycy5wZXJmb3JtR2VzdHVyZSA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9Ub3VjaEFjdGlvbihnZXN0dXJlLmFjdGlvbiwgZ2VzdHVyZS5vcHRpb25zIHx8IHt9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vIHNvbWV0aW1lIHRoZSBlbGVtZW50IGlzIG5vdCBhdmFpbGFibGUgd2hlbiByZWxlYXNpbmcsIHJldHJ5IHdpdGhvdXQgaXRcbiAgICBpZiAoaXNFcnJvclR5cGUoZSwgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcikgJiYgZ2VzdHVyZS5hY3Rpb24gPT09ICdyZWxlYXNlJyAmJlxuICAgICAgICBnZXN0dXJlLm9wdGlvbnMuZWxlbWVudCkge1xuICAgICAgZGVsZXRlIGdlc3R1cmUub3B0aW9ucy5lbGVtZW50O1xuICAgICAgbG9nLmRlYnVnKGByZXRyeWluZyByZWxlYXNlIHdpdGhvdXQgZWxlbWVudCBvcHRzOiAke2dlc3R1cmUub3B0aW9uc30uYCk7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5kb1RvdWNoQWN0aW9uKGdlc3R1cmUuYWN0aW9uLCBnZXN0dXJlLm9wdGlvbnMgfHwge30pO1xuICAgIH1cbiAgICB0aHJvdyBlO1xuICB9XG59O1xuXG5jb21tYW5kcy5wZXJmb3JtVG91Y2ggPSBhc3luYyBmdW5jdGlvbiAoZ2VzdHVyZXMpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdFlldEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIC8vIHByZXNzLXdhaXQtbW92ZVRvLXJlbGVhc2UgaXMgYHN3aXBlYCwgc28gdXNlIG5hdGl2ZSBtZXRob2RcbiAgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gNCAmJlxuICAgICAgZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAncHJlc3MnICYmXG4gICAgICBnZXN0dXJlc1sxXS5hY3Rpb24gPT09ICd3YWl0JyAmJlxuICAgICAgZ2VzdHVyZXNbMl0uYWN0aW9uID09PSAnbW92ZVRvJyAmJlxuICAgICAgZ2VzdHVyZXNbM10uYWN0aW9uID09PSAncmVsZWFzZScpIHtcblxuICAgIGxldCBzd2lwZU9wdHMgPSBhd2FpdCB0aGlzLmdldFN3aXBlT3B0aW9ucyhnZXN0dXJlcyk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc3dpcGUoc3dpcGVPcHRzLnN0YXJ0WCwgc3dpcGVPcHRzLnN0YXJ0WSwgc3dpcGVPcHRzLmVuZFgsXG4gICAgICAgIHN3aXBlT3B0cy5lbmRZLCBzd2lwZU9wdHMuZHVyYXRpb24sIHN3aXBlT3B0cy50b3VjaENvdW50LFxuICAgICAgICBzd2lwZU9wdHMuZWxlbWVudCk7XG4gIH1cbiAgbGV0IGFjdGlvbnMgPSBfLm1hcChnZXN0dXJlcywgXCJhY3Rpb25cIik7XG5cbiAgaWYgKGFjdGlvbnNbMF0gPT09ICdsb25nUHJlc3MnICYmIGFjdGlvbnNbMV0gPT09ICdtb3ZlVG8nICYmIGFjdGlvbnNbMl0gPT09ICdyZWxlYXNlJykge1xuICAgIC8vIHNvbWUgdGhpbmdzIGFyZSBzcGVjaWFsXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9Ub3VjaERyYWcoZ2VzdHVyZXMpO1xuICB9IGVsc2Uge1xuICAgIGlmIChhY3Rpb25zLmxlbmd0aCA9PT0gMikge1xuICAgICAgLy8gYHByZXNzYCB3aXRob3V0IGEgd2FpdCBpcyB0b28gc2xvdyBhbmQgZ2V0cyBpbnRlcnByZXR0ZWQgYXMgYSBgbG9uZ1ByZXNzYFxuICAgICAgaWYgKF8uaGVhZChhY3Rpb25zKSA9PT0gJ3ByZXNzJyAmJiBfLmxhc3QoYWN0aW9ucykgPT09ICdyZWxlYXNlJykge1xuICAgICAgICBhY3Rpb25zWzBdID0gJ3RhcCc7XG4gICAgICAgIGdlc3R1cmVzWzBdLmFjdGlvbiA9ICd0YXAnO1xuICAgICAgfVxuXG4gICAgICAvLyB0aGUgYGxvbmdQcmVzc2AgYW5kIGB0YXBgIG1ldGhvZHMgcmVsZWFzZSBvbiB0aGVpciBvd25cbiAgICAgIGlmICgoXy5oZWFkKGFjdGlvbnMpID09PSAndGFwJyB8fCBfLmhlYWQoYWN0aW9ucykgPT09ICdsb25nUHJlc3MnKSAmJiBfLmxhc3QoYWN0aW9ucykgPT09ICdyZWxlYXNlJykge1xuICAgICAgICBnZXN0dXJlcy5wb3AoKTtcbiAgICAgICAgYWN0aW9ucy5wb3AoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbG9uZ3ByZXNzIGZvbGxvd2VkIGJ5IGFueXRoaW5nIG90aGVyIHRoYW4gcmVsZWFzZSBzaG91bGQgYmVjb21lIGEgcHJlc3MgYW5kIHdhaXRcbiAgICAgIGlmIChhY3Rpb25zWzBdID09PSAnbG9uZ1ByZXNzJykge1xuICAgICAgICBhY3Rpb25zID0gWydwcmVzcycsICd3YWl0JywgLi4uYWN0aW9ucy5zbGljZSgxKV07XG5cbiAgICAgICAgbGV0IHByZXNzID0gZ2VzdHVyZXMuc2hpZnQoKTtcbiAgICAgICAgcHJlc3MuYWN0aW9uID0gJ3ByZXNzJztcbiAgICAgICAgbGV0IHdhaXQgPSB7XG4gICAgICAgICAgYWN0aW9uOiAnd2FpdCcsXG4gICAgICAgICAgb3B0aW9uczoge21zOiBwcmVzcy5vcHRpb25zLmR1cmF0aW9uIHx8IDEwMDB9XG4gICAgICAgIH07XG4gICAgICAgIGRlbGV0ZSBwcmVzcy5vcHRpb25zLmR1cmF0aW9uO1xuICAgICAgICBnZXN0dXJlcyA9IFtwcmVzcywgd2FpdCwgLi4uZ2VzdHVyZXNdO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBmaXhlZEdlc3R1cmVzID0gYXdhaXQgdGhpcy5wYXJzZVRvdWNoKGdlc3R1cmVzLCBmYWxzZSk7XG4gICAgLy8gZml4IHJlbGVhc2UgYWN0aW9uIHRoZW4gcGVyZm9ybSBhbGwgYWN0aW9uc1xuICAgIGlmIChhY3Rpb25zW2FjdGlvbnMubGVuZ3RoIC0gMV0gPT09ICdyZWxlYXNlJykge1xuICAgICAgYWN0aW9uc1thY3Rpb25zLmxlbmd0aCAtIDFdID0gYXdhaXQgdGhpcy5maXhSZWxlYXNlKGdlc3R1cmVzKTtcbiAgICB9XG4gICAgZm9yIChsZXQgZyBvZiBmaXhlZEdlc3R1cmVzKSB7XG4gICAgICBhd2FpdCB0aGlzLnBlcmZvcm1HZXN0dXJlKGcpO1xuICAgIH1cbiAgfVxufTtcblxuaGVscGVycy5wYXJzZVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzLCBtdWx0aSkge1xuICAvLyBiZWNhdXNlIG11bHRpLXRvdWNoIHJlbGVhc2VzIGF0IHRoZSBlbmQgYnkgZGVmYXVsdFxuICBpZiAobXVsdGkgJiYgXy5sYXN0KGdlc3R1cmVzKS5hY3Rpb24gPT09ICdyZWxlYXNlJykge1xuICAgIGdlc3R1cmVzLnBvcCgpO1xuICB9XG5cbiAgbGV0IHRvdWNoU3RhdGVPYmplY3RzID0gYXdhaXQgYXN5bmNtYXAoZ2VzdHVyZXMsIGFzeW5jIChnZXN0dXJlKSA9PiB7XG4gICAgbGV0IG9wdGlvbnMgPSBnZXN0dXJlLm9wdGlvbnMgfHwge307XG4gICAgaWYgKF8uaW5jbHVkZXMoWydwcmVzcycsICdtb3ZlVG8nLCAndGFwJywgJ2xvbmdQcmVzcyddLCBnZXN0dXJlLmFjdGlvbikpIHtcbiAgICAgIG9wdGlvbnMub2Zmc2V0ID0gZmFsc2U7XG4gICAgICBsZXQgZWxlbWVudElkID0gZ2VzdHVyZS5vcHRpb25zLmVsZW1lbnQ7XG4gICAgICBpZiAoZWxlbWVudElkKSB7XG4gICAgICAgIGxldCBwb3MgPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uSW5WaWV3KGVsZW1lbnRJZCk7XG4gICAgICAgIGlmIChnZXN0dXJlLm9wdGlvbnMueCB8fCBnZXN0dXJlLm9wdGlvbnMueSkge1xuICAgICAgICAgIG9wdGlvbnMueCA9IHBvcy54ICsgKGdlc3R1cmUub3B0aW9ucy54IHx8IDApO1xuICAgICAgICAgIG9wdGlvbnMueSA9IHBvcy55ICsgKGdlc3R1cmUub3B0aW9ucy55IHx8IDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHt3aWR0aCwgaGVpZ2h0fSA9IGF3YWl0IHRoaXMuZ2V0U2l6ZShlbGVtZW50SWQpO1xuICAgICAgICAgIG9wdGlvbnMueCA9IHBvcy54ICsgKHdpZHRoIC8gMik7XG4gICAgICAgICAgb3B0aW9ucy55ID0gcG9zLnkgKyAoaGVpZ2h0IC8gMik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRvdWNoU3RhdGVPYmplY3QgPSB7XG4gICAgICAgICAgYWN0aW9uOiBnZXN0dXJlLmFjdGlvbixcbiAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgIHRpbWVPZmZzZXQ6IDAuMDA1LFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdG91Y2hTdGF0ZU9iamVjdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wdGlvbnMueCA9IChnZXN0dXJlLm9wdGlvbnMueCB8fCAwKTtcbiAgICAgICAgb3B0aW9ucy55ID0gKGdlc3R1cmUub3B0aW9ucy55IHx8IDApO1xuXG4gICAgICAgIGxldCB0b3VjaFN0YXRlT2JqZWN0ID0ge1xuICAgICAgICAgIGFjdGlvbjogZ2VzdHVyZS5hY3Rpb24sXG4gICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICB0aW1lT2Zmc2V0OiAwLjAwNSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRvdWNoU3RhdGVPYmplY3Q7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBvZmZzZXQgPSAwLjAwNTtcbiAgICAgIGlmIChnZXN0dXJlLmFjdGlvbiA9PT0gJ3dhaXQnKSB7XG4gICAgICAgIG9wdGlvbnMgPSBnZXN0dXJlLm9wdGlvbnM7XG4gICAgICAgIG9mZnNldCA9IChwYXJzZUludChnZXN0dXJlLm9wdGlvbnMubXMsIDEwKSAvIDEwMDApO1xuICAgICAgfVxuICAgICAgbGV0IHRvdWNoU3RhdGVPYmplY3QgPSB7XG4gICAgICAgIGFjdGlvbjogZ2VzdHVyZS5hY3Rpb24sXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRpbWVPZmZzZXQ6IG9mZnNldCxcbiAgICAgIH07XG4gICAgICByZXR1cm4gdG91Y2hTdGF0ZU9iamVjdDtcbiAgICB9XG4gIH0sIGZhbHNlKTtcbiAgLy8gd2UgbmVlZCB0byBjaGFuZ2UgdGhlIHRpbWUgKHdoaWNoIGlzIG5vdyBhbiBvZmZzZXQpXG4gIC8vIGFuZCB0aGUgcG9zaXRpb24gKHdoaWNoIG1heSBiZSBhbiBvZmZzZXQpXG4gIGxldCBwcmV2UG9zID0gbnVsbCxcbiAgICAgIHRpbWUgPSAwO1xuICBmb3IgKGxldCBzdGF0ZSBvZiB0b3VjaFN0YXRlT2JqZWN0cykge1xuICAgIGlmIChfLmlzVW5kZWZpbmVkKHN0YXRlLm9wdGlvbnMueCkgJiYgXy5pc1VuZGVmaW5lZChzdGF0ZS5vcHRpb25zLnkpICYmIHByZXZQb3MgIT09IG51bGwpIHtcbiAgICAgIC8vIHRoaXMgaGFwcGVucyB3aXRoIHdhaXRcbiAgICAgIHN0YXRlLm9wdGlvbnMueCA9IHByZXZQb3MueDtcbiAgICAgIHN0YXRlLm9wdGlvbnMueSA9IHByZXZQb3MueTtcbiAgICB9XG4gICAgaWYgKHN0YXRlLm9wdGlvbnMub2Zmc2V0ICYmIHByZXZQb3MpIHtcbiAgICAgIC8vIHRoZSBjdXJyZW50IHBvc2l0aW9uIGlzIGFuIG9mZnNldFxuICAgICAgc3RhdGUub3B0aW9ucy54ICs9IHByZXZQb3MueDtcbiAgICAgIHN0YXRlLm9wdGlvbnMueSArPSBwcmV2UG9zLnk7XG4gICAgfVxuICAgIGRlbGV0ZSBzdGF0ZS5vcHRpb25zLm9mZnNldDtcbiAgICBpZiAoIV8uaXNVbmRlZmluZWQoc3RhdGUub3B0aW9ucy54KSAmJiAhXy5pc1VuZGVmaW5lZChzdGF0ZS5vcHRpb25zLnkpKSB7XG4gICAgICBwcmV2UG9zID0gc3RhdGUub3B0aW9ucztcbiAgICB9XG5cbiAgICBpZiAobXVsdGkpIHtcbiAgICAgIGxldCB0aW1lT2Zmc2V0ID0gc3RhdGUudGltZU9mZnNldDtcbiAgICAgIHRpbWUgKz0gdGltZU9mZnNldDtcbiAgICAgIHN0YXRlLnRpbWUgPSBhbmRyb2lkSGVscGVycy50cnVuY2F0ZURlY2ltYWxzKHRpbWUsIDMpO1xuXG4gICAgICAvLyBtdWx0aSBnZXN0dXJlcyByZXF1aXJlICd0b3VjaCcgcmF0aGVyIHRoYW4gJ29wdGlvbnMnXG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc3RhdGUub3B0aW9ucy54KSAmJiAhXy5pc1VuZGVmaW5lZChzdGF0ZS5vcHRpb25zLnkpKSB7XG4gICAgICAgIHN0YXRlLnRvdWNoID0ge1xuICAgICAgICAgIHg6IHN0YXRlLm9wdGlvbnMueCxcbiAgICAgICAgICB5OiBzdGF0ZS5vcHRpb25zLnlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGRlbGV0ZSBzdGF0ZS5vcHRpb25zO1xuICAgIH1cbiAgICBkZWxldGUgc3RhdGUudGltZU9mZnNldDtcbiAgfVxuICByZXR1cm4gdG91Y2hTdGF0ZU9iamVjdHM7XG59O1xuXG5cbmNvbW1hbmRzLnBlcmZvcm1NdWx0aUFjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChhY3Rpb25zLCBlbGVtZW50SWQpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdFlldEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIC8vIEFuZHJvaWQgbmVlZHMgYXQgbGVhc3QgdHdvIGFjdGlvbnMgdG8gYmUgYWJsZSB0byBwZXJmb3JtIGEgbXVsdGkgcG9pbnRlciBnZXN0dXJlXG4gIGlmIChhY3Rpb25zLmxlbmd0aCA9PT0gMSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk11bHRpIFBvaW50ZXIgR2VzdHVyZXMgbmVlZCBhdCBsZWFzdCB0d28gYWN0aW9ucy4gXCIgK1xuICAgICAgICBcIlVzZSBUb3VjaCBBY3Rpb25zIGZvciBhIHNpbmdsZSBhY3Rpb24uXCIpO1xuICB9XG5cbiAgbGV0IHN0YXRlcyA9IGF3YWl0IGFzeW5jbWFwKGFjdGlvbnMsIGFzeW5jIChhY3Rpb24pID0+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wYXJzZVRvdWNoKGFjdGlvbiwgdHJ1ZSk7XG4gIH0sIGZhbHNlKTtcblxuICByZXR1cm4gYXdhaXQgdGhpcy5kb1BlcmZvcm1NdWx0aUFjdGlvbihlbGVtZW50SWQsIHN0YXRlcyk7XG59O1xuXG4vKipcbiAqIFJlYXNvbiBmb3IgaXNvbGF0aW5nIGRvUGVyZm9ybU11bHRpQWN0aW9uIGZyb20gcGVyZm9ybU11bHRpQWN0aW9uIGlzIGZvciByZXVzaW5nIHBlcmZvcm1NdWx0aUFjdGlvblxuICogYWNyb3NzIGFuZHJvaWQtZHJpdmVycyAobGlrZSBhcHBpdW0tdWlhdXRvbWF0b3IyLWRyaXZlcikgYW5kIHRvIGF2b2lkIGNvZGUgZHVwbGljYXRpb24uXG4gKiBPdGhlciBhbmRyb2lkLWRyaXZlcnMgKGxpa2UgYXBwaXVtLXVpYXV0b21hdG9yMi1kcml2ZXIpIG5lZWQgdG8gb3ZlcnJpZGUgZG9QZXJmb3JtTXVsdGlBY3Rpb25cbiAqIHRvIGZhY2lsaXRhdGUgcGVyZm9ybU11bHRpQWN0aW9uLlxuICovXG5jb21tYW5kcy5kb1BlcmZvcm1NdWx0aUFjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQsIHN0YXRlcykge1xuICBsZXQgb3B0cztcbiAgaWYgKGVsZW1lbnRJZCkge1xuICAgIG9wdHMgPSB7XG4gICAgICBlbGVtZW50SWQsXG4gICAgICBhY3Rpb25zOiBzdGF0ZXNcbiAgICB9O1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDpwZXJmb3JtTXVsdGlQb2ludGVyR2VzdHVyZVwiLCBvcHRzKTtcbiAgfSBlbHNlIHtcbiAgICBvcHRzID0ge1xuICAgICAgYWN0aW9uczogc3RhdGVzXG4gICAgfTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcInBlcmZvcm1NdWx0aVBvaW50ZXJHZXN0dXJlXCIsIG9wdHMpO1xuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvdG91Y2guanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
