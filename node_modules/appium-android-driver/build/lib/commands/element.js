"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("../logger"));

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getAttribute = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (attribute, elementId) {
    let p = {
      attribute,
      elementId
    };
    return yield this.bootstrap.sendAction("element:getAttribute", p);
  });

  return function (_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

commands.getName = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.getAttribute("className", elementId);
  });

  return function (_x3) {
    return _ref2.apply(this, arguments);
  };
}();

commands.elementDisplayed = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return (yield this.getAttribute("displayed", elementId)) === 'true';
  });

  return function (_x4) {
    return _ref3.apply(this, arguments);
  };
}();

commands.elementEnabled = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return (yield this.getAttribute("enabled", elementId)) === 'true';
  });

  return function (_x5) {
    return _ref4.apply(this, arguments);
  };
}();

commands.elementSelected = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return (yield this.getAttribute("selected", elementId)) === 'true';
  });

  return function (_x6) {
    return _ref5.apply(this, arguments);
  };
}();

helpers.setElementValue = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (keys, elementId, replace = false) {
    let text = keys;

    if (keys instanceof Array) {
      text = keys.join("");
    }

    let params = {
      elementId,
      text,
      replace,
      unicodeKeyboard: this.opts.unicodeKeyboard
    };
    return yield this.doSetElementValue(params);
  });

  return function (_x7, _x8) {
    return _ref6.apply(this, arguments);
  };
}();

helpers.doSetElementValue = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (params) {
    return yield this.bootstrap.sendAction("element:setText", params);
  });

  return function (_x9) {
    return _ref7.apply(this, arguments);
  };
}();

commands.setValue = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (keys, elementId) {
    return yield this.setElementValue(keys, elementId, false);
  });

  return function (_x10, _x11) {
    return _ref8.apply(this, arguments);
  };
}();

commands.replaceValue = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (keys, elementId) {
    return yield this.setElementValue(keys, elementId, true);
  });

  return function (_x12, _x13) {
    return _ref9.apply(this, arguments);
  };
}();

commands.setValueImmediate = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (keys, elementId) {
    let text = keys;

    if (keys instanceof Array) {
      text = keys.join("");
    }

    yield this.click(elementId);
    yield this.adb.inputText(text);
  });

  return function (_x14, _x15) {
    return _ref10.apply(this, arguments);
  };
}();

commands.getText = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.bootstrap.sendAction("element:getText", {
      elementId
    });
  });

  return function (_x16) {
    return _ref11.apply(this, arguments);
  };
}();

commands.clear = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (elementId) {
    var _this = this;

    let text = (yield this.getText(elementId)) || '';
    let length = text.length;

    if (length === 0) {
      length = 100;
    }

    yield this.click(elementId);

    _logger.default.debug(`Sending up to ${length} clear characters to device`);

    return yield (0, _asyncbox.retryInterval)(5, 500, (0, _asyncToGenerator2.default)(function* () {
      let remainingLength = length;

      while (remainingLength > 0) {
        let lengthToSend = remainingLength < 50 ? remainingLength : 50;

        _logger.default.debug(`Sending ${lengthToSend} clear characters to device`);

        yield _this.adb.clearTextField(lengthToSend);
        remainingLength -= lengthToSend;
      }
    }));
  });

  return function (_x17) {
    return _ref12.apply(this, arguments);
  };
}();

commands.click = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.bootstrap.sendAction("element:click", {
      elementId
    });
  });

  return function (_x18) {
    return _ref14.apply(this, arguments);
  };
}();

commands.getLocation = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.bootstrap.sendAction("element:getLocation", {
      elementId
    });
  });

  return function (_x19) {
    return _ref15.apply(this, arguments);
  };
}();

commands.getLocationInView = function () {
  var _ref16 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.getLocation(elementId);
  });

  return function (_x20) {
    return _ref16.apply(this, arguments);
  };
}();

commands.getSize = function () {
  var _ref17 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.bootstrap.sendAction("element:getSize", {
      elementId
    });
  });

  return function (_x21) {
    return _ref17.apply(this, arguments);
  };
}();

commands.getElementRect = function () {
  var _ref18 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.bootstrap.sendAction("element:getRect", {
      elementId
    });
  });

  return function (_x22) {
    return _ref18.apply(this, arguments);
  };
}();

commands.touchLongClick = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (elementId, x, y, duration) {
    let params = {
      elementId,
      x,
      y,
      duration
    };

    _androidHelpers.default.removeNullProperties(params);

    return yield this.bootstrap.sendAction("element:touchLongClick", params);
  });

  return function (_x23, _x24, _x25, _x26) {
    return _ref19.apply(this, arguments);
  };
}();

commands.touchDown = function () {
  var _ref20 = (0, _asyncToGenerator2.default)(function* (elementId, x, y) {
    let params = {
      elementId,
      x,
      y
    };

    _androidHelpers.default.removeNullProperties(params);

    return yield this.bootstrap.sendAction("element:touchDown", params);
  });

  return function (_x27, _x28, _x29) {
    return _ref20.apply(this, arguments);
  };
}();

commands.touchUp = function () {
  var _ref21 = (0, _asyncToGenerator2.default)(function* (elementId, x, y) {
    let params = {
      elementId,
      x,
      y
    };

    _androidHelpers.default.removeNullProperties(params);

    return yield this.bootstrap.sendAction("element:touchUp", params);
  });

  return function (_x30, _x31, _x32) {
    return _ref21.apply(this, arguments);
  };
}();

commands.touchMove = function () {
  var _ref22 = (0, _asyncToGenerator2.default)(function* (elementId, x, y) {
    let params = {
      elementId,
      x,
      y
    };

    _androidHelpers.default.removeNullProperties(params);

    return yield this.bootstrap.sendAction("element:touchMove", params);
  });

  return function (_x33, _x34, _x35) {
    return _ref22.apply(this, arguments);
  };
}();

commands.complexTap = function () {
  var _ref23 = (0, _asyncToGenerator2.default)(function* (tapCount, touchCount, duration, x, y) {
    return yield this.bootstrap.sendAction("click", {
      x,
      y
    });
  });

  return function (_x36, _x37, _x38, _x39, _x40) {
    return _ref23.apply(this, arguments);
  };
}();

commands.tap = function () {
  var _ref24 = (0, _asyncToGenerator2.default)(function* (elementId, x = 0, y = 0, count = 1) {
    for (let i = 0; i < count; i++) {
      if (elementId) {
        if (x !== 0 || y !== 0) {
          yield this.bootstrap.sendAction("element:click", {
            elementId,
            x,
            y
          });
        } else {
          yield this.bootstrap.sendAction("element:click", {
            elementId
          });
        }
      } else {
        yield this.bootstrap.sendAction("click", {
          x,
          y
        });
      }
    }
  });

  return function (_x41) {
    return _ref24.apply(this, arguments);
  };
}();

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbGVtZW50SWQiLCJwIiwiYm9vdHN0cmFwIiwic2VuZEFjdGlvbiIsImdldE5hbWUiLCJlbGVtZW50RGlzcGxheWVkIiwiZWxlbWVudEVuYWJsZWQiLCJlbGVtZW50U2VsZWN0ZWQiLCJzZXRFbGVtZW50VmFsdWUiLCJrZXlzIiwicmVwbGFjZSIsInRleHQiLCJBcnJheSIsImpvaW4iLCJwYXJhbXMiLCJ1bmljb2RlS2V5Ym9hcmQiLCJvcHRzIiwiZG9TZXRFbGVtZW50VmFsdWUiLCJzZXRWYWx1ZSIsInJlcGxhY2VWYWx1ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwiY2xpY2siLCJhZGIiLCJpbnB1dFRleHQiLCJnZXRUZXh0IiwiY2xlYXIiLCJsZW5ndGgiLCJsb2dnZXIiLCJkZWJ1ZyIsInJlbWFpbmluZ0xlbmd0aCIsImxlbmd0aFRvU2VuZCIsImNsZWFyVGV4dEZpZWxkIiwiZ2V0TG9jYXRpb24iLCJnZXRMb2NhdGlvbkluVmlldyIsImdldFNpemUiLCJnZXRFbGVtZW50UmVjdCIsInRvdWNoTG9uZ0NsaWNrIiwieCIsInkiLCJkdXJhdGlvbiIsImFuZHJvaWRIZWxwZXJzIiwicmVtb3ZlTnVsbFByb3BlcnRpZXMiLCJ0b3VjaERvd24iLCJ0b3VjaFVwIiwidG91Y2hNb3ZlIiwiY29tcGxleFRhcCIsInRhcENvdW50IiwidG91Y2hDb3VudCIsInRhcCIsImNvdW50IiwiaSIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7O0FBRUFGLFFBQVEsQ0FBQ0csWUFBVDtBQUFB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LENBQWVDLFVBQWYsQ0FBMEIsZUFBMUIsRUFBMkM7QUFBQ0gsWUFBQUEsU0FBRDtBQUFZcUMsWUFBQUEsQ0FBWjtBQUFlQyxZQUFBQTtBQUFmLFdBQTNDLENBQU47QUFDRCxTQUZELE1BRU87QUFDTCxnQkFBTSxLQUFLcEMsU0FBTCxDQUFlQyxVQUFmLENBQTBCLGVBQTFCLEVBQTJDO0FBQUNILFlBQUFBO0FBQUQsV0FBM0MsQ0FBTjtBQUNEO0FBQ0YsT0FSRCxNQVFPO0FBQ0wsY0FBTSxLQUFLRSxTQUFMLENBQWVDLFVBQWYsQ0FBMEIsT0FBMUIsRUFBbUM7QUFBQ2tDLFVBQUFBLENBQUQ7QUFBSUMsVUFBQUE7QUFBSixTQUFuQyxDQUFOO0FBQ0Q7QUFDRjtBQUNGLEdBZEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZ0JBYSxNQUFNLENBQUNDLE1BQVAsQ0FBY3ZELFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuZHJvaWRIZWxwZXJzIGZyb20gJy4uL2FuZHJvaWQtaGVscGVycyc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuLi9sb2dnZXInO1xuXG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgZWxlbWVudElkKSB7XG4gIGxldCBwID0ge2F0dHJpYnV0ZSwgZWxlbWVudElkfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmdldEF0dHJpYnV0ZVwiLCBwKTtcbn07XG5cbmNvbW1hbmRzLmdldE5hbWUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZShcImNsYXNzTmFtZVwiLCBlbGVtZW50SWQpO1xufTtcblxuY29tbWFuZHMuZWxlbWVudERpc3BsYXllZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKFwiZGlzcGxheWVkXCIsIGVsZW1lbnRJZCkgPT09ICd0cnVlJztcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRFbmFibGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXRBdHRyaWJ1dGUoXCJlbmFibGVkXCIsIGVsZW1lbnRJZCkgPT09ICd0cnVlJztcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRTZWxlY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKFwic2VsZWN0ZWRcIiwgZWxlbWVudElkKSA9PT0gJ3RydWUnO1xufTtcblxuaGVscGVycy5zZXRFbGVtZW50VmFsdWUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkLCByZXBsYWNlID0gZmFsc2UpIHtcbiAgbGV0IHRleHQgPSBrZXlzO1xuICBpZiAoa2V5cyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgdGV4dCA9IGtleXMuam9pbihcIlwiKTtcbiAgfVxuXG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZWxlbWVudElkLFxuICAgIHRleHQsXG4gICAgcmVwbGFjZSxcbiAgICB1bmljb2RlS2V5Ym9hcmQ6IHRoaXMub3B0cy51bmljb2RlS2V5Ym9hcmRcbiAgfTtcblxuICByZXR1cm4gYXdhaXQgdGhpcy5kb1NldEVsZW1lbnRWYWx1ZShwYXJhbXMpO1xufTtcblxuLyoqXG4gKiBSZWFzb24gZm9yIGlzb2xhdGluZyBkb1NldEVsZW1lbnRWYWx1ZSBmcm9tIHNldEVsZW1lbnRWYWx1ZSBpcyBmb3IgcmV1c2luZyBzZXRFbGVtZW50VmFsdWVcbiAqIGFjcm9zcyBhbmRyb2lkLWRyaXZlcnMgKGxpa2UgYXBwaXVtLXVpYXV0b21hdG9yMi1kcml2ZXIpIGFuZCB0byBhdm9pZCBjb2RlIGR1cGxpY2F0aW9uLlxuICogT3RoZXIgYW5kcm9pZC1kcml2ZXJzIChsaWtlIGFwcGl1bS11aWF1dG9tYXRvcjItZHJpdmVyKSBuZWVkIHRvIG92ZXJyaWRlIGRvU2V0RWxlbWVudFZhbHVlXG4gKiB0byBmYWNpbGl0YXRlIHNldEVsZW1lbnRWYWx1ZS5cbiAqL1xuaGVscGVycy5kb1NldEVsZW1lbnRWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnNldFRleHRcIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKGtleXMsIGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5zZXRFbGVtZW50VmFsdWUoa2V5cywgZWxlbWVudElkLCBmYWxzZSk7XG59O1xuXG5jb21tYW5kcy5yZXBsYWNlVmFsdWUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnNldEVsZW1lbnRWYWx1ZShrZXlzLCBlbGVtZW50SWQsIHRydWUpO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWVJbW1lZGlhdGUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkKSB7XG4gIGxldCB0ZXh0ID0ga2V5cztcbiAgaWYgKGtleXMgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgIHRleHQgPSBrZXlzLmpvaW4oXCJcIik7XG4gIH1cblxuICAvLyBmaXJzdCwgbWFrZSBzdXJlIHdlIGFyZSBmb2N1c2VkIG9uIHRoZSBlbGVtZW50XG4gIGF3YWl0IHRoaXMuY2xpY2soZWxlbWVudElkKTtcblxuICAvLyB0aGVuIHNlbmQgdGhyb3VnaCBhZGJcbiAgYXdhaXQgdGhpcy5hZGIuaW5wdXRUZXh0KHRleHQpO1xufTtcblxuY29tbWFuZHMuZ2V0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmdldFRleHRcIiwge2VsZW1lbnRJZH0pO1xufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIGxldCB0ZXh0ID0gKGF3YWl0IHRoaXMuZ2V0VGV4dChlbGVtZW50SWQpKSB8fCAnJztcbiAgbGV0IGxlbmd0aCA9IHRleHQubGVuZ3RoO1xuICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgLy8gaWYgbGVuZ3RoIGlzIHplcm8gdGhlcmUgYXJlIHR3byBwb3NzaWJpbGl0aWVzOlxuICAgIC8vICAgMS4gdGhlcmUgaXMgbm90aGluZyBpbiB0aGUgdGV4dCBmaWVsZFxuICAgIC8vICAgMi4gaXQgaXMgYSBwYXNzd29yZCBmaWVsZFxuICAgIC8vIHNpbmNlIHRoZXJlIGlzIGxpdHRsZSBvdmVyaGVhZCB0byB0aGUgYWRiIGNhbGwsIGRlbGV0ZSAxMDAgZWxlbWVudHNcbiAgICAvLyBpZiB3ZSBnZXQgemVybywganVzdCBpbiBjYXNlIGl0IGlzICMyXG4gICAgbGVuZ3RoID0gMTAwO1xuICB9XG4gIGF3YWl0IHRoaXMuY2xpY2soZWxlbWVudElkKTtcbiAgbG9nZ2VyLmRlYnVnKGBTZW5kaW5nIHVwIHRvICR7bGVuZ3RofSBjbGVhciBjaGFyYWN0ZXJzIHRvIGRldmljZWApO1xuICByZXR1cm4gYXdhaXQgcmV0cnlJbnRlcnZhbCg1LCA1MDAsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgcmVtYWluaW5nTGVuZ3RoID0gbGVuZ3RoO1xuICAgIHdoaWxlIChyZW1haW5pbmdMZW5ndGggPiAwKSB7XG4gICAgICBsZXQgbGVuZ3RoVG9TZW5kID0gcmVtYWluaW5nTGVuZ3RoIDwgNTAgPyByZW1haW5pbmdMZW5ndGggOiA1MDtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgU2VuZGluZyAke2xlbmd0aFRvU2VuZH0gY2xlYXIgY2hhcmFjdGVycyB0byBkZXZpY2VgKTtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLmNsZWFyVGV4dEZpZWxkKGxlbmd0aFRvU2VuZCk7XG4gICAgICByZW1haW5pbmdMZW5ndGggLT0gbGVuZ3RoVG9TZW5kO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb21tYW5kcy5jbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmNsaWNrXCIsIHtlbGVtZW50SWR9KTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImVsZW1lbnQ6Z2V0TG9jYXRpb25cIiwge2VsZW1lbnRJZH0pO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb25JblZpZXcgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmdldExvY2F0aW9uKGVsZW1lbnRJZCk7XG59O1xuXG5jb21tYW5kcy5nZXRTaXplID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImVsZW1lbnQ6Z2V0U2l6ZVwiLCB7ZWxlbWVudElkfSk7XG59O1xuXG5jb21tYW5kcy5nZXRFbGVtZW50UmVjdCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmdldFJlY3RcIiwge2VsZW1lbnRJZH0pO1xufTtcblxuY29tbWFuZHMudG91Y2hMb25nQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4LCB5LCBkdXJhdGlvbikge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnRJZCwgeCwgeSwgZHVyYXRpb259O1xuICBhbmRyb2lkSGVscGVycy5yZW1vdmVOdWxsUHJvcGVydGllcyhwYXJhbXMpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImVsZW1lbnQ6dG91Y2hMb25nQ2xpY2tcIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoRG93biA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQsIHgsIHkpIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50SWQsIHgsIHl9O1xuICBhbmRyb2lkSGVscGVycy5yZW1vdmVOdWxsUHJvcGVydGllcyhwYXJhbXMpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImVsZW1lbnQ6dG91Y2hEb3duXCIsIHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy50b3VjaFVwID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCwgeCwgeSkge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnRJZCwgeCwgeX07XG4gIGFuZHJvaWRIZWxwZXJzLnJlbW92ZU51bGxQcm9wZXJ0aWVzKHBhcmFtcyk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDp0b3VjaFVwXCIsIHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy50b3VjaE1vdmUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudElkLCB4LCB5fTtcbiAgYW5kcm9pZEhlbHBlcnMucmVtb3ZlTnVsbFByb3BlcnRpZXMocGFyYW1zKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnRvdWNoTW92ZVwiLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuY29tcGxleFRhcCA9IGFzeW5jIGZ1bmN0aW9uICh0YXBDb3VudCwgdG91Y2hDb3VudCwgZHVyYXRpb24sIHgsIHkpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJjbGlja1wiLCB7eCwgeX0pO1xufTtcblxuY29tbWFuZHMudGFwID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCwgeCA9IDAsIHkgPSAwLCBjb3VudCA9IDEpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgaWYgKGVsZW1lbnRJZCkge1xuICAgICAgLy8gd2UgYXJlIGVpdGhlciB0YXBwaW5nIG9uIHRoZSBkZWZhdWx0IGxvY2F0aW9uIG9mIHRoZSBlbGVtZW50XG4gICAgICAvLyBvciBhbiBvZmZzZXQgZnJvbSB0aGUgdG9wIGxlZnQgY29ybmVyXG4gICAgICBpZiAoeCAhPT0gMCB8fCB5ICE9PSAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmNsaWNrXCIsIHtlbGVtZW50SWQsIHgsIHl9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmNsaWNrXCIsIHtlbGVtZW50SWR9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImNsaWNrXCIsIHt4LCB5fSk7XG4gICAgfVxuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZWxlbWVudC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
