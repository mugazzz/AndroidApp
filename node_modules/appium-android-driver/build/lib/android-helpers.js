"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _ioAppium = require("io.appium.settings");

var _bootstrap = _interopRequireDefault(require("./bootstrap"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumAdb = _interopRequireDefault(require("appium-adb"));

var _unlockHelpers = _interopRequireWildcard(require("./unlock-helpers"));

const PACKAGE_INSTALL_TIMEOUT = 90000;
const CHROME_BROWSER_PACKAGE_ACTIVITY = {
  chrome: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  chromium: {
    pkg: 'org.chromium.chrome.shell',
    activity: '.ChromeShellActivity'
  },
  chromebeta: {
    pkg: 'com.chrome.beta',
    activity: 'com.google.android.apps.chrome.Main'
  },
  browser: {
    pkg: 'com.android.browser',
    activity: 'com.android.browser.BrowserActivity'
  },
  'chromium-browser': {
    pkg: 'org.chromium.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  'chromium-webview': {
    pkg: 'org.chromium.webview_shell',
    activity: 'org.chromium.webview_shell.WebViewBrowserActivity'
  },
  default: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  }
};
const SETTINGS_HELPER_PKG_ID = 'io.appium.settings';
const SETTINGS_HELPER_MAIN_ACTIVITY = '.Settings';
const SETTINGS_HELPER_UNLOCK_ACTIVITY = '.Unlock';
let helpers = {};
exports.helpers = helpers;

helpers.createBaseADB = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const javaVersion = opts.javaVersion,
          adbPort = opts.adbPort,
          suppressKillServer = opts.suppressKillServer,
          remoteAdbHost = opts.remoteAdbHost,
          clearDeviceLogsOnStart = opts.clearDeviceLogsOnStart,
          adbExecTimeout = opts.adbExecTimeout,
          useKeystore = opts.useKeystore,
          keystorePath = opts.keystorePath,
          keystorePassword = opts.keystorePassword,
          keyAlias = opts.keyAlias,
          keyPassword = opts.keyPassword;
    return yield _appiumAdb.default.createADB({
      javaVersion,
      adbPort,
      suppressKillServer,
      remoteAdbHost,
      clearDeviceLogsOnStart,
      adbExecTimeout,
      useKeystore,
      keystorePath,
      keystorePassword,
      keyAlias,
      keyPassword
    });
  });

  return function () {
    return _ref.apply(this, arguments);
  };
}();

helpers.parseJavaVersion = function (stderr) {
  let lines = stderr.split("\n");
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = lines[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      let line = _step.value;

      if (new RegExp(/(java|openjdk) version/).test(line)) {
        return line.split(" ")[2].replace(/"/g, '');
      }
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }

  return null;
};

helpers.getJavaVersion = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (logVersion = true) {
    let _ref3 = yield (0, _teen_process.exec)('java', ['-version']),
        stderr = _ref3.stderr;

    let javaVer = helpers.parseJavaVersion(stderr);

    if (javaVer === null) {
      throw new Error("Could not get the Java version. Is Java installed?");
    }

    if (logVersion) {
      _logger.default.info(`Java version is: ${javaVer}`);
    }

    return javaVer;
  });

  return function () {
    return _ref2.apply(this, arguments);
  };
}();

helpers.prepareEmulator = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (adb, opts) {
    let avd = opts.avd,
        avdArgs = opts.avdArgs,
        language = opts.language,
        locale = opts.locale,
        avdLaunchTimeout = opts.avdLaunchTimeout,
        avdReadyTimeout = opts.avdReadyTimeout;

    if (!avd) {
      throw new Error("Cannot launch AVD without AVD name");
    }

    let avdName = avd.replace('@', '');
    let runningAVD = yield adb.getRunningAVD(avdName);

    if (runningAVD !== null) {
      if (avdArgs && avdArgs.toLowerCase().indexOf("-wipe-data") > -1) {
        _logger.default.debug(`Killing '${avdName}' because it needs to be wiped at start.`);

        yield adb.killEmulator(avdName);
      } else {
        _logger.default.debug("Not launching AVD because it is already running.");

        return;
      }
    }

    avdArgs = this.prepareAVDArgs(opts, adb, avdArgs);
    yield adb.launchAVD(avd, avdArgs, language, locale, avdLaunchTimeout, avdReadyTimeout);
  });

  return function (_x, _x2) {
    return _ref4.apply(this, arguments);
  };
}();

helpers.prepareAVDArgs = function (opts, adb, avdArgs) {
  let args = avdArgs ? [avdArgs] : [];

  if (!_lodash.default.isUndefined(opts.networkSpeed)) {
    let networkSpeed = this.ensureNetworkSpeed(adb, opts.networkSpeed);
    args.push('-netspeed', networkSpeed);
  }

  if (opts.isHeadless) {
    args.push('-no-window');
  }

  return args.join(' ');
};

helpers.ensureNetworkSpeed = function (adb, networkSpeed) {
  if (_lodash.default.values(adb.NETWORK_SPEED).indexOf(networkSpeed) !== -1) {
    return networkSpeed;
  }

  _logger.default.warn(`Wrong network speed param ${networkSpeed}, using default: full. Supported values: ${_lodash.default.values(adb.NETWORK_SPEED)}`);

  return adb.NETWORK_SPEED.FULL;
};

helpers.ensureDeviceLocale = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (adb, language, country, script = null) {
    if (!_lodash.default.isString(language) && !_lodash.default.isString(country)) {
      _logger.default.warn(`setDeviceLanguageCountry requires language or country.`);

      _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

      return;
    }

    yield adb.setDeviceLanguageCountry(language, country, script);

    if (!(yield adb.ensureCurrentLocale(language, country, script))) {
      const message = script ? `language: ${language}, country: ${country} and script: ${script}` : `language: ${language} and country: ${country}`;
      throw new Error(`Failed to set ${message}`);
    }
  });

  return function (_x3, _x4, _x5) {
    return _ref5.apply(this, arguments);
  };
}();

helpers.getDeviceInfoFromCaps = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const adb = yield helpers.createBaseADB(opts);
    let udid = opts.udid;
    let emPort = null;

    if (opts.avd) {
      yield helpers.prepareEmulator(adb, opts);
      udid = adb.curDeviceId;
      emPort = adb.emulatorPort;
    } else {
      _logger.default.info("Retrieving device list");

      let devices = yield adb.getDevicesWithRetry();

      if (udid) {
        if (!_lodash.default.includes(_lodash.default.map(devices, 'udid'), udid)) {
          _logger.default.errorAndThrow(`Device ${udid} was not in the list of connected devices`);
        }

        emPort = adb.getPortFromEmulatorString(udid);
      } else if (opts.platformVersion) {
        opts.platformVersion = `${opts.platformVersion}`.trim();

        _logger.default.info(`Looking for a device with Android '${opts.platformVersion}'`);

        let availDevicesStr = [];
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = devices[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            let device = _step2.value;
            yield adb.setDeviceId(device.udid);
            let deviceOS = yield adb.getPlatformVersion();
            availDevicesStr.push(`${device.udid} (${deviceOS})`);

            if (deviceOS.indexOf(opts.platformVersion) === 0) {
              udid = device.udid;
              break;
            }
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        if (!udid) {
          _logger.default.errorAndThrow(`Unable to find an active device or emulator ` + `with OS ${opts.platformVersion}. The following are available: ` + availDevicesStr.join(', '));
        }

        emPort = adb.getPortFromEmulatorString(udid);
      } else {
        udid = devices[0].udid;
        emPort = adb.getPortFromEmulatorString(udid);
      }
    }

    _logger.default.info(`Using device: ${udid}`);

    return {
      udid,
      emPort
    };
  });

  return function () {
    return _ref6.apply(this, arguments);
  };
}();

helpers.createADB = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const udid = opts.udid,
          emPort = opts.emPort;
    const adb = yield helpers.createBaseADB(opts);
    adb.setDeviceId(udid);

    if (emPort) {
      adb.setEmulatorPort(emPort);
    }

    return adb;
  });

  return function () {
    return _ref7.apply(this, arguments);
  };
}();

helpers.validatePackageActivityNames = function (opts) {
  var _arr = ['appPackage', 'appActivity', 'appWaitPackage', 'appWaitActivity'];

  for (var _i = 0; _i < _arr.length; _i++) {
    const key = _arr[_i];
    const name = opts[key];

    if (!name) {
      continue;
    }

    const match = /([^\w.*,])+/.exec(name);

    if (!match) {
      continue;
    }

    _logger.default.warn(`Capability '${key}' is expected to only include latin letters, digits, underscore, dot, comma and asterisk characters.`);

    _logger.default.warn(`Current value '${name}' has non-matching character at index ${match.index}: '${name.substring(0, match.index + 1)}'`);
  }
};

helpers.getLaunchInfo = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (adb, opts) {
    let app = opts.app,
        appPackage = opts.appPackage,
        appActivity = opts.appActivity,
        appWaitPackage = opts.appWaitPackage,
        appWaitActivity = opts.appWaitActivity;

    if (!app) {
      _logger.default.warn("No app sent in, not parsing package/activity");

      return;
    }

    this.validatePackageActivityNames(opts);

    if (appPackage && appActivity) {
      return;
    }

    _logger.default.debug("Parsing package and activity from app manifest");

    let _ref9 = yield adb.packageAndLaunchActivityFromManifest(app),
        apkPackage = _ref9.apkPackage,
        apkActivity = _ref9.apkActivity;

    if (apkPackage && !appPackage) {
      appPackage = apkPackage;
    }

    if (!appWaitPackage) {
      appWaitPackage = appPackage;
    }

    if (apkActivity && !appActivity) {
      appActivity = apkActivity;
    }

    if (!appWaitActivity) {
      appWaitActivity = appActivity;
    }

    _logger.default.debug(`Parsed package and activity are: ${apkPackage}/${apkActivity}`);

    return {
      appPackage,
      appWaitPackage,
      appActivity,
      appWaitActivity
    };
  });

  return function (_x6, _x7) {
    return _ref8.apply(this, arguments);
  };
}();

helpers.resetApp = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (adb, opts = {}) {
    const app = opts.app,
          appPackage = opts.appPackage,
          fastReset = opts.fastReset,
          fullReset = opts.fullReset,
          _opts$androidInstallT = opts.androidInstallTimeout,
          androidInstallTimeout = _opts$androidInstallT === void 0 ? PACKAGE_INSTALL_TIMEOUT : _opts$androidInstallT,
          autoGrantPermissions = opts.autoGrantPermissions,
          allowTestPackages = opts.allowTestPackages;

    if (!appPackage) {
      throw new Error("'appPackage' option is required");
    }

    const isInstalled = yield adb.isAppInstalled(appPackage);

    if (isInstalled) {
      try {
        yield adb.forceStop(appPackage);
      } catch (ign) {}

      if (!fullReset && fastReset) {
        const output = yield adb.clear(appPackage);

        if (_lodash.default.isString(output) && output.toLowerCase().includes('failed')) {
          throw new Error(`Cannot clear the application data of '${appPackage}'. Original error: ${output}`);
        }

        if (autoGrantPermissions) {
          try {
            yield adb.grantAllPermissions(appPackage);
          } catch (error) {
            _logger.default.error(`Unable to grant permissions requested. Original error: ${error.message}`);
          }
        }

        _logger.default.debug(`Performed fast reset on the installed '${appPackage}' application (stop and clear)`);

        return;
      }
    }

    if (!app) {
      throw new Error("'app' option is required for reinstall");
    }

    _logger.default.debug(`Running full reset on '${appPackage}' (reinstall)`);

    if (isInstalled) {
      yield adb.uninstallApk(appPackage);
    }

    yield adb.install(app, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });
  });

  return function (_x8) {
    return _ref10.apply(this, arguments);
  };
}();

helpers.installApk = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (adb, opts = {}) {
    const app = opts.app,
          appPackage = opts.appPackage,
          fastReset = opts.fastReset,
          fullReset = opts.fullReset,
          _opts$androidInstallT2 = opts.androidInstallTimeout,
          androidInstallTimeout = _opts$androidInstallT2 === void 0 ? PACKAGE_INSTALL_TIMEOUT : _opts$androidInstallT2,
          autoGrantPermissions = opts.autoGrantPermissions,
          allowTestPackages = opts.allowTestPackages;

    if (!app || !appPackage) {
      throw new Error("'app' and 'appPackage' options are required");
    }

    if (fullReset) {
      yield this.resetApp(adb, opts);
      return;
    }

    const shouldPerformFastReset = fastReset && (yield adb.isAppInstalled(appPackage));
    yield adb.installOrUpgrade(app, appPackage, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });

    if (shouldPerformFastReset) {
      _logger.default.info(`Performing fast reset on '${appPackage}'`);

      yield this.resetApp(adb, opts);
    }
  });

  return function (_x9) {
    return _ref11.apply(this, arguments);
  };
}();

helpers.installOtherApks = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (otherApps, adb, opts) {
    let _opts$androidInstallT3 = opts.androidInstallTimeout,
        androidInstallTimeout = _opts$androidInstallT3 === void 0 ? PACKAGE_INSTALL_TIMEOUT : _opts$androidInstallT3,
        autoGrantPermissions = opts.autoGrantPermissions,
        allowTestPackages = opts.allowTestPackages;
    yield _bluebird.default.all(otherApps.map(otherApp => {
      _logger.default.debug(`Installing app: ${otherApp}`);

      return adb.installOrUpgrade(otherApp, null, {
        grantPermissions: autoGrantPermissions,
        timeout: androidInstallTimeout,
        allowTestPackages
      });
    }));
  });

  return function (_x10, _x11, _x12) {
    return _ref12.apply(this, arguments);
  };
}();

helpers.initUnicodeKeyboard = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (adb) {
    _logger.default.debug('Enabling Unicode keyboard support');

    let defaultIME = yield adb.defaultIME();

    _logger.default.debug(`Unsetting previous IME ${defaultIME}`);

    const appiumIME = `${SETTINGS_HELPER_PKG_ID}/.UnicodeIME`;

    _logger.default.debug(`Setting IME to '${appiumIME}'`);

    yield adb.enableIME(appiumIME);
    yield adb.setIME(appiumIME);
    return defaultIME;
  });

  return function (_x13) {
    return _ref13.apply(this, arguments);
  };
}();

helpers.setMockLocationApp = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (adb, app) {
    try {
      if ((yield adb.getApiLevel()) < 23) {
        yield adb.shell(['settings', 'put', 'secure', 'mock_location', '1']);
      } else {
        yield adb.shell(['appops', 'set', app, 'android:mock_location', 'allow']);
      }
    } catch (err) {
      _logger.default.warn(`Unable to set mock location for app '${app}': ${err.message}`);
    }
  });

  return function (_x14, _x15) {
    return _ref14.apply(this, arguments);
  };
}();

helpers.installHelperApp = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (adb, apkPath, packageId, appName) {
    try {
      yield adb.installOrUpgrade(apkPath, packageId, {
        grantPermissions: true
      });
    } catch (err) {
      _logger.default.warn(`Ignored error while installing Appium ${appName} helper: ` + `'${err.message}'. Manually uninstalling the application ` + `with package id '${packageId}' may help. Expect some Appium ` + `features may not work as expected unless this problem is ` + `fixed.`);
    }
  });

  return function (_x16, _x17, _x18, _x19) {
    return _ref15.apply(this, arguments);
  };
}();

helpers.pushSettingsApp = function () {
  var _ref16 = (0, _asyncToGenerator2.default)(function* (adb, throwError = false) {
    _logger.default.debug("Pushing settings apk to device...");

    yield helpers.installHelperApp(adb, _ioAppium.path, SETTINGS_HELPER_PKG_ID, 'Settings');

    if (yield adb.processExists(SETTINGS_HELPER_PKG_ID)) {
      _logger.default.debug(`${SETTINGS_HELPER_PKG_ID} is already running. ` + `There is no need to reset its permissions.`);

      return;
    }

    if ((yield adb.getApiLevel()) < 23) {
      _logger.default.info('Granting android.permission.SET_ANIMATION_SCALE, CHANGE_CONFIGURATION, ACCESS_FINE_LOCATION by pm grant');

      yield adb.grantPermissions(SETTINGS_HELPER_PKG_ID, ['android.permission.SET_ANIMATION_SCALE', 'android.permission.CHANGE_CONFIGURATION', 'android.permission.ACCESS_FINE_LOCATION']);
    }

    try {
      yield adb.startApp({
        pkg: SETTINGS_HELPER_PKG_ID,
        activity: SETTINGS_HELPER_MAIN_ACTIVITY,
        action: "android.intent.action.MAIN",
        category: "android.intent.category.LAUNCHER",
        flags: "0x10200000",
        stopApp: false
      });
    } catch (err) {
      _logger.default.warn(`Failed to launch settings app: ${err.message}`);

      if (throwError) {
        throw err;
      }
    }
  });

  return function (_x20) {
    return _ref16.apply(this, arguments);
  };
}();

helpers.pushStrings = function () {
  var _ref17 = (0, _asyncToGenerator2.default)(function* (language, adb, opts) {
    const remoteDir = '/data/local/tmp';
    const stringsJson = 'strings.json';

    const remoteFile = _path.default.posix.resolve(remoteDir, stringsJson);

    yield adb.rimraf(remoteFile);
    let app;

    try {
      app = opts.app || (yield adb.pullApk(opts.appPackage, opts.tmpDir));
    } catch (err) {
      _logger.default.info(`Failed to pull an apk from '${opts.appPackage}' to '${opts.tmpDir}'. Original error: ${err.message}`);
    }

    if (_lodash.default.isEmpty(opts.appPackage) || !(yield _appiumSupport.fs.exists(app))) {
      _logger.default.debug(`No app or package specified. Returning empty strings`);

      return {};
    }

    const stringsTmpDir = _path.default.resolve(opts.tmpDir, opts.appPackage);

    try {
      _logger.default.debug('Extracting strings from apk', app, language, stringsTmpDir);

      const _ref18 = yield adb.extractStringsFromApk(app, language, stringsTmpDir),
            apkStrings = _ref18.apkStrings,
            localPath = _ref18.localPath;

      yield adb.push(localPath, remoteDir);
      return apkStrings;
    } catch (err) {
      _logger.default.warn(`Could not get strings, continuing anyway. Original error: ${err.message}`);

      yield adb.shell('echo', [`'{}' > ${remoteFile}`]);
    } finally {
      yield _appiumSupport.fs.rimraf(stringsTmpDir);
    }

    return {};
  });

  return function (_x21, _x22, _x23) {
    return _ref17.apply(this, arguments);
  };
}();

helpers.unlockWithUIAutomation = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (driver, adb, unlockCapabilities) {
    let unlockType = unlockCapabilities.unlockType;

    if (!_unlockHelpers.default.isValidUnlockType(unlockType)) {
      throw new Error(`Invalid unlock type ${unlockType}`);
    }

    let unlockKey = unlockCapabilities.unlockKey;

    if (!_unlockHelpers.default.isValidKey(unlockType, unlockKey)) {
      throw new Error(`Missing unlockKey ${unlockKey} capability for unlockType ${unlockType}`);
    }

    const unlockMethod = {
      [_unlockHelpers.PIN_UNLOCK]: _unlockHelpers.default.pinUnlock,
      [_unlockHelpers.PASSWORD_UNLOCK]: _unlockHelpers.default.passwordUnlock,
      [_unlockHelpers.PATTERN_UNLOCK]: _unlockHelpers.default.patternUnlock,
      [_unlockHelpers.FINGERPRINT_UNLOCK]: _unlockHelpers.default.fingerprintUnlock
    }[unlockType];
    yield unlockMethod(adb, driver, unlockCapabilities);
  });

  return function (_x24, _x25, _x26) {
    return _ref19.apply(this, arguments);
  };
}();

helpers.unlockWithHelperApp = function () {
  var _ref20 = (0, _asyncToGenerator2.default)(function* (adb) {
    _logger.default.info("Unlocking screen");

    let firstRun = true;
    yield (0, _asyncbox.retry)(3, (0, _asyncToGenerator2.default)(function* () {
      if (firstRun) {
        firstRun = false;
      } else {
        try {
          if (!(yield adb.isScreenLocked())) {
            return;
          }
        } catch (e) {
          _logger.default.warn(`Error in isScreenLocked: ${e.message}`);

          _logger.default.warn("\"adb shell dumpsys window\" command has timed out.");

          _logger.default.warn("The reason of this timeout is the delayed adb response. Resetting adb server can improve it.");
        }
      }

      _logger.default.info(`Launching ${SETTINGS_HELPER_UNLOCK_ACTIVITY}`);

      yield adb.shell(['am', 'start', '-n', `${SETTINGS_HELPER_PKG_ID}/${SETTINGS_HELPER_UNLOCK_ACTIVITY}`, '-c', 'android.intent.category.LAUNCHER', '-a', 'android.intent.action.MAIN', '-f', '0x10200000']);
      yield _bluebird.default.delay(1000);
    }));
  });

  return function (_x27) {
    return _ref20.apply(this, arguments);
  };
}();

helpers.unlock = function () {
  var _ref22 = (0, _asyncToGenerator2.default)(function* (driver, adb, capabilities) {
    if (!(yield adb.isScreenLocked())) {
      _logger.default.info("Screen already unlocked, doing nothing");

      return;
    }

    _logger.default.debug("Screen is locked, trying to unlock");

    if (_lodash.default.isUndefined(capabilities.unlockType)) {
      _logger.default.warn("Using app unlock, this is going to be deprecated!");

      yield helpers.unlockWithHelperApp(adb);
    } else {
      yield helpers.unlockWithUIAutomation(driver, adb, {
        unlockType: capabilities.unlockType,
        unlockKey: capabilities.unlockKey
      });
      yield helpers.verifyUnlock(adb);
    }
  });

  return function (_x28, _x29, _x30) {
    return _ref22.apply(this, arguments);
  };
}();

helpers.verifyUnlock = function () {
  var _ref23 = (0, _asyncToGenerator2.default)(function* (adb) {
    yield (0, _asyncbox.retryInterval)(2, 1000, (0, _asyncToGenerator2.default)(function* () {
      if (yield adb.isScreenLocked()) {
        throw new Error("Screen did not unlock successfully, retrying");
      }

      _logger.default.debug("Screen unlocked successfully");
    }));
  });

  return function (_x31) {
    return _ref23.apply(this, arguments);
  };
}();

helpers.initDevice = function () {
  var _ref25 = (0, _asyncToGenerator2.default)(function* (adb, opts) {
    yield adb.waitForDevice();
    yield helpers.pushSettingsApp(adb);

    if (!opts.avd) {
      yield helpers.setMockLocationApp(adb, SETTINGS_HELPER_PKG_ID);
    }

    yield helpers.ensureDeviceLocale(adb, opts.language, opts.locale, opts.localeScript);
    yield adb.startLogcat();

    if (opts.unicodeKeyboard) {
      return yield helpers.initUnicodeKeyboard(adb);
    }
  });

  return function (_x32, _x33) {
    return _ref25.apply(this, arguments);
  };
}();

helpers.removeNullProperties = function (obj) {
  var _iteratorNormalCompletion3 = true;
  var _didIteratorError3 = false;
  var _iteratorError3 = undefined;

  try {
    for (var _iterator3 = _lodash.default.keys(obj)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
      let key = _step3.value;

      if (_lodash.default.isNull(obj[key]) || _lodash.default.isUndefined(obj[key])) {
        delete obj[key];
      }
    }
  } catch (err) {
    _didIteratorError3 = true;
    _iteratorError3 = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
        _iterator3.return();
      }
    } finally {
      if (_didIteratorError3) {
        throw _iteratorError3;
      }
    }
  }
};

helpers.truncateDecimals = function (number, digits) {
  let multiplier = Math.pow(10, digits),
      adjustedNum = number * multiplier,
      truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);
  return truncatedNum / multiplier;
};

helpers.isChromeBrowser = function (browser) {
  return _lodash.default.includes(Object.keys(CHROME_BROWSER_PACKAGE_ACTIVITY), (browser || '').toLowerCase());
};

helpers.getChromePkg = function (browser) {
  return CHROME_BROWSER_PACKAGE_ACTIVITY[browser.toLowerCase()] || CHROME_BROWSER_PACKAGE_ACTIVITY.default;
};

helpers.removeAllSessionWebSocketHandlers = function () {
  var _ref26 = (0, _asyncToGenerator2.default)(function* (server, sessionId) {
    if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
      return;
    }

    const activeHandlers = yield server.getWebSocketHandlers(sessionId);
    var _iteratorNormalCompletion4 = true;
    var _didIteratorError4 = false;
    var _iteratorError4 = undefined;

    try {
      for (var _iterator4 = _lodash.default.keys(activeHandlers)[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
        const pathname = _step4.value;
        yield server.removeWebSocketHandler(pathname);
      }
    } catch (err) {
      _didIteratorError4 = true;
      _iteratorError4 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion4 && _iterator4.return != null) {
          _iterator4.return();
        }
      } finally {
        if (_didIteratorError4) {
          throw _iteratorError4;
        }
      }
    }
  });

  return function (_x34, _x35) {
    return _ref26.apply(this, arguments);
  };
}();

helpers.parseArray = function (cap) {
  let parsedCaps;

  try {
    parsedCaps = JSON.parse(cap);
  } catch (ign) {}

  if (_lodash.default.isArray(parsedCaps)) {
    return parsedCaps;
  } else if (_lodash.default.isString(cap)) {
    return [cap];
  }

  throw new Error(`must provide a string or JSON Array; received ${cap}`);
};

helpers.validateDesiredCaps = function (caps) {
  if ((!caps.browserName || !this.isChromeBrowser(caps.browserName)) && !caps.app && !caps.appPackage) {
    _logger.default.errorAndThrow('The desired capabilities must include either an app, appPackage or browserName');
  }

  if (caps.browserName) {
    if (caps.app) {
      _logger.default.warn(`The desired capabilities should generally not include both an 'app' and a 'browserName'`);
    }

    if (caps.appPackage) {
      _logger.default.errorAndThrow(`The desired should not include both of an 'appPackage' and a 'browserName'`);
    }
  }

  return true;
};

helpers.bootstrap = _bootstrap.default;
helpers.unlocker = _unlockHelpers.default;
var _default = helpers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbmRyb2lkLWhlbHBlcnMuanMiXSwibmFtZXMiOlsiUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQiLCJDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZIiwiY2hyb21lIiwicGtnIiwiYWN0aXZpdHkiLCJjaHJvbWl1bSIsImNocm9tZWJldGEiLCJicm93c2VyIiwiZGVmYXVsdCIsIlNFVFRJTkdTX0hFTFBFUl9QS0dfSUQiLCJTRVRUSU5HU19IRUxQRVJfTUFJTl9BQ1RJVklUWSIsIlNFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFkiLCJoZWxwZXJzIiwiY3JlYXRlQmFzZUFEQiIsIm9wdHMiLCJqYXZhVmVyc2lvbiIsImFkYlBvcnQiLCJzdXBwcmVzc0tpbGxTZXJ2ZXIiLCJyZW1vdGVBZGJIb3N0IiwiY2xlYXJEZXZpY2VMb2dzT25TdGFydCIsImFkYkV4ZWNUaW1lb3V0IiwidXNlS2V5c3RvcmUiLCJrZXlzdG9yZVBhdGgiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5QWxpYXMiLCJrZXlQYXNzd29yZCIsIkFEQiIsImNyZWF0ZUFEQiIsInBhcnNlSmF2YVZlcnNpb24iLCJzdGRlcnIiLCJsaW5lcyIsInNwbGl0IiwibGluZSIsIlJlZ0V4cCIsInRlc3QiLCJyZXBsYWNlIiwiZ2V0SmF2YVZlcnNpb24iLCJsb2dWZXJzaW9uIiwiamF2YVZlciIsIkVycm9yIiwibG9nZ2VyIiwiaW5mbyIsInByZXBhcmVFbXVsYXRvciIsImFkYiIsImF2ZCIsImF2ZEFyZ3MiLCJsYW5ndWFnZSIsImxvY2FsZSIsImF2ZExhdW5jaFRpbWVvdXQiLCJhdmRSZWFkeVRpbWVvdXQiLCJhdmROYW1lIiwicnVubmluZ0FWRCIsImdldFJ1bm5pbmdBVkQiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJkZWJ1ZyIsImtpbGxFbXVsYXRvciIsInByZXBhcmVBVkRBcmdzIiwibGF1bmNoQVZEIiwiYXJncyIsIl8iLCJpc1VuZGVmaW5lZCIsIm5ldHdvcmtTcGVlZCIsImVuc3VyZU5ldHdvcmtTcGVlZCIsInB1c2giLCJpc0hlYWRsZXNzIiwiam9pbiIsInZhbHVlcyIsIk5FVFdPUktfU1BFRUQiLCJ3YXJuIiwiRlVMTCIsImVuc3VyZURldmljZUxvY2FsZSIsImNvdW50cnkiLCJzY3JpcHQiLCJpc1N0cmluZyIsInNldERldmljZUxhbmd1YWdlQ291bnRyeSIsImVuc3VyZUN1cnJlbnRMb2NhbGUiLCJtZXNzYWdlIiwiZ2V0RGV2aWNlSW5mb0Zyb21DYXBzIiwidWRpZCIsImVtUG9ydCIsImN1ckRldmljZUlkIiwiZW11bGF0b3JQb3J0IiwiZGV2aWNlcyIsImdldERldmljZXNXaXRoUmV0cnkiLCJpbmNsdWRlcyIsIm1hcCIsImVycm9yQW5kVGhyb3ciLCJnZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nIiwicGxhdGZvcm1WZXJzaW9uIiwidHJpbSIsImF2YWlsRGV2aWNlc1N0ciIsImRldmljZSIsInNldERldmljZUlkIiwiZGV2aWNlT1MiLCJnZXRQbGF0Zm9ybVZlcnNpb24iLCJzZXRFbXVsYXRvclBvcnQiLCJ2YWxpZGF0ZVBhY2thZ2VBY3Rpdml0eU5hbWVzIiwia2V5IiwibmFtZSIsIm1hdGNoIiwiZXhlYyIsImluZGV4Iiwic3Vic3RyaW5nIiwiZ2V0TGF1bmNoSW5mbyIsImFwcCIsImFwcFBhY2thZ2UiLCJhcHBBY3Rpdml0eSIsImFwcFdhaXRQYWNrYWdlIiwiYXBwV2FpdEFjdGl2aXR5IiwicGFja2FnZUFuZExhdW5jaEFjdGl2aXR5RnJvbU1hbmlmZXN0IiwiYXBrUGFja2FnZSIsImFwa0FjdGl2aXR5IiwicmVzZXRBcHAiLCJmYXN0UmVzZXQiLCJmdWxsUmVzZXQiLCJhbmRyb2lkSW5zdGFsbFRpbWVvdXQiLCJhdXRvR3JhbnRQZXJtaXNzaW9ucyIsImFsbG93VGVzdFBhY2thZ2VzIiwiaXNJbnN0YWxsZWQiLCJpc0FwcEluc3RhbGxlZCIsImZvcmNlU3RvcCIsImlnbiIsIm91dHB1dCIsImNsZWFyIiwiZ3JhbnRBbGxQZXJtaXNzaW9ucyIsImVycm9yIiwidW5pbnN0YWxsQXBrIiwiaW5zdGFsbCIsImdyYW50UGVybWlzc2lvbnMiLCJ0aW1lb3V0IiwiaW5zdGFsbEFwayIsInNob3VsZFBlcmZvcm1GYXN0UmVzZXQiLCJpbnN0YWxsT3JVcGdyYWRlIiwiaW5zdGFsbE90aGVyQXBrcyIsIm90aGVyQXBwcyIsIkIiLCJhbGwiLCJvdGhlckFwcCIsImluaXRVbmljb2RlS2V5Ym9hcmQiLCJkZWZhdWx0SU1FIiwiYXBwaXVtSU1FIiwiZW5hYmxlSU1FIiwic2V0SU1FIiwic2V0TW9ja0xvY2F0aW9uQXBwIiwiZ2V0QXBpTGV2ZWwiLCJzaGVsbCIsImVyciIsImluc3RhbGxIZWxwZXJBcHAiLCJhcGtQYXRoIiwicGFja2FnZUlkIiwiYXBwTmFtZSIsInB1c2hTZXR0aW5nc0FwcCIsInRocm93RXJyb3IiLCJzZXR0aW5nc0Fwa1BhdGgiLCJwcm9jZXNzRXhpc3RzIiwic3RhcnRBcHAiLCJhY3Rpb24iLCJjYXRlZ29yeSIsImZsYWdzIiwic3RvcEFwcCIsInB1c2hTdHJpbmdzIiwicmVtb3RlRGlyIiwic3RyaW5nc0pzb24iLCJyZW1vdGVGaWxlIiwicGF0aCIsInBvc2l4IiwicmVzb2x2ZSIsInJpbXJhZiIsInB1bGxBcGsiLCJ0bXBEaXIiLCJpc0VtcHR5IiwiZnMiLCJleGlzdHMiLCJzdHJpbmdzVG1wRGlyIiwiZXh0cmFjdFN0cmluZ3NGcm9tQXBrIiwiYXBrU3RyaW5ncyIsImxvY2FsUGF0aCIsInVubG9ja1dpdGhVSUF1dG9tYXRpb24iLCJkcml2ZXIiLCJ1bmxvY2tDYXBhYmlsaXRpZXMiLCJ1bmxvY2tUeXBlIiwidW5sb2NrZXIiLCJpc1ZhbGlkVW5sb2NrVHlwZSIsInVubG9ja0tleSIsImlzVmFsaWRLZXkiLCJ1bmxvY2tNZXRob2QiLCJQSU5fVU5MT0NLIiwicGluVW5sb2NrIiwiUEFTU1dPUkRfVU5MT0NLIiwicGFzc3dvcmRVbmxvY2siLCJQQVRURVJOX1VOTE9DSyIsInBhdHRlcm5VbmxvY2siLCJGSU5HRVJQUklOVF9VTkxPQ0siLCJmaW5nZXJwcmludFVubG9jayIsInVubG9ja1dpdGhIZWxwZXJBcHAiLCJmaXJzdFJ1biIsImlzU2NyZWVuTG9ja2VkIiwiZSIsImRlbGF5IiwidW5sb2NrIiwiY2FwYWJpbGl0aWVzIiwidmVyaWZ5VW5sb2NrIiwiaW5pdERldmljZSIsIndhaXRGb3JEZXZpY2UiLCJsb2NhbGVTY3JpcHQiLCJzdGFydExvZ2NhdCIsInVuaWNvZGVLZXlib2FyZCIsInJlbW92ZU51bGxQcm9wZXJ0aWVzIiwib2JqIiwia2V5cyIsImlzTnVsbCIsInRydW5jYXRlRGVjaW1hbHMiLCJudW1iZXIiLCJkaWdpdHMiLCJtdWx0aXBsaWVyIiwiTWF0aCIsInBvdyIsImFkanVzdGVkTnVtIiwidHJ1bmNhdGVkTnVtIiwiaXNDaHJvbWVCcm93c2VyIiwiT2JqZWN0IiwiZ2V0Q2hyb21lUGtnIiwicmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzIiwic2VydmVyIiwic2Vzc2lvbklkIiwiaXNGdW5jdGlvbiIsImdldFdlYlNvY2tldEhhbmRsZXJzIiwiYWN0aXZlSGFuZGxlcnMiLCJwYXRobmFtZSIsInJlbW92ZVdlYlNvY2tldEhhbmRsZXIiLCJwYXJzZUFycmF5IiwiY2FwIiwicGFyc2VkQ2FwcyIsIkpTT04iLCJwYXJzZSIsImlzQXJyYXkiLCJ2YWxpZGF0ZURlc2lyZWRDYXBzIiwiY2FwcyIsImJyb3dzZXJOYW1lIiwiYm9vdHN0cmFwIiwiQm9vdHN0cmFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBSUEsTUFBTUEsdUJBQXVCLEdBQUcsS0FBaEM7QUFDQSxNQUFNQywrQkFBK0IsR0FBRztBQUN0Q0MsRUFBQUEsTUFBTSxFQUFFO0FBQ05DLElBQUFBLEdBQUcsRUFBRSxvQkFEQztBQUVOQyxJQUFBQSxRQUFRLEVBQUU7QUFGSixHQUQ4QjtBQUt0Q0MsRUFBQUEsUUFBUSxFQUFFO0FBQ1JGLElBQUFBLEdBQUcsRUFBRSwyQkFERztBQUVSQyxJQUFBQSxRQUFRLEVBQUU7QUFGRixHQUw0QjtBQVN0Q0UsRUFBQUEsVUFBVSxFQUFFO0FBQ1ZILElBQUFBLEdBQUcsRUFBRSxpQkFESztBQUVWQyxJQUFBQSxRQUFRLEVBQUU7QUFGQSxHQVQwQjtBQWF0Q0csRUFBQUEsT0FBTyxFQUFFO0FBQ1BKLElBQUFBLEdBQUcsRUFBRSxxQkFERTtBQUVQQyxJQUFBQSxRQUFRLEVBQUU7QUFGSCxHQWI2QjtBQWlCdEMsc0JBQW9CO0FBQ2xCRCxJQUFBQSxHQUFHLEVBQUUscUJBRGE7QUFFbEJDLElBQUFBLFFBQVEsRUFBRTtBQUZRLEdBakJrQjtBQXFCdEMsc0JBQW9CO0FBQ2xCRCxJQUFBQSxHQUFHLEVBQUUsNEJBRGE7QUFFbEJDLElBQUFBLFFBQVEsRUFBRTtBQUZRLEdBckJrQjtBQXlCdENJLEVBQUFBLE9BQU8sRUFBRTtBQUNQTCxJQUFBQSxHQUFHLEVBQUUsb0JBREU7QUFFUEMsSUFBQUEsUUFBUSxFQUFFO0FBRkg7QUF6QjZCLENBQXhDO0FBOEJBLE1BQU1LLHNCQUFzQixHQUFHLG9CQUEvQjtBQUNBLE1BQU1DLDZCQUE2QixHQUFHLFdBQXRDO0FBQ0EsTUFBTUMsK0JBQStCLEdBQUcsU0FBeEM7QUFFQSxJQUFJQyxPQUFPLEdBQUcsRUFBZDs7O0FBRUFBLE9BQU8sQ0FBQ0MsYUFBUjtBQUFBLDZDQUF3QixXQUFnQkMsSUFBSSxHQUFHLEVBQXZCLEVBQTJCO0FBQUEsVUFJL0NDLFdBSitDLEdBZTdDRCxJQWY2QyxDQUkvQ0MsV0FKK0M7QUFBQSxVQUsvQ0MsT0FMK0MsR0FlN0NGLElBZjZDLENBSy9DRSxPQUwrQztBQUFBLFVBTS9DQyxrQkFOK0MsR0FlN0NILElBZjZDLENBTS9DRyxrQkFOK0M7QUFBQSxVQU8vQ0MsYUFQK0MsR0FlN0NKLElBZjZDLENBTy9DSSxhQVArQztBQUFBLFVBUS9DQyxzQkFSK0MsR0FlN0NMLElBZjZDLENBUS9DSyxzQkFSK0M7QUFBQSxVQVMvQ0MsY0FUK0MsR0FlN0NOLElBZjZDLENBUy9DTSxjQVQrQztBQUFBLFVBVS9DQyxXQVYrQyxHQWU3Q1AsSUFmNkMsQ0FVL0NPLFdBVitDO0FBQUEsVUFXL0NDLFlBWCtDLEdBZTdDUixJQWY2QyxDQVcvQ1EsWUFYK0M7QUFBQSxVQVkvQ0MsZ0JBWitDLEdBZTdDVCxJQWY2QyxDQVkvQ1MsZ0JBWitDO0FBQUEsVUFhL0NDLFFBYitDLEdBZTdDVixJQWY2QyxDQWEvQ1UsUUFiK0M7QUFBQSxVQWMvQ0MsV0FkK0MsR0FlN0NYLElBZjZDLENBYy9DVyxXQWQrQztBQWdCakQsaUJBQWFDLG1CQUFJQyxTQUFKLENBQWM7QUFDekJaLE1BQUFBLFdBRHlCO0FBRXpCQyxNQUFBQSxPQUZ5QjtBQUd6QkMsTUFBQUEsa0JBSHlCO0FBSXpCQyxNQUFBQSxhQUp5QjtBQUt6QkMsTUFBQUEsc0JBTHlCO0FBTXpCQyxNQUFBQSxjQU55QjtBQU96QkMsTUFBQUEsV0FQeUI7QUFRekJDLE1BQUFBLFlBUnlCO0FBU3pCQyxNQUFBQSxnQkFUeUI7QUFVekJDLE1BQUFBLFFBVnlCO0FBV3pCQyxNQUFBQTtBQVh5QixLQUFkLENBQWI7QUFhRCxHQTdCRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUErQkFiLE9BQU8sQ0FBQ2dCLGdCQUFSLEdBQTJCLFVBQVVDLE1BQVYsRUFBa0I7QUFDM0MsTUFBSUMsS0FBSyxHQUFHRCxNQUFNLENBQUNFLEtBQVAsQ0FBYSxJQUFiLENBQVo7QUFEMkM7QUFBQTtBQUFBOztBQUFBO0FBRTNDLHlCQUFpQkQsS0FBakIsOEhBQXdCO0FBQUEsVUFBZkUsSUFBZTs7QUFDdEIsVUFBSSxJQUFJQyxNQUFKLENBQVcsd0JBQVgsRUFBcUNDLElBQXJDLENBQTBDRixJQUExQyxDQUFKLEVBQXFEO0FBQ25ELGVBQU9BLElBQUksQ0FBQ0QsS0FBTCxDQUFXLEdBQVgsRUFBZ0IsQ0FBaEIsRUFBbUJJLE9BQW5CLENBQTJCLElBQTNCLEVBQWlDLEVBQWpDLENBQVA7QUFDRDtBQUNGO0FBTjBDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBTzNDLFNBQU8sSUFBUDtBQUNELENBUkQ7O0FBVUF2QixPQUFPLENBQUN3QixjQUFSO0FBQUEsOENBQXlCLFdBQWdCQyxVQUFVLEdBQUcsSUFBN0IsRUFBbUM7QUFBQSxzQkFDckMsd0JBQUssTUFBTCxFQUFhLENBQUMsVUFBRCxDQUFiLENBRHFDO0FBQUEsUUFDckRSLE1BRHFELFNBQ3JEQSxNQURxRDs7QUFFMUQsUUFBSVMsT0FBTyxHQUFHMUIsT0FBTyxDQUFDZ0IsZ0JBQVIsQ0FBeUJDLE1BQXpCLENBQWQ7O0FBQ0EsUUFBSVMsT0FBTyxLQUFLLElBQWhCLEVBQXNCO0FBQ3BCLFlBQU0sSUFBSUMsS0FBSixDQUFVLG9EQUFWLENBQU47QUFDRDs7QUFDRCxRQUFJRixVQUFKLEVBQWdCO0FBQ2RHLHNCQUFPQyxJQUFQLENBQWEsb0JBQW1CSCxPQUFRLEVBQXhDO0FBQ0Q7O0FBQ0QsV0FBT0EsT0FBUDtBQUNELEdBVkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBWUExQixPQUFPLENBQUM4QixlQUFSO0FBQUEsOENBQTBCLFdBQWdCQyxHQUFoQixFQUFxQjdCLElBQXJCLEVBQTJCO0FBQUEsUUFFakQ4QixHQUZpRCxHQVEvQzlCLElBUitDLENBRWpEOEIsR0FGaUQ7QUFBQSxRQUdqREMsT0FIaUQsR0FRL0MvQixJQVIrQyxDQUdqRCtCLE9BSGlEO0FBQUEsUUFJakRDLFFBSmlELEdBUS9DaEMsSUFSK0MsQ0FJakRnQyxRQUppRDtBQUFBLFFBS2pEQyxNQUxpRCxHQVEvQ2pDLElBUitDLENBS2pEaUMsTUFMaUQ7QUFBQSxRQU1qREMsZ0JBTmlELEdBUS9DbEMsSUFSK0MsQ0FNakRrQyxnQkFOaUQ7QUFBQSxRQU9qREMsZUFQaUQsR0FRL0NuQyxJQVIrQyxDQU9qRG1DLGVBUGlEOztBQVNuRCxRQUFJLENBQUNMLEdBQUwsRUFBVTtBQUNSLFlBQU0sSUFBSUwsS0FBSixDQUFVLG9DQUFWLENBQU47QUFDRDs7QUFDRCxRQUFJVyxPQUFPLEdBQUdOLEdBQUcsQ0FBQ1QsT0FBSixDQUFZLEdBQVosRUFBaUIsRUFBakIsQ0FBZDtBQUNBLFFBQUlnQixVQUFVLFNBQVNSLEdBQUcsQ0FBQ1MsYUFBSixDQUFrQkYsT0FBbEIsQ0FBdkI7O0FBQ0EsUUFBSUMsVUFBVSxLQUFLLElBQW5CLEVBQXlCO0FBQ3ZCLFVBQUlOLE9BQU8sSUFBSUEsT0FBTyxDQUFDUSxXQUFSLEdBQXNCQyxPQUF0QixDQUE4QixZQUE5QixJQUE4QyxDQUFDLENBQTlELEVBQWlFO0FBQy9EZCx3QkFBT2UsS0FBUCxDQUFjLFlBQVdMLE9BQVEsMENBQWpDOztBQUNBLGNBQU1QLEdBQUcsQ0FBQ2EsWUFBSixDQUFpQk4sT0FBakIsQ0FBTjtBQUNELE9BSEQsTUFHTztBQUNMVix3QkFBT2UsS0FBUCxDQUFhLGtEQUFiOztBQUNBO0FBQ0Q7QUFDRjs7QUFDRFYsSUFBQUEsT0FBTyxHQUFHLEtBQUtZLGNBQUwsQ0FBb0IzQyxJQUFwQixFQUEwQjZCLEdBQTFCLEVBQStCRSxPQUEvQixDQUFWO0FBQ0EsVUFBTUYsR0FBRyxDQUFDZSxTQUFKLENBQWNkLEdBQWQsRUFBbUJDLE9BQW5CLEVBQTRCQyxRQUE1QixFQUFzQ0MsTUFBdEMsRUFBOENDLGdCQUE5QyxFQUNjQyxlQURkLENBQU47QUFFRCxHQTFCRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUE0QkFyQyxPQUFPLENBQUM2QyxjQUFSLEdBQXlCLFVBQVUzQyxJQUFWLEVBQWdCNkIsR0FBaEIsRUFBcUJFLE9BQXJCLEVBQThCO0FBQ3JELE1BQUljLElBQUksR0FBR2QsT0FBTyxHQUFHLENBQUNBLE9BQUQsQ0FBSCxHQUFlLEVBQWpDOztBQUNBLE1BQUksQ0FBQ2UsZ0JBQUVDLFdBQUYsQ0FBYy9DLElBQUksQ0FBQ2dELFlBQW5CLENBQUwsRUFBdUM7QUFDckMsUUFBSUEsWUFBWSxHQUFHLEtBQUtDLGtCQUFMLENBQXdCcEIsR0FBeEIsRUFBNkI3QixJQUFJLENBQUNnRCxZQUFsQyxDQUFuQjtBQUNBSCxJQUFBQSxJQUFJLENBQUNLLElBQUwsQ0FBVSxXQUFWLEVBQXVCRixZQUF2QjtBQUNEOztBQUNELE1BQUloRCxJQUFJLENBQUNtRCxVQUFULEVBQXFCO0FBQ25CTixJQUFBQSxJQUFJLENBQUNLLElBQUwsQ0FBVSxZQUFWO0FBQ0Q7O0FBQ0QsU0FBT0wsSUFBSSxDQUFDTyxJQUFMLENBQVUsR0FBVixDQUFQO0FBQ0QsQ0FWRDs7QUFZQXRELE9BQU8sQ0FBQ21ELGtCQUFSLEdBQTZCLFVBQVVwQixHQUFWLEVBQWVtQixZQUFmLEVBQTZCO0FBQ3hELE1BQUlGLGdCQUFFTyxNQUFGLENBQVN4QixHQUFHLENBQUN5QixhQUFiLEVBQTRCZCxPQUE1QixDQUFvQ1EsWUFBcEMsTUFBc0QsQ0FBQyxDQUEzRCxFQUE4RDtBQUM1RCxXQUFPQSxZQUFQO0FBQ0Q7O0FBQ0R0QixrQkFBTzZCLElBQVAsQ0FBYSw2QkFBNEJQLFlBQWEsNENBQTJDRixnQkFBRU8sTUFBRixDQUFTeEIsR0FBRyxDQUFDeUIsYUFBYixDQUE0QixFQUE3SDs7QUFDQSxTQUFPekIsR0FBRyxDQUFDeUIsYUFBSixDQUFrQkUsSUFBekI7QUFDRCxDQU5EOztBQW9CQTFELE9BQU8sQ0FBQzJELGtCQUFSO0FBQUEsOENBQTZCLFdBQWdCNUIsR0FBaEIsRUFBcUJHLFFBQXJCLEVBQStCMEIsT0FBL0IsRUFBd0NDLE1BQU0sR0FBRyxJQUFqRCxFQUF1RDtBQUNsRixRQUFJLENBQUNiLGdCQUFFYyxRQUFGLENBQVc1QixRQUFYLENBQUQsSUFBeUIsQ0FBQ2MsZ0JBQUVjLFFBQUYsQ0FBV0YsT0FBWCxDQUE5QixFQUFtRDtBQUNqRGhDLHNCQUFPNkIsSUFBUCxDQUFhLHdEQUFiOztBQUNBN0Isc0JBQU82QixJQUFQLENBQWEsa0JBQWlCdkIsUUFBUyxtQkFBa0IwQixPQUFRLEdBQWpFOztBQUNBO0FBQ0Q7O0FBRUQsVUFBTTdCLEdBQUcsQ0FBQ2dDLHdCQUFKLENBQTZCN0IsUUFBN0IsRUFBdUMwQixPQUF2QyxFQUFnREMsTUFBaEQsQ0FBTjs7QUFFQSxRQUFJLFFBQU85QixHQUFHLENBQUNpQyxtQkFBSixDQUF3QjlCLFFBQXhCLEVBQWtDMEIsT0FBbEMsRUFBMkNDLE1BQTNDLENBQVAsQ0FBSixFQUErRDtBQUM3RCxZQUFNSSxPQUFPLEdBQUdKLE1BQU0sR0FBSSxhQUFZM0IsUUFBUyxjQUFhMEIsT0FBUSxnQkFBZUMsTUFBTyxFQUFwRSxHQUF5RSxhQUFZM0IsUUFBUyxpQkFBZ0IwQixPQUFRLEVBQTVJO0FBQ0EsWUFBTSxJQUFJakMsS0FBSixDQUFXLGlCQUFnQnNDLE9BQVEsRUFBbkMsQ0FBTjtBQUNEO0FBQ0YsR0FiRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFlQWpFLE9BQU8sQ0FBQ2tFLHFCQUFSO0FBQUEsOENBQWdDLFdBQWdCaEUsSUFBSSxHQUFHLEVBQXZCLEVBQTJCO0FBS3pELFVBQU02QixHQUFHLFNBQVMvQixPQUFPLENBQUNDLGFBQVIsQ0FBc0JDLElBQXRCLENBQWxCO0FBQ0EsUUFBSWlFLElBQUksR0FBR2pFLElBQUksQ0FBQ2lFLElBQWhCO0FBQ0EsUUFBSUMsTUFBTSxHQUFHLElBQWI7O0FBR0EsUUFBSWxFLElBQUksQ0FBQzhCLEdBQVQsRUFBYztBQUNaLFlBQU1oQyxPQUFPLENBQUM4QixlQUFSLENBQXdCQyxHQUF4QixFQUE2QjdCLElBQTdCLENBQU47QUFDQWlFLE1BQUFBLElBQUksR0FBR3BDLEdBQUcsQ0FBQ3NDLFdBQVg7QUFDQUQsTUFBQUEsTUFBTSxHQUFHckMsR0FBRyxDQUFDdUMsWUFBYjtBQUNELEtBSkQsTUFJTztBQUVMMUMsc0JBQU9DLElBQVAsQ0FBWSx3QkFBWjs7QUFDQSxVQUFJMEMsT0FBTyxTQUFTeEMsR0FBRyxDQUFDeUMsbUJBQUosRUFBcEI7O0FBR0EsVUFBSUwsSUFBSixFQUFVO0FBQ1IsWUFBSSxDQUFDbkIsZ0JBQUV5QixRQUFGLENBQVd6QixnQkFBRTBCLEdBQUYsQ0FBTUgsT0FBTixFQUFlLE1BQWYsQ0FBWCxFQUFtQ0osSUFBbkMsQ0FBTCxFQUErQztBQUM3Q3ZDLDBCQUFPK0MsYUFBUCxDQUFzQixVQUFTUixJQUFLLDJDQUFwQztBQUNEOztBQUNEQyxRQUFBQSxNQUFNLEdBQUdyQyxHQUFHLENBQUM2Qyx5QkFBSixDQUE4QlQsSUFBOUIsQ0FBVDtBQUNELE9BTEQsTUFLTyxJQUFJakUsSUFBSSxDQUFDMkUsZUFBVCxFQUEwQjtBQUMvQjNFLFFBQUFBLElBQUksQ0FBQzJFLGVBQUwsR0FBd0IsR0FBRTNFLElBQUksQ0FBQzJFLGVBQWdCLEVBQXhCLENBQTBCQyxJQUExQixFQUF2Qjs7QUFHQWxELHdCQUFPQyxJQUFQLENBQWEsc0NBQXFDM0IsSUFBSSxDQUFDMkUsZUFBZ0IsR0FBdkU7O0FBSUEsWUFBSUUsZUFBZSxHQUFHLEVBQXRCO0FBUitCO0FBQUE7QUFBQTs7QUFBQTtBQVcvQixnQ0FBbUJSLE9BQW5CLG1JQUE0QjtBQUFBLGdCQUFuQlMsTUFBbUI7QUFFMUIsa0JBQU1qRCxHQUFHLENBQUNrRCxXQUFKLENBQWdCRCxNQUFNLENBQUNiLElBQXZCLENBQU47QUFDQSxnQkFBSWUsUUFBUSxTQUFTbkQsR0FBRyxDQUFDb0Qsa0JBQUosRUFBckI7QUFHQUosWUFBQUEsZUFBZSxDQUFDM0IsSUFBaEIsQ0FBc0IsR0FBRTRCLE1BQU0sQ0FBQ2IsSUFBSyxLQUFJZSxRQUFTLEdBQWpEOztBQUlBLGdCQUFJQSxRQUFRLENBQUN4QyxPQUFULENBQWlCeEMsSUFBSSxDQUFDMkUsZUFBdEIsTUFBMkMsQ0FBL0MsRUFBa0Q7QUFDaERWLGNBQUFBLElBQUksR0FBR2EsTUFBTSxDQUFDYixJQUFkO0FBQ0E7QUFDRDtBQUNGO0FBekI4QjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQTRCL0IsWUFBSSxDQUFDQSxJQUFMLEVBQVc7QUFDVHZDLDBCQUFPK0MsYUFBUCxDQUFzQiw4Q0FBRCxHQUNsQixXQUFVekUsSUFBSSxDQUFDMkUsZUFBZ0IsaUNBRGIsR0FDZ0RFLGVBQWUsQ0FBQ3pCLElBQWhCLENBQXFCLElBQXJCLENBRHJFO0FBRUQ7O0FBRURjLFFBQUFBLE1BQU0sR0FBR3JDLEdBQUcsQ0FBQzZDLHlCQUFKLENBQThCVCxJQUE5QixDQUFUO0FBQ0QsT0FsQ00sTUFrQ0E7QUFFTEEsUUFBQUEsSUFBSSxHQUFHSSxPQUFPLENBQUMsQ0FBRCxDQUFQLENBQVdKLElBQWxCO0FBQ0FDLFFBQUFBLE1BQU0sR0FBR3JDLEdBQUcsQ0FBQzZDLHlCQUFKLENBQThCVCxJQUE5QixDQUFUO0FBQ0Q7QUFDRjs7QUFFRHZDLG9CQUFPQyxJQUFQLENBQWEsaUJBQWdCc0MsSUFBSyxFQUFsQzs7QUFDQSxXQUFPO0FBQUNBLE1BQUFBLElBQUQ7QUFBT0MsTUFBQUE7QUFBUCxLQUFQO0FBQ0QsR0FwRUQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBdUVBcEUsT0FBTyxDQUFDZSxTQUFSO0FBQUEsOENBQW9CLFdBQWdCYixJQUFJLEdBQUcsRUFBdkIsRUFBMkI7QUFBQSxVQUN0Q2lFLElBRHNDLEdBQ3RCakUsSUFEc0IsQ0FDdENpRSxJQURzQztBQUFBLFVBQ2hDQyxNQURnQyxHQUN0QmxFLElBRHNCLENBQ2hDa0UsTUFEZ0M7QUFFN0MsVUFBTXJDLEdBQUcsU0FBUy9CLE9BQU8sQ0FBQ0MsYUFBUixDQUFzQkMsSUFBdEIsQ0FBbEI7QUFDQTZCLElBQUFBLEdBQUcsQ0FBQ2tELFdBQUosQ0FBZ0JkLElBQWhCOztBQUNBLFFBQUlDLE1BQUosRUFBWTtBQUNWckMsTUFBQUEsR0FBRyxDQUFDcUQsZUFBSixDQUFvQmhCLE1BQXBCO0FBQ0Q7O0FBRUQsV0FBT3JDLEdBQVA7QUFDRCxHQVREOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVdBL0IsT0FBTyxDQUFDcUYsNEJBQVIsR0FBdUMsVUFBVW5GLElBQVYsRUFBZ0I7QUFBQSxhQUNuQyxDQUFDLFlBQUQsRUFBZSxhQUFmLEVBQThCLGdCQUE5QixFQUFnRCxpQkFBaEQsQ0FEbUM7O0FBQ3JELDJDQUFzRjtBQUFqRixVQUFNb0YsR0FBRyxXQUFUO0FBQ0gsVUFBTUMsSUFBSSxHQUFHckYsSUFBSSxDQUFDb0YsR0FBRCxDQUFqQjs7QUFDQSxRQUFJLENBQUNDLElBQUwsRUFBVztBQUNUO0FBQ0Q7O0FBRUQsVUFBTUMsS0FBSyxHQUFHLGNBQWNDLElBQWQsQ0FBbUJGLElBQW5CLENBQWQ7O0FBQ0EsUUFBSSxDQUFDQyxLQUFMLEVBQVk7QUFDVjtBQUNEOztBQUVENUQsb0JBQU82QixJQUFQLENBQWEsZUFBYzZCLEdBQUksc0dBQS9COztBQUNBMUQsb0JBQU82QixJQUFQLENBQWEsa0JBQWlCOEIsSUFBSyx5Q0FBd0NDLEtBQUssQ0FBQ0UsS0FBTSxNQUFLSCxJQUFJLENBQUNJLFNBQUwsQ0FBZSxDQUFmLEVBQWtCSCxLQUFLLENBQUNFLEtBQU4sR0FBYyxDQUFoQyxDQUFtQyxHQUEvSDtBQUNEO0FBQ0YsQ0FmRDs7QUFpQkExRixPQUFPLENBQUM0RixhQUFSO0FBQUEsOENBQXdCLFdBQWdCN0QsR0FBaEIsRUFBcUI3QixJQUFyQixFQUEyQjtBQUFBLFFBQzVDMkYsR0FENEMsR0FDcUIzRixJQURyQixDQUM1QzJGLEdBRDRDO0FBQUEsUUFDdkNDLFVBRHVDLEdBQ3FCNUYsSUFEckIsQ0FDdkM0RixVQUR1QztBQUFBLFFBQzNCQyxXQUQyQixHQUNxQjdGLElBRHJCLENBQzNCNkYsV0FEMkI7QUFBQSxRQUNkQyxjQURjLEdBQ3FCOUYsSUFEckIsQ0FDZDhGLGNBRGM7QUFBQSxRQUNFQyxlQURGLEdBQ3FCL0YsSUFEckIsQ0FDRStGLGVBREY7O0FBRWpELFFBQUksQ0FBQ0osR0FBTCxFQUFVO0FBQ1JqRSxzQkFBTzZCLElBQVAsQ0FBWSw4Q0FBWjs7QUFDQTtBQUNEOztBQUVELFNBQUs0Qiw0QkFBTCxDQUFrQ25GLElBQWxDOztBQUVBLFFBQUk0RixVQUFVLElBQUlDLFdBQWxCLEVBQStCO0FBQzdCO0FBQ0Q7O0FBRURuRSxvQkFBT2UsS0FBUCxDQUFhLGdEQUFiOztBQWJpRCxzQkFlekNaLEdBQUcsQ0FBQ21FLG9DQUFKLENBQXlDTCxHQUF6QyxDQWZ5QztBQUFBLFFBYzVDTSxVQWQ0QyxTQWM1Q0EsVUFkNEM7QUFBQSxRQWNoQ0MsV0FkZ0MsU0FjaENBLFdBZGdDOztBQWdCakQsUUFBSUQsVUFBVSxJQUFJLENBQUNMLFVBQW5CLEVBQStCO0FBQzdCQSxNQUFBQSxVQUFVLEdBQUdLLFVBQWI7QUFDRDs7QUFDRCxRQUFJLENBQUNILGNBQUwsRUFBcUI7QUFDbkJBLE1BQUFBLGNBQWMsR0FBR0YsVUFBakI7QUFDRDs7QUFDRCxRQUFJTSxXQUFXLElBQUksQ0FBQ0wsV0FBcEIsRUFBaUM7QUFDL0JBLE1BQUFBLFdBQVcsR0FBR0ssV0FBZDtBQUNEOztBQUNELFFBQUksQ0FBQ0gsZUFBTCxFQUFzQjtBQUNwQkEsTUFBQUEsZUFBZSxHQUFHRixXQUFsQjtBQUNEOztBQUNEbkUsb0JBQU9lLEtBQVAsQ0FBYyxvQ0FBbUN3RCxVQUFXLElBQUdDLFdBQVksRUFBM0U7O0FBQ0EsV0FBTztBQUFDTixNQUFBQSxVQUFEO0FBQWFFLE1BQUFBLGNBQWI7QUFBNkJELE1BQUFBLFdBQTdCO0FBQTBDRSxNQUFBQTtBQUExQyxLQUFQO0FBQ0QsR0E5QkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZ0NBakcsT0FBTyxDQUFDcUcsUUFBUjtBQUFBLCtDQUFtQixXQUFnQnRFLEdBQWhCLEVBQXFCN0IsSUFBSSxHQUFHLEVBQTVCLEVBQWdDO0FBQUEsVUFFL0MyRixHQUYrQyxHQVM3QzNGLElBVDZDLENBRS9DMkYsR0FGK0M7QUFBQSxVQUcvQ0MsVUFIK0MsR0FTN0M1RixJQVQ2QyxDQUcvQzRGLFVBSCtDO0FBQUEsVUFJL0NRLFNBSitDLEdBUzdDcEcsSUFUNkMsQ0FJL0NvRyxTQUorQztBQUFBLFVBSy9DQyxTQUwrQyxHQVM3Q3JHLElBVDZDLENBSy9DcUcsU0FMK0M7QUFBQSxrQ0FTN0NyRyxJQVQ2QyxDQU0vQ3NHLHFCQU4rQztBQUFBLFVBTS9DQSxxQkFOK0Msc0NBTXZCcEgsdUJBTnVCO0FBQUEsVUFPL0NxSCxvQkFQK0MsR0FTN0N2RyxJQVQ2QyxDQU8vQ3VHLG9CQVArQztBQUFBLFVBUS9DQyxpQkFSK0MsR0FTN0N4RyxJQVQ2QyxDQVEvQ3dHLGlCQVIrQzs7QUFXakQsUUFBSSxDQUFDWixVQUFMLEVBQWlCO0FBQ2YsWUFBTSxJQUFJbkUsS0FBSixDQUFVLGlDQUFWLENBQU47QUFDRDs7QUFFRCxVQUFNZ0YsV0FBVyxTQUFTNUUsR0FBRyxDQUFDNkUsY0FBSixDQUFtQmQsVUFBbkIsQ0FBMUI7O0FBRUEsUUFBSWEsV0FBSixFQUFpQjtBQUNmLFVBQUk7QUFDRixjQUFNNUUsR0FBRyxDQUFDOEUsU0FBSixDQUFjZixVQUFkLENBQU47QUFDRCxPQUZELENBRUUsT0FBT2dCLEdBQVAsRUFBWSxDQUFFOztBQUVoQixVQUFJLENBQUNQLFNBQUQsSUFBY0QsU0FBbEIsRUFBNkI7QUFDM0IsY0FBTVMsTUFBTSxTQUFTaEYsR0FBRyxDQUFDaUYsS0FBSixDQUFVbEIsVUFBVixDQUFyQjs7QUFDQSxZQUFJOUMsZ0JBQUVjLFFBQUYsQ0FBV2lELE1BQVgsS0FBc0JBLE1BQU0sQ0FBQ3RFLFdBQVAsR0FBcUJnQyxRQUFyQixDQUE4QixRQUE5QixDQUExQixFQUFtRTtBQUNqRSxnQkFBTSxJQUFJOUMsS0FBSixDQUFXLHlDQUF3Q21FLFVBQVcsc0JBQXFCaUIsTUFBTyxFQUExRixDQUFOO0FBQ0Q7O0FBRUQsWUFBSU4sb0JBQUosRUFBMEI7QUFDeEIsY0FBSTtBQUNGLGtCQUFNMUUsR0FBRyxDQUFDa0YsbUJBQUosQ0FBd0JuQixVQUF4QixDQUFOO0FBQ0QsV0FGRCxDQUVFLE9BQU9vQixLQUFQLEVBQWM7QUFDZHRGLDRCQUFPc0YsS0FBUCxDQUFjLDBEQUF5REEsS0FBSyxDQUFDakQsT0FBUSxFQUFyRjtBQUNEO0FBQ0Y7O0FBQ0RyQyx3QkFBT2UsS0FBUCxDQUFjLDBDQUF5Q21ELFVBQVcsZ0NBQWxFOztBQUNBO0FBQ0Q7QUFDRjs7QUFFRCxRQUFJLENBQUNELEdBQUwsRUFBVTtBQUNSLFlBQU0sSUFBSWxFLEtBQUosQ0FBVSx3Q0FBVixDQUFOO0FBQ0Q7O0FBRURDLG9CQUFPZSxLQUFQLENBQWMsMEJBQXlCbUQsVUFBVyxlQUFsRDs7QUFDQSxRQUFJYSxXQUFKLEVBQWlCO0FBQ2YsWUFBTTVFLEdBQUcsQ0FBQ29GLFlBQUosQ0FBaUJyQixVQUFqQixDQUFOO0FBQ0Q7O0FBQ0QsVUFBTS9ELEdBQUcsQ0FBQ3FGLE9BQUosQ0FBWXZCLEdBQVosRUFBaUI7QUFDckJ3QixNQUFBQSxnQkFBZ0IsRUFBRVosb0JBREc7QUFFckJhLE1BQUFBLE9BQU8sRUFBRWQscUJBRlk7QUFHckJFLE1BQUFBO0FBSHFCLEtBQWpCLENBQU47QUFLRCxHQXJERDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUF1REExRyxPQUFPLENBQUN1SCxVQUFSO0FBQUEsK0NBQXFCLFdBQWdCeEYsR0FBaEIsRUFBcUI3QixJQUFJLEdBQUcsRUFBNUIsRUFBZ0M7QUFBQSxVQUVqRDJGLEdBRmlELEdBUy9DM0YsSUFUK0MsQ0FFakQyRixHQUZpRDtBQUFBLFVBR2pEQyxVQUhpRCxHQVMvQzVGLElBVCtDLENBR2pENEYsVUFIaUQ7QUFBQSxVQUlqRFEsU0FKaUQsR0FTL0NwRyxJQVQrQyxDQUlqRG9HLFNBSmlEO0FBQUEsVUFLakRDLFNBTGlELEdBUy9DckcsSUFUK0MsQ0FLakRxRyxTQUxpRDtBQUFBLG1DQVMvQ3JHLElBVCtDLENBTWpEc0cscUJBTmlEO0FBQUEsVUFNakRBLHFCQU5pRCx1Q0FNekJwSCx1QkFOeUI7QUFBQSxVQU9qRHFILG9CQVBpRCxHQVMvQ3ZHLElBVCtDLENBT2pEdUcsb0JBUGlEO0FBQUEsVUFRakRDLGlCQVJpRCxHQVMvQ3hHLElBVCtDLENBUWpEd0csaUJBUmlEOztBQVduRCxRQUFJLENBQUNiLEdBQUQsSUFBUSxDQUFDQyxVQUFiLEVBQXlCO0FBQ3ZCLFlBQU0sSUFBSW5FLEtBQUosQ0FBVSw2Q0FBVixDQUFOO0FBQ0Q7O0FBRUQsUUFBSTRFLFNBQUosRUFBZTtBQUNiLFlBQU0sS0FBS0YsUUFBTCxDQUFjdEUsR0FBZCxFQUFtQjdCLElBQW5CLENBQU47QUFDQTtBQUNEOztBQUdELFVBQU1zSCxzQkFBc0IsR0FBR2xCLFNBQVMsV0FBVXZFLEdBQUcsQ0FBQzZFLGNBQUosQ0FBbUJkLFVBQW5CLENBQVYsQ0FBeEM7QUFFQSxVQUFNL0QsR0FBRyxDQUFDMEYsZ0JBQUosQ0FBcUI1QixHQUFyQixFQUEwQkMsVUFBMUIsRUFBc0M7QUFDMUN1QixNQUFBQSxnQkFBZ0IsRUFBRVosb0JBRHdCO0FBRTFDYSxNQUFBQSxPQUFPLEVBQUVkLHFCQUZpQztBQUcxQ0UsTUFBQUE7QUFIMEMsS0FBdEMsQ0FBTjs7QUFNQSxRQUFJYyxzQkFBSixFQUE0QjtBQUMxQjVGLHNCQUFPQyxJQUFQLENBQWEsNkJBQTRCaUUsVUFBVyxHQUFwRDs7QUFDQSxZQUFNLEtBQUtPLFFBQUwsQ0FBY3RFLEdBQWQsRUFBbUI3QixJQUFuQixDQUFOO0FBQ0Q7QUFDRixHQWpDRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUF3Q0FGLE9BQU8sQ0FBQzBILGdCQUFSO0FBQUEsK0NBQTJCLFdBQWdCQyxTQUFoQixFQUEyQjVGLEdBQTNCLEVBQWdDN0IsSUFBaEMsRUFBc0M7QUFBQSxpQ0FLM0RBLElBTDJELENBRTdEc0cscUJBRjZEO0FBQUEsUUFFN0RBLHFCQUY2RCx1Q0FFckNwSCx1QkFGcUM7QUFBQSxRQUc3RHFILG9CQUg2RCxHQUszRHZHLElBTDJELENBRzdEdUcsb0JBSDZEO0FBQUEsUUFJN0RDLGlCQUo2RCxHQUszRHhHLElBTDJELENBSTdEd0csaUJBSjZEO0FBUS9ELFVBQU1rQixrQkFBRUMsR0FBRixDQUFNRixTQUFTLENBQUNqRCxHQUFWLENBQWVvRCxRQUFELElBQWM7QUFDdENsRyxzQkFBT2UsS0FBUCxDQUFjLG1CQUFrQm1GLFFBQVMsRUFBekM7O0FBQ0EsYUFBTy9GLEdBQUcsQ0FBQzBGLGdCQUFKLENBQXFCSyxRQUFyQixFQUErQixJQUEvQixFQUFxQztBQUMxQ1QsUUFBQUEsZ0JBQWdCLEVBQUVaLG9CQUR3QjtBQUUxQ2EsUUFBQUEsT0FBTyxFQUFFZCxxQkFGaUM7QUFHMUNFLFFBQUFBO0FBSDBDLE9BQXJDLENBQVA7QUFLRCxLQVBXLENBQU4sQ0FBTjtBQVFELEdBaEJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWtCQTFHLE9BQU8sQ0FBQytILG1CQUFSO0FBQUEsK0NBQThCLFdBQWdCaEcsR0FBaEIsRUFBcUI7QUFDakRILG9CQUFPZSxLQUFQLENBQWEsbUNBQWI7O0FBR0EsUUFBSXFGLFVBQVUsU0FBU2pHLEdBQUcsQ0FBQ2lHLFVBQUosRUFBdkI7O0FBRUFwRyxvQkFBT2UsS0FBUCxDQUFjLDBCQUF5QnFGLFVBQVcsRUFBbEQ7O0FBQ0EsVUFBTUMsU0FBUyxHQUFJLEdBQUVwSSxzQkFBdUIsY0FBNUM7O0FBQ0ErQixvQkFBT2UsS0FBUCxDQUFjLG1CQUFrQnNGLFNBQVUsR0FBMUM7O0FBQ0EsVUFBTWxHLEdBQUcsQ0FBQ21HLFNBQUosQ0FBY0QsU0FBZCxDQUFOO0FBQ0EsVUFBTWxHLEdBQUcsQ0FBQ29HLE1BQUosQ0FBV0YsU0FBWCxDQUFOO0FBQ0EsV0FBT0QsVUFBUDtBQUNELEdBWkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBY0FoSSxPQUFPLENBQUNvSSxrQkFBUjtBQUFBLCtDQUE2QixXQUFnQnJHLEdBQWhCLEVBQXFCOEQsR0FBckIsRUFBMEI7QUFDckQsUUFBSTtBQUNGLFVBQUksT0FBTTlELEdBQUcsQ0FBQ3NHLFdBQUosRUFBTixJQUEwQixFQUE5QixFQUFrQztBQUNoQyxjQUFNdEcsR0FBRyxDQUFDdUcsS0FBSixDQUFVLENBQUMsVUFBRCxFQUFhLEtBQWIsRUFBb0IsUUFBcEIsRUFBOEIsZUFBOUIsRUFBK0MsR0FBL0MsQ0FBVixDQUFOO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsY0FBTXZHLEdBQUcsQ0FBQ3VHLEtBQUosQ0FBVSxDQUFDLFFBQUQsRUFBVyxLQUFYLEVBQWtCekMsR0FBbEIsRUFBdUIsdUJBQXZCLEVBQWdELE9BQWhELENBQVYsQ0FBTjtBQUNEO0FBQ0YsS0FORCxDQU1FLE9BQU8wQyxHQUFQLEVBQVk7QUFDWjNHLHNCQUFPNkIsSUFBUCxDQUFhLHdDQUF1Q29DLEdBQUksTUFBSzBDLEdBQUcsQ0FBQ3RFLE9BQVEsRUFBekU7QUFDRDtBQUNGLEdBVkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBWUFqRSxPQUFPLENBQUN3SSxnQkFBUjtBQUFBLCtDQUEyQixXQUFnQnpHLEdBQWhCLEVBQXFCMEcsT0FBckIsRUFBOEJDLFNBQTlCLEVBQXlDQyxPQUF6QyxFQUFrRDtBQUMzRSxRQUFJO0FBQ0YsWUFBTTVHLEdBQUcsQ0FBQzBGLGdCQUFKLENBQXFCZ0IsT0FBckIsRUFBOEJDLFNBQTlCLEVBQXlDO0FBQUNyQixRQUFBQSxnQkFBZ0IsRUFBRTtBQUFuQixPQUF6QyxDQUFOO0FBQ0QsS0FGRCxDQUVFLE9BQU9rQixHQUFQLEVBQVk7QUFDWjNHLHNCQUFPNkIsSUFBUCxDQUFhLHlDQUF3Q2tGLE9BQVEsV0FBakQsR0FDQyxJQUFHSixHQUFHLENBQUN0RSxPQUFRLDJDQURoQixHQUVDLG9CQUFtQnlFLFNBQVUsaUNBRjlCLEdBR0MsMkRBSEQsR0FJQyxRQUpiO0FBS0Q7QUFDRixHQVZEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVlBMUksT0FBTyxDQUFDNEksZUFBUjtBQUFBLCtDQUEwQixXQUFnQjdHLEdBQWhCLEVBQXFCOEcsVUFBVSxHQUFHLEtBQWxDLEVBQXlDO0FBQ2pFakgsb0JBQU9lLEtBQVAsQ0FBYSxtQ0FBYjs7QUFFQSxVQUFNM0MsT0FBTyxDQUFDd0ksZ0JBQVIsQ0FBeUJ6RyxHQUF6QixFQUE4QitHLGNBQTlCLEVBQStDakosc0JBQS9DLEVBQXVFLFVBQXZFLENBQU47O0FBSUEsY0FBVWtDLEdBQUcsQ0FBQ2dILGFBQUosQ0FBa0JsSixzQkFBbEIsQ0FBVixFQUFxRDtBQUNuRCtCLHNCQUFPZSxLQUFQLENBQWMsR0FBRTlDLHNCQUF1Qix1QkFBMUIsR0FDViw0Q0FESDs7QUFFQTtBQUNEOztBQUVELFFBQUksT0FBTWtDLEdBQUcsQ0FBQ3NHLFdBQUosRUFBTixJQUEwQixFQUE5QixFQUFrQztBQUVoQ3pHLHNCQUFPQyxJQUFQLENBQVkseUdBQVo7O0FBQ0EsWUFBTUUsR0FBRyxDQUFDc0YsZ0JBQUosQ0FBcUJ4SCxzQkFBckIsRUFBNkMsQ0FDakQsd0NBRGlELEVBRWpELHlDQUZpRCxFQUdqRCx5Q0FIaUQsQ0FBN0MsQ0FBTjtBQUtEOztBQUtELFFBQUk7QUFDRixZQUFNa0MsR0FBRyxDQUFDaUgsUUFBSixDQUFhO0FBQ2pCekosUUFBQUEsR0FBRyxFQUFFTSxzQkFEWTtBQUVqQkwsUUFBQUEsUUFBUSxFQUFFTSw2QkFGTztBQUdqQm1KLFFBQUFBLE1BQU0sRUFBRSw0QkFIUztBQUlqQkMsUUFBQUEsUUFBUSxFQUFFLGtDQUpPO0FBS2pCQyxRQUFBQSxLQUFLLEVBQUUsWUFMVTtBQU1qQkMsUUFBQUEsT0FBTyxFQUFFO0FBTlEsT0FBYixDQUFOO0FBUUQsS0FURCxDQVNFLE9BQU9iLEdBQVAsRUFBWTtBQUNaM0csc0JBQU82QixJQUFQLENBQWEsa0NBQWlDOEUsR0FBRyxDQUFDdEUsT0FBUSxFQUExRDs7QUFDQSxVQUFJNEUsVUFBSixFQUFnQjtBQUNkLGNBQU1OLEdBQU47QUFDRDtBQUNGO0FBQ0YsR0F6Q0Q7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBeURBdkksT0FBTyxDQUFDcUosV0FBUjtBQUFBLCtDQUFzQixXQUFnQm5ILFFBQWhCLEVBQTBCSCxHQUExQixFQUErQjdCLElBQS9CLEVBQXFDO0FBQ3pELFVBQU1vSixTQUFTLEdBQUcsaUJBQWxCO0FBQ0EsVUFBTUMsV0FBVyxHQUFHLGNBQXBCOztBQUNBLFVBQU1DLFVBQVUsR0FBR0MsY0FBS0MsS0FBTCxDQUFXQyxPQUFYLENBQW1CTCxTQUFuQixFQUE4QkMsV0FBOUIsQ0FBbkI7O0FBR0EsVUFBTXhILEdBQUcsQ0FBQzZILE1BQUosQ0FBV0osVUFBWCxDQUFOO0FBRUEsUUFBSTNELEdBQUo7O0FBQ0EsUUFBSTtBQUNGQSxNQUFBQSxHQUFHLEdBQUczRixJQUFJLENBQUMyRixHQUFMLFdBQWtCOUQsR0FBRyxDQUFDOEgsT0FBSixDQUFZM0osSUFBSSxDQUFDNEYsVUFBakIsRUFBNkI1RixJQUFJLENBQUM0SixNQUFsQyxDQUFsQixDQUFOO0FBQ0QsS0FGRCxDQUVFLE9BQU92QixHQUFQLEVBQVk7QUFDWjNHLHNCQUFPQyxJQUFQLENBQWEsK0JBQThCM0IsSUFBSSxDQUFDNEYsVUFBVyxTQUFRNUYsSUFBSSxDQUFDNEosTUFBTyxzQkFBcUJ2QixHQUFHLENBQUN0RSxPQUFRLEVBQWhIO0FBQ0Q7O0FBRUQsUUFBSWpCLGdCQUFFK0csT0FBRixDQUFVN0osSUFBSSxDQUFDNEYsVUFBZixLQUE4QixRQUFRa0Usa0JBQUdDLE1BQUgsQ0FBVXBFLEdBQVYsQ0FBUixDQUFsQyxFQUEyRDtBQUN6RGpFLHNCQUFPZSxLQUFQLENBQWMsc0RBQWQ7O0FBQ0EsYUFBTyxFQUFQO0FBQ0Q7O0FBRUQsVUFBTXVILGFBQWEsR0FBR1QsY0FBS0UsT0FBTCxDQUFhekosSUFBSSxDQUFDNEosTUFBbEIsRUFBMEI1SixJQUFJLENBQUM0RixVQUEvQixDQUF0Qjs7QUFDQSxRQUFJO0FBQ0ZsRSxzQkFBT2UsS0FBUCxDQUFhLDZCQUFiLEVBQTRDa0QsR0FBNUMsRUFBaUQzRCxRQUFqRCxFQUEyRGdJLGFBQTNEOztBQURFLDJCQUVvQ25JLEdBQUcsQ0FBQ29JLHFCQUFKLENBQTBCdEUsR0FBMUIsRUFBK0IzRCxRQUEvQixFQUF5Q2dJLGFBQXpDLENBRnBDO0FBQUEsWUFFS0UsVUFGTCxVQUVLQSxVQUZMO0FBQUEsWUFFaUJDLFNBRmpCLFVBRWlCQSxTQUZqQjs7QUFHRixZQUFNdEksR0FBRyxDQUFDcUIsSUFBSixDQUFTaUgsU0FBVCxFQUFvQmYsU0FBcEIsQ0FBTjtBQUNBLGFBQU9jLFVBQVA7QUFDRCxLQUxELENBS0UsT0FBTzdCLEdBQVAsRUFBWTtBQUNaM0csc0JBQU82QixJQUFQLENBQWEsNkRBQTREOEUsR0FBRyxDQUFDdEUsT0FBUSxFQUFyRjs7QUFDQSxZQUFNbEMsR0FBRyxDQUFDdUcsS0FBSixDQUFVLE1BQVYsRUFBa0IsQ0FBRSxVQUFTa0IsVUFBVyxFQUF0QixDQUFsQixDQUFOO0FBQ0QsS0FSRCxTQVFVO0FBQ1IsWUFBTVEsa0JBQUdKLE1BQUgsQ0FBVU0sYUFBVixDQUFOO0FBQ0Q7O0FBQ0QsV0FBTyxFQUFQO0FBQ0QsR0FqQ0Q7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBbUNBbEssT0FBTyxDQUFDc0ssc0JBQVI7QUFBQSwrQ0FBaUMsV0FBZ0JDLE1BQWhCLEVBQXdCeEksR0FBeEIsRUFBNkJ5SSxrQkFBN0IsRUFBaUQ7QUFDaEYsUUFBSUMsVUFBVSxHQUFHRCxrQkFBa0IsQ0FBQ0MsVUFBcEM7O0FBQ0EsUUFBSSxDQUFDQyx1QkFBU0MsaUJBQVQsQ0FBMkJGLFVBQTNCLENBQUwsRUFBNkM7QUFDM0MsWUFBTSxJQUFJOUksS0FBSixDQUFXLHVCQUFzQjhJLFVBQVcsRUFBNUMsQ0FBTjtBQUNEOztBQUNELFFBQUlHLFNBQVMsR0FBR0osa0JBQWtCLENBQUNJLFNBQW5DOztBQUNBLFFBQUksQ0FBQ0YsdUJBQVNHLFVBQVQsQ0FBb0JKLFVBQXBCLEVBQWdDRyxTQUFoQyxDQUFMLEVBQWlEO0FBQy9DLFlBQU0sSUFBSWpKLEtBQUosQ0FBVyxxQkFBb0JpSixTQUFVLDhCQUE2QkgsVUFBVyxFQUFqRixDQUFOO0FBQ0Q7O0FBQ0QsVUFBTUssWUFBWSxHQUFHO0FBQ25CLE9BQUNDLHlCQUFELEdBQWNMLHVCQUFTTSxTQURKO0FBRW5CLE9BQUNDLDhCQUFELEdBQW1CUCx1QkFBU1EsY0FGVDtBQUduQixPQUFDQyw2QkFBRCxHQUFrQlQsdUJBQVNVLGFBSFI7QUFJbkIsT0FBQ0MsaUNBQUQsR0FBc0JYLHVCQUFTWTtBQUpaLE1BS25CYixVQUxtQixDQUFyQjtBQU1BLFVBQU1LLFlBQVksQ0FBQy9JLEdBQUQsRUFBTXdJLE1BQU4sRUFBY0Msa0JBQWQsQ0FBbEI7QUFDRCxHQWhCRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFrQkF4SyxPQUFPLENBQUN1TCxtQkFBUjtBQUFBLCtDQUE4QixXQUFnQnhKLEdBQWhCLEVBQXFCO0FBQ2pESCxvQkFBT0MsSUFBUCxDQUFZLGtCQUFaOztBQUdBLFFBQUkySixRQUFRLEdBQUcsSUFBZjtBQUNBLFVBQU0scUJBQU0sQ0FBTixrQ0FBUyxhQUFrQjtBQUUvQixVQUFJQSxRQUFKLEVBQWM7QUFDWkEsUUFBQUEsUUFBUSxHQUFHLEtBQVg7QUFDRCxPQUZELE1BRU87QUFDTCxZQUFJO0FBQ0YsY0FBSSxRQUFRekosR0FBRyxDQUFDMEosY0FBSixFQUFSLENBQUosRUFBbUM7QUFDakM7QUFDRDtBQUNGLFNBSkQsQ0FJRSxPQUFPQyxDQUFQLEVBQVU7QUFDVjlKLDBCQUFPNkIsSUFBUCxDQUFhLDRCQUEyQmlJLENBQUMsQ0FBQ3pILE9BQVEsRUFBbEQ7O0FBQ0FyQywwQkFBTzZCLElBQVAsQ0FBWSxxREFBWjs7QUFDQTdCLDBCQUFPNkIsSUFBUCxDQUFZLDhGQUFaO0FBQ0Q7QUFDRjs7QUFFRDdCLHNCQUFPQyxJQUFQLENBQWEsYUFBWTlCLCtCQUFnQyxFQUF6RDs7QUFDQSxZQUFNZ0MsR0FBRyxDQUFDdUcsS0FBSixDQUFVLENBQ2QsSUFEYyxFQUNSLE9BRFEsRUFFZCxJQUZjLEVBRVAsR0FBRXpJLHNCQUF1QixJQUFHRSwrQkFBZ0MsRUFGckQsRUFHZCxJQUhjLEVBR1Isa0NBSFEsRUFJZCxJQUpjLEVBSVIsNEJBSlEsRUFLZCxJQUxjLEVBS1IsWUFMUSxDQUFWLENBQU47QUFPQSxZQUFNNkgsa0JBQUUrRCxLQUFGLENBQVEsSUFBUixDQUFOO0FBQ0QsS0F6QkssRUFBTjtBQTBCRCxHQS9CRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFpQ0EzTCxPQUFPLENBQUM0TCxNQUFSO0FBQUEsK0NBQWlCLFdBQWdCckIsTUFBaEIsRUFBd0J4SSxHQUF4QixFQUE2QjhKLFlBQTdCLEVBQTJDO0FBQzFELFFBQUksUUFBUTlKLEdBQUcsQ0FBQzBKLGNBQUosRUFBUixDQUFKLEVBQW1DO0FBQ2pDN0osc0JBQU9DLElBQVAsQ0FBWSx3Q0FBWjs7QUFDQTtBQUNEOztBQUVERCxvQkFBT2UsS0FBUCxDQUFhLG9DQUFiOztBQUNBLFFBQUlLLGdCQUFFQyxXQUFGLENBQWM0SSxZQUFZLENBQUNwQixVQUEzQixDQUFKLEVBQTRDO0FBQzFDN0ksc0JBQU82QixJQUFQLENBQVksbURBQVo7O0FBQ0EsWUFBTXpELE9BQU8sQ0FBQ3VMLG1CQUFSLENBQTRCeEosR0FBNUIsQ0FBTjtBQUNELEtBSEQsTUFHTztBQUNMLFlBQU0vQixPQUFPLENBQUNzSyxzQkFBUixDQUErQkMsTUFBL0IsRUFBdUN4SSxHQUF2QyxFQUE0QztBQUFDMEksUUFBQUEsVUFBVSxFQUFFb0IsWUFBWSxDQUFDcEIsVUFBMUI7QUFBc0NHLFFBQUFBLFNBQVMsRUFBRWlCLFlBQVksQ0FBQ2pCO0FBQTlELE9BQTVDLENBQU47QUFDQSxZQUFNNUssT0FBTyxDQUFDOEwsWUFBUixDQUFxQi9KLEdBQXJCLENBQU47QUFDRDtBQUNGLEdBZEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZ0JBL0IsT0FBTyxDQUFDOEwsWUFBUjtBQUFBLCtDQUF1QixXQUFnQi9KLEdBQWhCLEVBQXFCO0FBQzFDLFVBQU0sNkJBQWMsQ0FBZCxFQUFpQixJQUFqQixrQ0FBdUIsYUFBWTtBQUN2QyxnQkFBVUEsR0FBRyxDQUFDMEosY0FBSixFQUFWLEVBQWdDO0FBQzlCLGNBQU0sSUFBSTlKLEtBQUosQ0FBVSw4Q0FBVixDQUFOO0FBQ0Q7O0FBQ0RDLHNCQUFPZSxLQUFQLENBQWEsOEJBQWI7QUFDRCxLQUxLLEVBQU47QUFNRCxHQVBEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVNBM0MsT0FBTyxDQUFDK0wsVUFBUjtBQUFBLCtDQUFxQixXQUFnQmhLLEdBQWhCLEVBQXFCN0IsSUFBckIsRUFBMkI7QUFDOUMsVUFBTTZCLEdBQUcsQ0FBQ2lLLGFBQUosRUFBTjtBQUVBLFVBQU1oTSxPQUFPLENBQUM0SSxlQUFSLENBQXdCN0csR0FBeEIsQ0FBTjs7QUFDQSxRQUFJLENBQUM3QixJQUFJLENBQUM4QixHQUFWLEVBQWU7QUFDYixZQUFNaEMsT0FBTyxDQUFDb0ksa0JBQVIsQ0FBMkJyRyxHQUEzQixFQUFnQ2xDLHNCQUFoQyxDQUFOO0FBQ0Q7O0FBRUQsVUFBTUcsT0FBTyxDQUFDMkQsa0JBQVIsQ0FBMkI1QixHQUEzQixFQUFnQzdCLElBQUksQ0FBQ2dDLFFBQXJDLEVBQStDaEMsSUFBSSxDQUFDaUMsTUFBcEQsRUFBNERqQyxJQUFJLENBQUMrTCxZQUFqRSxDQUFOO0FBQ0EsVUFBTWxLLEdBQUcsQ0FBQ21LLFdBQUosRUFBTjs7QUFDQSxRQUFJaE0sSUFBSSxDQUFDaU0sZUFBVCxFQUEwQjtBQUN4QixtQkFBYW5NLE9BQU8sQ0FBQytILG1CQUFSLENBQTRCaEcsR0FBNUIsQ0FBYjtBQUNEO0FBQ0YsR0FiRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFlQS9CLE9BQU8sQ0FBQ29NLG9CQUFSLEdBQStCLFVBQVVDLEdBQVYsRUFBZTtBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUM1QywwQkFBZ0JySixnQkFBRXNKLElBQUYsQ0FBT0QsR0FBUCxDQUFoQixtSUFBNkI7QUFBQSxVQUFwQi9HLEdBQW9COztBQUMzQixVQUFJdEMsZ0JBQUV1SixNQUFGLENBQVNGLEdBQUcsQ0FBQy9HLEdBQUQsQ0FBWixLQUFzQnRDLGdCQUFFQyxXQUFGLENBQWNvSixHQUFHLENBQUMvRyxHQUFELENBQWpCLENBQTFCLEVBQW1EO0FBQ2pELGVBQU8rRyxHQUFHLENBQUMvRyxHQUFELENBQVY7QUFDRDtBQUNGO0FBTDJDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFNN0MsQ0FORDs7QUFRQXRGLE9BQU8sQ0FBQ3dNLGdCQUFSLEdBQTJCLFVBQVVDLE1BQVYsRUFBa0JDLE1BQWxCLEVBQTBCO0FBQ25ELE1BQUlDLFVBQVUsR0FBR0MsSUFBSSxDQUFDQyxHQUFMLENBQVMsRUFBVCxFQUFhSCxNQUFiLENBQWpCO0FBQUEsTUFDSUksV0FBVyxHQUFHTCxNQUFNLEdBQUdFLFVBRDNCO0FBQUEsTUFFSUksWUFBWSxHQUFHSCxJQUFJLENBQUNFLFdBQVcsR0FBRyxDQUFkLEdBQWtCLE1BQWxCLEdBQTJCLE9BQTVCLENBQUosQ0FBeUNBLFdBQXpDLENBRm5CO0FBSUEsU0FBT0MsWUFBWSxHQUFHSixVQUF0QjtBQUNELENBTkQ7O0FBUUEzTSxPQUFPLENBQUNnTixlQUFSLEdBQTBCLFVBQVVyTixPQUFWLEVBQW1CO0FBQzNDLFNBQU9xRCxnQkFBRXlCLFFBQUYsQ0FBV3dJLE1BQU0sQ0FBQ1gsSUFBUCxDQUFZak4sK0JBQVosQ0FBWCxFQUF5RCxDQUFDTSxPQUFPLElBQUksRUFBWixFQUFnQjhDLFdBQWhCLEVBQXpELENBQVA7QUFDRCxDQUZEOztBQUlBekMsT0FBTyxDQUFDa04sWUFBUixHQUF1QixVQUFVdk4sT0FBVixFQUFtQjtBQUN4QyxTQUFPTiwrQkFBK0IsQ0FBQ00sT0FBTyxDQUFDOEMsV0FBUixFQUFELENBQS9CLElBQTBEcEQsK0JBQStCLENBQUNPLE9BQWpHO0FBQ0QsQ0FGRDs7QUFJQUksT0FBTyxDQUFDbU4saUNBQVI7QUFBQSwrQ0FBNEMsV0FBZ0JDLE1BQWhCLEVBQXdCQyxTQUF4QixFQUFtQztBQUM3RSxRQUFJLENBQUNELE1BQUQsSUFBVyxDQUFDcEssZ0JBQUVzSyxVQUFGLENBQWFGLE1BQU0sQ0FBQ0csb0JBQXBCLENBQWhCLEVBQTJEO0FBQ3pEO0FBQ0Q7O0FBRUQsVUFBTUMsY0FBYyxTQUFTSixNQUFNLENBQUNHLG9CQUFQLENBQTRCRixTQUE1QixDQUE3QjtBQUw2RTtBQUFBO0FBQUE7O0FBQUE7QUFNN0UsNEJBQXVCckssZ0JBQUVzSixJQUFGLENBQU9rQixjQUFQLENBQXZCLG1JQUErQztBQUFBLGNBQXBDQyxRQUFvQztBQUM3QyxjQUFNTCxNQUFNLENBQUNNLHNCQUFQLENBQThCRCxRQUE5QixDQUFOO0FBQ0Q7QUFSNEU7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVM5RSxHQVREOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWlCQXpOLE9BQU8sQ0FBQzJOLFVBQVIsR0FBcUIsVUFBVUMsR0FBVixFQUFlO0FBQ2xDLE1BQUlDLFVBQUo7O0FBQ0EsTUFBSTtBQUNGQSxJQUFBQSxVQUFVLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXSCxHQUFYLENBQWI7QUFDRCxHQUZELENBRUUsT0FBTzlHLEdBQVAsRUFBWSxDQUFHOztBQUVqQixNQUFJOUQsZ0JBQUVnTCxPQUFGLENBQVVILFVBQVYsQ0FBSixFQUEyQjtBQUN6QixXQUFPQSxVQUFQO0FBQ0QsR0FGRCxNQUVPLElBQUk3SyxnQkFBRWMsUUFBRixDQUFXOEosR0FBWCxDQUFKLEVBQXFCO0FBQzFCLFdBQU8sQ0FBQ0EsR0FBRCxDQUFQO0FBQ0Q7O0FBRUQsUUFBTSxJQUFJak0sS0FBSixDQUFXLGlEQUFnRGlNLEdBQUksRUFBL0QsQ0FBTjtBQUNELENBYkQ7O0FBZUE1TixPQUFPLENBQUNpTyxtQkFBUixHQUE4QixVQUFVQyxJQUFWLEVBQWdCO0FBRTVDLE1BQUksQ0FBQyxDQUFDQSxJQUFJLENBQUNDLFdBQU4sSUFBcUIsQ0FBQyxLQUFLbkIsZUFBTCxDQUFxQmtCLElBQUksQ0FBQ0MsV0FBMUIsQ0FBdkIsS0FBa0UsQ0FBQ0QsSUFBSSxDQUFDckksR0FBeEUsSUFBK0UsQ0FBQ3FJLElBQUksQ0FBQ3BJLFVBQXpGLEVBQXFHO0FBQ25HbEUsb0JBQU8rQyxhQUFQLENBQXFCLGdGQUFyQjtBQUNEOztBQUNELE1BQUl1SixJQUFJLENBQUNDLFdBQVQsRUFBc0I7QUFDcEIsUUFBSUQsSUFBSSxDQUFDckksR0FBVCxFQUFjO0FBRVpqRSxzQkFBTzZCLElBQVAsQ0FBYSx5RkFBYjtBQUNEOztBQUNELFFBQUl5SyxJQUFJLENBQUNwSSxVQUFULEVBQXFCO0FBQ25CbEUsc0JBQU8rQyxhQUFQLENBQXNCLDRFQUF0QjtBQUNEO0FBQ0Y7O0FBRUQsU0FBTyxJQUFQO0FBQ0QsQ0FoQkQ7O0FBa0JBM0UsT0FBTyxDQUFDb08sU0FBUixHQUFvQkMsa0JBQXBCO0FBQ0FyTyxPQUFPLENBQUMwSyxRQUFSLEdBQW1CQSxzQkFBbkI7ZUFHZTFLLE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IHJldHJ5LCByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHBhdGggYXMgc2V0dGluZ3NBcGtQYXRoIH0gZnJvbSAnaW8uYXBwaXVtLnNldHRpbmdzJztcbmltcG9ydCBCb290c3RyYXAgZnJvbSAnLi9ib290c3RyYXAnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IEFEQiBmcm9tICdhcHBpdW0tYWRiJztcbmltcG9ydCB7IGRlZmF1bHQgYXMgdW5sb2NrZXIsIFBJTl9VTkxPQ0ssIFBBU1NXT1JEX1VOTE9DSyxcbiAgICAgICAgIFBBVFRFUk5fVU5MT0NLLCBGSU5HRVJQUklOVF9VTkxPQ0sgfSBmcm9tICcuL3VubG9jay1oZWxwZXJzJztcblxuXG5jb25zdCBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCA9IDkwMDAwOyAvLyBtaWxsaXNlY29uZHNcbmNvbnN0IENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFkgPSB7XG4gIGNocm9tZToge1xuICAgIHBrZzogJ2NvbS5hbmRyb2lkLmNocm9tZScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG4gIGNocm9taXVtOiB7XG4gICAgcGtnOiAnb3JnLmNocm9taXVtLmNocm9tZS5zaGVsbCcsXG4gICAgYWN0aXZpdHk6ICcuQ2hyb21lU2hlbGxBY3Rpdml0eScsXG4gIH0sXG4gIGNocm9tZWJldGE6IHtcbiAgICBwa2c6ICdjb20uY2hyb21lLmJldGEnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxuICBicm93c2VyOiB7XG4gICAgcGtnOiAnY29tLmFuZHJvaWQuYnJvd3NlcicsXG4gICAgYWN0aXZpdHk6ICdjb20uYW5kcm9pZC5icm93c2VyLkJyb3dzZXJBY3Rpdml0eScsXG4gIH0sXG4gICdjaHJvbWl1bS1icm93c2VyJzoge1xuICAgIHBrZzogJ29yZy5jaHJvbWl1bS5jaHJvbWUnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxuICAnY2hyb21pdW0td2Vidmlldyc6IHtcbiAgICBwa2c6ICdvcmcuY2hyb21pdW0ud2Vidmlld19zaGVsbCcsXG4gICAgYWN0aXZpdHk6ICdvcmcuY2hyb21pdW0ud2Vidmlld19zaGVsbC5XZWJWaWV3QnJvd3NlckFjdGl2aXR5JyxcbiAgfSxcbiAgZGVmYXVsdDoge1xuICAgIHBrZzogJ2NvbS5hbmRyb2lkLmNocm9tZScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG59O1xuY29uc3QgU0VUVElOR1NfSEVMUEVSX1BLR19JRCA9ICdpby5hcHBpdW0uc2V0dGluZ3MnO1xuY29uc3QgU0VUVElOR1NfSEVMUEVSX01BSU5fQUNUSVZJVFkgPSAnLlNldHRpbmdzJztcbmNvbnN0IFNFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFkgPSAnLlVubG9jayc7XG5cbmxldCBoZWxwZXJzID0ge307XG5cbmhlbHBlcnMuY3JlYXRlQmFzZUFEQiA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgLy8gZmlsdGVyIG91dCBhbnkgdW53YW50ZWQgb3B0aW9ucyBzZW50IGluXG4gIC8vIHRoaXMgbGlzdCBzaG91bGQgYmUgdXBkYXRlZCBhcyBBREIgdGFrZXMgbW9yZSBhcmd1bWVudHNcbiAgY29uc3Qge1xuICAgIGphdmFWZXJzaW9uLFxuICAgIGFkYlBvcnQsXG4gICAgc3VwcHJlc3NLaWxsU2VydmVyLFxuICAgIHJlbW90ZUFkYkhvc3QsXG4gICAgY2xlYXJEZXZpY2VMb2dzT25TdGFydCxcbiAgICBhZGJFeGVjVGltZW91dCxcbiAgICB1c2VLZXlzdG9yZSxcbiAgICBrZXlzdG9yZVBhdGgsXG4gICAga2V5c3RvcmVQYXNzd29yZCxcbiAgICBrZXlBbGlhcyxcbiAgICBrZXlQYXNzd29yZCxcbiAgfSA9IG9wdHM7XG4gIHJldHVybiBhd2FpdCBBREIuY3JlYXRlQURCKHtcbiAgICBqYXZhVmVyc2lvbixcbiAgICBhZGJQb3J0LFxuICAgIHN1cHByZXNzS2lsbFNlcnZlcixcbiAgICByZW1vdGVBZGJIb3N0LFxuICAgIGNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgYWRiRXhlY1RpbWVvdXQsXG4gICAgdXNlS2V5c3RvcmUsXG4gICAga2V5c3RvcmVQYXRoLFxuICAgIGtleXN0b3JlUGFzc3dvcmQsXG4gICAga2V5QWxpYXMsXG4gICAga2V5UGFzc3dvcmQsXG4gIH0pO1xufTtcblxuaGVscGVycy5wYXJzZUphdmFWZXJzaW9uID0gZnVuY3Rpb24gKHN0ZGVycikge1xuICBsZXQgbGluZXMgPSBzdGRlcnIuc3BsaXQoXCJcXG5cIik7XG4gIGZvciAobGV0IGxpbmUgb2YgbGluZXMpIHtcbiAgICBpZiAobmV3IFJlZ0V4cCgvKGphdmF8b3BlbmpkaykgdmVyc2lvbi8pLnRlc3QobGluZSkpIHtcbiAgICAgIHJldHVybiBsaW5lLnNwbGl0KFwiIFwiKVsyXS5yZXBsYWNlKC9cIi9nLCAnJyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuaGVscGVycy5nZXRKYXZhVmVyc2lvbiA9IGFzeW5jIGZ1bmN0aW9uIChsb2dWZXJzaW9uID0gdHJ1ZSkge1xuICBsZXQge3N0ZGVycn0gPSBhd2FpdCBleGVjKCdqYXZhJywgWyctdmVyc2lvbiddKTtcbiAgbGV0IGphdmFWZXIgPSBoZWxwZXJzLnBhcnNlSmF2YVZlcnNpb24oc3RkZXJyKTtcbiAgaWYgKGphdmFWZXIgPT09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZ2V0IHRoZSBKYXZhIHZlcnNpb24uIElzIEphdmEgaW5zdGFsbGVkP1wiKTtcbiAgfVxuICBpZiAobG9nVmVyc2lvbikge1xuICAgIGxvZ2dlci5pbmZvKGBKYXZhIHZlcnNpb24gaXM6ICR7amF2YVZlcn1gKTtcbiAgfVxuICByZXR1cm4gamF2YVZlcjtcbn07XG5cbmhlbHBlcnMucHJlcGFyZUVtdWxhdG9yID0gYXN5bmMgZnVuY3Rpb24gKGFkYiwgb3B0cykge1xuICBsZXQge1xuICAgIGF2ZCxcbiAgICBhdmRBcmdzLFxuICAgIGxhbmd1YWdlLFxuICAgIGxvY2FsZSxcbiAgICBhdmRMYXVuY2hUaW1lb3V0LFxuICAgIGF2ZFJlYWR5VGltZW91dCxcbiAgfSA9IG9wdHM7XG4gIGlmICghYXZkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGxhdW5jaCBBVkQgd2l0aG91dCBBVkQgbmFtZVwiKTtcbiAgfVxuICBsZXQgYXZkTmFtZSA9IGF2ZC5yZXBsYWNlKCdAJywgJycpO1xuICBsZXQgcnVubmluZ0FWRCA9IGF3YWl0IGFkYi5nZXRSdW5uaW5nQVZEKGF2ZE5hbWUpO1xuICBpZiAocnVubmluZ0FWRCAhPT0gbnVsbCkge1xuICAgIGlmIChhdmRBcmdzICYmIGF2ZEFyZ3MudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiLXdpcGUtZGF0YVwiKSA+IC0xKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEtpbGxpbmcgJyR7YXZkTmFtZX0nIGJlY2F1c2UgaXQgbmVlZHMgdG8gYmUgd2lwZWQgYXQgc3RhcnQuYCk7XG4gICAgICBhd2FpdCBhZGIua2lsbEVtdWxhdG9yKGF2ZE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJOb3QgbGF1bmNoaW5nIEFWRCBiZWNhdXNlIGl0IGlzIGFscmVhZHkgcnVubmluZy5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGF2ZEFyZ3MgPSB0aGlzLnByZXBhcmVBVkRBcmdzKG9wdHMsIGFkYiwgYXZkQXJncyk7XG4gIGF3YWl0IGFkYi5sYXVuY2hBVkQoYXZkLCBhdmRBcmdzLCBsYW5ndWFnZSwgbG9jYWxlLCBhdmRMYXVuY2hUaW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICAgIGF2ZFJlYWR5VGltZW91dCk7XG59O1xuXG5oZWxwZXJzLnByZXBhcmVBVkRBcmdzID0gZnVuY3Rpb24gKG9wdHMsIGFkYiwgYXZkQXJncykge1xuICBsZXQgYXJncyA9IGF2ZEFyZ3MgPyBbYXZkQXJnc10gOiBbXTtcbiAgaWYgKCFfLmlzVW5kZWZpbmVkKG9wdHMubmV0d29ya1NwZWVkKSkge1xuICAgIGxldCBuZXR3b3JrU3BlZWQgPSB0aGlzLmVuc3VyZU5ldHdvcmtTcGVlZChhZGIsIG9wdHMubmV0d29ya1NwZWVkKTtcbiAgICBhcmdzLnB1c2goJy1uZXRzcGVlZCcsIG5ldHdvcmtTcGVlZCk7XG4gIH1cbiAgaWYgKG9wdHMuaXNIZWFkbGVzcykge1xuICAgIGFyZ3MucHVzaCgnLW5vLXdpbmRvdycpO1xuICB9XG4gIHJldHVybiBhcmdzLmpvaW4oJyAnKTtcbn07XG5cbmhlbHBlcnMuZW5zdXJlTmV0d29ya1NwZWVkID0gZnVuY3Rpb24gKGFkYiwgbmV0d29ya1NwZWVkKSB7XG4gIGlmIChfLnZhbHVlcyhhZGIuTkVUV09SS19TUEVFRCkuaW5kZXhPZihuZXR3b3JrU3BlZWQpICE9PSAtMSkge1xuICAgIHJldHVybiBuZXR3b3JrU3BlZWQ7XG4gIH1cbiAgbG9nZ2VyLndhcm4oYFdyb25nIG5ldHdvcmsgc3BlZWQgcGFyYW0gJHtuZXR3b3JrU3BlZWR9LCB1c2luZyBkZWZhdWx0OiBmdWxsLiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGFkYi5ORVRXT1JLX1NQRUVEKX1gKTtcbiAgcmV0dXJuIGFkYi5ORVRXT1JLX1NQRUVELkZVTEw7XG59O1xuXG4vKipcbiAqIFNldCBhbmQgZW5zdXJlIHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGFkYiAtIFRoZSBhZGIgbW9kdWxlIGluc3RhbmNlLlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UuIFRoZSBsYW5ndWFnZSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIGxvd2VyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezIsOH0uIGUuZy4gZW4sIGphIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgY291bnRyeSAocmVnaW9uKSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHVwcGVyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezJ9IHwgWzAtOV17M30uIGUuZy4gVVMsIEpQIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezR9LiBlLmcuIEhhbnMgaW4gemgtSGFucy1DTiA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBpdCBmYWlsZWQgdG8gc2V0IGxvY2FsZSBwcm9wZXJseVxuICovXG5oZWxwZXJzLmVuc3VyZURldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIGxhbmd1YWdlLCBjb3VudHJ5LCBzY3JpcHQgPSBudWxsKSB7XG4gIGlmICghXy5pc1N0cmluZyhsYW5ndWFnZSkgJiYgIV8uaXNTdHJpbmcoY291bnRyeSkpIHtcbiAgICBsb2dnZXIud2Fybihgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IHJlcXVpcmVzIGxhbmd1YWdlIG9yIGNvdW50cnkuYCk7XG4gICAgbG9nZ2VyLndhcm4oYEdvdCBsYW5ndWFnZTogJyR7bGFuZ3VhZ2V9JyBhbmQgY291bnRyeTogJyR7Y291bnRyeX0nYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgYXdhaXQgYWRiLnNldERldmljZUxhbmd1YWdlQ291bnRyeShsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0KTtcblxuICBpZiAoIWF3YWl0IGFkYi5lbnN1cmVDdXJyZW50TG9jYWxlKGxhbmd1YWdlLCBjb3VudHJ5LCBzY3JpcHQpKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IHNjcmlwdCA/IGBsYW5ndWFnZTogJHtsYW5ndWFnZX0sIGNvdW50cnk6ICR7Y291bnRyeX0gYW5kIHNjcmlwdDogJHtzY3JpcHR9YCA6IGBsYW5ndWFnZTogJHtsYW5ndWFnZX0gYW5kIGNvdW50cnk6ICR7Y291bnRyeX1gO1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCAke21lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0RGV2aWNlSW5mb0Zyb21DYXBzID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICAvLyB3ZSBjYW4gY3JlYXRlIGEgdGhyb3dhd2F5IEFEQiBpbnN0YW5jZSBoZXJlLCBzbyB0aGVyZSBpcyBubyBkZXBlbmRlbmN5XG4gIC8vIG9uIGluc3RhbnRpYXRpbmcgb24gZWFybGllciAoYXQgdGhpcyBwb2ludCwgd2UgaGF2ZSBubyB1ZGlkKVxuICAvLyB3ZSBjYW4gb25seSB1c2UgdGhpcyBBREIgb2JqZWN0IGZvciBjb21tYW5kcyB0aGF0IHdvdWxkIG5vdCBiZSBjb25mdXNlZFxuICAvLyBpZiBtdWx0aXBsZSBkZXZpY2VzIGFyZSBjb25uZWN0ZWRcbiAgY29uc3QgYWRiID0gYXdhaXQgaGVscGVycy5jcmVhdGVCYXNlQURCKG9wdHMpO1xuICBsZXQgdWRpZCA9IG9wdHMudWRpZDtcbiAgbGV0IGVtUG9ydCA9IG51bGw7XG5cbiAgLy8gYSBzcGVjaWZpYyBhdmQgbmFtZSB3YXMgZ2l2ZW4uIHRyeSB0byBpbml0aWFsaXplIHdpdGggdGhhdFxuICBpZiAob3B0cy5hdmQpIHtcbiAgICBhd2FpdCBoZWxwZXJzLnByZXBhcmVFbXVsYXRvcihhZGIsIG9wdHMpO1xuICAgIHVkaWQgPSBhZGIuY3VyRGV2aWNlSWQ7XG4gICAgZW1Qb3J0ID0gYWRiLmVtdWxhdG9yUG9ydDtcbiAgfSBlbHNlIHtcbiAgICAvLyBubyBhdmQgZ2l2ZW4uIGxldHMgdHJ5IHdoYXRldmVyJ3MgcGx1Z2dlZCBpbiBkZXZpY2VzL2VtdWxhdG9yc1xuICAgIGxvZ2dlci5pbmZvKFwiUmV0cmlldmluZyBkZXZpY2UgbGlzdFwiKTtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IGFkYi5nZXREZXZpY2VzV2l0aFJldHJ5KCk7XG5cbiAgICAvLyB1ZGlkIHdhcyBnaXZlbiwgbGV0cyB0cnkgdG8gaW5pdCB3aXRoIHRoYXQgZGV2aWNlXG4gICAgaWYgKHVkaWQpIHtcbiAgICAgIGlmICghXy5pbmNsdWRlcyhfLm1hcChkZXZpY2VzLCAndWRpZCcpLCB1ZGlkKSkge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhgRGV2aWNlICR7dWRpZH0gd2FzIG5vdCBpbiB0aGUgbGlzdCBvZiBjb25uZWN0ZWQgZGV2aWNlc2ApO1xuICAgICAgfVxuICAgICAgZW1Qb3J0ID0gYWRiLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcodWRpZCk7XG4gICAgfSBlbHNlIGlmIChvcHRzLnBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgb3B0cy5wbGF0Zm9ybVZlcnNpb24gPSBgJHtvcHRzLnBsYXRmb3JtVmVyc2lvbn1gLnRyaW0oKTtcblxuICAgICAgLy8gYSBwbGF0Zm9ybSB2ZXJzaW9uIHdhcyBnaXZlbi4gbGV0cyB0cnkgdG8gZmluZCBhIGRldmljZSB3aXRoIHRoZSBzYW1lIG9zXG4gICAgICBsb2dnZXIuaW5mbyhgTG9va2luZyBmb3IgYSBkZXZpY2Ugd2l0aCBBbmRyb2lkICcke29wdHMucGxhdGZvcm1WZXJzaW9ufSdgKTtcblxuICAgICAgLy8gaW4gY2FzZSB3ZSBmYWlsIHRvIGZpbmQgc29tZXRoaW5nLCBnaXZlIHRoZSB1c2VyIGEgdXNlZnVsIGxvZyB0aGF0IGhhc1xuICAgICAgLy8gdGhlIGRldmljZSB1ZGlkcyBhbmQgb3MgdmVyc2lvbnMgc28gdGhleSBrbm93IHdoYXQncyBhdmFpbGFibGVcbiAgICAgIGxldCBhdmFpbERldmljZXNTdHIgPSBbXTtcblxuICAgICAgLy8gZmlyc3QgdHJ5IHN0YXJ0ZWQgZGV2aWNlcy9lbXVsYXRvcnNcbiAgICAgIGZvciAobGV0IGRldmljZSBvZiBkZXZpY2VzKSB7XG4gICAgICAgIC8vIGRpcmVjdCBhZGIgY2FsbHMgdG8gdGhlIHNwZWNpZmljIGRldmljZVxuICAgICAgICBhd2FpdCBhZGIuc2V0RGV2aWNlSWQoZGV2aWNlLnVkaWQpO1xuICAgICAgICBsZXQgZGV2aWNlT1MgPSBhd2FpdCBhZGIuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG5cbiAgICAgICAgLy8gYnVpbGQgdXAgb3VyIGluZm8gc3RyaW5nIG9mIGF2YWlsYWJsZSBkZXZpY2VzIGFzIHdlIGl0ZXJhdGVcbiAgICAgICAgYXZhaWxEZXZpY2VzU3RyLnB1c2goYCR7ZGV2aWNlLnVkaWR9ICgke2RldmljZU9TfSlgKTtcblxuICAgICAgICAvLyB3ZSBkbyBhIGJlZ2lucyB3aXRoIGNoZWNrIGZvciBpbXBsaWVkIHdpbGRjYXJkIG1hdGNoaW5nXG4gICAgICAgIC8vIGVnOiA0IG1hdGNoZXMgNC4xLCA0LjAsIDQuMS4zLXNhbXN1bmcsIGV0Y1xuICAgICAgICBpZiAoZGV2aWNlT1MuaW5kZXhPZihvcHRzLnBsYXRmb3JtVmVyc2lvbikgPT09IDApIHtcbiAgICAgICAgICB1ZGlkID0gZGV2aWNlLnVkaWQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gd2UgY291bGRuJ3QgZmluZCBhbnl0aGluZyEgcXVpdFxuICAgICAgaWYgKCF1ZGlkKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGBVbmFibGUgdG8gZmluZCBhbiBhY3RpdmUgZGV2aWNlIG9yIGVtdWxhdG9yIGAgK1xuICAgICAgICAgIGB3aXRoIE9TICR7b3B0cy5wbGF0Zm9ybVZlcnNpb259LiBUaGUgZm9sbG93aW5nIGFyZSBhdmFpbGFibGU6IGAgKyBhdmFpbERldmljZXNTdHIuam9pbignLCAnKSk7XG4gICAgICB9XG5cbiAgICAgIGVtUG9ydCA9IGFkYi5nZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nKHVkaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBhIHVkaWQgd2FzIG5vdCBnaXZlbiwgZ3JhYiB0aGUgZmlyc3QgZGV2aWNlIHdlIHNlZVxuICAgICAgdWRpZCA9IGRldmljZXNbMF0udWRpZDtcbiAgICAgIGVtUG9ydCA9IGFkYi5nZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nKHVkaWQpO1xuICAgIH1cbiAgfVxuXG4gIGxvZ2dlci5pbmZvKGBVc2luZyBkZXZpY2U6ICR7dWRpZH1gKTtcbiAgcmV0dXJuIHt1ZGlkLCBlbVBvcnR9O1xufTtcblxuLy8gcmV0dXJucyBhIG5ldyBhZGIgaW5zdGFuY2Ugd2l0aCBkZXZpY2VJZCBzZXRcbmhlbHBlcnMuY3JlYXRlQURCID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCB7dWRpZCwgZW1Qb3J0fSA9IG9wdHM7XG4gIGNvbnN0IGFkYiA9IGF3YWl0IGhlbHBlcnMuY3JlYXRlQmFzZUFEQihvcHRzKTtcbiAgYWRiLnNldERldmljZUlkKHVkaWQpO1xuICBpZiAoZW1Qb3J0KSB7XG4gICAgYWRiLnNldEVtdWxhdG9yUG9ydChlbVBvcnQpO1xuICB9XG5cbiAgcmV0dXJuIGFkYjtcbn07XG5cbmhlbHBlcnMudmFsaWRhdGVQYWNrYWdlQWN0aXZpdHlOYW1lcyA9IGZ1bmN0aW9uIChvcHRzKSB7XG4gIGZvciAoY29uc3Qga2V5IG9mIFsnYXBwUGFja2FnZScsICdhcHBBY3Rpdml0eScsICdhcHBXYWl0UGFja2FnZScsICdhcHBXYWl0QWN0aXZpdHknXSkge1xuICAgIGNvbnN0IG5hbWUgPSBvcHRzW2tleV07XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaCA9IC8oW15cXHcuKixdKSsvLmV4ZWMobmFtZSk7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgbG9nZ2VyLndhcm4oYENhcGFiaWxpdHkgJyR7a2V5fScgaXMgZXhwZWN0ZWQgdG8gb25seSBpbmNsdWRlIGxhdGluIGxldHRlcnMsIGRpZ2l0cywgdW5kZXJzY29yZSwgZG90LCBjb21tYSBhbmQgYXN0ZXJpc2sgY2hhcmFjdGVycy5gKTtcbiAgICBsb2dnZXIud2FybihgQ3VycmVudCB2YWx1ZSAnJHtuYW1lfScgaGFzIG5vbi1tYXRjaGluZyBjaGFyYWN0ZXIgYXQgaW5kZXggJHttYXRjaC5pbmRleH06ICcke25hbWUuc3Vic3RyaW5nKDAsIG1hdGNoLmluZGV4ICsgMSl9J2ApO1xuICB9XG59O1xuXG5oZWxwZXJzLmdldExhdW5jaEluZm8gPSBhc3luYyBmdW5jdGlvbiAoYWRiLCBvcHRzKSB7XG4gIGxldCB7YXBwLCBhcHBQYWNrYWdlLCBhcHBBY3Rpdml0eSwgYXBwV2FpdFBhY2thZ2UsIGFwcFdhaXRBY3Rpdml0eX0gPSBvcHRzO1xuICBpZiAoIWFwcCkge1xuICAgIGxvZ2dlci53YXJuKFwiTm8gYXBwIHNlbnQgaW4sIG5vdCBwYXJzaW5nIHBhY2thZ2UvYWN0aXZpdHlcIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy52YWxpZGF0ZVBhY2thZ2VBY3Rpdml0eU5hbWVzKG9wdHMpO1xuXG4gIGlmIChhcHBQYWNrYWdlICYmIGFwcEFjdGl2aXR5KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKFwiUGFyc2luZyBwYWNrYWdlIGFuZCBhY3Rpdml0eSBmcm9tIGFwcCBtYW5pZmVzdFwiKTtcbiAgbGV0IHthcGtQYWNrYWdlLCBhcGtBY3Rpdml0eX0gPVxuICAgIGF3YWl0IGFkYi5wYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QoYXBwKTtcbiAgaWYgKGFwa1BhY2thZ2UgJiYgIWFwcFBhY2thZ2UpIHtcbiAgICBhcHBQYWNrYWdlID0gYXBrUGFja2FnZTtcbiAgfVxuICBpZiAoIWFwcFdhaXRQYWNrYWdlKSB7XG4gICAgYXBwV2FpdFBhY2thZ2UgPSBhcHBQYWNrYWdlO1xuICB9XG4gIGlmIChhcGtBY3Rpdml0eSAmJiAhYXBwQWN0aXZpdHkpIHtcbiAgICBhcHBBY3Rpdml0eSA9IGFwa0FjdGl2aXR5O1xuICB9XG4gIGlmICghYXBwV2FpdEFjdGl2aXR5KSB7XG4gICAgYXBwV2FpdEFjdGl2aXR5ID0gYXBwQWN0aXZpdHk7XG4gIH1cbiAgbG9nZ2VyLmRlYnVnKGBQYXJzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHkgYXJlOiAke2Fwa1BhY2thZ2V9LyR7YXBrQWN0aXZpdHl9YCk7XG4gIHJldHVybiB7YXBwUGFja2FnZSwgYXBwV2FpdFBhY2thZ2UsIGFwcEFjdGl2aXR5LCBhcHBXYWl0QWN0aXZpdHl9O1xufTtcblxuaGVscGVycy5yZXNldEFwcCA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGFwcFBhY2thZ2UsXG4gICAgZmFzdFJlc2V0LFxuICAgIGZ1bGxSZXNldCxcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlc1xuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcFBhY2thZ2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCInYXBwUGFja2FnZScgb3B0aW9uIGlzIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgY29uc3QgaXNJbnN0YWxsZWQgPSBhd2FpdCBhZGIuaXNBcHBJbnN0YWxsZWQoYXBwUGFja2FnZSk7XG5cbiAgaWYgKGlzSW5zdGFsbGVkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFkYi5mb3JjZVN0b3AoYXBwUGFja2FnZSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIC8vIGZ1bGxSZXNldCBoYXMgcHJpb3JpdHkgb3ZlciBmYXN0UmVzZXRcbiAgICBpZiAoIWZ1bGxSZXNldCAmJiBmYXN0UmVzZXQpIHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IGFkYi5jbGVhcihhcHBQYWNrYWdlKTtcbiAgICAgIGlmIChfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2ZhaWxlZCcpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNsZWFyIHRoZSBhcHBsaWNhdGlvbiBkYXRhIG9mICcke2FwcFBhY2thZ2V9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7b3V0cHV0fWApO1xuICAgICAgfVxuICAgICAgLy8gZXhlY3V0aW5nIGBzaGVsbCBwbSBjbGVhcmAgcmVzZXRzIHByZXZpb3VzbHkgYXNzaWduZWQgYXBwbGljYXRpb24gcGVybWlzc2lvbnMgYXMgd2VsbFxuICAgICAgaWYgKGF1dG9HcmFudFBlcm1pc3Npb25zKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgYWRiLmdyYW50QWxsUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKGBVbmFibGUgdG8gZ3JhbnQgcGVybWlzc2lvbnMgcmVxdWVzdGVkLiBPcmlnaW5hbCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsb2dnZXIuZGVidWcoYFBlcmZvcm1lZCBmYXN0IHJlc2V0IG9uIHRoZSBpbnN0YWxsZWQgJyR7YXBwUGFja2FnZX0nIGFwcGxpY2F0aW9uIChzdG9wIGFuZCBjbGVhcilgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBpZiAoIWFwcCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHAnIG9wdGlvbiBpcyByZXF1aXJlZCBmb3IgcmVpbnN0YWxsXCIpO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKGBSdW5uaW5nIGZ1bGwgcmVzZXQgb24gJyR7YXBwUGFja2FnZX0nIChyZWluc3RhbGwpYCk7XG4gIGlmIChpc0luc3RhbGxlZCkge1xuICAgIGF3YWl0IGFkYi51bmluc3RhbGxBcGsoYXBwUGFja2FnZSk7XG4gIH1cbiAgYXdhaXQgYWRiLmluc3RhbGwoYXBwLCB7XG4gICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICB9KTtcbn07XG5cbmhlbHBlcnMuaW5zdGFsbEFwayA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGFwcFBhY2thZ2UsXG4gICAgZmFzdFJlc2V0LFxuICAgIGZ1bGxSZXNldCxcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlc1xuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcCB8fCAhYXBwUGFja2FnZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHAnIGFuZCAnYXBwUGFja2FnZScgb3B0aW9ucyBhcmUgcmVxdWlyZWRcIik7XG4gIH1cblxuICBpZiAoZnVsbFJlc2V0KSB7XG4gICAgYXdhaXQgdGhpcy5yZXNldEFwcChhZGIsIG9wdHMpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFRoZXJlIGlzIG5vIG5lZWQgdG8gcmVzZXQgdGhlIG5ld2x5IGluc3RhbGxlZCBhcHBcbiAgY29uc3Qgc2hvdWxkUGVyZm9ybUZhc3RSZXNldCA9IGZhc3RSZXNldCAmJiBhd2FpdCBhZGIuaXNBcHBJbnN0YWxsZWQoYXBwUGFja2FnZSk7XG5cbiAgYXdhaXQgYWRiLmluc3RhbGxPclVwZ3JhZGUoYXBwLCBhcHBQYWNrYWdlLCB7XG4gICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICB9KTtcblxuICBpZiAoc2hvdWxkUGVyZm9ybUZhc3RSZXNldCkge1xuICAgIGxvZ2dlci5pbmZvKGBQZXJmb3JtaW5nIGZhc3QgcmVzZXQgb24gJyR7YXBwUGFja2FnZX0nYCk7XG4gICAgYXdhaXQgdGhpcy5yZXNldEFwcChhZGIsIG9wdHMpO1xuICB9XG59O1xuXG4vKipcbiAqIEluc3RhbGxzIGFuIGFycmF5IG9mIGFwa3NcbiAqIEBwYXJhbSB7QURCfSBhZGIgSW5zdGFuY2Ugb2YgQXBwaXVtIEFEQiBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIE9wdHMgZGVmaW5lZCBpbiBkcml2ZXIuanNcbiAqL1xuaGVscGVycy5pbnN0YWxsT3RoZXJBcGtzID0gYXN5bmMgZnVuY3Rpb24gKG90aGVyQXBwcywgYWRiLCBvcHRzKSB7XG4gIGxldCB7XG4gICAgYW5kcm9pZEluc3RhbGxUaW1lb3V0ID0gUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQsXG4gICAgYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgYWxsb3dUZXN0UGFja2FnZXNcbiAgfSA9IG9wdHM7XG5cbiAgLy8gSW5zdGFsbCBhbGwgb2YgdGhlIEFQSydzIGFzeW5jaHJvbm91c2x5XG4gIGF3YWl0IEIuYWxsKG90aGVyQXBwcy5tYXAoKG90aGVyQXBwKSA9PiB7XG4gICAgbG9nZ2VyLmRlYnVnKGBJbnN0YWxsaW5nIGFwcDogJHtvdGhlckFwcH1gKTtcbiAgICByZXR1cm4gYWRiLmluc3RhbGxPclVwZ3JhZGUob3RoZXJBcHAsIG51bGwsIHtcbiAgICAgIGdyYW50UGVybWlzc2lvbnM6IGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgICAgYWxsb3dUZXN0UGFja2FnZXMsXG4gICAgfSk7XG4gIH0pKTtcbn07XG5cbmhlbHBlcnMuaW5pdFVuaWNvZGVLZXlib2FyZCA9IGFzeW5jIGZ1bmN0aW9uIChhZGIpIHtcbiAgbG9nZ2VyLmRlYnVnKCdFbmFibGluZyBVbmljb2RlIGtleWJvYXJkIHN1cHBvcnQnKTtcblxuICAvLyBnZXQgdGhlIGRlZmF1bHQgSU1FIHNvIHdlIGNhbiByZXR1cm4gYmFjayB0byBpdCBsYXRlciBpZiB3ZSB3YW50XG4gIGxldCBkZWZhdWx0SU1FID0gYXdhaXQgYWRiLmRlZmF1bHRJTUUoKTtcblxuICBsb2dnZXIuZGVidWcoYFVuc2V0dGluZyBwcmV2aW91cyBJTUUgJHtkZWZhdWx0SU1FfWApO1xuICBjb25zdCBhcHBpdW1JTUUgPSBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS8uVW5pY29kZUlNRWA7XG4gIGxvZ2dlci5kZWJ1ZyhgU2V0dGluZyBJTUUgdG8gJyR7YXBwaXVtSU1FfSdgKTtcbiAgYXdhaXQgYWRiLmVuYWJsZUlNRShhcHBpdW1JTUUpO1xuICBhd2FpdCBhZGIuc2V0SU1FKGFwcGl1bUlNRSk7XG4gIHJldHVybiBkZWZhdWx0SU1FO1xufTtcblxuaGVscGVycy5zZXRNb2NrTG9jYXRpb25BcHAgPSBhc3luYyBmdW5jdGlvbiAoYWRiLCBhcHApIHtcbiAgdHJ5IHtcbiAgICBpZiAoYXdhaXQgYWRiLmdldEFwaUxldmVsKCkgPCAyMykge1xuICAgICAgYXdhaXQgYWRiLnNoZWxsKFsnc2V0dGluZ3MnLCAncHV0JywgJ3NlY3VyZScsICdtb2NrX2xvY2F0aW9uJywgJzEnXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGFkYi5zaGVsbChbJ2FwcG9wcycsICdzZXQnLCBhcHAsICdhbmRyb2lkOm1vY2tfbG9jYXRpb24nLCAnYWxsb3cnXSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgVW5hYmxlIHRvIHNldCBtb2NrIGxvY2F0aW9uIGZvciBhcHAgJyR7YXBwfSc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuaW5zdGFsbEhlbHBlckFwcCA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIGFwa1BhdGgsIHBhY2thZ2VJZCwgYXBwTmFtZSkge1xuICB0cnkge1xuICAgIGF3YWl0IGFkYi5pbnN0YWxsT3JVcGdyYWRlKGFwa1BhdGgsIHBhY2thZ2VJZCwge2dyYW50UGVybWlzc2lvbnM6IHRydWV9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLndhcm4oYElnbm9yZWQgZXJyb3Igd2hpbGUgaW5zdGFsbGluZyBBcHBpdW0gJHthcHBOYW1lfSBoZWxwZXI6IGAgK1xuICAgICAgICAgICAgICAgIGAnJHtlcnIubWVzc2FnZX0nLiBNYW51YWxseSB1bmluc3RhbGxpbmcgdGhlIGFwcGxpY2F0aW9uIGAgK1xuICAgICAgICAgICAgICAgIGB3aXRoIHBhY2thZ2UgaWQgJyR7cGFja2FnZUlkfScgbWF5IGhlbHAuIEV4cGVjdCBzb21lIEFwcGl1bSBgICtcbiAgICAgICAgICAgICAgICBgZmVhdHVyZXMgbWF5IG5vdCB3b3JrIGFzIGV4cGVjdGVkIHVubGVzcyB0aGlzIHByb2JsZW0gaXMgYCArXG4gICAgICAgICAgICAgICAgYGZpeGVkLmApO1xuICB9XG59O1xuXG5oZWxwZXJzLnB1c2hTZXR0aW5nc0FwcCA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIHRocm93RXJyb3IgPSBmYWxzZSkge1xuICBsb2dnZXIuZGVidWcoXCJQdXNoaW5nIHNldHRpbmdzIGFwayB0byBkZXZpY2UuLi5cIik7XG5cbiAgYXdhaXQgaGVscGVycy5pbnN0YWxsSGVscGVyQXBwKGFkYiwgc2V0dGluZ3NBcGtQYXRoLCBTRVRUSU5HU19IRUxQRVJfUEtHX0lELCAnU2V0dGluZ3MnKTtcblxuICAvLyBSZWluc3RhbGwgd2lsbCBzdG9wIHRoZSBzZXR0aW5ncyBoZWxwZXIgcHJvY2VzcyBhbnl3YXksIHNvXG4gIC8vIHRoZXJlIGlzIG5vIG5lZWQgdG8gY29udGludWUgaWYgdGhlIGFwcGxpY2F0aW9uIGlzIHN0aWxsIHJ1bm5pbmdcbiAgaWYgKGF3YWl0IGFkYi5wcm9jZXNzRXhpc3RzKFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGAke1NFVFRJTkdTX0hFTFBFUl9QS0dfSUR9IGlzIGFscmVhZHkgcnVubmluZy4gYCArXG4gICAgICBgVGhlcmUgaXMgbm8gbmVlZCB0byByZXNldCBpdHMgcGVybWlzc2lvbnMuYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpIDwgMjMpIHsgLy8gQW5kcm9pZCA2LSBkZXZpY2VzIHNob3VsZCBoYXZlIGdyYW50ZWQgcGVybWlzc2lvbnNcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9wdWxsLzExNjQwI2lzc3VlY29tbWVudC00MzgyNjA0NzdcbiAgICBsb2dnZXIuaW5mbygnR3JhbnRpbmcgYW5kcm9pZC5wZXJtaXNzaW9uLlNFVF9BTklNQVRJT05fU0NBTEUsIENIQU5HRV9DT05GSUdVUkFUSU9OLCBBQ0NFU1NfRklORV9MT0NBVElPTiBieSBwbSBncmFudCcpO1xuICAgIGF3YWl0IGFkYi5ncmFudFBlcm1pc3Npb25zKFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQsIFtcbiAgICAgICdhbmRyb2lkLnBlcm1pc3Npb24uU0VUX0FOSU1BVElPTl9TQ0FMRScsXG4gICAgICAnYW5kcm9pZC5wZXJtaXNzaW9uLkNIQU5HRV9DT05GSUdVUkFUSU9OJyxcbiAgICAgICdhbmRyb2lkLnBlcm1pc3Npb24uQUNDRVNTX0ZJTkVfTE9DQVRJT04nXG4gICAgXSk7XG4gIH1cblxuICAvLyBsYXVuY2ggaW8uYXBwaXVtLnNldHRpbmdzIGFwcCBkdWUgdG8gc2V0dGluZ3MgZmFpbGluZyB0byBiZSBzZXRcbiAgLy8gaWYgdGhlIGFwcCBpcyBub3QgbGF1bmNoZWQgcHJpb3IgdG8gc3RhcnQgdGhlIHNlc3Npb24gb24gYW5kcm9pZCA3K1xuICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzg5NTdcbiAgdHJ5IHtcbiAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe1xuICAgICAgcGtnOiBTRVRUSU5HU19IRUxQRVJfUEtHX0lELFxuICAgICAgYWN0aXZpdHk6IFNFVFRJTkdTX0hFTFBFUl9NQUlOX0FDVElWSVRZLFxuICAgICAgYWN0aW9uOiBcImFuZHJvaWQuaW50ZW50LmFjdGlvbi5NQUlOXCIsXG4gICAgICBjYXRlZ29yeTogXCJhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUlwiLFxuICAgICAgZmxhZ3M6IFwiMHgxMDIwMDAwMFwiLFxuICAgICAgc3RvcEFwcDogZmFsc2UsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci53YXJuKGBGYWlsZWQgdG8gbGF1bmNoIHNldHRpbmdzIGFwcDogJHtlcnIubWVzc2FnZX1gKTtcbiAgICBpZiAodGhyb3dFcnJvcikge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBFeHRyYWN0cyBzdHJpbmcueG1sIGFuZCBjb252ZXJ0cyBpdCB0byBzdHJpbmcuanNvbiBhbmQgcHVzaGVzXG4gKiBpdCB0byAvZGF0YS9sb2NhbC90bXAvc3RyaW5nLmpzb24gb24gZm9yIHVzZSBvZiBib290c3RyYXBcbiAqIElmIGFwcCBpcyBub3QgcHJlc2VudCB0byBleHRyYWN0IHN0cmluZy54bWwgaXQgZGVsZXRlcyByZW1vdGUgc3RyaW5ncy5qc29uXG4gKiBJZiBhcHAgZG9lcyBub3QgaGF2ZSBzdHJpbmdzLnhtbCB3ZSBwdXNoIGFuIGVtcHR5IGpzb24gb2JqZWN0IHRvIHJlbW90ZVxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZSBhYmJyZXZpYXRpb24sIGZvciBleGFtcGxlICdmcicuIFRoZSBkZWZhdWx0IGxhbmd1YWdlXG4gKiBpcyB1c2VkIGlmIHRoaXMgYXJndW1lbnQgaXMgbm90IGRlZmluZWQuXG4gKiBAcGFyYW0ge09iamVjdH0gYWRiIC0gVGhlIGFkYiBtb2R1bGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIERyaXZlciBvcHRpb25zIGRpY3Rpb25hcnkuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgZGljdGlvbmFyeSwgd2hlcmUgc3RyaW5nIHJlc291cmNlIGlkZW50aWZpZXJzIGFyZSBrZXlzXG4gKiBhbG9uZyB3aXRoIHRoZWlyIGNvcnJlc3BvbmRpbmcgdmFsdWVzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb3IgYW4gZW1wdHkgb2JqZWN0XG4gKiBpZiBubyBtYXRjaGluZyByZXNvdXJjZXMgd2VyZSBleHRyYWN0ZWQuXG4gKi9cbmhlbHBlcnMucHVzaFN0cmluZ3MgPSBhc3luYyBmdW5jdGlvbiAobGFuZ3VhZ2UsIGFkYiwgb3B0cykge1xuICBjb25zdCByZW1vdGVEaXIgPSAnL2RhdGEvbG9jYWwvdG1wJztcbiAgY29uc3Qgc3RyaW5nc0pzb24gPSAnc3RyaW5ncy5qc29uJztcbiAgY29uc3QgcmVtb3RlRmlsZSA9IHBhdGgucG9zaXgucmVzb2x2ZShyZW1vdGVEaXIsIHN0cmluZ3NKc29uKTtcblxuICAvLyBjbGVhbiB1cCByZW1vdGUgc3RyaW5nLmpzb24gaWYgcHJlc2VudFxuICBhd2FpdCBhZGIucmltcmFmKHJlbW90ZUZpbGUpO1xuXG4gIGxldCBhcHA7XG4gIHRyeSB7XG4gICAgYXBwID0gb3B0cy5hcHAgfHwgYXdhaXQgYWRiLnB1bGxBcGsob3B0cy5hcHBQYWNrYWdlLCBvcHRzLnRtcERpcik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5pbmZvKGBGYWlsZWQgdG8gcHVsbCBhbiBhcGsgZnJvbSAnJHtvcHRzLmFwcFBhY2thZ2V9JyB0byAnJHtvcHRzLnRtcERpcn0nLiBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkob3B0cy5hcHBQYWNrYWdlKSB8fCAhKGF3YWl0IGZzLmV4aXN0cyhhcHApKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhgTm8gYXBwIG9yIHBhY2thZ2Ugc3BlY2lmaWVkLiBSZXR1cm5pbmcgZW1wdHkgc3RyaW5nc2ApO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHN0cmluZ3NUbXBEaXIgPSBwYXRoLnJlc29sdmUob3B0cy50bXBEaXIsIG9wdHMuYXBwUGFja2FnZSk7XG4gIHRyeSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdFeHRyYWN0aW5nIHN0cmluZ3MgZnJvbSBhcGsnLCBhcHAsIGxhbmd1YWdlLCBzdHJpbmdzVG1wRGlyKTtcbiAgICBjb25zdCB7YXBrU3RyaW5ncywgbG9jYWxQYXRofSA9IGF3YWl0IGFkYi5leHRyYWN0U3RyaW5nc0Zyb21BcGsoYXBwLCBsYW5ndWFnZSwgc3RyaW5nc1RtcERpcik7XG4gICAgYXdhaXQgYWRiLnB1c2gobG9jYWxQYXRoLCByZW1vdGVEaXIpO1xuICAgIHJldHVybiBhcGtTdHJpbmdzO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgQ291bGQgbm90IGdldCBzdHJpbmdzLCBjb250aW51aW5nIGFueXdheS4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgYXdhaXQgYWRiLnNoZWxsKCdlY2hvJywgW2Ane30nID4gJHtyZW1vdGVGaWxlfWBdKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCBmcy5yaW1yYWYoc3RyaW5nc1RtcERpcik7XG4gIH1cbiAgcmV0dXJuIHt9O1xufTtcblxuaGVscGVycy51bmxvY2tXaXRoVUlBdXRvbWF0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGRyaXZlciwgYWRiLCB1bmxvY2tDYXBhYmlsaXRpZXMpIHtcbiAgbGV0IHVubG9ja1R5cGUgPSB1bmxvY2tDYXBhYmlsaXRpZXMudW5sb2NrVHlwZTtcbiAgaWYgKCF1bmxvY2tlci5pc1ZhbGlkVW5sb2NrVHlwZSh1bmxvY2tUeXBlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCB1bmxvY2sgdHlwZSAke3VubG9ja1R5cGV9YCk7XG4gIH1cbiAgbGV0IHVubG9ja0tleSA9IHVubG9ja0NhcGFiaWxpdGllcy51bmxvY2tLZXk7XG4gIGlmICghdW5sb2NrZXIuaXNWYWxpZEtleSh1bmxvY2tUeXBlLCB1bmxvY2tLZXkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIHVubG9ja0tleSAke3VubG9ja0tleX0gY2FwYWJpbGl0eSBmb3IgdW5sb2NrVHlwZSAke3VubG9ja1R5cGV9YCk7XG4gIH1cbiAgY29uc3QgdW5sb2NrTWV0aG9kID0ge1xuICAgIFtQSU5fVU5MT0NLXTogdW5sb2NrZXIucGluVW5sb2NrLFxuICAgIFtQQVNTV09SRF9VTkxPQ0tdOiB1bmxvY2tlci5wYXNzd29yZFVubG9jayxcbiAgICBbUEFUVEVSTl9VTkxPQ0tdOiB1bmxvY2tlci5wYXR0ZXJuVW5sb2NrLFxuICAgIFtGSU5HRVJQUklOVF9VTkxPQ0tdOiB1bmxvY2tlci5maW5nZXJwcmludFVubG9ja1xuICB9W3VubG9ja1R5cGVdO1xuICBhd2FpdCB1bmxvY2tNZXRob2QoYWRiLCBkcml2ZXIsIHVubG9ja0NhcGFiaWxpdGllcyk7XG59O1xuXG5oZWxwZXJzLnVubG9ja1dpdGhIZWxwZXJBcHAgPSBhc3luYyBmdW5jdGlvbiAoYWRiKSB7XG4gIGxvZ2dlci5pbmZvKFwiVW5sb2NraW5nIHNjcmVlblwiKTtcblxuICAvLyBVbmxvY2sgc3VjY2VlZCB3aXRoIGEgY291cGxlIG9mIHJldHJpZXMuXG4gIGxldCBmaXJzdFJ1biA9IHRydWU7XG4gIGF3YWl0IHJldHJ5KDMsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAvLyBUbyByZWR1Y2UgYSB0aW1lIHRvIGNhbGwgYWRiLmlzU2NyZWVuTG9ja2VkKCkgc2luY2UgYGFkYiBzaGVsbCBkdW1wc3lzIHdpbmRvd2AgaXMgZWFzeSB0byBoYW5nIGFkYiBjb21tYW5kc1xuICAgIGlmIChmaXJzdFJ1bikge1xuICAgICAgZmlyc3RSdW4gPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCEoYXdhaXQgYWRiLmlzU2NyZWVuTG9ja2VkKCkpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKGBFcnJvciBpbiBpc1NjcmVlbkxvY2tlZDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgIGxvZ2dlci53YXJuKFwiXFxcImFkYiBzaGVsbCBkdW1wc3lzIHdpbmRvd1xcXCIgY29tbWFuZCBoYXMgdGltZWQgb3V0LlwiKTtcbiAgICAgICAgbG9nZ2VyLndhcm4oXCJUaGUgcmVhc29uIG9mIHRoaXMgdGltZW91dCBpcyB0aGUgZGVsYXllZCBhZGIgcmVzcG9uc2UuIFJlc2V0dGluZyBhZGIgc2VydmVyIGNhbiBpbXByb3ZlIGl0LlwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2dnZXIuaW5mbyhgTGF1bmNoaW5nICR7U0VUVElOR1NfSEVMUEVSX1VOTE9DS19BQ1RJVklUWX1gKTtcbiAgICBhd2FpdCBhZGIuc2hlbGwoW1xuICAgICAgJ2FtJywgJ3N0YXJ0JyxcbiAgICAgICctbicsIGAke1NFVFRJTkdTX0hFTFBFUl9QS0dfSUR9LyR7U0VUVElOR1NfSEVMUEVSX1VOTE9DS19BQ1RJVklUWX1gLFxuICAgICAgJy1jJywgJ2FuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSJyxcbiAgICAgICctYScsICdhbmRyb2lkLmludGVudC5hY3Rpb24uTUFJTicsXG4gICAgICAnLWYnLCAnMHgxMDIwMDAwMCcsXG4gICAgXSk7XG4gICAgYXdhaXQgQi5kZWxheSgxMDAwKTtcbiAgfSk7XG59O1xuXG5oZWxwZXJzLnVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIChkcml2ZXIsIGFkYiwgY2FwYWJpbGl0aWVzKSB7XG4gIGlmICghKGF3YWl0IGFkYi5pc1NjcmVlbkxvY2tlZCgpKSkge1xuICAgIGxvZ2dlci5pbmZvKFwiU2NyZWVuIGFscmVhZHkgdW5sb2NrZWQsIGRvaW5nIG5vdGhpbmdcIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKFwiU2NyZWVuIGlzIGxvY2tlZCwgdHJ5aW5nIHRvIHVubG9ja1wiKTtcbiAgaWYgKF8uaXNVbmRlZmluZWQoY2FwYWJpbGl0aWVzLnVubG9ja1R5cGUpKSB7XG4gICAgbG9nZ2VyLndhcm4oXCJVc2luZyBhcHAgdW5sb2NrLCB0aGlzIGlzIGdvaW5nIHRvIGJlIGRlcHJlY2F0ZWQhXCIpO1xuICAgIGF3YWl0IGhlbHBlcnMudW5sb2NrV2l0aEhlbHBlckFwcChhZGIpO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IGhlbHBlcnMudW5sb2NrV2l0aFVJQXV0b21hdGlvbihkcml2ZXIsIGFkYiwge3VubG9ja1R5cGU6IGNhcGFiaWxpdGllcy51bmxvY2tUeXBlLCB1bmxvY2tLZXk6IGNhcGFiaWxpdGllcy51bmxvY2tLZXl9KTtcbiAgICBhd2FpdCBoZWxwZXJzLnZlcmlmeVVubG9jayhhZGIpO1xuICB9XG59O1xuXG5oZWxwZXJzLnZlcmlmeVVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIChhZGIpIHtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbCgyLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgaWYgKGF3YWl0IGFkYi5pc1NjcmVlbkxvY2tlZCgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTY3JlZW4gZGlkIG5vdCB1bmxvY2sgc3VjY2Vzc2Z1bGx5LCByZXRyeWluZ1wiKTtcbiAgICB9XG4gICAgbG9nZ2VyLmRlYnVnKFwiU2NyZWVuIHVubG9ja2VkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgfSk7XG59O1xuXG5oZWxwZXJzLmluaXREZXZpY2UgPSBhc3luYyBmdW5jdGlvbiAoYWRiLCBvcHRzKSB7XG4gIGF3YWl0IGFkYi53YWl0Rm9yRGV2aWNlKCk7XG4gIC8vIHB1c2hTZXR0aW5nc0FwcCByZXF1aXJlZCBiZWZvcmUgY2FsbGluZyBlbnN1cmVEZXZpY2VMb2NhbGUgZm9yIEFQSSBMZXZlbCAyNCtcbiAgYXdhaXQgaGVscGVycy5wdXNoU2V0dGluZ3NBcHAoYWRiKTtcbiAgaWYgKCFvcHRzLmF2ZCkge1xuICAgIGF3YWl0IGhlbHBlcnMuc2V0TW9ja0xvY2F0aW9uQXBwKGFkYiwgU0VUVElOR1NfSEVMUEVSX1BLR19JRCk7XG4gIH1cblxuICBhd2FpdCBoZWxwZXJzLmVuc3VyZURldmljZUxvY2FsZShhZGIsIG9wdHMubGFuZ3VhZ2UsIG9wdHMubG9jYWxlLCBvcHRzLmxvY2FsZVNjcmlwdCk7XG4gIGF3YWl0IGFkYi5zdGFydExvZ2NhdCgpO1xuICBpZiAob3B0cy51bmljb2RlS2V5Ym9hcmQpIHtcbiAgICByZXR1cm4gYXdhaXQgaGVscGVycy5pbml0VW5pY29kZUtleWJvYXJkKGFkYik7XG4gIH1cbn07XG5cbmhlbHBlcnMucmVtb3ZlTnVsbFByb3BlcnRpZXMgPSBmdW5jdGlvbiAob2JqKSB7XG4gIGZvciAobGV0IGtleSBvZiBfLmtleXMob2JqKSkge1xuICAgIGlmIChfLmlzTnVsbChvYmpba2V5XSkgfHwgXy5pc1VuZGVmaW5lZChvYmpba2V5XSkpIHtcbiAgICAgIGRlbGV0ZSBvYmpba2V5XTtcbiAgICB9XG4gIH1cbn07XG5cbmhlbHBlcnMudHJ1bmNhdGVEZWNpbWFscyA9IGZ1bmN0aW9uIChudW1iZXIsIGRpZ2l0cykge1xuICBsZXQgbXVsdGlwbGllciA9IE1hdGgucG93KDEwLCBkaWdpdHMpLFxuICAgICAgYWRqdXN0ZWROdW0gPSBudW1iZXIgKiBtdWx0aXBsaWVyLFxuICAgICAgdHJ1bmNhdGVkTnVtID0gTWF0aFthZGp1c3RlZE51bSA8IDAgPyAnY2VpbCcgOiAnZmxvb3InXShhZGp1c3RlZE51bSk7XG5cbiAgcmV0dXJuIHRydW5jYXRlZE51bSAvIG11bHRpcGxpZXI7XG59O1xuXG5oZWxwZXJzLmlzQ2hyb21lQnJvd3NlciA9IGZ1bmN0aW9uIChicm93c2VyKSB7XG4gIHJldHVybiBfLmluY2x1ZGVzKE9iamVjdC5rZXlzKENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFkpLCAoYnJvd3NlciB8fCAnJykudG9Mb3dlckNhc2UoKSk7XG59O1xuXG5oZWxwZXJzLmdldENocm9tZVBrZyA9IGZ1bmN0aW9uIChicm93c2VyKSB7XG4gIHJldHVybiBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZW2Jyb3dzZXIudG9Mb3dlckNhc2UoKV0gfHwgQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWS5kZWZhdWx0O1xufTtcblxuaGVscGVycy5yZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMgPSBhc3luYyBmdW5jdGlvbiAoc2VydmVyLCBzZXNzaW9uSWQpIHtcbiAgaWYgKCFzZXJ2ZXIgfHwgIV8uaXNGdW5jdGlvbihzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlSGFuZGxlcnMgPSBhd2FpdCBzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMoc2Vzc2lvbklkKTtcbiAgZm9yIChjb25zdCBwYXRobmFtZSBvZiBfLmtleXMoYWN0aXZlSGFuZGxlcnMpKSB7XG4gICAgYXdhaXQgc2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIocGF0aG5hbWUpO1xuICB9XG59O1xuXG4vKipcbiAqIFRha2VzIGEgZGVzaXJlZCBjYXBhYmlsaXR5IGFuZCB0cmllcyB0byBKU09OLnBhcnNlIGl0IGFzIGFuIGFycmF5LFxuICogYW5kIGVpdGhlciByZXR1cm5zIHRoZSBwYXJzZWQgYXJyYXkgb3IgYSBzaW5nbGV0b24gYXJyYXkuXG4gKlxuICogQHBhcmFtIHthbnl9IGNhcCBBIGRlc2lyZWQgY2FwYWJpbGl0eVxuICovXG5oZWxwZXJzLnBhcnNlQXJyYXkgPSBmdW5jdGlvbiAoY2FwKSB7XG4gIGxldCBwYXJzZWRDYXBzO1xuICB0cnkge1xuICAgIHBhcnNlZENhcHMgPSBKU09OLnBhcnNlKGNhcCk7XG4gIH0gY2F0Y2ggKGlnbikgeyB9XG5cbiAgaWYgKF8uaXNBcnJheShwYXJzZWRDYXBzKSkge1xuICAgIHJldHVybiBwYXJzZWRDYXBzO1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoY2FwKSkge1xuICAgIHJldHVybiBbY2FwXTtcbiAgfVxuXG4gIHRocm93IG5ldyBFcnJvcihgbXVzdCBwcm92aWRlIGEgc3RyaW5nIG9yIEpTT04gQXJyYXk7IHJlY2VpdmVkICR7Y2FwfWApO1xufTtcblxuaGVscGVycy52YWxpZGF0ZURlc2lyZWRDYXBzID0gZnVuY3Rpb24gKGNhcHMpIHtcbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIGNhcGFiaWxpdGllcyBoYXZlIG9uZSBvZiBgYXBwYCwgYGFwcFBhY2thZ2VgIG9yIGBicm93c2VyYFxuICBpZiAoKCFjYXBzLmJyb3dzZXJOYW1lIHx8ICF0aGlzLmlzQ2hyb21lQnJvd3NlcihjYXBzLmJyb3dzZXJOYW1lKSkgJiYgIWNhcHMuYXBwICYmICFjYXBzLmFwcFBhY2thZ2UpIHtcbiAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdygnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBlaXRoZXIgYW4gYXBwLCBhcHBQYWNrYWdlIG9yIGJyb3dzZXJOYW1lJyk7XG4gIH1cbiAgaWYgKGNhcHMuYnJvd3Nlck5hbWUpIHtcbiAgICBpZiAoY2Fwcy5hcHApIHtcbiAgICAgIC8vIHdhcm4gaWYgdGhlIGNhcGFiaWxpdGllcyBoYXZlIGJvdGggYGFwcGAgYW5kIGBicm93c2VyLCBhbHRob3VnaCB0aGlzIGlzIGNvbW1vbiB3aXRoIHNlbGVuaXVtIGdyaWRcbiAgICAgIGxvZ2dlci53YXJuKGBUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgc2hvdWxkIGdlbmVyYWxseSBub3QgaW5jbHVkZSBib3RoIGFuICdhcHAnIGFuZCBhICdicm93c2VyTmFtZSdgKTtcbiAgICB9XG4gICAgaWYgKGNhcHMuYXBwUGFja2FnZSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFRoZSBkZXNpcmVkIHNob3VsZCBub3QgaW5jbHVkZSBib3RoIG9mIGFuICdhcHBQYWNrYWdlJyBhbmQgYSAnYnJvd3Nlck5hbWUnYCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5oZWxwZXJzLmJvb3RzdHJhcCA9IEJvb3RzdHJhcDtcbmhlbHBlcnMudW5sb2NrZXIgPSB1bmxvY2tlcjtcblxuZXhwb3J0IHsgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgaGVscGVycztcbiJdLCJmaWxlIjoibGliL2FuZHJvaWQtaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
