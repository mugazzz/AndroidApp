"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.routeConfiguringFunction = routeConfiguringFunction;
exports.isSessionCommand = isSessionCommand;
exports.driverShouldDoJwpProxy = driverShouldDoJwpProxy;
exports.IMAGE_ELEMENT_PREFIX = exports.W3C_ELEMENT_KEY = exports.MJSONWP_ELEMENT_KEY = exports.Protocol = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _validators = require("./validators");

var _errors = require("./errors");

var _routes = require("./routes");

var _helpers = require("../basedriver/helpers");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _driver = _interopRequireDefault(require("../basedriver/driver"));

var _lruCache = _interopRequireDefault(require("lru-cache"));

const GENERIC_PROTOCOL = 'GENERIC';

const mjsonwpLog = _appiumSupport.logger.getLogger('MJSONWP');

const w3cLog = _appiumSupport.logger.getLogger('W3C');

const genericProtocolLog = _appiumSupport.logger.getLogger(GENERIC_PROTOCOL);

const JSONWP_SUCCESS_STATUS_CODE = 0;
const LOG_OBJ_LENGTH = 1024;
const MJSONWP_ELEMENT_KEY = 'ELEMENT';
exports.MJSONWP_ELEMENT_KEY = MJSONWP_ELEMENT_KEY;
const W3C_ELEMENT_KEY = 'element-6066-11e4-a52e-4f735466cecf';
exports.W3C_ELEMENT_KEY = W3C_ELEMENT_KEY;
const IMAGE_ELEMENT_PREFIX = 'appium-image-element-';
exports.IMAGE_ELEMENT_PREFIX = IMAGE_ELEMENT_PREFIX;
const CREATE_SESSION_COMMAND = 'createSession';
const DELETE_SESSION_COMMAND = 'deleteSession';
const IMG_EL_BODY_RE = new RegExp(`"(${W3C_ELEMENT_KEY}|${MJSONWP_ELEMENT_KEY})":\s*` + `"${IMAGE_ELEMENT_PREFIX}[^"]+"`);
const IMG_EL_URL_RE = new RegExp(`/(element|screenshot)` + `/${IMAGE_ELEMENT_PREFIX}[^/]+`);

class Protocol {}

exports.Protocol = Protocol;

class SessionsCache {
  constructor(max) {
    this._cache = new _lruCache.default({
      max
    });
  }

  getLogger(sessionId, protocol) {
    if (sessionId) {
      if (this._cache.has(sessionId)) {
        const value = this._cache.get(sessionId);

        if (value.logger) {
          return value.logger;
        }

        protocol = protocol || value.protocol;
      }

      return _appiumSupport.logger.getLogger(`${protocol || GENERIC_PROTOCOL} ` + `(${sessionId.substring(0, Math.min(sessionId.length, 8))})`);
    }

    switch (protocol) {
      case _driver.default.DRIVER_PROTOCOL.W3C:
        return w3cLog;

      case _driver.default.DRIVER_PROTOCOL.MJSONWP:
        return mjsonwpLog;

      default:
        return genericProtocolLog;
    }
  }

  getProtocol(sessionId) {
    return (this._cache.get(sessionId) || {}).protocol;
  }

  putSession(sessionId, value) {
    if (sessionId && value) {
      this._cache.set(sessionId, {
        protocol: value,
        logger: this.getLogger(sessionId, value)
      });
    }

    return value;
  }

  resetLogger(sessionId) {
    if (this._cache.has(sessionId)) {
      this._cache.get(sessionId).logger = null;
    }
  }

}

const SESSIONS_CACHE = new SessionsCache(100);

function extractProtocol(driver, sessionId = null) {
  const dstDriver = _lodash.default.isFunction(driver.driverForSession) ? driver.driverForSession(sessionId) : driver;

  if (dstDriver === driver) {
    return driver.protocol;
  }

  return dstDriver ? dstDriver.protocol : SESSIONS_CACHE.getProtocol(sessionId);
}

function isSessionCommand(command) {
  return !_lodash.default.includes(_routes.NO_SESSION_ID_COMMANDS, command);
}

function wrapParams(paramSets, jsonObj) {
  let res = jsonObj;

  if (_lodash.default.isArray(jsonObj) || !_lodash.default.isObject(jsonObj)) {
    res = {};
    res[paramSets.wrap] = jsonObj;
  }

  return res;
}

function unwrapParams(paramSets, jsonObj) {
  let res = jsonObj;

  if (_lodash.default.isObject(jsonObj)) {
    if (jsonObj[paramSets.unwrap]) {
      res = jsonObj[paramSets.unwrap];
    }
  }

  return res;
}

function checkParams(paramSets, jsonObj, protocol) {
  let requiredParams = [];
  let optionalParams = [];

  let receivedParams = _lodash.default.keys(jsonObj);

  if (paramSets) {
    if (paramSets.required) {
      if (!_lodash.default.isArray(_lodash.default.first(paramSets.required))) {
        requiredParams = [paramSets.required];
      } else {
        requiredParams = paramSets.required;
      }
    }

    if (paramSets.optional) {
      optionalParams = paramSets.optional;
    }

    if (paramSets.validate) {
      let message = paramSets.validate(jsonObj, protocol);

      if (message) {
        throw new _errors.errors.BadParametersError(message, jsonObj);
      }
    }
  }

  if (requiredParams.length === 0) {
    return;
  }

  if (optionalParams.indexOf('sessionId') === -1) {
    optionalParams.push('sessionId');
  }

  if (optionalParams.indexOf('id') === -1) {
    optionalParams.push('id');
  }

  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = requiredParams[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      let params = _step.value;

      if (_lodash.default.difference(receivedParams, params, optionalParams).length === 0 && _lodash.default.difference(params, receivedParams).length === 0) {
        return;
      }
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }

  throw new _errors.errors.BadParametersError(paramSets, receivedParams);
}

function makeArgs(requestParams, jsonObj, payloadParams, protocol) {
  let urlParams = _lodash.default.keys(requestParams).reverse();

  let requiredParams = payloadParams.required;

  if (_lodash.default.isArray(_lodash.default.first(payloadParams.required))) {
    let keys = _lodash.default.keys(jsonObj);

    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = payloadParams.required[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        let params = _step2.value;

        if (_lodash.default.without(params, ...keys).length === 0) {
          requiredParams = params;
          break;
        }
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }
  }

  let args;

  if (_lodash.default.isFunction(payloadParams.makeArgs)) {
    args = payloadParams.makeArgs(jsonObj, protocol);
  } else {
    args = _lodash.default.flatten(requiredParams).map(p => jsonObj[p]);

    if (payloadParams.optional) {
      args = args.concat(_lodash.default.flatten(payloadParams.optional).map(p => jsonObj[p]));
    }
  }

  args = args.concat(urlParams.map(u => requestParams[u]));
  return args;
}

function routeConfiguringFunction(driver) {
  if (!driver.sessionExists) {
    throw new Error('Drivers used with MJSONWP must implement `sessionExists`');
  }

  if (!(driver.executeCommand || driver.execute)) {
    throw new Error('Drivers used with MJSONWP must implement `executeCommand` or `execute`');
  }

  return function (app) {
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = _lodash.default.toPairs(_routes.METHOD_MAP)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        let _step3$value = (0, _slicedToArray2.default)(_step3.value, 2),
            path = _step3$value[0],
            methods = _step3$value[1];

        var _iteratorNormalCompletion4 = true;
        var _didIteratorError4 = false;
        var _iteratorError4 = undefined;

        try {
          for (var _iterator4 = _lodash.default.toPairs(methods)[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
            let _step4$value = (0, _slicedToArray2.default)(_step4.value, 2),
                method = _step4$value[0],
                spec = _step4$value[1];

            buildHandler(app, method, path, spec, driver, isSessionCommand(spec.command));
          }
        } catch (err) {
          _didIteratorError4 = true;
          _iteratorError4 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion4 && _iterator4.return != null) {
              _iterator4.return();
            }
          } finally {
            if (_didIteratorError4) {
              throw _iteratorError4;
            }
          }
        }
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }
  };
}

function buildHandler(app, method, path, spec, driver, isSessCmd) {
  let asyncHandler = function () {
    var _ref = (0, _asyncToGenerator2.default)(function* (req, res) {
      let jsonObj = req.body;
      let httpResBody = {};
      let httpStatus = 200;
      let newSessionId;
      let currentProtocol = extractProtocol(driver, req.params.sessionId);

      try {
        if (isSessCmd && !driver.sessionExists(req.params.sessionId)) {
          throw new _errors.errors.NoSuchDriverError();
        }

        if (isSessCmd && driverShouldDoJwpProxy(driver, req, spec.command)) {
          yield doJwpProxy(driver, req, res);
          return;
        }

        if (!spec.command) {
          throw new _errors.errors.NotImplementedError();
        }

        if (spec.payloadParams && spec.payloadParams.wrap) {
          jsonObj = wrapParams(spec.payloadParams, jsonObj);
        }

        if (spec.payloadParams && spec.payloadParams.unwrap) {
          jsonObj = unwrapParams(spec.payloadParams, jsonObj);
        }

        if (spec.command === CREATE_SESSION_COMMAND) {
          currentProtocol = _driver.default.determineProtocol(...makeArgs(req.params, jsonObj, spec.payloadParams || {}));
        }

        checkParams(spec.payloadParams, jsonObj, currentProtocol);
        let args = makeArgs(req.params, jsonObj, spec.payloadParams || {}, currentProtocol);
        let driverRes;

        if (_validators.validators[spec.command]) {
          _validators.validators[spec.command](...args);
        }

        SESSIONS_CACHE.getLogger(req.params.sessionId, currentProtocol).debug(`Calling ` + `${driver.constructor.name}.${spec.command}() with args: ` + _lodash.default.truncate(JSON.stringify(args), {
          length: LOG_OBJ_LENGTH
        }));

        if (driver.executeCommand) {
          driverRes = yield driver.executeCommand(spec.command, ...args);
        } else {
          driverRes = yield driver.execute(spec.command, ...args);
        }

        currentProtocol = extractProtocol(driver, req.params.sessionId) || currentProtocol;

        if (_lodash.default.isPlainObject(driverRes) && _lodash.default.has(driverRes, 'protocol')) {
          currentProtocol = driverRes.protocol || currentProtocol;

          if (driverRes.error) {
            throw driverRes.error;
          }

          driverRes = driverRes.value;
        }

        if (spec.command === CREATE_SESSION_COMMAND) {
          newSessionId = driverRes[0];
          SESSIONS_CACHE.putSession(newSessionId, currentProtocol);
          SESSIONS_CACHE.getLogger(newSessionId, currentProtocol).debug(`Cached the protocol value '${currentProtocol}' for the new session ${newSessionId}`);

          if (currentProtocol === _driver.default.DRIVER_PROTOCOL.MJSONWP) {
            driverRes = driverRes[1];
          } else if (currentProtocol === _driver.default.DRIVER_PROTOCOL.W3C) {
            driverRes = {
              capabilities: driverRes[1]
            };
          }
        }

        if (driverRes) {
          if (currentProtocol === _driver.default.DRIVER_PROTOCOL.W3C) {
            driverRes = (0, _helpers.renameKey)(driverRes, MJSONWP_ELEMENT_KEY, W3C_ELEMENT_KEY);
          } else {
            driverRes = (0, _helpers.renameKey)(driverRes, W3C_ELEMENT_KEY, MJSONWP_ELEMENT_KEY);
          }
        }

        if (_lodash.default.isUndefined(driverRes)) {
          driverRes = null;
        }

        if (spec.command === DELETE_SESSION_COMMAND) {
          SESSIONS_CACHE.getLogger(req.params.sessionId, currentProtocol).debug(`Received response: ${_lodash.default.truncate(JSON.stringify(driverRes), {
            length: LOG_OBJ_LENGTH
          })}`);
          SESSIONS_CACHE.getLogger(req.params.sessionId, currentProtocol).debug('But deleting session, so not returning');
          driverRes = null;
        }

        if (_appiumSupport.util.hasValue(driverRes)) {
          if (_appiumSupport.util.hasValue(driverRes.status) && !isNaN(driverRes.status) && parseInt(driverRes.status, 10) !== 0) {
            throw (0, _errors.errorFromMJSONWPStatusCode)(driverRes.status, driverRes.value);
          } else if (_lodash.default.isPlainObject(driverRes.value) && driverRes.value.error) {
            throw (0, _errors.errorFromW3CJsonCode)(driverRes.value.error, driverRes.value.message, driverRes.value.stacktrace);
          }
        }

        if (currentProtocol !== _driver.default.DRIVER_PROTOCOL.W3C) {
          httpResBody.status = _lodash.default.isNil(driverRes) || _lodash.default.isUndefined(driverRes.status) ? JSONWP_SUCCESS_STATUS_CODE : driverRes.status;
        }

        httpResBody.value = driverRes;
        SESSIONS_CACHE.getLogger(req.params.sessionId || newSessionId, currentProtocol).debug(`Responding ` + `to client with driver.${spec.command}() result: ${_lodash.default.truncate(JSON.stringify(driverRes), {
          length: LOG_OBJ_LENGTH
        })}`);

        if (spec.command === DELETE_SESSION_COMMAND) {
          SESSIONS_CACHE.resetLogger(req.params.sessionId);
        }
      } catch (err) {
        let actualErr = err;
        currentProtocol = currentProtocol || extractProtocol(driver, req.params.sessionId || newSessionId);
        let errMsg = err.stacktrace || err.stack;

        if (!_lodash.default.includes(errMsg, err.message)) {
          errMsg = `${err.message}${errMsg ? '\n' + errMsg : ''}`;
        }

        SESSIONS_CACHE.getLogger(req.params.sessionId || newSessionId, currentProtocol).debug(`Encountered ` + `internal error running command: ${errMsg}`);

        if ((0, _errors.isErrorType)(err, _errors.errors.ProxyRequestError)) {
          actualErr = err.getActualError();
        }

        if (currentProtocol === _driver.default.DRIVER_PROTOCOL.W3C) {
          var _getResponseForW3CErr = (0, _errors.getResponseForW3CError)(actualErr);

          var _getResponseForW3CErr2 = (0, _slicedToArray2.default)(_getResponseForW3CErr, 2);

          httpStatus = _getResponseForW3CErr2[0];
          httpResBody = _getResponseForW3CErr2[1];
        } else if (currentProtocol === _driver.default.DRIVER_PROTOCOL.MJSONWP) {
          var _getResponseForJsonwp = (0, _errors.getResponseForJsonwpError)(actualErr);

          var _getResponseForJsonwp2 = (0, _slicedToArray2.default)(_getResponseForJsonwp, 2);

          httpStatus = _getResponseForJsonwp2[0];
          httpResBody = _getResponseForJsonwp2[1];
        } else {
          let jsonwpRes = (0, _errors.getResponseForJsonwpError)(actualErr);
          let w3cRes = (0, _errors.getResponseForW3CError)(actualErr);
          httpResBody = (0, _objectSpread2.default)({}, jsonwpRes[1], w3cRes[1]);
          httpStatus = jsonwpRes[0];
        }
      }

      if (_lodash.default.isString(httpResBody)) {
        res.status(httpStatus).send(httpResBody);
      } else {
        if (newSessionId) {
          if (currentProtocol === _driver.default.DRIVER_PROTOCOL.W3C) {
            httpResBody.value.sessionId = newSessionId;
          } else {
            httpResBody.sessionId = newSessionId;
          }
        } else {
          httpResBody.sessionId = req.params.sessionId || null;
        }

        if (currentProtocol === _driver.default.DRIVER_PROTOCOL.W3C) {
          delete httpResBody.sessionId;
        }

        res.status(httpStatus).json(httpResBody);
      }
    });

    return function asyncHandler(_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  app[method.toLowerCase()](path, (req, res) => {
    _bluebird.default.resolve(asyncHandler(req, res)).done();
  });
}

function driverShouldDoJwpProxy(driver, req, command) {
  if (!driver.proxyActive(req.params.sessionId)) {
    return false;
  }

  if (command === 'deleteSession') {
    return false;
  }

  if (driver.proxyRouteIsAvoided(req.params.sessionId, req.method, req.originalUrl)) {
    return false;
  }

  if (IMG_EL_URL_RE.test(req.originalUrl)) {
    return false;
  }

  const stringBody = JSON.stringify(req.body);

  if (stringBody && IMG_EL_BODY_RE.test(stringBody)) {
    return false;
  }

  return true;
}

function doJwpProxy(_x3, _x4, _x5) {
  return _doJwpProxy.apply(this, arguments);
}

function _doJwpProxy() {
  _doJwpProxy = (0, _asyncToGenerator2.default)(function* (driver, req, res) {
    SESSIONS_CACHE.getLogger(req.params.sessionId, extractProtocol(driver, req.params.sessionId)).info('Driver proxy active, passing request on via HTTP proxy');

    if (!driver.canProxy(req.params.sessionId)) {
      throw new Error('Trying to proxy to a JSONWP server but driver is unable to proxy');
    }

    try {
      const proxiedRes = yield driver.executeCommand('proxyReqRes', req, res, req.params.sessionId);
      if (proxiedRes && proxiedRes.error) throw proxiedRes.error;
    } catch (err) {
      if ((0, _errors.isErrorType)(err, _errors.errors.ProxyRequestError)) {
        throw err;
      } else {
        throw new Error(`Could not proxy. Proxy error: ${err.message}`);
      }
    }
  });
  return _doJwpProxy.apply(this, arguments);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9wcm90b2NvbC9wcm90b2NvbC5qcyJdLCJuYW1lcyI6WyJHRU5FUklDX1BST1RPQ09MIiwibWpzb253cExvZyIsImxvZ2dlciIsImdldExvZ2dlciIsInczY0xvZyIsImdlbmVyaWNQcm90b2NvbExvZyIsIkpTT05XUF9TVUNDRVNTX1NUQVRVU19DT0RFIiwiTE9HX09CSl9MRU5HVEgiLCJNSlNPTldQX0VMRU1FTlRfS0VZIiwiVzNDX0VMRU1FTlRfS0VZIiwiSU1BR0VfRUxFTUVOVF9QUkVGSVgiLCJDUkVBVEVfU0VTU0lPTl9DT01NQU5EIiwiREVMRVRFX1NFU1NJT05fQ09NTUFORCIsIklNR19FTF9CT0RZX1JFIiwiUmVnRXhwIiwiSU1HX0VMX1VSTF9SRSIsIlByb3RvY29sIiwiU2Vzc2lvbnNDYWNoZSIsImNvbnN0cnVjdG9yIiwibWF4IiwiX2NhY2hlIiwiTFJVIiwic2Vzc2lvbklkIiwicHJvdG9jb2wiLCJoYXMiLCJ2YWx1ZSIsImdldCIsInN1YnN0cmluZyIsIk1hdGgiLCJtaW4iLCJsZW5ndGgiLCJCYXNlRHJpdmVyIiwiRFJJVkVSX1BST1RPQ09MIiwiVzNDIiwiTUpTT05XUCIsImdldFByb3RvY29sIiwicHV0U2Vzc2lvbiIsInNldCIsInJlc2V0TG9nZ2VyIiwiU0VTU0lPTlNfQ0FDSEUiLCJleHRyYWN0UHJvdG9jb2wiLCJkcml2ZXIiLCJkc3REcml2ZXIiLCJfIiwiaXNGdW5jdGlvbiIsImRyaXZlckZvclNlc3Npb24iLCJpc1Nlc3Npb25Db21tYW5kIiwiY29tbWFuZCIsImluY2x1ZGVzIiwiTk9fU0VTU0lPTl9JRF9DT01NQU5EUyIsIndyYXBQYXJhbXMiLCJwYXJhbVNldHMiLCJqc29uT2JqIiwicmVzIiwiaXNBcnJheSIsImlzT2JqZWN0Iiwid3JhcCIsInVud3JhcFBhcmFtcyIsInVud3JhcCIsImNoZWNrUGFyYW1zIiwicmVxdWlyZWRQYXJhbXMiLCJvcHRpb25hbFBhcmFtcyIsInJlY2VpdmVkUGFyYW1zIiwia2V5cyIsInJlcXVpcmVkIiwiZmlyc3QiLCJvcHRpb25hbCIsInZhbGlkYXRlIiwibWVzc2FnZSIsImVycm9ycyIsIkJhZFBhcmFtZXRlcnNFcnJvciIsImluZGV4T2YiLCJwdXNoIiwicGFyYW1zIiwiZGlmZmVyZW5jZSIsIm1ha2VBcmdzIiwicmVxdWVzdFBhcmFtcyIsInBheWxvYWRQYXJhbXMiLCJ1cmxQYXJhbXMiLCJyZXZlcnNlIiwid2l0aG91dCIsImFyZ3MiLCJmbGF0dGVuIiwibWFwIiwicCIsImNvbmNhdCIsInUiLCJyb3V0ZUNvbmZpZ3VyaW5nRnVuY3Rpb24iLCJzZXNzaW9uRXhpc3RzIiwiRXJyb3IiLCJleGVjdXRlQ29tbWFuZCIsImV4ZWN1dGUiLCJhcHAiLCJ0b1BhaXJzIiwiTUVUSE9EX01BUCIsInBhdGgiLCJtZXRob2RzIiwibWV0aG9kIiwic3BlYyIsImJ1aWxkSGFuZGxlciIsImlzU2Vzc0NtZCIsImFzeW5jSGFuZGxlciIsInJlcSIsImJvZHkiLCJodHRwUmVzQm9keSIsImh0dHBTdGF0dXMiLCJuZXdTZXNzaW9uSWQiLCJjdXJyZW50UHJvdG9jb2wiLCJOb1N1Y2hEcml2ZXJFcnJvciIsImRyaXZlclNob3VsZERvSndwUHJveHkiLCJkb0p3cFByb3h5IiwiTm90SW1wbGVtZW50ZWRFcnJvciIsImRldGVybWluZVByb3RvY29sIiwiZHJpdmVyUmVzIiwidmFsaWRhdG9ycyIsImRlYnVnIiwibmFtZSIsInRydW5jYXRlIiwiSlNPTiIsInN0cmluZ2lmeSIsImlzUGxhaW5PYmplY3QiLCJlcnJvciIsImNhcGFiaWxpdGllcyIsImlzVW5kZWZpbmVkIiwidXRpbCIsImhhc1ZhbHVlIiwic3RhdHVzIiwiaXNOYU4iLCJwYXJzZUludCIsInN0YWNrdHJhY2UiLCJpc05pbCIsImVyciIsImFjdHVhbEVyciIsImVyck1zZyIsInN0YWNrIiwiUHJveHlSZXF1ZXN0RXJyb3IiLCJnZXRBY3R1YWxFcnJvciIsImpzb253cFJlcyIsInczY1JlcyIsImlzU3RyaW5nIiwic2VuZCIsImpzb24iLCJ0b0xvd2VyQ2FzZSIsIkIiLCJyZXNvbHZlIiwiZG9uZSIsInByb3h5QWN0aXZlIiwicHJveHlSb3V0ZUlzQXZvaWRlZCIsIm9yaWdpbmFsVXJsIiwidGVzdCIsInN0cmluZ0JvZHkiLCJpbmZvIiwiY2FuUHJveHkiLCJwcm94aWVkUmVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxnQkFBZ0IsR0FBRyxTQUF6Qjs7QUFDQSxNQUFNQyxVQUFVLEdBQUdDLHNCQUFPQyxTQUFQLENBQWlCLFNBQWpCLENBQW5COztBQUNBLE1BQU1DLE1BQU0sR0FBR0Ysc0JBQU9DLFNBQVAsQ0FBaUIsS0FBakIsQ0FBZjs7QUFDQSxNQUFNRSxrQkFBa0IsR0FBR0gsc0JBQU9DLFNBQVAsQ0FBaUJILGdCQUFqQixDQUEzQjs7QUFFQSxNQUFNTSwwQkFBMEIsR0FBRyxDQUFuQztBQUVBLE1BQU1DLGNBQWMsR0FBRyxJQUF2QjtBQUVBLE1BQU1DLG1CQUFtQixHQUFHLFNBQTVCOztBQUNBLE1BQU1DLGVBQWUsR0FBRyxxQ0FBeEI7O0FBQ0EsTUFBTUMsb0JBQW9CLEdBQUcsdUJBQTdCOztBQUVBLE1BQU1DLHNCQUFzQixHQUFHLGVBQS9CO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsZUFBL0I7QUFFQSxNQUFNQyxjQUFjLEdBQUcsSUFBSUMsTUFBSixDQUNwQixLQUFJTCxlQUFnQixJQUFHRCxtQkFBb0IsUUFBNUMsR0FDQyxJQUFHRSxvQkFBcUIsUUFGSixDQUF2QjtBQUlBLE1BQU1LLGFBQWEsR0FBRyxJQUFJRCxNQUFKLENBQ25CLHVCQUFELEdBQ0MsSUFBR0osb0JBQXFCLE9BRkwsQ0FBdEI7O0FBS0EsTUFBTU0sUUFBTixDQUFlOzs7O0FBRWYsTUFBTUMsYUFBTixDQUFvQjtBQUNsQkMsRUFBQUEsV0FBVyxDQUFFQyxHQUFGLEVBQU87QUFDaEIsU0FBS0MsTUFBTCxHQUFjLElBQUlDLGlCQUFKLENBQVE7QUFBRUYsTUFBQUE7QUFBRixLQUFSLENBQWQ7QUFDRDs7QUFFRGhCLEVBQUFBLFNBQVMsQ0FBRW1CLFNBQUYsRUFBYUMsUUFBYixFQUF1QjtBQUM5QixRQUFJRCxTQUFKLEVBQWU7QUFDYixVQUFJLEtBQUtGLE1BQUwsQ0FBWUksR0FBWixDQUFnQkYsU0FBaEIsQ0FBSixFQUFnQztBQUM5QixjQUFNRyxLQUFLLEdBQUcsS0FBS0wsTUFBTCxDQUFZTSxHQUFaLENBQWdCSixTQUFoQixDQUFkOztBQUNBLFlBQUlHLEtBQUssQ0FBQ3ZCLE1BQVYsRUFBa0I7QUFDaEIsaUJBQU91QixLQUFLLENBQUN2QixNQUFiO0FBQ0Q7O0FBQ0RxQixRQUFBQSxRQUFRLEdBQUdBLFFBQVEsSUFBSUUsS0FBSyxDQUFDRixRQUE3QjtBQUNEOztBQUlELGFBQU9yQixzQkFBT0MsU0FBUCxDQUFrQixHQUFFb0IsUUFBUSxJQUFJdkIsZ0JBQWlCLEdBQWhDLEdBQ3JCLElBQUdzQixTQUFTLENBQUNLLFNBQVYsQ0FBb0IsQ0FBcEIsRUFBdUJDLElBQUksQ0FBQ0MsR0FBTCxDQUFTUCxTQUFTLENBQUNRLE1BQW5CLEVBQTJCLENBQTNCLENBQXZCLENBQXNELEdBRHJELENBQVA7QUFFRDs7QUFHRCxZQUFRUCxRQUFSO0FBQ0UsV0FBS1EsZ0JBQVdDLGVBQVgsQ0FBMkJDLEdBQWhDO0FBQ0UsZUFBTzdCLE1BQVA7O0FBQ0YsV0FBSzJCLGdCQUFXQyxlQUFYLENBQTJCRSxPQUFoQztBQUNFLGVBQU9qQyxVQUFQOztBQUNGO0FBQ0UsZUFBT0ksa0JBQVA7QUFOSjtBQVFEOztBQUVEOEIsRUFBQUEsV0FBVyxDQUFFYixTQUFGLEVBQWE7QUFDdEIsV0FBTyxDQUFDLEtBQUtGLE1BQUwsQ0FBWU0sR0FBWixDQUFnQkosU0FBaEIsS0FBOEIsRUFBL0IsRUFBbUNDLFFBQTFDO0FBQ0Q7O0FBRURhLEVBQUFBLFVBQVUsQ0FBRWQsU0FBRixFQUFhRyxLQUFiLEVBQW9CO0FBQzVCLFFBQUlILFNBQVMsSUFBSUcsS0FBakIsRUFBd0I7QUFDdEIsV0FBS0wsTUFBTCxDQUFZaUIsR0FBWixDQUFnQmYsU0FBaEIsRUFBMkI7QUFDekJDLFFBQUFBLFFBQVEsRUFBRUUsS0FEZTtBQUt6QnZCLFFBQUFBLE1BQU0sRUFBRSxLQUFLQyxTQUFMLENBQWVtQixTQUFmLEVBQTBCRyxLQUExQjtBQUxpQixPQUEzQjtBQU9EOztBQUNELFdBQU9BLEtBQVA7QUFDRDs7QUFFRGEsRUFBQUEsV0FBVyxDQUFFaEIsU0FBRixFQUFhO0FBQ3RCLFFBQUksS0FBS0YsTUFBTCxDQUFZSSxHQUFaLENBQWdCRixTQUFoQixDQUFKLEVBQWdDO0FBQzlCLFdBQUtGLE1BQUwsQ0FBWU0sR0FBWixDQUFnQkosU0FBaEIsRUFBMkJwQixNQUEzQixHQUFvQyxJQUFwQztBQUNEO0FBQ0Y7O0FBckRpQjs7QUE0RHBCLE1BQU1xQyxjQUFjLEdBQUcsSUFBSXRCLGFBQUosQ0FBa0IsR0FBbEIsQ0FBdkI7O0FBR0EsU0FBU3VCLGVBQVQsQ0FBMEJDLE1BQTFCLEVBQWtDbkIsU0FBUyxHQUFHLElBQTlDLEVBQW9EO0FBQ2xELFFBQU1vQixTQUFTLEdBQUdDLGdCQUFFQyxVQUFGLENBQWFILE1BQU0sQ0FBQ0ksZ0JBQXBCLElBQ2RKLE1BQU0sQ0FBQ0ksZ0JBQVAsQ0FBd0J2QixTQUF4QixDQURjLEdBRWRtQixNQUZKOztBQUdBLE1BQUlDLFNBQVMsS0FBS0QsTUFBbEIsRUFBMEI7QUFJeEIsV0FBT0EsTUFBTSxDQUFDbEIsUUFBZDtBQUNEOztBQUdELFNBQU9tQixTQUFTLEdBQUdBLFNBQVMsQ0FBQ25CLFFBQWIsR0FBd0JnQixjQUFjLENBQUNKLFdBQWYsQ0FBMkJiLFNBQTNCLENBQXhDO0FBQ0Q7O0FBRUQsU0FBU3dCLGdCQUFULENBQTJCQyxPQUEzQixFQUFvQztBQUNsQyxTQUFPLENBQUNKLGdCQUFFSyxRQUFGLENBQVdDLDhCQUFYLEVBQW1DRixPQUFuQyxDQUFSO0FBQ0Q7O0FBRUQsU0FBU0csVUFBVCxDQUFxQkMsU0FBckIsRUFBZ0NDLE9BQWhDLEVBQXlDO0FBT3ZDLE1BQUlDLEdBQUcsR0FBR0QsT0FBVjs7QUFDQSxNQUFJVCxnQkFBRVcsT0FBRixDQUFVRixPQUFWLEtBQXNCLENBQUNULGdCQUFFWSxRQUFGLENBQVdILE9BQVgsQ0FBM0IsRUFBZ0Q7QUFDOUNDLElBQUFBLEdBQUcsR0FBRyxFQUFOO0FBQ0FBLElBQUFBLEdBQUcsQ0FBQ0YsU0FBUyxDQUFDSyxJQUFYLENBQUgsR0FBc0JKLE9BQXRCO0FBQ0Q7O0FBQ0QsU0FBT0MsR0FBUDtBQUNEOztBQUVELFNBQVNJLFlBQVQsQ0FBdUJOLFNBQXZCLEVBQWtDQyxPQUFsQyxFQUEyQztBQUl6QyxNQUFJQyxHQUFHLEdBQUdELE9BQVY7O0FBQ0EsTUFBSVQsZ0JBQUVZLFFBQUYsQ0FBV0gsT0FBWCxDQUFKLEVBQXlCO0FBRXZCLFFBQUlBLE9BQU8sQ0FBQ0QsU0FBUyxDQUFDTyxNQUFYLENBQVgsRUFBK0I7QUFDN0JMLE1BQUFBLEdBQUcsR0FBR0QsT0FBTyxDQUFDRCxTQUFTLENBQUNPLE1BQVgsQ0FBYjtBQUNEO0FBQ0Y7O0FBQ0QsU0FBT0wsR0FBUDtBQUNEOztBQUVELFNBQVNNLFdBQVQsQ0FBc0JSLFNBQXRCLEVBQWlDQyxPQUFqQyxFQUEwQzdCLFFBQTFDLEVBQW9EO0FBQ2xELE1BQUlxQyxjQUFjLEdBQUcsRUFBckI7QUFDQSxNQUFJQyxjQUFjLEdBQUcsRUFBckI7O0FBQ0EsTUFBSUMsY0FBYyxHQUFHbkIsZ0JBQUVvQixJQUFGLENBQU9YLE9BQVAsQ0FBckI7O0FBRUEsTUFBSUQsU0FBSixFQUFlO0FBQ2IsUUFBSUEsU0FBUyxDQUFDYSxRQUFkLEVBQXdCO0FBR3RCLFVBQUksQ0FBQ3JCLGdCQUFFVyxPQUFGLENBQVVYLGdCQUFFc0IsS0FBRixDQUFRZCxTQUFTLENBQUNhLFFBQWxCLENBQVYsQ0FBTCxFQUE2QztBQUMzQ0osUUFBQUEsY0FBYyxHQUFHLENBQUNULFNBQVMsQ0FBQ2EsUUFBWCxDQUFqQjtBQUNELE9BRkQsTUFFTztBQUNMSixRQUFBQSxjQUFjLEdBQUdULFNBQVMsQ0FBQ2EsUUFBM0I7QUFDRDtBQUNGOztBQUVELFFBQUliLFNBQVMsQ0FBQ2UsUUFBZCxFQUF3QjtBQUN0QkwsTUFBQUEsY0FBYyxHQUFHVixTQUFTLENBQUNlLFFBQTNCO0FBQ0Q7O0FBTUQsUUFBSWYsU0FBUyxDQUFDZ0IsUUFBZCxFQUF3QjtBQUN0QixVQUFJQyxPQUFPLEdBQUdqQixTQUFTLENBQUNnQixRQUFWLENBQW1CZixPQUFuQixFQUE0QjdCLFFBQTVCLENBQWQ7O0FBQ0EsVUFBSTZDLE9BQUosRUFBYTtBQUNYLGNBQU0sSUFBSUMsZUFBT0Msa0JBQVgsQ0FBOEJGLE9BQTlCLEVBQXVDaEIsT0FBdkMsQ0FBTjtBQUNEO0FBQ0Y7QUFDRjs7QUFHRCxNQUFJUSxjQUFjLENBQUM5QixNQUFmLEtBQTBCLENBQTlCLEVBQWlDO0FBQy9CO0FBQ0Q7O0FBR0QsTUFBSStCLGNBQWMsQ0FBQ1UsT0FBZixDQUF1QixXQUF2QixNQUF3QyxDQUFDLENBQTdDLEVBQWdEO0FBQzlDVixJQUFBQSxjQUFjLENBQUNXLElBQWYsQ0FBb0IsV0FBcEI7QUFDRDs7QUFHRCxNQUFJWCxjQUFjLENBQUNVLE9BQWYsQ0FBdUIsSUFBdkIsTUFBaUMsQ0FBQyxDQUF0QyxFQUF5QztBQUN2Q1YsSUFBQUEsY0FBYyxDQUFDVyxJQUFmLENBQW9CLElBQXBCO0FBQ0Q7O0FBN0NpRDtBQUFBO0FBQUE7O0FBQUE7QUFnRGxELHlCQUFtQlosY0FBbkIsOEhBQW1DO0FBQUEsVUFBMUJhLE1BQTBCOztBQUNqQyxVQUFJOUIsZ0JBQUUrQixVQUFGLENBQWFaLGNBQWIsRUFBNkJXLE1BQTdCLEVBQXFDWixjQUFyQyxFQUFxRC9CLE1BQXJELEtBQWdFLENBQWhFLElBQ0FhLGdCQUFFK0IsVUFBRixDQUFhRCxNQUFiLEVBQXFCWCxjQUFyQixFQUFxQ2hDLE1BQXJDLEtBQWdELENBRHBELEVBQ3VEO0FBR3JEO0FBQ0Q7QUFDRjtBQXZEaUQ7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUF3RGxELFFBQU0sSUFBSXVDLGVBQU9DLGtCQUFYLENBQThCbkIsU0FBOUIsRUFBeUNXLGNBQXpDLENBQU47QUFDRDs7QUFTRCxTQUFTYSxRQUFULENBQW1CQyxhQUFuQixFQUFrQ3hCLE9BQWxDLEVBQTJDeUIsYUFBM0MsRUFBMER0RCxRQUExRCxFQUFvRTtBQUtsRSxNQUFJdUQsU0FBUyxHQUFHbkMsZ0JBQUVvQixJQUFGLENBQU9hLGFBQVAsRUFBc0JHLE9BQXRCLEVBQWhCOztBQU1BLE1BQUluQixjQUFjLEdBQUdpQixhQUFhLENBQUNiLFFBQW5DOztBQUNBLE1BQUlyQixnQkFBRVcsT0FBRixDQUFVWCxnQkFBRXNCLEtBQUYsQ0FBUVksYUFBYSxDQUFDYixRQUF0QixDQUFWLENBQUosRUFBZ0Q7QUFLOUMsUUFBSUQsSUFBSSxHQUFHcEIsZ0JBQUVvQixJQUFGLENBQU9YLE9BQVAsQ0FBWDs7QUFMOEM7QUFBQTtBQUFBOztBQUFBO0FBTTlDLDRCQUFtQnlCLGFBQWEsQ0FBQ2IsUUFBakMsbUlBQTJDO0FBQUEsWUFBbENTLE1BQWtDOztBQUN6QyxZQUFJOUIsZ0JBQUVxQyxPQUFGLENBQVVQLE1BQVYsRUFBa0IsR0FBR1YsSUFBckIsRUFBMkJqQyxNQUEzQixLQUFzQyxDQUExQyxFQUE2QztBQUMzQzhCLFVBQUFBLGNBQWMsR0FBR2EsTUFBakI7QUFDQTtBQUNEO0FBQ0Y7QUFYNkM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVkvQzs7QUFHRCxNQUFJUSxJQUFKOztBQUNBLE1BQUl0QyxnQkFBRUMsVUFBRixDQUFhaUMsYUFBYSxDQUFDRixRQUEzQixDQUFKLEVBQTBDO0FBT3hDTSxJQUFBQSxJQUFJLEdBQUdKLGFBQWEsQ0FBQ0YsUUFBZCxDQUF1QnZCLE9BQXZCLEVBQWdDN0IsUUFBaEMsQ0FBUDtBQUNELEdBUkQsTUFRTztBQUdMMEQsSUFBQUEsSUFBSSxHQUFHdEMsZ0JBQUV1QyxPQUFGLENBQVV0QixjQUFWLEVBQTBCdUIsR0FBMUIsQ0FBK0JDLENBQUQsSUFBT2hDLE9BQU8sQ0FBQ2dDLENBQUQsQ0FBNUMsQ0FBUDs7QUFDQSxRQUFJUCxhQUFhLENBQUNYLFFBQWxCLEVBQTRCO0FBQzFCZSxNQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ0ksTUFBTCxDQUFZMUMsZ0JBQUV1QyxPQUFGLENBQVVMLGFBQWEsQ0FBQ1gsUUFBeEIsRUFBa0NpQixHQUFsQyxDQUF1Q0MsQ0FBRCxJQUFPaEMsT0FBTyxDQUFDZ0MsQ0FBRCxDQUFwRCxDQUFaLENBQVA7QUFDRDtBQUNGOztBQUdESCxFQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ0ksTUFBTCxDQUFZUCxTQUFTLENBQUNLLEdBQVYsQ0FBZUcsQ0FBRCxJQUFPVixhQUFhLENBQUNVLENBQUQsQ0FBbEMsQ0FBWixDQUFQO0FBQ0EsU0FBT0wsSUFBUDtBQUNEOztBQUVELFNBQVNNLHdCQUFULENBQW1DOUMsTUFBbkMsRUFBMkM7QUFDekMsTUFBSSxDQUFDQSxNQUFNLENBQUMrQyxhQUFaLEVBQTJCO0FBQ3pCLFVBQU0sSUFBSUMsS0FBSixDQUFVLDBEQUFWLENBQU47QUFDRDs7QUFFRCxNQUFJLEVBQUVoRCxNQUFNLENBQUNpRCxjQUFQLElBQXlCakQsTUFBTSxDQUFDa0QsT0FBbEMsQ0FBSixFQUFnRDtBQUM5QyxVQUFNLElBQUlGLEtBQUosQ0FBVSx3RUFBVixDQUFOO0FBQ0Q7O0FBR0QsU0FBTyxVQUFVRyxHQUFWLEVBQWU7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFDcEIsNEJBQTRCakQsZ0JBQUVrRCxPQUFGLENBQVVDLGtCQUFWLENBQTVCLG1JQUFtRDtBQUFBO0FBQUEsWUFBekNDLElBQXlDO0FBQUEsWUFBbkNDLE9BQW1DOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUNqRCxnQ0FBMkJyRCxnQkFBRWtELE9BQUYsQ0FBVUcsT0FBVixDQUEzQixtSUFBK0M7QUFBQTtBQUFBLGdCQUFyQ0MsTUFBcUM7QUFBQSxnQkFBN0JDLElBQTZCOztBQUU3Q0MsWUFBQUEsWUFBWSxDQUFDUCxHQUFELEVBQU1LLE1BQU4sRUFBY0YsSUFBZCxFQUFvQkcsSUFBcEIsRUFBMEJ6RCxNQUExQixFQUFrQ0ssZ0JBQWdCLENBQUNvRCxJQUFJLENBQUNuRCxPQUFOLENBQWxELENBQVo7QUFDRDtBQUpnRDtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS2xEO0FBTm1CO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPckIsR0FQRDtBQVFEOztBQUVELFNBQVNvRCxZQUFULENBQXVCUCxHQUF2QixFQUE0QkssTUFBNUIsRUFBb0NGLElBQXBDLEVBQTBDRyxJQUExQyxFQUFnRHpELE1BQWhELEVBQXdEMkQsU0FBeEQsRUFBbUU7QUFDakUsTUFBSUMsWUFBWTtBQUFBLCtDQUFHLFdBQU9DLEdBQVAsRUFBWWpELEdBQVosRUFBb0I7QUFDckMsVUFBSUQsT0FBTyxHQUFHa0QsR0FBRyxDQUFDQyxJQUFsQjtBQUNBLFVBQUlDLFdBQVcsR0FBRyxFQUFsQjtBQUNBLFVBQUlDLFVBQVUsR0FBRyxHQUFqQjtBQUNBLFVBQUlDLFlBQUo7QUFDQSxVQUFJQyxlQUFlLEdBQUduRSxlQUFlLENBQUNDLE1BQUQsRUFBUzZELEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQXBCLENBQXJDOztBQUVBLFVBQUk7QUFHRixZQUFJOEUsU0FBUyxJQUFJLENBQUMzRCxNQUFNLENBQUMrQyxhQUFQLENBQXFCYyxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUFoQyxDQUFsQixFQUE4RDtBQUM1RCxnQkFBTSxJQUFJK0MsZUFBT3VDLGlCQUFYLEVBQU47QUFDRDs7QUFRRCxZQUFJUixTQUFTLElBQUlTLHNCQUFzQixDQUFDcEUsTUFBRCxFQUFTNkQsR0FBVCxFQUFjSixJQUFJLENBQUNuRCxPQUFuQixDQUF2QyxFQUFvRTtBQUNsRSxnQkFBTStELFVBQVUsQ0FBQ3JFLE1BQUQsRUFBUzZELEdBQVQsRUFBY2pELEdBQWQsQ0FBaEI7QUFDQTtBQUNEOztBQUlELFlBQUksQ0FBQzZDLElBQUksQ0FBQ25ELE9BQVYsRUFBbUI7QUFDakIsZ0JBQU0sSUFBSXNCLGVBQU8wQyxtQkFBWCxFQUFOO0FBQ0Q7O0FBR0QsWUFBSWIsSUFBSSxDQUFDckIsYUFBTCxJQUFzQnFCLElBQUksQ0FBQ3JCLGFBQUwsQ0FBbUJyQixJQUE3QyxFQUFtRDtBQUNqREosVUFBQUEsT0FBTyxHQUFHRixVQUFVLENBQUNnRCxJQUFJLENBQUNyQixhQUFOLEVBQXFCekIsT0FBckIsQ0FBcEI7QUFDRDs7QUFHRCxZQUFJOEMsSUFBSSxDQUFDckIsYUFBTCxJQUFzQnFCLElBQUksQ0FBQ3JCLGFBQUwsQ0FBbUJuQixNQUE3QyxFQUFxRDtBQUNuRE4sVUFBQUEsT0FBTyxHQUFHSyxZQUFZLENBQUN5QyxJQUFJLENBQUNyQixhQUFOLEVBQXFCekIsT0FBckIsQ0FBdEI7QUFDRDs7QUFFRCxZQUFJOEMsSUFBSSxDQUFDbkQsT0FBTCxLQUFpQnBDLHNCQUFyQixFQUE2QztBQUczQ2dHLFVBQUFBLGVBQWUsR0FBRzVFLGdCQUFXaUYsaUJBQVgsQ0FBNkIsR0FBR3JDLFFBQVEsQ0FBQzJCLEdBQUcsQ0FBQzdCLE1BQUwsRUFBYXJCLE9BQWIsRUFBc0I4QyxJQUFJLENBQUNyQixhQUFMLElBQXNCLEVBQTVDLENBQXhDLENBQWxCO0FBQ0Q7O0FBR0RsQixRQUFBQSxXQUFXLENBQUN1QyxJQUFJLENBQUNyQixhQUFOLEVBQXFCekIsT0FBckIsRUFBOEJ1RCxlQUE5QixDQUFYO0FBSUEsWUFBSTFCLElBQUksR0FBR04sUUFBUSxDQUFDMkIsR0FBRyxDQUFDN0IsTUFBTCxFQUFhckIsT0FBYixFQUFzQjhDLElBQUksQ0FBQ3JCLGFBQUwsSUFBc0IsRUFBNUMsRUFBZ0Q4QixlQUFoRCxDQUFuQjtBQUNBLFlBQUlNLFNBQUo7O0FBRUEsWUFBSUMsdUJBQVdoQixJQUFJLENBQUNuRCxPQUFoQixDQUFKLEVBQThCO0FBQzVCbUUsaUNBQVdoQixJQUFJLENBQUNuRCxPQUFoQixFQUF5QixHQUFHa0MsSUFBNUI7QUFDRDs7QUFHRDFDLFFBQUFBLGNBQWMsQ0FBQ3BDLFNBQWYsQ0FBeUJtRyxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUFwQyxFQUErQ3FGLGVBQS9DLEVBQWdFUSxLQUFoRSxDQUF1RSxVQUFELEdBQ25FLEdBQUUxRSxNQUFNLENBQUN2QixXQUFQLENBQW1Ca0csSUFBSyxJQUFHbEIsSUFBSSxDQUFDbkQsT0FBUSxnQkFEeUIsR0FFcEVKLGdCQUFFMEUsUUFBRixDQUFXQyxJQUFJLENBQUNDLFNBQUwsQ0FBZXRDLElBQWYsQ0FBWCxFQUFpQztBQUFDbkQsVUFBQUEsTUFBTSxFQUFFdkI7QUFBVCxTQUFqQyxDQUZGOztBQUlBLFlBQUlrQyxNQUFNLENBQUNpRCxjQUFYLEVBQTJCO0FBQ3pCdUIsVUFBQUEsU0FBUyxTQUFTeEUsTUFBTSxDQUFDaUQsY0FBUCxDQUFzQlEsSUFBSSxDQUFDbkQsT0FBM0IsRUFBb0MsR0FBR2tDLElBQXZDLENBQWxCO0FBQ0QsU0FGRCxNQUVPO0FBQ0xnQyxVQUFBQSxTQUFTLFNBQVN4RSxNQUFNLENBQUNrRCxPQUFQLENBQWVPLElBQUksQ0FBQ25ELE9BQXBCLEVBQTZCLEdBQUdrQyxJQUFoQyxDQUFsQjtBQUNEOztBQUdEMEIsUUFBQUEsZUFBZSxHQUFHbkUsZUFBZSxDQUFDQyxNQUFELEVBQVM2RCxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUFwQixDQUFmLElBQWlEcUYsZUFBbkU7O0FBSUEsWUFBSWhFLGdCQUFFNkUsYUFBRixDQUFnQlAsU0FBaEIsS0FBOEJ0RSxnQkFBRW5CLEdBQUYsQ0FBTXlGLFNBQU4sRUFBaUIsVUFBakIsQ0FBbEMsRUFBZ0U7QUFDOUROLFVBQUFBLGVBQWUsR0FBR00sU0FBUyxDQUFDMUYsUUFBVixJQUFzQm9GLGVBQXhDOztBQUNBLGNBQUlNLFNBQVMsQ0FBQ1EsS0FBZCxFQUFxQjtBQUNuQixrQkFBTVIsU0FBUyxDQUFDUSxLQUFoQjtBQUNEOztBQUNEUixVQUFBQSxTQUFTLEdBQUdBLFNBQVMsQ0FBQ3hGLEtBQXRCO0FBQ0Q7O0FBR0QsWUFBSXlFLElBQUksQ0FBQ25ELE9BQUwsS0FBaUJwQyxzQkFBckIsRUFBNkM7QUFDM0MrRixVQUFBQSxZQUFZLEdBQUdPLFNBQVMsQ0FBQyxDQUFELENBQXhCO0FBQ0ExRSxVQUFBQSxjQUFjLENBQUNILFVBQWYsQ0FBMEJzRSxZQUExQixFQUF3Q0MsZUFBeEM7QUFDQXBFLFVBQUFBLGNBQWMsQ0FBQ3BDLFNBQWYsQ0FBeUJ1RyxZQUF6QixFQUF1Q0MsZUFBdkMsRUFDR1EsS0FESCxDQUNVLDhCQUE2QlIsZUFBZ0IseUJBQXdCRCxZQUFhLEVBRDVGOztBQUVBLGNBQUlDLGVBQWUsS0FBSzVFLGdCQUFXQyxlQUFYLENBQTJCRSxPQUFuRCxFQUE0RDtBQUMxRCtFLFlBQUFBLFNBQVMsR0FBR0EsU0FBUyxDQUFDLENBQUQsQ0FBckI7QUFDRCxXQUZELE1BRU8sSUFBSU4sZUFBZSxLQUFLNUUsZ0JBQVdDLGVBQVgsQ0FBMkJDLEdBQW5ELEVBQXdEO0FBQzdEZ0YsWUFBQUEsU0FBUyxHQUFHO0FBQ1ZTLGNBQUFBLFlBQVksRUFBRVQsU0FBUyxDQUFDLENBQUQ7QUFEYixhQUFaO0FBR0Q7QUFDRjs7QUFHRCxZQUFJQSxTQUFKLEVBQWU7QUFDYixjQUFJTixlQUFlLEtBQUs1RSxnQkFBV0MsZUFBWCxDQUEyQkMsR0FBbkQsRUFBd0Q7QUFDdERnRixZQUFBQSxTQUFTLEdBQUcsd0JBQVVBLFNBQVYsRUFBcUJ6RyxtQkFBckIsRUFBMENDLGVBQTFDLENBQVo7QUFDRCxXQUZELE1BRU87QUFDTHdHLFlBQUFBLFNBQVMsR0FBRyx3QkFBVUEsU0FBVixFQUFxQnhHLGVBQXJCLEVBQXNDRCxtQkFBdEMsQ0FBWjtBQUNEO0FBQ0Y7O0FBR0QsWUFBSW1DLGdCQUFFZ0YsV0FBRixDQUFjVixTQUFkLENBQUosRUFBOEI7QUFDNUJBLFVBQUFBLFNBQVMsR0FBRyxJQUFaO0FBQ0Q7O0FBR0QsWUFBSWYsSUFBSSxDQUFDbkQsT0FBTCxLQUFpQm5DLHNCQUFyQixFQUE2QztBQUMzQzJCLFVBQUFBLGNBQWMsQ0FBQ3BDLFNBQWYsQ0FBeUJtRyxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUFwQyxFQUErQ3FGLGVBQS9DLEVBQ0dRLEtBREgsQ0FDVSxzQkFBcUJ4RSxnQkFBRTBFLFFBQUYsQ0FBV0MsSUFBSSxDQUFDQyxTQUFMLENBQWVOLFNBQWYsQ0FBWCxFQUFzQztBQUFDbkYsWUFBQUEsTUFBTSxFQUFFdkI7QUFBVCxXQUF0QyxDQUFnRSxFQUQvRjtBQUVBZ0MsVUFBQUEsY0FBYyxDQUFDcEMsU0FBZixDQUF5Qm1HLEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQXBDLEVBQStDcUYsZUFBL0MsRUFBZ0VRLEtBQWhFLENBQXNFLHdDQUF0RTtBQUNBRixVQUFBQSxTQUFTLEdBQUcsSUFBWjtBQUNEOztBQUdELFlBQUlXLG9CQUFLQyxRQUFMLENBQWNaLFNBQWQsQ0FBSixFQUE4QjtBQUM1QixjQUFJVyxvQkFBS0MsUUFBTCxDQUFjWixTQUFTLENBQUNhLE1BQXhCLEtBQW1DLENBQUNDLEtBQUssQ0FBQ2QsU0FBUyxDQUFDYSxNQUFYLENBQXpDLElBQStERSxRQUFRLENBQUNmLFNBQVMsQ0FBQ2EsTUFBWCxFQUFtQixFQUFuQixDQUFSLEtBQW1DLENBQXRHLEVBQXlHO0FBQ3ZHLGtCQUFNLHdDQUEyQmIsU0FBUyxDQUFDYSxNQUFyQyxFQUE2Q2IsU0FBUyxDQUFDeEYsS0FBdkQsQ0FBTjtBQUNELFdBRkQsTUFFTyxJQUFJa0IsZ0JBQUU2RSxhQUFGLENBQWdCUCxTQUFTLENBQUN4RixLQUExQixLQUFvQ3dGLFNBQVMsQ0FBQ3hGLEtBQVYsQ0FBZ0JnRyxLQUF4RCxFQUErRDtBQUNwRSxrQkFBTSxrQ0FBcUJSLFNBQVMsQ0FBQ3hGLEtBQVYsQ0FBZ0JnRyxLQUFyQyxFQUE0Q1IsU0FBUyxDQUFDeEYsS0FBVixDQUFnQjJDLE9BQTVELEVBQXFFNkMsU0FBUyxDQUFDeEYsS0FBVixDQUFnQndHLFVBQXJGLENBQU47QUFDRDtBQUNGOztBQUdELFlBQUl0QixlQUFlLEtBQUs1RSxnQkFBV0MsZUFBWCxDQUEyQkMsR0FBbkQsRUFBd0Q7QUFDdER1RSxVQUFBQSxXQUFXLENBQUNzQixNQUFaLEdBQXNCbkYsZ0JBQUV1RixLQUFGLENBQVFqQixTQUFSLEtBQXNCdEUsZ0JBQUVnRixXQUFGLENBQWNWLFNBQVMsQ0FBQ2EsTUFBeEIsQ0FBdkIsR0FBMER4SCwwQkFBMUQsR0FBdUYyRyxTQUFTLENBQUNhLE1BQXRIO0FBQ0Q7O0FBQ0R0QixRQUFBQSxXQUFXLENBQUMvRSxLQUFaLEdBQW9Cd0YsU0FBcEI7QUFDQTFFLFFBQUFBLGNBQWMsQ0FBQ3BDLFNBQWYsQ0FBeUJtRyxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUFYLElBQXdCb0YsWUFBakQsRUFBK0RDLGVBQS9ELEVBQWdGUSxLQUFoRixDQUF1RixhQUFELEdBQ25GLHlCQUF3QmpCLElBQUksQ0FBQ25ELE9BQVEsY0FBYUosZ0JBQUUwRSxRQUFGLENBQVdDLElBQUksQ0FBQ0MsU0FBTCxDQUFlTixTQUFmLENBQVgsRUFBc0M7QUFBQ25GLFVBQUFBLE1BQU0sRUFBRXZCO0FBQVQsU0FBdEMsQ0FBZ0UsRUFEckg7O0FBR0EsWUFBSTJGLElBQUksQ0FBQ25ELE9BQUwsS0FBaUJuQyxzQkFBckIsRUFBNkM7QUFJM0MyQixVQUFBQSxjQUFjLENBQUNELFdBQWYsQ0FBMkJnRSxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUF0QztBQUNEO0FBQ0YsT0F4SUQsQ0F3SUUsT0FBTzZHLEdBQVAsRUFBWTtBQUdaLFlBQUlDLFNBQVMsR0FBR0QsR0FBaEI7QUFFQXhCLFFBQUFBLGVBQWUsR0FBR0EsZUFBZSxJQUFJbkUsZUFBZSxDQUFDQyxNQUFELEVBQVM2RCxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUFYLElBQXdCb0YsWUFBakMsQ0FBcEQ7QUFFQSxZQUFJMkIsTUFBTSxHQUFHRixHQUFHLENBQUNGLFVBQUosSUFBa0JFLEdBQUcsQ0FBQ0csS0FBbkM7O0FBQ0EsWUFBSSxDQUFDM0YsZ0JBQUVLLFFBQUYsQ0FBV3FGLE1BQVgsRUFBbUJGLEdBQUcsQ0FBQy9ELE9BQXZCLENBQUwsRUFBc0M7QUFHcENpRSxVQUFBQSxNQUFNLEdBQUksR0FBRUYsR0FBRyxDQUFDL0QsT0FBUSxHQUFFaUUsTUFBTSxHQUFJLE9BQU9BLE1BQVgsR0FBcUIsRUFBRyxFQUF4RDtBQUNEOztBQUNEOUYsUUFBQUEsY0FBYyxDQUFDcEMsU0FBZixDQUF5Qm1HLEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQVgsSUFBd0JvRixZQUFqRCxFQUErREMsZUFBL0QsRUFBZ0ZRLEtBQWhGLENBQXVGLGNBQUQsR0FDbkYsbUNBQWtDa0IsTUFBTyxFQUQ1Qzs7QUFFQSxZQUFJLHlCQUFZRixHQUFaLEVBQWlCOUQsZUFBT2tFLGlCQUF4QixDQUFKLEVBQWdEO0FBQzlDSCxVQUFBQSxTQUFTLEdBQUdELEdBQUcsQ0FBQ0ssY0FBSixFQUFaO0FBQ0Q7O0FBRUQsWUFBSTdCLGVBQWUsS0FBSzVFLGdCQUFXQyxlQUFYLENBQTJCQyxHQUFuRCxFQUF3RDtBQUFBLHNDQUMxQixvQ0FBdUJtRyxTQUF2QixDQUQwQjs7QUFBQTs7QUFDckQzQixVQUFBQSxVQURxRDtBQUN6Q0QsVUFBQUEsV0FEeUM7QUFFdkQsU0FGRCxNQUVPLElBQUlHLGVBQWUsS0FBSzVFLGdCQUFXQyxlQUFYLENBQTJCRSxPQUFuRCxFQUE0RDtBQUFBLHNDQUNyQyx1Q0FBMEJrRyxTQUExQixDQURxQzs7QUFBQTs7QUFDaEUzQixVQUFBQSxVQURnRTtBQUNwREQsVUFBQUEsV0FEb0Q7QUFFbEUsU0FGTSxNQUVBO0FBR0wsY0FBSWlDLFNBQVMsR0FBRyx1Q0FBMEJMLFNBQTFCLENBQWhCO0FBQ0EsY0FBSU0sTUFBTSxHQUFHLG9DQUF1Qk4sU0FBdkIsQ0FBYjtBQUVBNUIsVUFBQUEsV0FBVyxtQ0FDTmlDLFNBQVMsQ0FBQyxDQUFELENBREgsRUFFTkMsTUFBTSxDQUFDLENBQUQsQ0FGQSxDQUFYO0FBTUFqQyxVQUFBQSxVQUFVLEdBQUdnQyxTQUFTLENBQUMsQ0FBRCxDQUF0QjtBQUNEO0FBQ0Y7O0FBR0QsVUFBSTlGLGdCQUFFZ0csUUFBRixDQUFXbkMsV0FBWCxDQUFKLEVBQTZCO0FBQzNCbkQsUUFBQUEsR0FBRyxDQUFDeUUsTUFBSixDQUFXckIsVUFBWCxFQUF1Qm1DLElBQXZCLENBQTRCcEMsV0FBNUI7QUFDRCxPQUZELE1BRU87QUFDTCxZQUFJRSxZQUFKLEVBQWtCO0FBQ2hCLGNBQUlDLGVBQWUsS0FBSzVFLGdCQUFXQyxlQUFYLENBQTJCQyxHQUFuRCxFQUF3RDtBQUN0RHVFLFlBQUFBLFdBQVcsQ0FBQy9FLEtBQVosQ0FBa0JILFNBQWxCLEdBQThCb0YsWUFBOUI7QUFDRCxXQUZELE1BRU87QUFDTEYsWUFBQUEsV0FBVyxDQUFDbEYsU0FBWixHQUF3Qm9GLFlBQXhCO0FBQ0Q7QUFDRixTQU5ELE1BTU87QUFDTEYsVUFBQUEsV0FBVyxDQUFDbEYsU0FBWixHQUF3QmdGLEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQVgsSUFBd0IsSUFBaEQ7QUFDRDs7QUFHRCxZQUFJcUYsZUFBZSxLQUFLNUUsZ0JBQVdDLGVBQVgsQ0FBMkJDLEdBQW5ELEVBQXdEO0FBQ3RELGlCQUFPdUUsV0FBVyxDQUFDbEYsU0FBbkI7QUFDRDs7QUFDRCtCLFFBQUFBLEdBQUcsQ0FBQ3lFLE1BQUosQ0FBV3JCLFVBQVgsRUFBdUJvQyxJQUF2QixDQUE0QnJDLFdBQTVCO0FBQ0Q7QUFDRixLQTFNZTs7QUFBQSxvQkFBWkgsWUFBWTtBQUFBO0FBQUE7QUFBQSxLQUFoQjs7QUE0TUFULEVBQUFBLEdBQUcsQ0FBQ0ssTUFBTSxDQUFDNkMsV0FBUCxFQUFELENBQUgsQ0FBMEIvQyxJQUExQixFQUFnQyxDQUFDTyxHQUFELEVBQU1qRCxHQUFOLEtBQWM7QUFDNUMwRixzQkFBRUMsT0FBRixDQUFVM0MsWUFBWSxDQUFDQyxHQUFELEVBQU1qRCxHQUFOLENBQXRCLEVBQWtDNEYsSUFBbEM7QUFDRCxHQUZEO0FBR0Q7O0FBRUQsU0FBU3BDLHNCQUFULENBQWlDcEUsTUFBakMsRUFBeUM2RCxHQUF6QyxFQUE4Q3ZELE9BQTlDLEVBQXVEO0FBRXJELE1BQUksQ0FBQ04sTUFBTSxDQUFDeUcsV0FBUCxDQUFtQjVDLEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQTlCLENBQUwsRUFBK0M7QUFDN0MsV0FBTyxLQUFQO0FBQ0Q7O0FBSUQsTUFBSXlCLE9BQU8sS0FBSyxlQUFoQixFQUFpQztBQUMvQixXQUFPLEtBQVA7QUFDRDs7QUFJRCxNQUFJTixNQUFNLENBQUMwRyxtQkFBUCxDQUEyQjdDLEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQXRDLEVBQWlEZ0YsR0FBRyxDQUFDTCxNQUFyRCxFQUE2REssR0FBRyxDQUFDOEMsV0FBakUsQ0FBSixFQUFtRjtBQUNqRixXQUFPLEtBQVA7QUFDRDs7QUFNRCxNQUFJckksYUFBYSxDQUFDc0ksSUFBZCxDQUFtQi9DLEdBQUcsQ0FBQzhDLFdBQXZCLENBQUosRUFBeUM7QUFDdkMsV0FBTyxLQUFQO0FBQ0Q7O0FBT0QsUUFBTUUsVUFBVSxHQUFHaEMsSUFBSSxDQUFDQyxTQUFMLENBQWVqQixHQUFHLENBQUNDLElBQW5CLENBQW5COztBQUNBLE1BQUkrQyxVQUFVLElBQUl6SSxjQUFjLENBQUN3SSxJQUFmLENBQW9CQyxVQUFwQixDQUFsQixFQUFtRDtBQUNqRCxXQUFPLEtBQVA7QUFDRDs7QUFFRCxTQUFPLElBQVA7QUFDRDs7U0FFY3hDLFU7Ozs7O2dEQUFmLFdBQTJCckUsTUFBM0IsRUFBbUM2RCxHQUFuQyxFQUF3Q2pELEdBQXhDLEVBQTZDO0FBQzNDZCxJQUFBQSxjQUFjLENBQUNwQyxTQUFmLENBQXlCbUcsR0FBRyxDQUFDN0IsTUFBSixDQUFXbkQsU0FBcEMsRUFBK0NrQixlQUFlLENBQUNDLE1BQUQsRUFBUzZELEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQXBCLENBQTlELEVBQ0dpSSxJQURILENBQ1Esd0RBRFI7O0FBSUEsUUFBSSxDQUFDOUcsTUFBTSxDQUFDK0csUUFBUCxDQUFnQmxELEdBQUcsQ0FBQzdCLE1BQUosQ0FBV25ELFNBQTNCLENBQUwsRUFBNEM7QUFDMUMsWUFBTSxJQUFJbUUsS0FBSixDQUFVLGtFQUFWLENBQU47QUFDRDs7QUFDRCxRQUFJO0FBQ0YsWUFBTWdFLFVBQVUsU0FBU2hILE1BQU0sQ0FBQ2lELGNBQVAsQ0FBc0IsYUFBdEIsRUFBcUNZLEdBQXJDLEVBQTBDakQsR0FBMUMsRUFBK0NpRCxHQUFHLENBQUM3QixNQUFKLENBQVduRCxTQUExRCxDQUF6QjtBQUNBLFVBQUltSSxVQUFVLElBQUlBLFVBQVUsQ0FBQ2hDLEtBQTdCLEVBQW9DLE1BQU1nQyxVQUFVLENBQUNoQyxLQUFqQjtBQUNyQyxLQUhELENBR0UsT0FBT1UsR0FBUCxFQUFZO0FBQ1osVUFBSSx5QkFBWUEsR0FBWixFQUFpQjlELGVBQU9rRSxpQkFBeEIsQ0FBSixFQUFnRDtBQUM5QyxjQUFNSixHQUFOO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsY0FBTSxJQUFJMUMsS0FBSixDQUFXLGlDQUFnQzBDLEdBQUcsQ0FBQy9ELE9BQVEsRUFBdkQsQ0FBTjtBQUNEO0FBQ0Y7QUFDRixHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGxvZ2dlciwgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHZhbGlkYXRvcnMgfSBmcm9tICcuL3ZhbGlkYXRvcnMnO1xuaW1wb3J0IHsgZXJyb3JzLCBpc0Vycm9yVHlwZSwgZXJyb3JGcm9tTUpTT05XUFN0YXR1c0NvZGUsIGVycm9yRnJvbVczQ0pzb25Db2RlLFxuICAgICAgICAgZ2V0UmVzcG9uc2VGb3JXM0NFcnJvciwgZ2V0UmVzcG9uc2VGb3JKc29ud3BFcnJvciB9IGZyb20gJy4vZXJyb3JzJztcbmltcG9ydCB7IE1FVEhPRF9NQVAsIE5PX1NFU1NJT05fSURfQ09NTUFORFMgfSBmcm9tICcuL3JvdXRlcyc7XG5pbXBvcnQgeyByZW5hbWVLZXkgfSBmcm9tICcuLi9iYXNlZHJpdmVyL2hlbHBlcnMnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IEJhc2VEcml2ZXIgZnJvbSAnLi4vYmFzZWRyaXZlci9kcml2ZXInO1xuaW1wb3J0IExSVSBmcm9tICdscnUtY2FjaGUnO1xuXG5jb25zdCBHRU5FUklDX1BST1RPQ09MID0gJ0dFTkVSSUMnO1xuY29uc3QgbWpzb253cExvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ01KU09OV1AnKTtcbmNvbnN0IHczY0xvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ1czQycpO1xuY29uc3QgZ2VuZXJpY1Byb3RvY29sTG9nID0gbG9nZ2VyLmdldExvZ2dlcihHRU5FUklDX1BST1RPQ09MKTtcblxuY29uc3QgSlNPTldQX1NVQ0NFU1NfU1RBVFVTX0NPREUgPSAwO1xuLy8gVE9ETzogTWFrZSB0aGlzIHZhbHVlIGNvbmZpZ3VyYWJsZSBhcyBhIHNlcnZlciBzaWRlIGNhcGFiaWxpdHlcbmNvbnN0IExPR19PQkpfTEVOR1RIID0gMTAyNDsgLy8gTUFYIExFTkdUSCBMb2dnZWQgdG8gZmlsZSAvIGNvbnNvbGVcblxuY29uc3QgTUpTT05XUF9FTEVNRU5UX0tFWSA9ICdFTEVNRU5UJztcbmNvbnN0IFczQ19FTEVNRU5UX0tFWSA9ICdlbGVtZW50LTYwNjYtMTFlNC1hNTJlLTRmNzM1NDY2Y2VjZic7XG5jb25zdCBJTUFHRV9FTEVNRU5UX1BSRUZJWCA9ICdhcHBpdW0taW1hZ2UtZWxlbWVudC0nO1xuXG5jb25zdCBDUkVBVEVfU0VTU0lPTl9DT01NQU5EID0gJ2NyZWF0ZVNlc3Npb24nO1xuY29uc3QgREVMRVRFX1NFU1NJT05fQ09NTUFORCA9ICdkZWxldGVTZXNzaW9uJztcblxuY29uc3QgSU1HX0VMX0JPRFlfUkUgPSBuZXcgUmVnRXhwKFxuICBgXCIoJHtXM0NfRUxFTUVOVF9LRVl9fCR7TUpTT05XUF9FTEVNRU5UX0tFWX0pXCI6XFxzKmAgKyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVzZWxlc3MtZXNjYXBlXG4gIGBcIiR7SU1BR0VfRUxFTUVOVF9QUkVGSVh9W15cIl0rXCJgXG4pO1xuY29uc3QgSU1HX0VMX1VSTF9SRSA9IG5ldyBSZWdFeHAoXG4gIGAvKGVsZW1lbnR8c2NyZWVuc2hvdClgICtcbiAgYC8ke0lNQUdFX0VMRU1FTlRfUFJFRklYfVteL10rYFxuKTtcblxuY2xhc3MgUHJvdG9jb2wge31cblxuY2xhc3MgU2Vzc2lvbnNDYWNoZSB7XG4gIGNvbnN0cnVjdG9yIChtYXgpIHtcbiAgICB0aGlzLl9jYWNoZSA9IG5ldyBMUlUoeyBtYXggfSk7XG4gIH1cblxuICBnZXRMb2dnZXIgKHNlc3Npb25JZCwgcHJvdG9jb2wpIHtcbiAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICBpZiAodGhpcy5fY2FjaGUuaGFzKHNlc3Npb25JZCkpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9jYWNoZS5nZXQoc2Vzc2lvbklkKTtcbiAgICAgICAgaWYgKHZhbHVlLmxvZ2dlcikge1xuICAgICAgICAgIHJldHVybiB2YWx1ZS5sb2dnZXI7XG4gICAgICAgIH1cbiAgICAgICAgcHJvdG9jb2wgPSBwcm90b2NvbCB8fCB2YWx1ZS5wcm90b2NvbDtcbiAgICAgIH1cbiAgICAgIC8vIEFsd2F5cyBjcmVhdGUgYSBuZXcgbG9nZ2VyIGluc3RhbmNlIGZvciBpZHNcbiAgICAgIC8vIHRoYXQgYXJlIG5vdCBpbiB0aGUgY3VycmVudCBzZXNzaW9ucyBsaXN0LFxuICAgICAgLy8gc28gd2UgY2FuIHN0aWxsIHNlZSBzdWNoIGlkcyBhcyBwcmVmaXhlc1xuICAgICAgcmV0dXJuIGxvZ2dlci5nZXRMb2dnZXIoYCR7cHJvdG9jb2wgfHwgR0VORVJJQ19QUk9UT0NPTH0gYCArXG4gICAgICAgIGAoJHtzZXNzaW9uSWQuc3Vic3RyaW5nKDAsIE1hdGgubWluKHNlc3Npb25JZC5sZW5ndGgsIDgpKX0pYCk7XG4gICAgfVxuXG4gICAgLy8gRmFsbCBiYWNrIHRvIHByb3RvY29sIG5hbWUtb25seSBsb2dnZXIgaWYgc2Vzc2lvbiBpZCBpcyB1bmtub3duXG4gICAgc3dpdGNoIChwcm90b2NvbCkge1xuICAgICAgY2FzZSBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5XM0M6XG4gICAgICAgIHJldHVybiB3M2NMb2c7XG4gICAgICBjYXNlIEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLk1KU09OV1A6XG4gICAgICAgIHJldHVybiBtanNvbndwTG9nO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGdlbmVyaWNQcm90b2NvbExvZztcbiAgICB9XG4gIH1cblxuICBnZXRQcm90b2NvbCAoc2Vzc2lvbklkKSB7XG4gICAgcmV0dXJuICh0aGlzLl9jYWNoZS5nZXQoc2Vzc2lvbklkKSB8fCB7fSkucHJvdG9jb2w7XG4gIH1cblxuICBwdXRTZXNzaW9uIChzZXNzaW9uSWQsIHZhbHVlKSB7XG4gICAgaWYgKHNlc3Npb25JZCAmJiB2YWx1ZSkge1xuICAgICAgdGhpcy5fY2FjaGUuc2V0KHNlc3Npb25JZCwge1xuICAgICAgICBwcm90b2NvbDogdmFsdWUsXG4gICAgICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gY2FjaGUgdGhlIGxvZ2dlciBpbnN0YW5jZSBmb3IgZWFjaCByYW5kb20gc2Vzc2lvbiBpZCBpbiB0aGUgY2FjaGVcbiAgICAgICAgLy8gaW4gb3JkZXIgdG8gc2F2ZSBtZW1vcnkuIEluc3RlYWQgd2Ugb25seSBjYWNoZSBsb2dnZXJzIGZvciB2YWxpZCBpZHMgdGhhdFxuICAgICAgICAvLyBhcmUgcmV0dXJuZWQgYnkgYGNyZWF0ZVNlc3Npb25gIGNhbGwgYW5kIHJlc2V0IHRoZW0gYWZ0ZXIgYGRlbGV0ZVNlc3Npb25gIGlzIGNhbGxlZFxuICAgICAgICBsb2dnZXI6IHRoaXMuZ2V0TG9nZ2VyKHNlc3Npb25JZCwgdmFsdWUpLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIHJlc2V0TG9nZ2VyIChzZXNzaW9uSWQpIHtcbiAgICBpZiAodGhpcy5fY2FjaGUuaGFzKHNlc3Npb25JZCkpIHtcbiAgICAgIHRoaXMuX2NhY2hlLmdldChzZXNzaW9uSWQpLmxvZ2dlciA9IG51bGw7XG4gICAgfVxuICB9XG59XG5cbi8vIFRoaXMgY2FjaGUgaXMgdXNlZnVsIHdoZW4gYSBzZXNzaW9uIGdldHMgdGVybWluYXRlZFxuLy8gYW5kIHJlbW92ZWQgZnJvbSB0aGUgc2Vzc2lvbnMgbGlzdCBpbiB0aGUgdW1icmVsbGEgZHJpdmVyLFxuLy8gYnV0IHRoZSBjbGllbnQgc3RpbGwgdHJpZXMgdG8gc2VuZCBhIGNvbW1hbmQgdG8gdGhpcyBzZXNzaW9uIGlkLlxuLy8gU28gd2Uga25vdyBob3cgdG8gcHJvcGVybHkgd3JhcCB0aGUgZXJyb3IgbWVzc2FnZSBmb3IgaXRcbmNvbnN0IFNFU1NJT05TX0NBQ0hFID0gbmV3IFNlc3Npb25zQ2FjaGUoMTAwKTtcblxuXG5mdW5jdGlvbiBleHRyYWN0UHJvdG9jb2wgKGRyaXZlciwgc2Vzc2lvbklkID0gbnVsbCkge1xuICBjb25zdCBkc3REcml2ZXIgPSBfLmlzRnVuY3Rpb24oZHJpdmVyLmRyaXZlckZvclNlc3Npb24pXG4gICAgPyBkcml2ZXIuZHJpdmVyRm9yU2Vzc2lvbihzZXNzaW9uSWQpXG4gICAgOiBkcml2ZXI7XG4gIGlmIChkc3REcml2ZXIgPT09IGRyaXZlcikge1xuICAgIC8vIFNob3J0Y2lyY3VpdCBpZiB0aGUgZHJpdmVyIGluc3RhbmNlIGlzIG5vdCBhbiB1bWJyZWxsYSBkcml2ZXJcbiAgICAvLyBvciBpdCBpcyBGYWtlIGRyaXZlciBpbnN0YW5jZSwgd2hlcmUgYGRyaXZlci5kcml2ZXJGb3JTZXNzaW9uYFxuICAgIC8vIGFsd2F5cyByZXR1cm5zIHNlbGYgaW5zdGFuY2VcbiAgICByZXR1cm4gZHJpdmVyLnByb3RvY29sO1xuICB9XG5cbiAgLy8gRXh0cmFjdCB0aGUgcHJvdG9jb2wgZm9yIHRoZSBjdXJyZW50IHNlc3Npb24gaWYgdGhlIGdpdmVuIGRyaXZlciBpcyB0aGUgdW1icmVsbGEgb25lXG4gIHJldHVybiBkc3REcml2ZXIgPyBkc3REcml2ZXIucHJvdG9jb2wgOiBTRVNTSU9OU19DQUNIRS5nZXRQcm90b2NvbChzZXNzaW9uSWQpO1xufVxuXG5mdW5jdGlvbiBpc1Nlc3Npb25Db21tYW5kIChjb21tYW5kKSB7XG4gIHJldHVybiAhXy5pbmNsdWRlcyhOT19TRVNTSU9OX0lEX0NPTU1BTkRTLCBjb21tYW5kKTtcbn1cblxuZnVuY3Rpb24gd3JhcFBhcmFtcyAocGFyYW1TZXRzLCBqc29uT2JqKSB7XG4gIC8qIFRoZXJlIGFyZSBjb21tYW5kcyBsaWtlIHBlcmZvcm1Ub3VjaCB3aGljaCB0YWtlIGEgc2luZ2xlIHBhcmFtZXRlciAocHJpbWl0aXZlIHR5cGUgb3IgYXJyYXkpLlxuICAgKiBTb21lIGRyaXZlcnMgY2hvb3NlIHRvIHBhc3MgdGhpcyBwYXJhbWV0ZXIgYXMgYSB2YWx1ZSAoZWcuIFthY3Rpb24xLCBhY3Rpb24yLi4uXSkgd2hpbGUgb3RoZXJzIHRvXG4gICAqIHdyYXAgaXQgd2l0aGluIGFuIG9iamVjdChlZycge2dlc3R1cmU6ICBbYWN0aW9uMSwgYWN0aW9uMi4uLl19KSwgd2hpY2ggbWFrZXMgaXQgaGFyZCB0byB2YWxpZGF0ZS5cbiAgICogVGhlIHdyYXAgb3B0aW9uIGluIHRoZSBzcGVjIGVuZm9yY2Ugd3JhcHBpbmcgYmVmb3JlIHZhbGlkYXRpb24sIHNvIHRoYXQgYWxsIHBhcmFtcyBhcmUgd3JhcHBlZCBhdFxuICAgKiB0aGUgdGltZSB0aGV5IGFyZSB2YWxpZGF0ZWQgYW5kIGxhdGVyIHBhc3NlZCB0byB0aGUgY29tbWFuZHMuXG4gICAqL1xuICBsZXQgcmVzID0ganNvbk9iajtcbiAgaWYgKF8uaXNBcnJheShqc29uT2JqKSB8fCAhXy5pc09iamVjdChqc29uT2JqKSkge1xuICAgIHJlcyA9IHt9O1xuICAgIHJlc1twYXJhbVNldHMud3JhcF0gPSBqc29uT2JqO1xuICB9XG4gIHJldHVybiByZXM7XG59XG5cbmZ1bmN0aW9uIHVud3JhcFBhcmFtcyAocGFyYW1TZXRzLCBqc29uT2JqKSB7XG4gIC8qIFRoZXJlIGFyZSBjb21tYW5kcyBsaWtlIHNldE5ldHdvcmtDb25uZWN0aW9uIHdoaWNoIHNlbmQgcGFyYW1ldGVycyB3cmFwcGVkIGluc2lkZSBhIGtleSBzdWNoIGFzXG4gICAqIFwicGFyYW1ldGVyc1wiLiBUaGlzIGZ1bmN0aW9uIHVud3JhcHMgdGhlbSAoZWcuIHtcInBhcmFtZXRlcnNcIjoge1widHlwZVwiOiAxfX0gYmVjb21lcyB7XCJ0eXBlXCI6IDF9KS5cbiAgICovXG4gIGxldCByZXMgPSBqc29uT2JqO1xuICBpZiAoXy5pc09iamVjdChqc29uT2JqKSkge1xuICAgIC8vIHNvbWUgY2xpZW50cywgbGlrZSBydWJ5LCBkb24ndCB3cmFwXG4gICAgaWYgKGpzb25PYmpbcGFyYW1TZXRzLnVud3JhcF0pIHtcbiAgICAgIHJlcyA9IGpzb25PYmpbcGFyYW1TZXRzLnVud3JhcF07XG4gICAgfVxuICB9XG4gIHJldHVybiByZXM7XG59XG5cbmZ1bmN0aW9uIGNoZWNrUGFyYW1zIChwYXJhbVNldHMsIGpzb25PYmosIHByb3RvY29sKSB7XG4gIGxldCByZXF1aXJlZFBhcmFtcyA9IFtdO1xuICBsZXQgb3B0aW9uYWxQYXJhbXMgPSBbXTtcbiAgbGV0IHJlY2VpdmVkUGFyYW1zID0gXy5rZXlzKGpzb25PYmopO1xuXG4gIGlmIChwYXJhbVNldHMpIHtcbiAgICBpZiAocGFyYW1TZXRzLnJlcXVpcmVkKSB7XG4gICAgICAvLyB3ZSBtaWdodCBoYXZlIGFuIGFycmF5IG9mIHBhcmFtZXRlcnMsXG4gICAgICAvLyBvciBhbiBhcnJheSBvZiBhcnJheXMgb2YgcGFyYW1ldGVycywgc28gc3RhbmRhcmRpemVcbiAgICAgIGlmICghXy5pc0FycmF5KF8uZmlyc3QocGFyYW1TZXRzLnJlcXVpcmVkKSkpIHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXMgPSBbcGFyYW1TZXRzLnJlcXVpcmVkXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcXVpcmVkUGFyYW1zID0gcGFyYW1TZXRzLnJlcXVpcmVkO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBvcHRpb25hbCBwYXJhbWV0ZXJzIGFyZSBqdXN0IGFuIGFycmF5XG4gICAgaWYgKHBhcmFtU2V0cy5vcHRpb25hbCkge1xuICAgICAgb3B0aW9uYWxQYXJhbXMgPSBwYXJhbVNldHMub3B0aW9uYWw7XG4gICAgfVxuXG4gICAgLy8gSWYgYSBmdW5jdGlvbiB3YXMgcHJvdmlkZWQgYXMgdGhlICd2YWxpZGF0ZScga2V5LCBpdCB3aWxsIGhlcmUgYmUgY2FsbGVkIHdpdGhcbiAgICAvLyBqc29uT2JqIGFzIHRoZSBwYXJhbS4gSWYgaXQgcmV0dXJucyBzb21ldGhpbmcgZmFsc3ksIHZlcmlmaWNhdGlvbiB3aWxsIGJlXG4gICAgLy8gY29uc2lkZXJlZCB0byBoYXZlIHBhc3NlZC4gSWYgaXQgcmV0dXJucyBzb21ldGhpbmcgZWxzZSwgdGhhdCB3aWxsIGJlIHRoZVxuICAgIC8vIGFyZ3VtZW50IHRvIGFuIGVycm9yIHdoaWNoIGlzIHRocm93biB0byB0aGUgdXNlclxuICAgIGlmIChwYXJhbVNldHMudmFsaWRhdGUpIHtcbiAgICAgIGxldCBtZXNzYWdlID0gcGFyYW1TZXRzLnZhbGlkYXRlKGpzb25PYmosIHByb3RvY29sKTtcbiAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnMuQmFkUGFyYW1ldGVyc0Vycm9yKG1lc3NhZ2UsIGpzb25PYmopO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGlmIHdlIGhhdmUgbm8gcmVxdWlyZWQgcGFyYW1ldGVycywgYWxsIGlzIHdlbGxcbiAgaWYgKHJlcXVpcmVkUGFyYW1zLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNvbWUgY2xpZW50cyBwYXNzIGluIHRoZSBzZXNzaW9uIGlkIGluIHRoZSBwYXJhbXNcbiAgaWYgKG9wdGlvbmFsUGFyYW1zLmluZGV4T2YoJ3Nlc3Npb25JZCcpID09PSAtMSkge1xuICAgIG9wdGlvbmFsUGFyYW1zLnB1c2goJ3Nlc3Npb25JZCcpO1xuICB9XG5cbiAgLy8gc29tZSBjbGllbnRzIHBhc3MgaW4gYW4gZWxlbWVudCBpZCBpbiB0aGUgcGFyYW1zXG4gIGlmIChvcHRpb25hbFBhcmFtcy5pbmRleE9mKCdpZCcpID09PSAtMSkge1xuICAgIG9wdGlvbmFsUGFyYW1zLnB1c2goJ2lkJyk7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIHRoZSByZXF1aXJlZCBwYXJhbWV0ZXJzIGFuZCBjaGVjayBhZ2FpbnN0IG91ciBhcmd1bWVudHNcbiAgZm9yIChsZXQgcGFyYW1zIG9mIHJlcXVpcmVkUGFyYW1zKSB7XG4gICAgaWYgKF8uZGlmZmVyZW5jZShyZWNlaXZlZFBhcmFtcywgcGFyYW1zLCBvcHRpb25hbFBhcmFtcykubGVuZ3RoID09PSAwICYmXG4gICAgICAgIF8uZGlmZmVyZW5jZShwYXJhbXMsIHJlY2VpdmVkUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIHdlIGhhdmUgYSBzZXQgb2YgcGFyYW1ldGVycyB0aGF0IGlzIGNvcnJlY3RcbiAgICAgIC8vIHNvIHNob3J0LWNpcmN1aXRcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgdGhyb3cgbmV3IGVycm9ycy5CYWRQYXJhbWV0ZXJzRXJyb3IocGFyYW1TZXRzLCByZWNlaXZlZFBhcmFtcyk7XG59XG5cbi8qXG4gKiBUaGlzIG1ldGhvZCB0YWtlcyAzIHBpZWNlcyBvZiBkYXRhOiByZXF1ZXN0IHBhcmFtZXRlcnMgKCdyZXF1ZXN0UGFyYW1zJyksXG4gKiBhIHJlcXVlc3QgSlNPTiBib2R5ICgnanNvbk9iaicpLCBhbmQgJ3BheWxvYWRQYXJhbXMnLCB3aGljaCBpcyB0aGUgc2VjdGlvblxuICogZnJvbSB0aGUgcm91dGUgZGVmaW5pdGlvbiBmb3IgYSBwYXJ0aWN1bGFyIGVuZHBvaW50IHdoaWNoIGhhcyBpbnN0cnVjdGlvbnNcbiAqIG9uIGhhbmRsaW5nIHBhcmFtZXRlcnMuIFRoaXMgbWV0aG9kIHJldHVybnMgYW4gYXJyYXkgb2YgYXJndW1lbnRzIHdoaWNoIHdpbGxcbiAqIGJlIGFwcGxpZWQgdG8gYSBjb21tYW5kLlxuICovXG5mdW5jdGlvbiBtYWtlQXJncyAocmVxdWVzdFBhcmFtcywganNvbk9iaiwgcGF5bG9hZFBhcmFtcywgcHJvdG9jb2wpIHtcbiAgLy8gV2Ugd2FudCB0byBwYXNzIHRoZSBcInVybFwiIHBhcmFtZXRlcnMgdG8gdGhlIGNvbW1hbmRzIGluIHJldmVyc2Ugb3JkZXJcbiAgLy8gc2luY2UgdGhlIGNvbW1hbmQgd2lsbCBzb21ldGltZXMgd2FudCB0byBpZ25vcmUsIHNheSwgdGhlIHNlc3Npb25JZC5cbiAgLy8gVGhpcyBoYXMgdGhlIGVmZmVjdCBvZiBwdXR0aW5nIHNlc3Npb25JZCBsYXN0LCB3aGljaCBtZWFucyBpbiBKUyB3ZSBjYW5cbiAgLy8gb21pdCBpdCBmcm9tIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgaWYgd2UncmUgbm90IGdvaW5nIHRvIHVzZSBpdC5cbiAgbGV0IHVybFBhcmFtcyA9IF8ua2V5cyhyZXF1ZXN0UGFyYW1zKS5yZXZlcnNlKCk7XG5cbiAgLy8gSW4gdGhlIHNpbXBsZSBjYXNlLCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVycyBhcmUgYSBiYXNpYyBhcnJheSBpblxuICAvLyBwYXlsb2FkUGFyYW1zLnJlcXVpcmVkLCBzbyBzdGFydCB0aGVyZS4gSXQncyBwb3NzaWJsZSB0aGF0IHRoZXJlIGFyZVxuICAvLyBtdWx0aXBsZSBvcHRpb25hbCBzZXRzIG9mIHJlcXVpcmVkIHBhcmFtcywgdGhvdWdoLCBzbyBoYW5kbGUgdGhhdCBjYXNlXG4gIC8vIHRvby5cbiAgbGV0IHJlcXVpcmVkUGFyYW1zID0gcGF5bG9hZFBhcmFtcy5yZXF1aXJlZDtcbiAgaWYgKF8uaXNBcnJheShfLmZpcnN0KHBheWxvYWRQYXJhbXMucmVxdWlyZWQpKSkge1xuICAgIC8vIElmIHRoZXJlIGFyZSBvcHRpb25hbCBzZXRzIG9mIHJlcXVpcmVkIHBhcmFtcywgdGhlbiB3ZSB3aWxsIGhhdmUgYW5cbiAgICAvLyBhcnJheSBvZiBhcnJheXMgaW4gcGF5bG9hZFBhcmFtcy5yZXF1aXJlZCwgc28gbG9vcCB0aHJvdWdoIGVhY2ggc2V0IGFuZFxuICAgIC8vIHBpY2sgdGhlIG9uZSB0aGF0IG1hdGNoZXMgd2hpY2ggSlNPTiBwYXJhbXMgd2VyZSBhY3R1YWxseSBzZW50LiBXZSd2ZVxuICAgIC8vIGFscmVhZHkgYmVlbiB0aHJvdWdoIHZhbGlkYXRpb24gc28gd2UncmUgZ3VhcmFudGVlZCB0byBmaW5kIGEgbWF0Y2guXG4gICAgbGV0IGtleXMgPSBfLmtleXMoanNvbk9iaik7XG4gICAgZm9yIChsZXQgcGFyYW1zIG9mIHBheWxvYWRQYXJhbXMucmVxdWlyZWQpIHtcbiAgICAgIGlmIChfLndpdGhvdXQocGFyYW1zLCAuLi5rZXlzKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXMgPSBwYXJhbXM7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIE5vdyB3ZSBjb25zdHJ1Y3Qgb3VyIGxpc3Qgb2YgYXJndW1lbnRzIHdoaWNoIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBjb21tYW5kXG4gIGxldCBhcmdzO1xuICBpZiAoXy5pc0Z1bmN0aW9uKHBheWxvYWRQYXJhbXMubWFrZUFyZ3MpKSB7XG4gICAgLy8gSW4gdGhlIHJvdXRlIHNwZWMsIGEgcGFydGljdWxhciByb3V0ZSBtaWdodCBkZWZpbmUgYSAnbWFrZUFyZ3MnIGZ1bmN0aW9uXG4gICAgLy8gaWYgaXQgd2FudHMgZnVsbCBjb250cm9sIG92ZXIgaG93IHRvIHR1cm4gSlNPTiBwYXJhbWV0ZXJzIGludG8gY29tbWFuZFxuICAgIC8vIGFyZ3VtZW50cy4gU28gd2UgcGFzcyBpdCB0aGUgSlNPTiBwYXJhbWV0ZXJzIGFuZCBpdCByZXR1cm5zIGFuIGFycmF5XG4gICAgLy8gd2hpY2ggd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBoYW5kbGluZyBjb21tYW5kLiBGb3IgZXhhbXBsZSBpZiBpdCByZXR1cm5zXG4gICAgLy8gWzEsIDIsIDNdLCB3ZSB3aWxsIGNhbGwgYGNvbW1hbmQoMSwgMiwgMywgLi4uKWAgKHVybCBwYXJhbXMgYXJlIHNlcGFyYXRlXG4gICAgLy8gZnJvbSBKU09OIHBhcmFtcyBhbmQgZ2V0IGNvbmNhdGVuYXRlZCBiZWxvdykuXG4gICAgYXJncyA9IHBheWxvYWRQYXJhbXMubWFrZUFyZ3MoanNvbk9iaiwgcHJvdG9jb2wpO1xuICB9IGVsc2Uge1xuICAgIC8vIE90aGVyd2lzZSwgY29sbGVjdCBhbGwgdGhlIHJlcXVpcmVkIGFuZCBvcHRpb25hbCBwYXJhbXMgYW5kIGZsYXR0ZW4gdGhlbVxuICAgIC8vIGludG8gYW4gYXJndW1lbnQgYXJyYXlcbiAgICBhcmdzID0gXy5mbGF0dGVuKHJlcXVpcmVkUGFyYW1zKS5tYXAoKHApID0+IGpzb25PYmpbcF0pO1xuICAgIGlmIChwYXlsb2FkUGFyYW1zLm9wdGlvbmFsKSB7XG4gICAgICBhcmdzID0gYXJncy5jb25jYXQoXy5mbGF0dGVuKHBheWxvYWRQYXJhbXMub3B0aW9uYWwpLm1hcCgocCkgPT4ganNvbk9ialtwXSkpO1xuICAgIH1cbiAgfVxuICAvLyBGaW5hbGx5LCBnZXQgb3VyIHVybCBwYXJhbXMgKHNlc3Npb24gaWQsIGVsZW1lbnQgaWQsIGV0Yy4uLikgb24gdGhlIGVuZCBvZlxuICAvLyB0aGUgbGlzdFxuICBhcmdzID0gYXJncy5jb25jYXQodXJsUGFyYW1zLm1hcCgodSkgPT4gcmVxdWVzdFBhcmFtc1t1XSkpO1xuICByZXR1cm4gYXJncztcbn1cblxuZnVuY3Rpb24gcm91dGVDb25maWd1cmluZ0Z1bmN0aW9uIChkcml2ZXIpIHtcbiAgaWYgKCFkcml2ZXIuc2Vzc2lvbkV4aXN0cykge1xuICAgIHRocm93IG5ldyBFcnJvcignRHJpdmVycyB1c2VkIHdpdGggTUpTT05XUCBtdXN0IGltcGxlbWVudCBgc2Vzc2lvbkV4aXN0c2AnKTtcbiAgfVxuXG4gIGlmICghKGRyaXZlci5leGVjdXRlQ29tbWFuZCB8fCBkcml2ZXIuZXhlY3V0ZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RyaXZlcnMgdXNlZCB3aXRoIE1KU09OV1AgbXVzdCBpbXBsZW1lbnQgYGV4ZWN1dGVDb21tYW5kYCBvciBgZXhlY3V0ZWAnKTtcbiAgfVxuXG4gIC8vIHJldHVybiBhIGZ1bmN0aW9uIHdoaWNoIHdpbGwgYWRkIGFsbCB0aGUgcm91dGVzIHRvIHRoZSBkcml2ZXJcbiAgcmV0dXJuIGZ1bmN0aW9uIChhcHApIHtcbiAgICBmb3IgKGxldCBbcGF0aCwgbWV0aG9kc10gb2YgXy50b1BhaXJzKE1FVEhPRF9NQVApKSB7XG4gICAgICBmb3IgKGxldCBbbWV0aG9kLCBzcGVjXSBvZiBfLnRvUGFpcnMobWV0aG9kcykpIHtcbiAgICAgICAgLy8gc2V0IHVwIHRoZSBleHByZXNzIHJvdXRlIGhhbmRsZXJcbiAgICAgICAgYnVpbGRIYW5kbGVyKGFwcCwgbWV0aG9kLCBwYXRoLCBzcGVjLCBkcml2ZXIsIGlzU2Vzc2lvbkNvbW1hbmQoc3BlYy5jb21tYW5kKSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEhhbmRsZXIgKGFwcCwgbWV0aG9kLCBwYXRoLCBzcGVjLCBkcml2ZXIsIGlzU2Vzc0NtZCkge1xuICBsZXQgYXN5bmNIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgbGV0IGpzb25PYmogPSByZXEuYm9keTtcbiAgICBsZXQgaHR0cFJlc0JvZHkgPSB7fTtcbiAgICBsZXQgaHR0cFN0YXR1cyA9IDIwMDtcbiAgICBsZXQgbmV3U2Vzc2lvbklkO1xuICAgIGxldCBjdXJyZW50UHJvdG9jb2wgPSBleHRyYWN0UHJvdG9jb2woZHJpdmVyLCByZXEucGFyYW1zLnNlc3Npb25JZCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gaWYgdGhpcyBpcyBhIHNlc3Npb24gY29tbWFuZCBidXQgd2UgZG9uJ3QgaGF2ZSBhIHNlc3Npb24sXG4gICAgICAvLyBlcnJvciBvdXQgZWFybHkgKGVzcGVjaWFsbHkgYmVmb3JlIHByb3h5aW5nKVxuICAgICAgaWYgKGlzU2Vzc0NtZCAmJiAhZHJpdmVyLnNlc3Npb25FeGlzdHMocmVxLnBhcmFtcy5zZXNzaW9uSWQpKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRHJpdmVyRXJyb3IoKTtcbiAgICAgIH1cblxuICAgICAgLy8gaWYgdGhlIGRyaXZlciBpcyBjdXJyZW50bHkgcHJveHlpbmcgY29tbWFuZHMgdG8gYW5vdGhlciBKU09OV1BcbiAgICAgIC8vIHNlcnZlciwgYnlwYXNzIGFsbCBvdXIgY2hlY2tzIGFuZCBhc3N1bWUgdGhlIHVwc3RyZWFtIHNlcnZlciBrbm93c1xuICAgICAgLy8gd2hhdCBpdCdzIGRvaW5nLiBCdXQga2VlcCB0aGlzIGluIHRoZSB0cnkvY2F0Y2ggYmxvY2sgc28gaWYgcHJveHlpbmdcbiAgICAgIC8vIGl0c2VsZiBmYWlscywgd2UgZ2l2ZSBhIG1lc3NhZ2UgdG8gdGhlIGNsaWVudC4gT2YgY291cnNlIHdlIG9ubHlcbiAgICAgIC8vIHdhbnQgdG8gZG8gdGhlc2Ugd2hlbiB3ZSBoYXZlIGEgc2Vzc2lvbiBjb21tYW5kOyB0aGUgQXBwaXVtIGRyaXZlclxuICAgICAgLy8gbXVzdCBiZSByZXNwb25zaWJsZSBmb3Igc3RhcnQvc3RvcCBzZXNzaW9uLCBldGMuLi5cbiAgICAgIGlmIChpc1Nlc3NDbWQgJiYgZHJpdmVyU2hvdWxkRG9Kd3BQcm94eShkcml2ZXIsIHJlcSwgc3BlYy5jb21tYW5kKSkge1xuICAgICAgICBhd2FpdCBkb0p3cFByb3h5KGRyaXZlciwgcmVxLCByZXMpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIGEgY29tbWFuZCBpcyBub3QgaW4gb3VyIG1ldGhvZCBtYXAsIGl0J3MgYmVjYXVzZSB3ZVxuICAgICAgLy8gaGF2ZSBubyBwbGFucyB0byBldmVyIGltcGxlbWVudCBpdFxuICAgICAgaWYgKCFzcGVjLmNvbW1hbmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIHdyYXAgcGFyYW1zIGlmIG5lY2Vzc2FyeVxuICAgICAgaWYgKHNwZWMucGF5bG9hZFBhcmFtcyAmJiBzcGVjLnBheWxvYWRQYXJhbXMud3JhcCkge1xuICAgICAgICBqc29uT2JqID0gd3JhcFBhcmFtcyhzcGVjLnBheWxvYWRQYXJhbXMsIGpzb25PYmopO1xuICAgICAgfVxuXG4gICAgICAvLyB1bndyYXAgcGFyYW1zIGlmIG5lY2Vzc2FyeVxuICAgICAgaWYgKHNwZWMucGF5bG9hZFBhcmFtcyAmJiBzcGVjLnBheWxvYWRQYXJhbXMudW53cmFwKSB7XG4gICAgICAgIGpzb25PYmogPSB1bndyYXBQYXJhbXMoc3BlYy5wYXlsb2FkUGFyYW1zLCBqc29uT2JqKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNwZWMuY29tbWFuZCA9PT0gQ1JFQVRFX1NFU1NJT05fQ09NTUFORCkge1xuICAgICAgICAvLyB0cnkgdG8gZGV0ZXJtaW5lIHByb3RvY29sIGJ5IHNlc3Npb24gY3JlYXRpb24gYXJncywgc28gd2UgY2FuIHRocm93IGFcbiAgICAgICAgLy8gcHJvcGVybHkgZm9ybWF0dGVkIGVycm9yIGlmIGFyZ3VtZW50cyB2YWxpZGF0aW9uIGZhaWxzXG4gICAgICAgIGN1cnJlbnRQcm90b2NvbCA9IEJhc2VEcml2ZXIuZGV0ZXJtaW5lUHJvdG9jb2woLi4ubWFrZUFyZ3MocmVxLnBhcmFtcywganNvbk9iaiwgc3BlYy5wYXlsb2FkUGFyYW1zIHx8IHt9KSk7XG4gICAgICB9XG5cbiAgICAgIC8vIGVuc3VyZSB0aGF0IHRoZSBqc29uIHBheWxvYWQgY29uZm9ybXMgdG8gdGhlIHNwZWNcbiAgICAgIGNoZWNrUGFyYW1zKHNwZWMucGF5bG9hZFBhcmFtcywganNvbk9iaiwgY3VycmVudFByb3RvY29sKTtcblxuICAgICAgLy8gdHVybiB0aGUgY29tbWFuZCBhbmQganNvbiBwYXlsb2FkIGludG8gYW4gYXJndW1lbnQgbGlzdCBmb3JcbiAgICAgIC8vIHRoZSBkcml2ZXIgbWV0aG9kc1xuICAgICAgbGV0IGFyZ3MgPSBtYWtlQXJncyhyZXEucGFyYW1zLCBqc29uT2JqLCBzcGVjLnBheWxvYWRQYXJhbXMgfHwge30sIGN1cnJlbnRQcm90b2NvbCk7XG4gICAgICBsZXQgZHJpdmVyUmVzO1xuICAgICAgLy8gdmFsaWRhdGUgY29tbWFuZCBhcmdzIGFjY29yZGluZyB0byBNSlNPTldQXG4gICAgICBpZiAodmFsaWRhdG9yc1tzcGVjLmNvbW1hbmRdKSB7XG4gICAgICAgIHZhbGlkYXRvcnNbc3BlYy5jb21tYW5kXSguLi5hcmdzKTtcbiAgICAgIH1cblxuICAgICAgLy8gcnVuIHRoZSBkcml2ZXIgY29tbWFuZCB3cmFwcGVkIGluc2lkZSB0aGUgYXJndW1lbnQgdmFsaWRhdG9yc1xuICAgICAgU0VTU0lPTlNfQ0FDSEUuZ2V0TG9nZ2VyKHJlcS5wYXJhbXMuc2Vzc2lvbklkLCBjdXJyZW50UHJvdG9jb2wpLmRlYnVnKGBDYWxsaW5nIGAgK1xuICAgICAgICBgJHtkcml2ZXIuY29uc3RydWN0b3IubmFtZX0uJHtzcGVjLmNvbW1hbmR9KCkgd2l0aCBhcmdzOiBgICtcbiAgICAgICAgXy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeShhcmdzKSwge2xlbmd0aDogTE9HX09CSl9MRU5HVEh9KSk7XG5cbiAgICAgIGlmIChkcml2ZXIuZXhlY3V0ZUNvbW1hbmQpIHtcbiAgICAgICAgZHJpdmVyUmVzID0gYXdhaXQgZHJpdmVyLmV4ZWN1dGVDb21tYW5kKHNwZWMuY29tbWFuZCwgLi4uYXJncyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkcml2ZXJSZXMgPSBhd2FpdCBkcml2ZXIuZXhlY3V0ZShzcGVjLmNvbW1hbmQsIC4uLmFyZ3MpO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIHByb3RvY29sIGFmdGVyIGV4ZWN1dGVDb21tYW5kXG4gICAgICBjdXJyZW50UHJvdG9jb2wgPSBleHRyYWN0UHJvdG9jb2woZHJpdmVyLCByZXEucGFyYW1zLnNlc3Npb25JZCkgfHwgY3VycmVudFByb3RvY29sO1xuXG4gICAgICAvLyBJZiBgZXhlY3V0ZUNvbW1hbmRgIHdhcyBvdmVycmlkZGVuIGFuZCB0aGUgbWV0aG9kIHJldHVybnMgYW4gb2JqZWN0XG4gICAgICAvLyB3aXRoIGEgcHJvdG9jb2wgYW5kIHZhbHVlL2Vycm9yIHByb3BlcnR5LCByZS1hc3NpZ24gdGhlIHByb3RvY29sXG4gICAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGRyaXZlclJlcykgJiYgXy5oYXMoZHJpdmVyUmVzLCAncHJvdG9jb2wnKSkge1xuICAgICAgICBjdXJyZW50UHJvdG9jb2wgPSBkcml2ZXJSZXMucHJvdG9jb2wgfHwgY3VycmVudFByb3RvY29sO1xuICAgICAgICBpZiAoZHJpdmVyUmVzLmVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgZHJpdmVyUmVzLmVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGRyaXZlclJlcyA9IGRyaXZlclJlcy52YWx1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gdW5wYWNrIGNyZWF0ZVNlc3Npb24gcmVzcG9uc2VcbiAgICAgIGlmIChzcGVjLmNvbW1hbmQgPT09IENSRUFURV9TRVNTSU9OX0NPTU1BTkQpIHtcbiAgICAgICAgbmV3U2Vzc2lvbklkID0gZHJpdmVyUmVzWzBdO1xuICAgICAgICBTRVNTSU9OU19DQUNIRS5wdXRTZXNzaW9uKG5ld1Nlc3Npb25JZCwgY3VycmVudFByb3RvY29sKTtcbiAgICAgICAgU0VTU0lPTlNfQ0FDSEUuZ2V0TG9nZ2VyKG5ld1Nlc3Npb25JZCwgY3VycmVudFByb3RvY29sKVxuICAgICAgICAgIC5kZWJ1ZyhgQ2FjaGVkIHRoZSBwcm90b2NvbCB2YWx1ZSAnJHtjdXJyZW50UHJvdG9jb2x9JyBmb3IgdGhlIG5ldyBzZXNzaW9uICR7bmV3U2Vzc2lvbklkfWApO1xuICAgICAgICBpZiAoY3VycmVudFByb3RvY29sID09PSBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5NSlNPTldQKSB7XG4gICAgICAgICAgZHJpdmVyUmVzID0gZHJpdmVyUmVzWzFdO1xuICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRQcm90b2NvbCA9PT0gQmFzZURyaXZlci5EUklWRVJfUFJPVE9DT0wuVzNDKSB7XG4gICAgICAgICAgZHJpdmVyUmVzID0ge1xuICAgICAgICAgICAgY2FwYWJpbGl0aWVzOiBkcml2ZXJSZXNbMV0sXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gSWYgdGhlIE1KU09OV1AgZWxlbWVudCBrZXkgZm9ybWF0IChFTEVNRU5UKSB3YXMgcHJvdmlkZWQgdHJhbnNsYXRlIGl0IHRvIFczQyBlbGVtZW50IGtleSBmb3JtYXQgKGVsZW1lbnQtNjA2Ni0xMWU0LWE1MmUtNGY3MzU0NjZjZWNmKVxuICAgICAgLy8gYW5kIHZpY2UtdmVyc2FcbiAgICAgIGlmIChkcml2ZXJSZXMpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRQcm90b2NvbCA9PT0gQmFzZURyaXZlci5EUklWRVJfUFJPVE9DT0wuVzNDKSB7XG4gICAgICAgICAgZHJpdmVyUmVzID0gcmVuYW1lS2V5KGRyaXZlclJlcywgTUpTT05XUF9FTEVNRU5UX0tFWSwgVzNDX0VMRU1FTlRfS0VZKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkcml2ZXJSZXMgPSByZW5hbWVLZXkoZHJpdmVyUmVzLCBXM0NfRUxFTUVOVF9LRVksIE1KU09OV1BfRUxFTUVOVF9LRVkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIGNvbnZlcnQgdW5kZWZpbmVkIHRvIG51bGwsIGJ1dCBsZWF2ZSBhbGwgb3RoZXIgdmFsdWVzIHRoZSBzYW1lXG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZChkcml2ZXJSZXMpKSB7XG4gICAgICAgIGRyaXZlclJlcyA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIGRlbGV0ZSBzaG91bGQgbm90IHJldHVybiBhbnl0aGluZyBldmVuIGlmIHN1Y2Nlc3NmdWxcbiAgICAgIGlmIChzcGVjLmNvbW1hbmQgPT09IERFTEVURV9TRVNTSU9OX0NPTU1BTkQpIHtcbiAgICAgICAgU0VTU0lPTlNfQ0FDSEUuZ2V0TG9nZ2VyKHJlcS5wYXJhbXMuc2Vzc2lvbklkLCBjdXJyZW50UHJvdG9jb2wpXG4gICAgICAgICAgLmRlYnVnKGBSZWNlaXZlZCByZXNwb25zZTogJHtfLnRydW5jYXRlKEpTT04uc3RyaW5naWZ5KGRyaXZlclJlcyksIHtsZW5ndGg6IExPR19PQkpfTEVOR1RIfSl9YCk7XG4gICAgICAgIFNFU1NJT05TX0NBQ0hFLmdldExvZ2dlcihyZXEucGFyYW1zLnNlc3Npb25JZCwgY3VycmVudFByb3RvY29sKS5kZWJ1ZygnQnV0IGRlbGV0aW5nIHNlc3Npb24sIHNvIG5vdCByZXR1cm5pbmcnKTtcbiAgICAgICAgZHJpdmVyUmVzID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gaWYgdGhlIHN0YXR1cyBpcyBub3QgMCwgIHRocm93IHRoZSBhcHByb3ByaWF0ZSBlcnJvciBmb3Igc3RhdHVzIGNvZGUuXG4gICAgICBpZiAodXRpbC5oYXNWYWx1ZShkcml2ZXJSZXMpKSB7XG4gICAgICAgIGlmICh1dGlsLmhhc1ZhbHVlKGRyaXZlclJlcy5zdGF0dXMpICYmICFpc05hTihkcml2ZXJSZXMuc3RhdHVzKSAmJiBwYXJzZUludChkcml2ZXJSZXMuc3RhdHVzLCAxMCkgIT09IDApIHtcbiAgICAgICAgICB0aHJvdyBlcnJvckZyb21NSlNPTldQU3RhdHVzQ29kZShkcml2ZXJSZXMuc3RhdHVzLCBkcml2ZXJSZXMudmFsdWUpO1xuICAgICAgICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChkcml2ZXJSZXMudmFsdWUpICYmIGRyaXZlclJlcy52YWx1ZS5lcnJvcikge1xuICAgICAgICAgIHRocm93IGVycm9yRnJvbVczQ0pzb25Db2RlKGRyaXZlclJlcy52YWx1ZS5lcnJvciwgZHJpdmVyUmVzLnZhbHVlLm1lc3NhZ2UsIGRyaXZlclJlcy52YWx1ZS5zdGFja3RyYWNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBSZXNwb25zZSBzdGF0dXMgc2hvdWxkIGJlIHRoZSBzdGF0dXMgc2V0IGJ5IHRoZSBkcml2ZXIgcmVzcG9uc2UuXG4gICAgICBpZiAoY3VycmVudFByb3RvY29sICE9PSBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5XM0MpIHtcbiAgICAgICAgaHR0cFJlc0JvZHkuc3RhdHVzID0gKF8uaXNOaWwoZHJpdmVyUmVzKSB8fCBfLmlzVW5kZWZpbmVkKGRyaXZlclJlcy5zdGF0dXMpKSA/IEpTT05XUF9TVUNDRVNTX1NUQVRVU19DT0RFIDogZHJpdmVyUmVzLnN0YXR1cztcbiAgICAgIH1cbiAgICAgIGh0dHBSZXNCb2R5LnZhbHVlID0gZHJpdmVyUmVzO1xuICAgICAgU0VTU0lPTlNfQ0FDSEUuZ2V0TG9nZ2VyKHJlcS5wYXJhbXMuc2Vzc2lvbklkIHx8IG5ld1Nlc3Npb25JZCwgY3VycmVudFByb3RvY29sKS5kZWJ1ZyhgUmVzcG9uZGluZyBgICtcbiAgICAgICAgYHRvIGNsaWVudCB3aXRoIGRyaXZlci4ke3NwZWMuY29tbWFuZH0oKSByZXN1bHQ6ICR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeShkcml2ZXJSZXMpLCB7bGVuZ3RoOiBMT0dfT0JKX0xFTkdUSH0pfWApO1xuXG4gICAgICBpZiAoc3BlYy5jb21tYW5kID09PSBERUxFVEVfU0VTU0lPTl9DT01NQU5EKSB7XG4gICAgICAgIC8vIFdlIGRvbid0IHdhbnQgdG8ga2VlcCB0aGUgbG9nZ2VyIGluc3RhbmNlIGluIHRoZSBjYWNoZVxuICAgICAgICAvLyBhZnRlciB0aGUgc2Vzc2lvbiBpcyBkZWxldGVkLCBiZWNhdXNlIGl0IGNvbnRhaW5zIHRoZSBsb2dnaW5nIGhpc3RvcnlcbiAgICAgICAgLy8gYW5kIGNvbnN1bWVzIHRoZSBtZW1vcnlcbiAgICAgICAgU0VTU0lPTlNfQ0FDSEUucmVzZXRMb2dnZXIocmVxLnBhcmFtcy5zZXNzaW9uSWQpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaWYgYW55dGhpbmcgZ29lcyB3cm9uZywgZmlndXJlIG91dCB3aGF0IG91ciByZXNwb25zZSBzaG91bGQgYmVcbiAgICAgIC8vIGJhc2VkIG9uIHRoZSB0eXBlIG9mIGVycm9yIHRoYXQgd2UgZW5jb3VudGVyZWRcbiAgICAgIGxldCBhY3R1YWxFcnIgPSBlcnI7XG5cbiAgICAgIGN1cnJlbnRQcm90b2NvbCA9IGN1cnJlbnRQcm90b2NvbCB8fCBleHRyYWN0UHJvdG9jb2woZHJpdmVyLCByZXEucGFyYW1zLnNlc3Npb25JZCB8fCBuZXdTZXNzaW9uSWQpO1xuXG4gICAgICBsZXQgZXJyTXNnID0gZXJyLnN0YWNrdHJhY2UgfHwgZXJyLnN0YWNrO1xuICAgICAgaWYgKCFfLmluY2x1ZGVzKGVyck1zZywgZXJyLm1lc3NhZ2UpKSB7XG4gICAgICAgIC8vIGlmIHRoZSBtZXNzYWdlIGhhcyBtb3JlIGluZm9ybWF0aW9uLCBhZGQgaXQuIGJ1dCBvZnRlbiB0aGUgbWVzc2FnZVxuICAgICAgICAvLyBpcyB0aGUgZmlyc3QgcGFydCBvZiB0aGUgc3RhY2sgdHJhY2VcbiAgICAgICAgZXJyTXNnID0gYCR7ZXJyLm1lc3NhZ2V9JHtlcnJNc2cgPyAoJ1xcbicgKyBlcnJNc2cpIDogJyd9YDtcbiAgICAgIH1cbiAgICAgIFNFU1NJT05TX0NBQ0hFLmdldExvZ2dlcihyZXEucGFyYW1zLnNlc3Npb25JZCB8fCBuZXdTZXNzaW9uSWQsIGN1cnJlbnRQcm90b2NvbCkuZGVidWcoYEVuY291bnRlcmVkIGAgK1xuICAgICAgICBgaW50ZXJuYWwgZXJyb3IgcnVubmluZyBjb21tYW5kOiAke2Vyck1zZ31gKTtcbiAgICAgIGlmIChpc0Vycm9yVHlwZShlcnIsIGVycm9ycy5Qcm94eVJlcXVlc3RFcnJvcikpIHtcbiAgICAgICAgYWN0dWFsRXJyID0gZXJyLmdldEFjdHVhbEVycm9yKCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50UHJvdG9jb2wgPT09IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLlczQykge1xuICAgICAgICBbaHR0cFN0YXR1cywgaHR0cFJlc0JvZHldID0gZ2V0UmVzcG9uc2VGb3JXM0NFcnJvcihhY3R1YWxFcnIpO1xuICAgICAgfSBlbHNlIGlmIChjdXJyZW50UHJvdG9jb2wgPT09IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLk1KU09OV1ApIHtcbiAgICAgICAgW2h0dHBTdGF0dXMsIGh0dHBSZXNCb2R5XSA9IGdldFJlc3BvbnNlRm9ySnNvbndwRXJyb3IoYWN0dWFsRXJyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIGl0J3MgdW5rbm93biB3aGF0IHRoZSBwcm90b2NvbCBpcyAobGlrZSBpZiBpdCdzIGBnZXRTdGF0dXNgIHByaW9yIHRvIGBjcmVhdGVTZXNzaW9uYCksIG1lcmdlIHRoZSByZXNwb25zZXNcbiAgICAgICAgLy8gdG9nZXRoZXIgdG8gYmUgcHJvdG9jb2wtYWdub3N0aWNcbiAgICAgICAgbGV0IGpzb253cFJlcyA9IGdldFJlc3BvbnNlRm9ySnNvbndwRXJyb3IoYWN0dWFsRXJyKTtcbiAgICAgICAgbGV0IHczY1JlcyA9IGdldFJlc3BvbnNlRm9yVzNDRXJyb3IoYWN0dWFsRXJyKTtcblxuICAgICAgICBodHRwUmVzQm9keSA9IHtcbiAgICAgICAgICAuLi5qc29ud3BSZXNbMV0sXG4gICAgICAgICAgLi4udzNjUmVzWzFdLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFVzZSB0aGUgSlNPTldQIHN0YXR1cyBjb2RlICh3aGljaCBpcyB1c3VhbGx5IDUwMClcbiAgICAgICAgaHR0cFN0YXR1cyA9IGpzb253cFJlc1swXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBkZWNvZGUgdGhlIHJlc3BvbnNlLCB3aGljaCBpcyBlaXRoZXIgYSBzdHJpbmcgb3IganNvblxuICAgIGlmIChfLmlzU3RyaW5nKGh0dHBSZXNCb2R5KSkge1xuICAgICAgcmVzLnN0YXR1cyhodHRwU3RhdHVzKS5zZW5kKGh0dHBSZXNCb2R5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKG5ld1Nlc3Npb25JZCkge1xuICAgICAgICBpZiAoY3VycmVudFByb3RvY29sID09PSBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5XM0MpIHtcbiAgICAgICAgICBodHRwUmVzQm9keS52YWx1ZS5zZXNzaW9uSWQgPSBuZXdTZXNzaW9uSWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaHR0cFJlc0JvZHkuc2Vzc2lvbklkID0gbmV3U2Vzc2lvbklkO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBodHRwUmVzQm9keS5zZXNzaW9uSWQgPSByZXEucGFyYW1zLnNlc3Npb25JZCB8fCBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBEb24ndCBpbmNsdWRlIHNlc3Npb25JZCBpbiBXM0MgcmVzcG9uc2VzXG4gICAgICBpZiAoY3VycmVudFByb3RvY29sID09PSBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5XM0MpIHtcbiAgICAgICAgZGVsZXRlIGh0dHBSZXNCb2R5LnNlc3Npb25JZDtcbiAgICAgIH1cbiAgICAgIHJlcy5zdGF0dXMoaHR0cFN0YXR1cykuanNvbihodHRwUmVzQm9keSk7XG4gICAgfVxuICB9O1xuICAvLyBhZGQgdGhlIG1ldGhvZCB0byB0aGUgYXBwXG4gIGFwcFttZXRob2QudG9Mb3dlckNhc2UoKV0ocGF0aCwgKHJlcSwgcmVzKSA9PiB7XG4gICAgQi5yZXNvbHZlKGFzeW5jSGFuZGxlcihyZXEsIHJlcykpLmRvbmUoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRyaXZlclNob3VsZERvSndwUHJveHkgKGRyaXZlciwgcmVxLCBjb21tYW5kKSB7XG4gIC8vIGRyaXZlcnMgbmVlZCB0byBleHBsaWNpdGx5IHNheSB3aGVuIHRoZSBwcm94eSBpcyBhY3RpdmVcbiAgaWYgKCFkcml2ZXIucHJveHlBY3RpdmUocmVxLnBhcmFtcy5zZXNzaW9uSWQpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gd2Ugc2hvdWxkIG5ldmVyIHByb3h5IGRlbGV0ZVNlc3Npb24gYmVjYXVzZSB3ZSBuZWVkIHRvIGdpdmUgdGhlIGNvbnRhaW5pbmdcbiAgLy8gZHJpdmVyIGFuIG9wcG9ydHVuaXR5IHRvIGNsZWFuIGl0c2VsZiB1cFxuICBpZiAoY29tbWFuZCA9PT0gJ2RlbGV0ZVNlc3Npb24nKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gdmFsaWRhdGUgYXZvaWRhbmNlIHNjaGVtYSwgYW5kIHNheSB3ZSBzaG91bGRuJ3QgcHJveHkgaWYgYW55dGhpbmcgaW4gdGhlXG4gIC8vIGF2b2lkIGxpc3QgbWF0Y2hlcyBvdXIgcmVxXG4gIGlmIChkcml2ZXIucHJveHlSb3V0ZUlzQXZvaWRlZChyZXEucGFyYW1zLnNlc3Npb25JZCwgcmVxLm1ldGhvZCwgcmVxLm9yaWdpbmFsVXJsKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIGlmIGl0IGxvb2tzIGxpa2Ugd2UgaGF2ZSBhbiBpbWFnZSBlbGVtZW50IGluIHRoZSB1cmwgKGFzIGEgcm91dGVcbiAgLy8gcGFyYW1ldGVyKSwgbmV2ZXIgcHJveHkuIEp1c3QgbG9vayBmb3Igb3VyIGltYWdlIGVsZW1lbnQgcHJlZml4IGluIGFsbG93ZWRcbiAgLy8gcG9zaXRpb25zIChlaXRoZXIgYWZ0ZXIgYW4gJ2VsZW1lbnQnIG9yICdzY3JlZW5zaG90JyBwYXRoIHNlZ21lbnQpLCBhbmRcbiAgLy8gZW5zdXJlIHRoZSBwcmVmaXggaXMgZm9sbG93ZWQgYnkgc29tZXRoaW5nXG4gIGlmIChJTUdfRUxfVVJMX1JFLnRlc3QocmVxLm9yaWdpbmFsVXJsKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG5cbiAgLy8gYWxzbyBpZiBpdCBsb29rcyBsaWtlIHdlIGhhdmUgYW4gaW1hZ2UgZWxlbWVudCBpbiB0aGUgcmVxdWVzdCBib2R5IChhc1xuICAvLyBhIEpTT04gcGFyYW1ldGVyKSwgbmV2ZXIgcHJveHkuIEJhc2ljYWxseSBjaGVjayBhZ2FpbnN0IGEgcmVnZXhwIG9mIHRoZVxuICAvLyBqc29uIHN0cmluZyBvZiB0aGUgYm9keSwgd2hlcmUgd2Uga25vdyB3aGF0IHRoZSBmb3JtIG9mIGFuIGltYWdlIGVsZW1lbnRcbiAgLy8gbXVzdCBiZVxuICBjb25zdCBzdHJpbmdCb2R5ID0gSlNPTi5zdHJpbmdpZnkocmVxLmJvZHkpO1xuICBpZiAoc3RyaW5nQm9keSAmJiBJTUdfRUxfQk9EWV9SRS50ZXN0KHN0cmluZ0JvZHkpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRvSndwUHJveHkgKGRyaXZlciwgcmVxLCByZXMpIHtcbiAgU0VTU0lPTlNfQ0FDSEUuZ2V0TG9nZ2VyKHJlcS5wYXJhbXMuc2Vzc2lvbklkLCBleHRyYWN0UHJvdG9jb2woZHJpdmVyLCByZXEucGFyYW1zLnNlc3Npb25JZCkpXG4gICAgLmluZm8oJ0RyaXZlciBwcm94eSBhY3RpdmUsIHBhc3NpbmcgcmVxdWVzdCBvbiB2aWEgSFRUUCBwcm94eScpO1xuXG4gIC8vIGNoZWNrIHRoYXQgdGhlIGlubmVyIGRyaXZlciBoYXMgYSBwcm94eSBmdW5jdGlvblxuICBpZiAoIWRyaXZlci5jYW5Qcm94eShyZXEucGFyYW1zLnNlc3Npb25JZCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyeWluZyB0byBwcm94eSB0byBhIEpTT05XUCBzZXJ2ZXIgYnV0IGRyaXZlciBpcyB1bmFibGUgdG8gcHJveHknKTtcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IHByb3hpZWRSZXMgPSBhd2FpdCBkcml2ZXIuZXhlY3V0ZUNvbW1hbmQoJ3Byb3h5UmVxUmVzJywgcmVxLCByZXMsIHJlcS5wYXJhbXMuc2Vzc2lvbklkKTtcbiAgICBpZiAocHJveGllZFJlcyAmJiBwcm94aWVkUmVzLmVycm9yKSB0aHJvdyBwcm94aWVkUmVzLmVycm9yOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmIChpc0Vycm9yVHlwZShlcnIsIGVycm9ycy5Qcm94eVJlcXVlc3RFcnJvcikpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgcHJveHkuIFByb3h5IGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxufVxuXG5cbmV4cG9ydCB7XG4gIFByb3RvY29sLCByb3V0ZUNvbmZpZ3VyaW5nRnVuY3Rpb24sIGlzU2Vzc2lvbkNvbW1hbmQsXG4gIE1KU09OV1BfRUxFTUVOVF9LRVksIFczQ19FTEVNRU5UX0tFWSwgSU1BR0VfRUxFTUVOVF9QUkVGSVgsXG4gIGRyaXZlclNob3VsZERvSndwUHJveHksXG59O1xuIl0sImZpbGUiOiJsaWIvcHJvdG9jb2wvcHJvdG9jb2wuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
