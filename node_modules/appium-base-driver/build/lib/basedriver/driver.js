"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BaseDriver = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _protocol = require("../protocol");

var _os = _interopRequireDefault(require("os"));

var _commands = _interopRequireDefault(require("./commands"));

var helpers = _interopRequireWildcard(require("./helpers"));

var _logger = _interopRequireDefault(require("./logger"));

var _deviceSettings = _interopRequireDefault(require("./device-settings"));

var _desiredCaps = require("./desired-caps");

var _capabilities = require("./capabilities");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _imageElement = require("./image-element");

const NEW_COMMAND_TIMEOUT_MS = 60 * 1000;
const EVENT_SESSION_INIT = 'newSessionRequested';
const EVENT_SESSION_START = 'newSessionStarted';
const EVENT_SESSION_QUIT_START = 'quitSessionRequested';
const EVENT_SESSION_QUIT_DONE = 'quitSessionFinished';

class BaseDriver extends _protocol.Protocol {
  constructor(opts = {}, shouldValidateCaps = true) {
    super();
    this.sessionId = null;
    this.opts = opts;
    this.caps = null;
    this.helpers = helpers;
    this.newCommandTimeoutMs = NEW_COMMAND_TIMEOUT_MS;
    this.implicitWaitMs = 0;
    this._constraints = _lodash.default.cloneDeep(_desiredCaps.desiredCapabilityConstraints);
    this.locatorStrategies = [];
    this.webLocatorStrategies = [];
    this.opts.tmpDir = this.opts.tmpDir || process.env.APPIUM_TMP_DIR || _os.default.tmpdir();
    this.curCommand = new _bluebird.default(r => {
      r();
    });
    this.curCommandCancellable = new _bluebird.default(r => {
      r();
    });
    this.shutdownUnexpectedly = false;
    this.noCommandTimer = null;
    this.shouldValidateCaps = shouldValidateCaps;
    this.settings = new _deviceSettings.default({}, _lodash.default.noop);
    this.resetOnUnexpectedShutdown();
    this.initialOpts = _lodash.default.cloneDeep(this.opts);
    this.managedDrivers = [];
    this._eventHistory = {
      commands: []
    };
    this._imgElCache = (0, _imageElement.makeImageElementCache)();
    this.protocol = null;
  }

  get driverData() {
    return {};
  }

  get isCommandsQueueEnabled() {
    return true;
  }

  get eventHistory() {
    return _lodash.default.cloneDeep(this._eventHistory);
  }

  logEvent(eventName) {
    if (eventName === "commands") {
      throw new Error("Cannot log commands directly");
    }

    if (typeof eventName !== "string") {
      throw new Error(`Invalid eventName ${eventName}`);
    }

    if (!this._eventHistory[eventName]) {
      this._eventHistory[eventName] = [];
    }

    let ts = Date.now();
    let logTime = new Date(ts).toTimeString();

    this._eventHistory[eventName].push(ts);

    _logger.default.debug(`Event '${eventName}' logged at ${ts} (${logTime})`);
  }

  getStatus() {
    return (0, _asyncToGenerator2.default)(function* () {
      return {};
    })();
  }

  resetOnUnexpectedShutdown() {
    if (this.onUnexpectedShutdown && !this.onUnexpectedShutdown.isFulfilled()) {
      this.onUnexpectedShutdown.cancel();
    }

    this.onUnexpectedShutdown = new _bluebird.default((resolve, reject) => {
      this.unexpectedShutdownDeferred = {
        resolve,
        reject
      };
    }).cancellable();
    this.onUnexpectedShutdown.catch(() => {});
  }

  set desiredCapConstraints(constraints) {
    this._constraints = Object.assign(this._constraints, constraints);
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = _lodash.default.toPairs(this._constraints)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        const _step$value = (0, _slicedToArray2.default)(_step.value, 2),
              value = _step$value[1];

        if (value && value.presence === true) {
          value.presence = {
            allowEmpty: false
          };
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }
  }

  get desiredCapConstraints() {
    return this._constraints;
  }

  sessionExists(sessionId) {
    if (!sessionId) return false;
    return sessionId === this.sessionId;
  }

  driverForSession() {
    return this;
  }

  logExtraCaps(caps) {
    let extraCaps = _lodash.default.difference(_lodash.default.keys(caps), _lodash.default.keys(this._constraints));

    if (extraCaps.length) {
      _logger.default.warn(`The following capabilities were provided, but are not ` + `recognized by appium: ${extraCaps.join(', ')}.`);
    }
  }

  validateDesiredCaps(caps) {
    if (!this.shouldValidateCaps) {
      return true;
    }

    try {
      (0, _capabilities.validateCaps)(caps, this._constraints);
    } catch (e) {
      _logger.default.errorAndThrow(new _protocol.errors.SessionNotCreatedError(`The desiredCapabilities object was not valid for the ` + `following reason(s): ${e.message}`));
    }

    this.logExtraCaps(caps);
    return true;
  }

  isMjsonwpProtocol() {
    return this.protocol === BaseDriver.DRIVER_PROTOCOL.MJSONWP;
  }

  isW3CProtocol() {
    return this.protocol === BaseDriver.DRIVER_PROTOCOL.W3C;
  }

  setProtocolMJSONWP() {
    this.protocol = BaseDriver.DRIVER_PROTOCOL.MJSONWP;
  }

  setProtocolW3C() {
    this.protocol = BaseDriver.DRIVER_PROTOCOL.W3C;
  }

  static determineProtocol(desiredCapabilities, requiredCapabilities, capabilities) {
    return _lodash.default.isPlainObject(capabilities) ? BaseDriver.DRIVER_PROTOCOL.W3C : BaseDriver.DRIVER_PROTOCOL.MJSONWP;
  }

  executeCommand(cmd, ...args) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let startTime = Date.now();

      if (cmd === 'createSession') {
        _this.protocol = BaseDriver.determineProtocol(...args);

        _this.logEvent(EVENT_SESSION_INIT);
      } else if (cmd === 'deleteSession') {
        _this.logEvent(EVENT_SESSION_QUIT_START);
      }

      _this.clearNewCommandTimeout();

      const imgElId = (0, _imageElement.getImgElFromArgs)(args);

      if (!_this[cmd] && !imgElId) {
        throw new _protocol.errors.NotYetImplementedError();
      }

      let res;

      if (_this.isCommandsQueueEnabled) {
        let nextCommand = _this.curCommand.then(() => {
          if (_this.shutdownUnexpectedly) {
            return _bluebird.default.reject(new _protocol.errors.NoSuchDriverError('The driver was unexpectedly shut down!'));
          }

          _this.curCommandCancellable = _bluebird.default.resolve().then(() => {
            if (imgElId) {
              return _imageElement.ImageElement.execute(_this, cmd, imgElId);
            }

            return _this[cmd](...args);
          }).cancellable();
          return _this.curCommandCancellable;
        });

        _this.curCommand = nextCommand.catch(() => {});
        res = yield nextCommand;
      } else {
        if (_this.shutdownUnexpectedly) {
          throw new _protocol.errors.NoSuchDriverError('The driver was unexpectedly shut down!');
        }

        res = yield _this[cmd](...args);
      }

      if (cmd !== 'deleteSession') {
        _this.startNewCommandTimeout();
      }

      let endTime = Date.now();

      _this._eventHistory.commands.push({
        cmd,
        startTime,
        endTime
      });

      if (cmd === 'createSession') {
        _this.logEvent(EVENT_SESSION_START);
      } else if (cmd === 'deleteSession') {
        _this.logEvent(EVENT_SESSION_QUIT_DONE);
      }

      return res;
    })();
  }

  startUnexpectedShutdown(err = new _protocol.errors.NoSuchDriverError('The driver was unexpectedly shut down!')) {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this2.unexpectedShutdownDeferred.reject(err);

      _this2.shutdownUnexpectedly = true;
      yield _this2.deleteSession(_this2.sessionId);
      _this2.shutdownUnexpectedly = false;

      _this2.curCommandCancellable.cancel(err);
    })();
  }

  validateLocatorStrategy(strategy, webContext = false) {
    let validStrategies = this.locatorStrategies;

    _logger.default.debug(`Valid locator strategies for this request: ${validStrategies.join(', ')}`);

    if (webContext) {
      validStrategies = validStrategies.concat(this.webLocatorStrategies);
    }

    if (!_lodash.default.includes(validStrategies, strategy)) {
      throw new _protocol.errors.InvalidSelectorError(`Locator Strategy '${strategy}' is not supported for this session`);
    }
  }

  reset() {
    var _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Resetting app mid-session');

      _logger.default.debug('Running generic full reset');

      let currentConfig = {};
      var _arr = ['implicitWaitMs', 'newCommandTimeoutMs', 'sessionId', 'resetOnUnexpectedShutdown'];

      for (var _i = 0; _i < _arr.length; _i++) {
        let property = _arr[_i];
        currentConfig[property] = _this3[property];
      }

      _this3.resetOnUnexpectedShutdown = () => {};

      const args = _this3.protocol === BaseDriver.DRIVER_PROTOCOL.W3C ? [undefined, undefined, {
        alwaysMatch: _this3.caps,
        firstMatch: [{}]
      }] : [_this3.caps];

      try {
        yield _this3.deleteSession(_this3.sessionId);

        _logger.default.debug('Restarting app');

        yield _this3.createSession(...args);
      } finally {
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = _lodash.default.toPairs(currentConfig)[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            let _step2$value = (0, _slicedToArray2.default)(_step2.value, 2),
                key = _step2$value[0],
                value = _step2$value[1];

            _this3[key] = value;
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }

      _this3.clearNewCommandTimeout();
    })();
  }

  getSwipeOptions(gestures, touchCount = 1) {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let startX = _this4.helpers.getCoordDefault(gestures[0].options.x),
          startY = _this4.helpers.getCoordDefault(gestures[0].options.y),
          endX = _this4.helpers.getCoordDefault(gestures[2].options.x),
          endY = _this4.helpers.getCoordDefault(gestures[2].options.y),
          duration = _this4.helpers.getSwipeTouchDuration(gestures[1]),
          element = gestures[0].options.element,
          destElement = gestures[2].options.element || gestures[0].options.element;

      if (_appiumSupport.util.hasValue(destElement)) {
        let locResult = yield _this4.getLocationInView(destElement);
        let sizeResult = yield _this4.getSize(destElement);
        let offsetX = Math.abs(endX) < 1 && Math.abs(endX) > 0 ? sizeResult.width * endX : endX;
        let offsetY = Math.abs(endY) < 1 && Math.abs(endY) > 0 ? sizeResult.height * endY : endY;
        endX = locResult.x + offsetX;
        endY = locResult.y + offsetY;

        if (_appiumSupport.util.hasValue(element)) {
          let firstElLocation = yield _this4.getLocationInView(element);
          endX -= firstElLocation.x;
          endY -= firstElLocation.y;
        }
      }

      return {
        startX,
        startY,
        endX,
        endY,
        duration,
        touchCount,
        element
      };
    })();
  }

  proxyActive() {
    return false;
  }

  getProxyAvoidList() {
    return [];
  }

  canProxy() {
    return false;
  }

  proxyRouteIsAvoided(sessionId, method, url) {
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = this.getProxyAvoidList(sessionId)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        let avoidSchema = _step3.value;

        if (!_lodash.default.isArray(avoidSchema) || avoidSchema.length !== 2) {
          throw new Error('Proxy avoidance must be a list of pairs');
        }

        let _avoidSchema = (0, _slicedToArray2.default)(avoidSchema, 2),
            avoidMethod = _avoidSchema[0],
            avoidPathRegex = _avoidSchema[1];

        if (!_lodash.default.includes(['GET', 'POST', 'DELETE'], avoidMethod)) {
          throw new Error(`Unrecognized proxy avoidance method '${avoidMethod}'`);
        }

        if (!_lodash.default.isRegExp(avoidPathRegex)) {
          throw new Error('Proxy avoidance path must be a regular expression');
        }

        let normalizedUrl = url.replace(/^\/wd\/hub/, '');

        if (avoidMethod === method && avoidPathRegex.test(normalizedUrl)) {
          return true;
        }
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    return false;
  }

  addManagedDriver(driver) {
    this.managedDrivers.push(driver);
  }

  getManagedDrivers() {
    return this.managedDrivers;
  }

}

exports.BaseDriver = BaseDriver;
(0, _defineProperty2.default)(BaseDriver, "DRIVER_PROTOCOL", {
  W3C: 'W3C',
  MJSONWP: 'MJSONWP'
});
var _iteratorNormalCompletion4 = true;
var _didIteratorError4 = false;
var _iteratorError4 = undefined;

try {
  for (var _iterator4 = _lodash.default.toPairs(_commands.default)[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
    let _step4$value = (0, _slicedToArray2.default)(_step4.value, 2),
        cmd = _step4$value[0],
        fn = _step4$value[1];

    BaseDriver.prototype[cmd] = fn;
  }
} catch (err) {
  _didIteratorError4 = true;
  _iteratorError4 = err;
} finally {
  try {
    if (!_iteratorNormalCompletion4 && _iterator4.return != null) {
      _iterator4.return();
    }
  } finally {
    if (_didIteratorError4) {
      throw _iteratorError4;
    }
  }
}

var _default = BaseDriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9iYXNlZHJpdmVyL2RyaXZlci5qcyJdLCJuYW1lcyI6WyJORVdfQ09NTUFORF9USU1FT1VUX01TIiwiRVZFTlRfU0VTU0lPTl9JTklUIiwiRVZFTlRfU0VTU0lPTl9TVEFSVCIsIkVWRU5UX1NFU1NJT05fUVVJVF9TVEFSVCIsIkVWRU5UX1NFU1NJT05fUVVJVF9ET05FIiwiQmFzZURyaXZlciIsIlByb3RvY29sIiwiY29uc3RydWN0b3IiLCJvcHRzIiwic2hvdWxkVmFsaWRhdGVDYXBzIiwic2Vzc2lvbklkIiwiY2FwcyIsImhlbHBlcnMiLCJuZXdDb21tYW5kVGltZW91dE1zIiwiaW1wbGljaXRXYWl0TXMiLCJfY29uc3RyYWludHMiLCJfIiwiY2xvbmVEZWVwIiwiZGVzaXJlZENhcGFiaWxpdHlDb25zdHJhaW50cyIsImxvY2F0b3JTdHJhdGVnaWVzIiwid2ViTG9jYXRvclN0cmF0ZWdpZXMiLCJ0bXBEaXIiLCJwcm9jZXNzIiwiZW52IiwiQVBQSVVNX1RNUF9ESVIiLCJvcyIsInRtcGRpciIsImN1ckNvbW1hbmQiLCJCIiwiciIsImN1ckNvbW1hbmRDYW5jZWxsYWJsZSIsInNodXRkb3duVW5leHBlY3RlZGx5Iiwibm9Db21tYW5kVGltZXIiLCJzZXR0aW5ncyIsIkRldmljZVNldHRpbmdzIiwibm9vcCIsInJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24iLCJpbml0aWFsT3B0cyIsIm1hbmFnZWREcml2ZXJzIiwiX2V2ZW50SGlzdG9yeSIsImNvbW1hbmRzIiwiX2ltZ0VsQ2FjaGUiLCJwcm90b2NvbCIsImRyaXZlckRhdGEiLCJpc0NvbW1hbmRzUXVldWVFbmFibGVkIiwiZXZlbnRIaXN0b3J5IiwibG9nRXZlbnQiLCJldmVudE5hbWUiLCJFcnJvciIsInRzIiwiRGF0ZSIsIm5vdyIsImxvZ1RpbWUiLCJ0b1RpbWVTdHJpbmciLCJwdXNoIiwibG9nIiwiZGVidWciLCJnZXRTdGF0dXMiLCJvblVuZXhwZWN0ZWRTaHV0ZG93biIsImlzRnVsZmlsbGVkIiwiY2FuY2VsIiwicmVzb2x2ZSIsInJlamVjdCIsInVuZXhwZWN0ZWRTaHV0ZG93bkRlZmVycmVkIiwiY2FuY2VsbGFibGUiLCJjYXRjaCIsImRlc2lyZWRDYXBDb25zdHJhaW50cyIsImNvbnN0cmFpbnRzIiwiT2JqZWN0IiwiYXNzaWduIiwidG9QYWlycyIsInZhbHVlIiwicHJlc2VuY2UiLCJhbGxvd0VtcHR5Iiwic2Vzc2lvbkV4aXN0cyIsImRyaXZlckZvclNlc3Npb24iLCJsb2dFeHRyYUNhcHMiLCJleHRyYUNhcHMiLCJkaWZmZXJlbmNlIiwia2V5cyIsImxlbmd0aCIsIndhcm4iLCJqb2luIiwidmFsaWRhdGVEZXNpcmVkQ2FwcyIsImUiLCJlcnJvckFuZFRocm93IiwiZXJyb3JzIiwiU2Vzc2lvbk5vdENyZWF0ZWRFcnJvciIsIm1lc3NhZ2UiLCJpc01qc29ud3BQcm90b2NvbCIsIkRSSVZFUl9QUk9UT0NPTCIsIk1KU09OV1AiLCJpc1czQ1Byb3RvY29sIiwiVzNDIiwic2V0UHJvdG9jb2xNSlNPTldQIiwic2V0UHJvdG9jb2xXM0MiLCJkZXRlcm1pbmVQcm90b2NvbCIsImRlc2lyZWRDYXBhYmlsaXRpZXMiLCJyZXF1aXJlZENhcGFiaWxpdGllcyIsImNhcGFiaWxpdGllcyIsImlzUGxhaW5PYmplY3QiLCJleGVjdXRlQ29tbWFuZCIsImNtZCIsImFyZ3MiLCJzdGFydFRpbWUiLCJjbGVhck5ld0NvbW1hbmRUaW1lb3V0IiwiaW1nRWxJZCIsIk5vdFlldEltcGxlbWVudGVkRXJyb3IiLCJyZXMiLCJuZXh0Q29tbWFuZCIsInRoZW4iLCJOb1N1Y2hEcml2ZXJFcnJvciIsIkltYWdlRWxlbWVudCIsImV4ZWN1dGUiLCJzdGFydE5ld0NvbW1hbmRUaW1lb3V0IiwiZW5kVGltZSIsInN0YXJ0VW5leHBlY3RlZFNodXRkb3duIiwiZXJyIiwiZGVsZXRlU2Vzc2lvbiIsInZhbGlkYXRlTG9jYXRvclN0cmF0ZWd5Iiwic3RyYXRlZ3kiLCJ3ZWJDb250ZXh0IiwidmFsaWRTdHJhdGVnaWVzIiwiY29uY2F0IiwiaW5jbHVkZXMiLCJJbnZhbGlkU2VsZWN0b3JFcnJvciIsInJlc2V0IiwiY3VycmVudENvbmZpZyIsInByb3BlcnR5IiwidW5kZWZpbmVkIiwiYWx3YXlzTWF0Y2giLCJmaXJzdE1hdGNoIiwiY3JlYXRlU2Vzc2lvbiIsImtleSIsImdldFN3aXBlT3B0aW9ucyIsImdlc3R1cmVzIiwidG91Y2hDb3VudCIsInN0YXJ0WCIsImdldENvb3JkRGVmYXVsdCIsIm9wdGlvbnMiLCJ4Iiwic3RhcnRZIiwieSIsImVuZFgiLCJlbmRZIiwiZHVyYXRpb24iLCJnZXRTd2lwZVRvdWNoRHVyYXRpb24iLCJlbGVtZW50IiwiZGVzdEVsZW1lbnQiLCJ1dGlsIiwiaGFzVmFsdWUiLCJsb2NSZXN1bHQiLCJnZXRMb2NhdGlvbkluVmlldyIsInNpemVSZXN1bHQiLCJnZXRTaXplIiwib2Zmc2V0WCIsIk1hdGgiLCJhYnMiLCJ3aWR0aCIsIm9mZnNldFkiLCJoZWlnaHQiLCJmaXJzdEVsTG9jYXRpb24iLCJwcm94eUFjdGl2ZSIsImdldFByb3h5QXZvaWRMaXN0IiwiY2FuUHJveHkiLCJwcm94eVJvdXRlSXNBdm9pZGVkIiwibWV0aG9kIiwidXJsIiwiYXZvaWRTY2hlbWEiLCJpc0FycmF5IiwiYXZvaWRNZXRob2QiLCJhdm9pZFBhdGhSZWdleCIsImlzUmVnRXhwIiwibm9ybWFsaXplZFVybCIsInJlcGxhY2UiLCJ0ZXN0IiwiYWRkTWFuYWdlZERyaXZlciIsImRyaXZlciIsImdldE1hbmFnZWREcml2ZXJzIiwiZm4iLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsc0JBQXNCLEdBQUcsS0FBSyxJQUFwQztBQUVBLE1BQU1DLGtCQUFrQixHQUFHLHFCQUEzQjtBQUNBLE1BQU1DLG1CQUFtQixHQUFHLG1CQUE1QjtBQUNBLE1BQU1DLHdCQUF3QixHQUFHLHNCQUFqQztBQUNBLE1BQU1DLHVCQUF1QixHQUFHLHFCQUFoQzs7QUFFQSxNQUFNQyxVQUFOLFNBQXlCQyxrQkFBekIsQ0FBa0M7QUFFaENDLEVBQUFBLFdBQVcsQ0FBRUMsSUFBSSxHQUFHLEVBQVQsRUFBYUMsa0JBQWtCLEdBQUcsSUFBbEMsRUFBd0M7QUFDakQ7QUFHQSxTQUFLQyxTQUFMLEdBQWlCLElBQWpCO0FBQ0EsU0FBS0YsSUFBTCxHQUFZQSxJQUFaO0FBQ0EsU0FBS0csSUFBTCxHQUFZLElBQVo7QUFDQSxTQUFLQyxPQUFMLEdBQWVBLE9BQWY7QUFHQSxTQUFLQyxtQkFBTCxHQUEyQmIsc0JBQTNCO0FBQ0EsU0FBS2MsY0FBTCxHQUFzQixDQUF0QjtBQUVBLFNBQUtDLFlBQUwsR0FBb0JDLGdCQUFFQyxTQUFGLENBQVlDLHlDQUFaLENBQXBCO0FBQ0EsU0FBS0MsaUJBQUwsR0FBeUIsRUFBekI7QUFDQSxTQUFLQyxvQkFBTCxHQUE0QixFQUE1QjtBQUlBLFNBQUtaLElBQUwsQ0FBVWEsTUFBVixHQUFtQixLQUFLYixJQUFMLENBQVVhLE1BQVYsSUFDQUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLGNBRFosSUFFQUMsWUFBR0MsTUFBSCxFQUZuQjtBQUtBLFNBQUtDLFVBQUwsR0FBa0IsSUFBSUMsaUJBQUosQ0FBT0MsQ0FBRCxJQUFPO0FBQUVBLE1BQUFBLENBQUM7QUFBSyxLQUFyQixDQUFsQjtBQUNBLFNBQUtDLHFCQUFMLEdBQTZCLElBQUlGLGlCQUFKLENBQU9DLENBQUQsSUFBTztBQUFFQSxNQUFBQSxDQUFDO0FBQUssS0FBckIsQ0FBN0I7QUFDQSxTQUFLRSxvQkFBTCxHQUE0QixLQUE1QjtBQUNBLFNBQUtDLGNBQUwsR0FBc0IsSUFBdEI7QUFDQSxTQUFLdkIsa0JBQUwsR0FBMEJBLGtCQUExQjtBQU1BLFNBQUt3QixRQUFMLEdBQWdCLElBQUlDLHVCQUFKLENBQW1CLEVBQW5CLEVBQXVCbEIsZ0JBQUVtQixJQUF6QixDQUFoQjtBQUVBLFNBQUtDLHlCQUFMO0FBR0EsU0FBS0MsV0FBTCxHQUFtQnJCLGdCQUFFQyxTQUFGLENBQVksS0FBS1QsSUFBakIsQ0FBbkI7QUFHQSxTQUFLOEIsY0FBTCxHQUFzQixFQUF0QjtBQUdBLFNBQUtDLGFBQUwsR0FBcUI7QUFDbkJDLE1BQUFBLFFBQVEsRUFBRTtBQURTLEtBQXJCO0FBS0EsU0FBS0MsV0FBTCxHQUFtQiwwQ0FBbkI7QUFFQSxTQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0Q7O0FBVUQsTUFBSUMsVUFBSixHQUFrQjtBQUNoQixXQUFPLEVBQVA7QUFDRDs7QUFhRCxNQUFJQyxzQkFBSixHQUE4QjtBQUM1QixXQUFPLElBQVA7QUFDRDs7QUFNRCxNQUFJQyxZQUFKLEdBQW9CO0FBQ2xCLFdBQU83QixnQkFBRUMsU0FBRixDQUFZLEtBQUtzQixhQUFqQixDQUFQO0FBQ0Q7O0FBS0RPLEVBQUFBLFFBQVEsQ0FBRUMsU0FBRixFQUFhO0FBQ25CLFFBQUlBLFNBQVMsS0FBSyxVQUFsQixFQUE4QjtBQUM1QixZQUFNLElBQUlDLEtBQUosQ0FBVSw4QkFBVixDQUFOO0FBQ0Q7O0FBQ0QsUUFBSSxPQUFPRCxTQUFQLEtBQXFCLFFBQXpCLEVBQW1DO0FBQ2pDLFlBQU0sSUFBSUMsS0FBSixDQUFXLHFCQUFvQkQsU0FBVSxFQUF6QyxDQUFOO0FBQ0Q7O0FBQ0QsUUFBSSxDQUFDLEtBQUtSLGFBQUwsQ0FBbUJRLFNBQW5CLENBQUwsRUFBb0M7QUFDbEMsV0FBS1IsYUFBTCxDQUFtQlEsU0FBbkIsSUFBZ0MsRUFBaEM7QUFDRDs7QUFDRCxRQUFJRSxFQUFFLEdBQUdDLElBQUksQ0FBQ0MsR0FBTCxFQUFUO0FBQ0EsUUFBSUMsT0FBTyxHQUFJLElBQUlGLElBQUosQ0FBU0QsRUFBVCxDQUFELENBQWVJLFlBQWYsRUFBZDs7QUFDQSxTQUFLZCxhQUFMLENBQW1CUSxTQUFuQixFQUE4Qk8sSUFBOUIsQ0FBbUNMLEVBQW5DOztBQUNBTSxvQkFBSUMsS0FBSixDQUFXLFVBQVNULFNBQVUsZUFBY0UsRUFBRyxLQUFJRyxPQUFRLEdBQTNEO0FBQ0Q7O0FBTUtLLEVBQUFBLFNBQU4sR0FBbUI7QUFBQTtBQUNqQixhQUFPLEVBQVA7QUFEaUI7QUFFbEI7O0FBS0RyQixFQUFBQSx5QkFBeUIsR0FBSTtBQUMzQixRQUFJLEtBQUtzQixvQkFBTCxJQUE2QixDQUFDLEtBQUtBLG9CQUFMLENBQTBCQyxXQUExQixFQUFsQyxFQUEyRTtBQUN6RSxXQUFLRCxvQkFBTCxDQUEwQkUsTUFBMUI7QUFDRDs7QUFDRCxTQUFLRixvQkFBTCxHQUE0QixJQUFJOUIsaUJBQUosQ0FBTSxDQUFDaUMsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3JELFdBQUtDLDBCQUFMLEdBQWtDO0FBQUNGLFFBQUFBLE9BQUQ7QUFBVUMsUUFBQUE7QUFBVixPQUFsQztBQUNELEtBRjJCLEVBRXpCRSxXQUZ5QixFQUE1QjtBQUlBLFNBQUtOLG9CQUFMLENBQTBCTyxLQUExQixDQUFnQyxNQUFNLENBQUUsQ0FBeEM7QUFDRDs7QUFHRCxNQUFJQyxxQkFBSixDQUEyQkMsV0FBM0IsRUFBd0M7QUFDdEMsU0FBS3BELFlBQUwsR0FBb0JxRCxNQUFNLENBQUNDLE1BQVAsQ0FBYyxLQUFLdEQsWUFBbkIsRUFBaUNvRCxXQUFqQyxDQUFwQjtBQURzQztBQUFBO0FBQUE7O0FBQUE7QUFJdEMsMkJBQXdCbkQsZ0JBQUVzRCxPQUFGLENBQVUsS0FBS3ZELFlBQWYsQ0FBeEIsOEhBQXNEO0FBQUE7QUFBQSxjQUF4Q3dELEtBQXdDOztBQUNwRCxZQUFJQSxLQUFLLElBQUlBLEtBQUssQ0FBQ0MsUUFBTixLQUFtQixJQUFoQyxFQUFzQztBQUNwQ0QsVUFBQUEsS0FBSyxDQUFDQyxRQUFOLEdBQWlCO0FBQ2ZDLFlBQUFBLFVBQVUsRUFBRTtBQURHLFdBQWpCO0FBR0Q7QUFDRjtBQVZxQztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBV3ZDOztBQUVELE1BQUlQLHFCQUFKLEdBQTZCO0FBQzNCLFdBQU8sS0FBS25ELFlBQVo7QUFDRDs7QUFJRDJELEVBQUFBLGFBQWEsQ0FBRWhFLFNBQUYsRUFBYTtBQUN4QixRQUFJLENBQUNBLFNBQUwsRUFBZ0IsT0FBTyxLQUFQO0FBQ2hCLFdBQU9BLFNBQVMsS0FBSyxLQUFLQSxTQUExQjtBQUNEOztBQUlEaUUsRUFBQUEsZ0JBQWdCLEdBQWlCO0FBQy9CLFdBQU8sSUFBUDtBQUNEOztBQUVEQyxFQUFBQSxZQUFZLENBQUVqRSxJQUFGLEVBQVE7QUFDbEIsUUFBSWtFLFNBQVMsR0FBRzdELGdCQUFFOEQsVUFBRixDQUFhOUQsZ0JBQUUrRCxJQUFGLENBQU9wRSxJQUFQLENBQWIsRUFDYUssZ0JBQUUrRCxJQUFGLENBQU8sS0FBS2hFLFlBQVosQ0FEYixDQUFoQjs7QUFFQSxRQUFJOEQsU0FBUyxDQUFDRyxNQUFkLEVBQXNCO0FBQ3BCekIsc0JBQUkwQixJQUFKLENBQVUsd0RBQUQsR0FDQyx5QkFBd0JKLFNBQVMsQ0FBQ0ssSUFBVixDQUFlLElBQWYsQ0FBcUIsR0FEdkQ7QUFFRDtBQUNGOztBQUVEQyxFQUFBQSxtQkFBbUIsQ0FBRXhFLElBQUYsRUFBUTtBQUN6QixRQUFJLENBQUMsS0FBS0Ysa0JBQVYsRUFBOEI7QUFDNUIsYUFBTyxJQUFQO0FBQ0Q7O0FBRUQsUUFBSTtBQUNGLHNDQUFhRSxJQUFiLEVBQW1CLEtBQUtJLFlBQXhCO0FBQ0QsS0FGRCxDQUVFLE9BQU9xRSxDQUFQLEVBQVU7QUFDVjdCLHNCQUFJOEIsYUFBSixDQUFrQixJQUFJQyxpQkFBT0Msc0JBQVgsQ0FBbUMsdURBQUQsR0FDckMsd0JBQXVCSCxDQUFDLENBQUNJLE9BQVEsRUFEOUIsQ0FBbEI7QUFFRDs7QUFFRCxTQUFLWixZQUFMLENBQWtCakUsSUFBbEI7QUFFQSxXQUFPLElBQVA7QUFDRDs7QUFPRDhFLEVBQUFBLGlCQUFpQixHQUFJO0FBQ25CLFdBQU8sS0FBSy9DLFFBQUwsS0FBa0JyQyxVQUFVLENBQUNxRixlQUFYLENBQTJCQyxPQUFwRDtBQUNEOztBQUVEQyxFQUFBQSxhQUFhLEdBQUk7QUFDZixXQUFPLEtBQUtsRCxRQUFMLEtBQWtCckMsVUFBVSxDQUFDcUYsZUFBWCxDQUEyQkcsR0FBcEQ7QUFDRDs7QUFFREMsRUFBQUEsa0JBQWtCLEdBQUk7QUFDcEIsU0FBS3BELFFBQUwsR0FBZ0JyQyxVQUFVLENBQUNxRixlQUFYLENBQTJCQyxPQUEzQztBQUNEOztBQUVESSxFQUFBQSxjQUFjLEdBQUk7QUFDaEIsU0FBS3JELFFBQUwsR0FBZ0JyQyxVQUFVLENBQUNxRixlQUFYLENBQTJCRyxHQUEzQztBQUNEOztBQUtELFNBQU9HLGlCQUFQLENBQTBCQyxtQkFBMUIsRUFBK0NDLG9CQUEvQyxFQUFxRUMsWUFBckUsRUFBbUY7QUFDakYsV0FBT25GLGdCQUFFb0YsYUFBRixDQUFnQkQsWUFBaEIsSUFDTDlGLFVBQVUsQ0FBQ3FGLGVBQVgsQ0FBMkJHLEdBRHRCLEdBRUx4RixVQUFVLENBQUNxRixlQUFYLENBQTJCQyxPQUY3QjtBQUdEOztBQU1LVSxFQUFBQSxjQUFOLENBQXNCQyxHQUF0QixFQUEyQixHQUFHQyxJQUE5QixFQUFvQztBQUFBOztBQUFBO0FBRWxDLFVBQUlDLFNBQVMsR0FBR3RELElBQUksQ0FBQ0MsR0FBTCxFQUFoQjs7QUFDQSxVQUFJbUQsR0FBRyxLQUFLLGVBQVosRUFBNkI7QUFFM0IsUUFBQSxLQUFJLENBQUM1RCxRQUFMLEdBQWdCckMsVUFBVSxDQUFDMkYsaUJBQVgsQ0FBNkIsR0FBR08sSUFBaEMsQ0FBaEI7O0FBQ0EsUUFBQSxLQUFJLENBQUN6RCxRQUFMLENBQWM3QyxrQkFBZDtBQUNELE9BSkQsTUFJTyxJQUFJcUcsR0FBRyxLQUFLLGVBQVosRUFBNkI7QUFDbEMsUUFBQSxLQUFJLENBQUN4RCxRQUFMLENBQWMzQyx3QkFBZDtBQUNEOztBQUlELE1BQUEsS0FBSSxDQUFDc0csc0JBQUw7O0FBS0EsWUFBTUMsT0FBTyxHQUFHLG9DQUFpQkgsSUFBakIsQ0FBaEI7O0FBQ0EsVUFBSSxDQUFDLEtBQUksQ0FBQ0QsR0FBRCxDQUFMLElBQWMsQ0FBQ0ksT0FBbkIsRUFBNEI7QUFDMUIsY0FBTSxJQUFJcEIsaUJBQU9xQixzQkFBWCxFQUFOO0FBQ0Q7O0FBRUQsVUFBSUMsR0FBSjs7QUFDQSxVQUFJLEtBQUksQ0FBQ2hFLHNCQUFULEVBQWlDO0FBWS9CLFlBQUlpRSxXQUFXLEdBQUcsS0FBSSxDQUFDbEYsVUFBTCxDQUFnQm1GLElBQWhCLENBQXFCLE1BQU07QUFHM0MsY0FBSSxLQUFJLENBQUMvRSxvQkFBVCxFQUErQjtBQUM3QixtQkFBT0gsa0JBQUVrQyxNQUFGLENBQVMsSUFBSXdCLGlCQUFPeUIsaUJBQVgsQ0FBNkIsd0NBQTdCLENBQVQsQ0FBUDtBQUNEOztBQUlELFVBQUEsS0FBSSxDQUFDakYscUJBQUwsR0FBNkJGLGtCQUFFaUMsT0FBRixHQUFZaUQsSUFBWixDQUFpQixNQUFNO0FBRWxELGdCQUFJSixPQUFKLEVBQWE7QUFDWCxxQkFBT00sMkJBQWFDLE9BQWIsQ0FBcUIsS0FBckIsRUFBMkJYLEdBQTNCLEVBQWdDSSxPQUFoQyxDQUFQO0FBQ0Q7O0FBQ0QsbUJBQU8sS0FBSSxDQUFDSixHQUFELENBQUosQ0FBVSxHQUFHQyxJQUFiLENBQVA7QUFDRCxXQU40QixFQU0xQnZDLFdBTjBCLEVBQTdCO0FBT0EsaUJBQU8sS0FBSSxDQUFDbEMscUJBQVo7QUFDRCxTQWpCaUIsQ0FBbEI7O0FBa0JBLFFBQUEsS0FBSSxDQUFDSCxVQUFMLEdBQWtCa0YsV0FBVyxDQUFDNUMsS0FBWixDQUFrQixNQUFNLENBQUUsQ0FBMUIsQ0FBbEI7QUFDQTJDLFFBQUFBLEdBQUcsU0FBU0MsV0FBWjtBQUNELE9BaENELE1BZ0NPO0FBQ0wsWUFBSSxLQUFJLENBQUM5RSxvQkFBVCxFQUErQjtBQUM3QixnQkFBTSxJQUFJdUQsaUJBQU95QixpQkFBWCxDQUE2Qix3Q0FBN0IsQ0FBTjtBQUNEOztBQUNESCxRQUFBQSxHQUFHLFNBQVMsS0FBSSxDQUFDTixHQUFELENBQUosQ0FBVSxHQUFHQyxJQUFiLENBQVo7QUFDRDs7QUFRRCxVQUFJRCxHQUFHLEtBQUssZUFBWixFQUE2QjtBQUUzQixRQUFBLEtBQUksQ0FBQ1ksc0JBQUw7QUFDRDs7QUFHRCxVQUFJQyxPQUFPLEdBQUdqRSxJQUFJLENBQUNDLEdBQUwsRUFBZDs7QUFDQSxNQUFBLEtBQUksQ0FBQ1osYUFBTCxDQUFtQkMsUUFBbkIsQ0FBNEJjLElBQTVCLENBQWlDO0FBQUNnRCxRQUFBQSxHQUFEO0FBQU1FLFFBQUFBLFNBQU47QUFBaUJXLFFBQUFBO0FBQWpCLE9BQWpDOztBQUNBLFVBQUliLEdBQUcsS0FBSyxlQUFaLEVBQTZCO0FBQzNCLFFBQUEsS0FBSSxDQUFDeEQsUUFBTCxDQUFjNUMsbUJBQWQ7QUFDRCxPQUZELE1BRU8sSUFBSW9HLEdBQUcsS0FBSyxlQUFaLEVBQTZCO0FBQ2xDLFFBQUEsS0FBSSxDQUFDeEQsUUFBTCxDQUFjMUMsdUJBQWQ7QUFDRDs7QUFFRCxhQUFPd0csR0FBUDtBQW5Ga0M7QUFvRm5DOztBQUVLUSxFQUFBQSx1QkFBTixDQUErQkMsR0FBRyxHQUFHLElBQUkvQixpQkFBT3lCLGlCQUFYLENBQTZCLHdDQUE3QixDQUFyQyxFQUE2RztBQUFBOztBQUFBO0FBQzNHLE1BQUEsTUFBSSxDQUFDaEQsMEJBQUwsQ0FBZ0NELE1BQWhDLENBQXVDdUQsR0FBdkM7O0FBQ0EsTUFBQSxNQUFJLENBQUN0RixvQkFBTCxHQUE0QixJQUE1QjtBQUNBLFlBQU0sTUFBSSxDQUFDdUYsYUFBTCxDQUFtQixNQUFJLENBQUM1RyxTQUF4QixDQUFOO0FBQ0EsTUFBQSxNQUFJLENBQUNxQixvQkFBTCxHQUE0QixLQUE1Qjs7QUFDQSxNQUFBLE1BQUksQ0FBQ0QscUJBQUwsQ0FBMkI4QixNQUEzQixDQUFrQ3lELEdBQWxDO0FBTDJHO0FBTTVHOztBQUVERSxFQUFBQSx1QkFBdUIsQ0FBRUMsUUFBRixFQUFZQyxVQUFVLEdBQUcsS0FBekIsRUFBZ0M7QUFDckQsUUFBSUMsZUFBZSxHQUFHLEtBQUt2RyxpQkFBM0I7O0FBQ0FvQyxvQkFBSUMsS0FBSixDQUFXLDhDQUE2Q2tFLGVBQWUsQ0FBQ3hDLElBQWhCLENBQXFCLElBQXJCLENBQTJCLEVBQW5GOztBQUVBLFFBQUl1QyxVQUFKLEVBQWdCO0FBQ2RDLE1BQUFBLGVBQWUsR0FBR0EsZUFBZSxDQUFDQyxNQUFoQixDQUF1QixLQUFLdkcsb0JBQTVCLENBQWxCO0FBQ0Q7O0FBRUQsUUFBSSxDQUFDSixnQkFBRTRHLFFBQUYsQ0FBV0YsZUFBWCxFQUE0QkYsUUFBNUIsQ0FBTCxFQUE0QztBQUMxQyxZQUFNLElBQUlsQyxpQkFBT3VDLG9CQUFYLENBQWlDLHFCQUFvQkwsUUFBUyxxQ0FBOUQsQ0FBTjtBQUNEO0FBQ0Y7O0FBTUtNLEVBQUFBLEtBQU4sR0FBZTtBQUFBOztBQUFBO0FBQ2J2RSxzQkFBSUMsS0FBSixDQUFVLDJCQUFWOztBQUNBRCxzQkFBSUMsS0FBSixDQUFVLDRCQUFWOztBQUdBLFVBQUl1RSxhQUFhLEdBQUcsRUFBcEI7QUFMYSxpQkFNUSxDQUFDLGdCQUFELEVBQW1CLHFCQUFuQixFQUEwQyxXQUExQyxFQUF1RCwyQkFBdkQsQ0FOUjs7QUFNYiwrQ0FBMEc7QUFBckcsWUFBSUMsUUFBUSxXQUFaO0FBQ0hELFFBQUFBLGFBQWEsQ0FBQ0MsUUFBRCxDQUFiLEdBQTBCLE1BQUksQ0FBQ0EsUUFBRCxDQUE5QjtBQUNEOztBQUdELE1BQUEsTUFBSSxDQUFDNUYseUJBQUwsR0FBaUMsTUFBTSxDQUFFLENBQXpDOztBQUdBLFlBQU1tRSxJQUFJLEdBQUcsTUFBSSxDQUFDN0QsUUFBTCxLQUFrQnJDLFVBQVUsQ0FBQ3FGLGVBQVgsQ0FBMkJHLEdBQTdDLEdBQ1gsQ0FBQ29DLFNBQUQsRUFBWUEsU0FBWixFQUF1QjtBQUFDQyxRQUFBQSxXQUFXLEVBQUUsTUFBSSxDQUFDdkgsSUFBbkI7QUFBeUJ3SCxRQUFBQSxVQUFVLEVBQUUsQ0FBQyxFQUFEO0FBQXJDLE9BQXZCLENBRFcsR0FFWCxDQUFDLE1BQUksQ0FBQ3hILElBQU4sQ0FGRjs7QUFJQSxVQUFJO0FBQ0YsY0FBTSxNQUFJLENBQUMyRyxhQUFMLENBQW1CLE1BQUksQ0FBQzVHLFNBQXhCLENBQU47O0FBQ0E2Qyx3QkFBSUMsS0FBSixDQUFVLGdCQUFWOztBQUNBLGNBQU0sTUFBSSxDQUFDNEUsYUFBTCxDQUFtQixHQUFHN0IsSUFBdEIsQ0FBTjtBQUNELE9BSkQsU0FJVTtBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUVSLGdDQUF5QnZGLGdCQUFFc0QsT0FBRixDQUFVeUQsYUFBVixDQUF6QixtSUFBbUQ7QUFBQTtBQUFBLGdCQUF6Q00sR0FBeUM7QUFBQSxnQkFBcEM5RCxLQUFvQzs7QUFDakQsWUFBQSxNQUFJLENBQUM4RCxHQUFELENBQUosR0FBWTlELEtBQVo7QUFDRDtBQUpPO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLVDs7QUFDRCxNQUFBLE1BQUksQ0FBQ2tDLHNCQUFMO0FBNUJhO0FBNkJkOztBQUVLNkIsRUFBQUEsZUFBTixDQUF1QkMsUUFBdkIsRUFBaUNDLFVBQVUsR0FBRyxDQUE5QyxFQUFpRDtBQUFBOztBQUFBO0FBQy9DLFVBQUlDLE1BQU0sR0FBRyxNQUFJLENBQUM3SCxPQUFMLENBQWE4SCxlQUFiLENBQTZCSCxRQUFRLENBQUMsQ0FBRCxDQUFSLENBQVlJLE9BQVosQ0FBb0JDLENBQWpELENBQWI7QUFBQSxVQUNJQyxNQUFNLEdBQUcsTUFBSSxDQUFDakksT0FBTCxDQUFhOEgsZUFBYixDQUE2QkgsUUFBUSxDQUFDLENBQUQsQ0FBUixDQUFZSSxPQUFaLENBQW9CRyxDQUFqRCxDQURiO0FBQUEsVUFFSUMsSUFBSSxHQUFHLE1BQUksQ0FBQ25JLE9BQUwsQ0FBYThILGVBQWIsQ0FBNkJILFFBQVEsQ0FBQyxDQUFELENBQVIsQ0FBWUksT0FBWixDQUFvQkMsQ0FBakQsQ0FGWDtBQUFBLFVBR0lJLElBQUksR0FBRyxNQUFJLENBQUNwSSxPQUFMLENBQWE4SCxlQUFiLENBQTZCSCxRQUFRLENBQUMsQ0FBRCxDQUFSLENBQVlJLE9BQVosQ0FBb0JHLENBQWpELENBSFg7QUFBQSxVQUlJRyxRQUFRLEdBQUcsTUFBSSxDQUFDckksT0FBTCxDQUFhc0kscUJBQWIsQ0FBbUNYLFFBQVEsQ0FBQyxDQUFELENBQTNDLENBSmY7QUFBQSxVQUtJWSxPQUFPLEdBQUdaLFFBQVEsQ0FBQyxDQUFELENBQVIsQ0FBWUksT0FBWixDQUFvQlEsT0FMbEM7QUFBQSxVQU1JQyxXQUFXLEdBQUdiLFFBQVEsQ0FBQyxDQUFELENBQVIsQ0FBWUksT0FBWixDQUFvQlEsT0FBcEIsSUFBK0JaLFFBQVEsQ0FBQyxDQUFELENBQVIsQ0FBWUksT0FBWixDQUFvQlEsT0FOckU7O0FBU0EsVUFBSUUsb0JBQUtDLFFBQUwsQ0FBY0YsV0FBZCxDQUFKLEVBQWdDO0FBQzlCLFlBQUlHLFNBQVMsU0FBUyxNQUFJLENBQUNDLGlCQUFMLENBQXVCSixXQUF2QixDQUF0QjtBQUNBLFlBQUlLLFVBQVUsU0FBUyxNQUFJLENBQUNDLE9BQUwsQ0FBYU4sV0FBYixDQUF2QjtBQUNBLFlBQUlPLE9BQU8sR0FBSUMsSUFBSSxDQUFDQyxHQUFMLENBQVNkLElBQVQsSUFBaUIsQ0FBakIsSUFBc0JhLElBQUksQ0FBQ0MsR0FBTCxDQUFTZCxJQUFULElBQWlCLENBQXhDLEdBQTZDVSxVQUFVLENBQUNLLEtBQVgsR0FBbUJmLElBQWhFLEdBQXVFQSxJQUFyRjtBQUNBLFlBQUlnQixPQUFPLEdBQUlILElBQUksQ0FBQ0MsR0FBTCxDQUFTYixJQUFULElBQWlCLENBQWpCLElBQXNCWSxJQUFJLENBQUNDLEdBQUwsQ0FBU2IsSUFBVCxJQUFpQixDQUF4QyxHQUE2Q1MsVUFBVSxDQUFDTyxNQUFYLEdBQW9CaEIsSUFBakUsR0FBd0VBLElBQXRGO0FBQ0FELFFBQUFBLElBQUksR0FBR1EsU0FBUyxDQUFDWCxDQUFWLEdBQWNlLE9BQXJCO0FBQ0FYLFFBQUFBLElBQUksR0FBR08sU0FBUyxDQUFDVCxDQUFWLEdBQWNpQixPQUFyQjs7QUFFQSxZQUFJVixvQkFBS0MsUUFBTCxDQUFjSCxPQUFkLENBQUosRUFBNEI7QUFDMUIsY0FBSWMsZUFBZSxTQUFTLE1BQUksQ0FBQ1QsaUJBQUwsQ0FBdUJMLE9BQXZCLENBQTVCO0FBQ0FKLFVBQUFBLElBQUksSUFBSWtCLGVBQWUsQ0FBQ3JCLENBQXhCO0FBQ0FJLFVBQUFBLElBQUksSUFBSWlCLGVBQWUsQ0FBQ25CLENBQXhCO0FBQ0Q7QUFDRjs7QUFFRCxhQUFPO0FBQUNMLFFBQUFBLE1BQUQ7QUFBU0ksUUFBQUEsTUFBVDtBQUFpQkUsUUFBQUEsSUFBakI7QUFBdUJDLFFBQUFBLElBQXZCO0FBQTZCQyxRQUFBQSxRQUE3QjtBQUF1Q1QsUUFBQUEsVUFBdkM7QUFBbURXLFFBQUFBO0FBQW5ELE9BQVA7QUF6QitDO0FBMEJoRDs7QUFFRGUsRUFBQUEsV0FBVyxHQUFtQjtBQUM1QixXQUFPLEtBQVA7QUFDRDs7QUFFREMsRUFBQUEsaUJBQWlCLEdBQW1CO0FBQ2xDLFdBQU8sRUFBUDtBQUNEOztBQUVEQyxFQUFBQSxRQUFRLEdBQW1CO0FBQ3pCLFdBQU8sS0FBUDtBQUNEOztBQWNEQyxFQUFBQSxtQkFBbUIsQ0FBRTNKLFNBQUYsRUFBYTRKLE1BQWIsRUFBcUJDLEdBQXJCLEVBQTBCO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQzNDLDRCQUF3QixLQUFLSixpQkFBTCxDQUF1QnpKLFNBQXZCLENBQXhCLG1JQUEyRDtBQUFBLFlBQWxEOEosV0FBa0Q7O0FBQ3pELFlBQUksQ0FBQ3hKLGdCQUFFeUosT0FBRixDQUFVRCxXQUFWLENBQUQsSUFBMkJBLFdBQVcsQ0FBQ3hGLE1BQVosS0FBdUIsQ0FBdEQsRUFBeUQ7QUFDdkQsZ0JBQU0sSUFBSWhDLEtBQUosQ0FBVSx5Q0FBVixDQUFOO0FBQ0Q7O0FBSHdELHdEQUlyQndILFdBSnFCO0FBQUEsWUFJcERFLFdBSm9EO0FBQUEsWUFJdkNDLGNBSnVDOztBQUt6RCxZQUFJLENBQUMzSixnQkFBRTRHLFFBQUYsQ0FBVyxDQUFDLEtBQUQsRUFBUSxNQUFSLEVBQWdCLFFBQWhCLENBQVgsRUFBc0M4QyxXQUF0QyxDQUFMLEVBQXlEO0FBQ3ZELGdCQUFNLElBQUkxSCxLQUFKLENBQVcsd0NBQXVDMEgsV0FBWSxHQUE5RCxDQUFOO0FBQ0Q7O0FBQ0QsWUFBSSxDQUFDMUosZ0JBQUU0SixRQUFGLENBQVdELGNBQVgsQ0FBTCxFQUFpQztBQUMvQixnQkFBTSxJQUFJM0gsS0FBSixDQUFVLG1EQUFWLENBQU47QUFDRDs7QUFDRCxZQUFJNkgsYUFBYSxHQUFHTixHQUFHLENBQUNPLE9BQUosQ0FBWSxZQUFaLEVBQTBCLEVBQTFCLENBQXBCOztBQUNBLFlBQUlKLFdBQVcsS0FBS0osTUFBaEIsSUFBMEJLLGNBQWMsQ0FBQ0ksSUFBZixDQUFvQkYsYUFBcEIsQ0FBOUIsRUFBa0U7QUFDaEUsaUJBQU8sSUFBUDtBQUNEO0FBQ0Y7QUFoQjBDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBaUIzQyxXQUFPLEtBQVA7QUFDRDs7QUFFREcsRUFBQUEsZ0JBQWdCLENBQUVDLE1BQUYsRUFBVTtBQUN4QixTQUFLM0ksY0FBTCxDQUFvQmdCLElBQXBCLENBQXlCMkgsTUFBekI7QUFDRDs7QUFFREMsRUFBQUEsaUJBQWlCLEdBQUk7QUFDbkIsV0FBTyxLQUFLNUksY0FBWjtBQUNEOztBQTViK0I7Ozs4QkFBNUJqQyxVLHFCQThMcUI7QUFDdkJ3RixFQUFBQSxHQUFHLEVBQUUsS0FEa0I7QUFFdkJGLEVBQUFBLE9BQU8sRUFBRTtBQUZjLEM7Ozs7OztBQWlRM0Isd0JBQXNCM0UsZ0JBQUVzRCxPQUFGLENBQVU5QixpQkFBVixDQUF0QixtSUFBMkM7QUFBQTtBQUFBLFFBQWpDOEQsR0FBaUM7QUFBQSxRQUE1QjZFLEVBQTRCOztBQUN6QzlLLElBQUFBLFVBQVUsQ0FBQytLLFNBQVgsQ0FBcUI5RSxHQUFyQixJQUE0QjZFLEVBQTVCO0FBQ0Q7Ozs7Ozs7Ozs7Ozs7Ozs7ZUFHYzlLLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm90b2NvbCwgZXJyb3JzIH0gZnJvbSAnLi4vcHJvdG9jb2wnO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBjb21tYW5kcyBmcm9tICcuL2NvbW1hbmRzJztcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IERldmljZVNldHRpbmdzIGZyb20gJy4vZGV2aWNlLXNldHRpbmdzJztcbmltcG9ydCB7IGRlc2lyZWRDYXBhYmlsaXR5Q29uc3RyYWludHMgfSBmcm9tICcuL2Rlc2lyZWQtY2Fwcyc7XG5pbXBvcnQgeyB2YWxpZGF0ZUNhcHMgfSBmcm9tICcuL2NhcGFiaWxpdGllcyc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IEltYWdlRWxlbWVudCwgbWFrZUltYWdlRWxlbWVudENhY2hlLCBnZXRJbWdFbEZyb21BcmdzIH0gZnJvbSAnLi9pbWFnZS1lbGVtZW50JztcblxuXG5jb25zdCBORVdfQ09NTUFORF9USU1FT1VUX01TID0gNjAgKiAxMDAwO1xuXG5jb25zdCBFVkVOVF9TRVNTSU9OX0lOSVQgPSAnbmV3U2Vzc2lvblJlcXVlc3RlZCc7XG5jb25zdCBFVkVOVF9TRVNTSU9OX1NUQVJUID0gJ25ld1Nlc3Npb25TdGFydGVkJztcbmNvbnN0IEVWRU5UX1NFU1NJT05fUVVJVF9TVEFSVCA9ICdxdWl0U2Vzc2lvblJlcXVlc3RlZCc7XG5jb25zdCBFVkVOVF9TRVNTSU9OX1FVSVRfRE9ORSA9ICdxdWl0U2Vzc2lvbkZpbmlzaGVkJztcblxuY2xhc3MgQmFzZURyaXZlciBleHRlbmRzIFByb3RvY29sIHtcblxuICBjb25zdHJ1Y3RvciAob3B0cyA9IHt9LCBzaG91bGRWYWxpZGF0ZUNhcHMgPSB0cnVlKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIC8vIHNldHVwIHN0YXRlXG4gICAgdGhpcy5zZXNzaW9uSWQgPSBudWxsO1xuICAgIHRoaXMub3B0cyA9IG9wdHM7XG4gICAgdGhpcy5jYXBzID0gbnVsbDtcbiAgICB0aGlzLmhlbHBlcnMgPSBoZWxwZXJzO1xuXG4gICAgLy8gdGltZW91dCBpbml0aWFsaXphdGlvblxuICAgIHRoaXMubmV3Q29tbWFuZFRpbWVvdXRNcyA9IE5FV19DT01NQU5EX1RJTUVPVVRfTVM7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IDA7XG5cbiAgICB0aGlzLl9jb25zdHJhaW50cyA9IF8uY2xvbmVEZWVwKGRlc2lyZWRDYXBhYmlsaXR5Q29uc3RyYWludHMpO1xuICAgIHRoaXMubG9jYXRvclN0cmF0ZWdpZXMgPSBbXTtcbiAgICB0aGlzLndlYkxvY2F0b3JTdHJhdGVnaWVzID0gW107XG5cbiAgICAvLyB1c2UgYSBjdXN0b20gdG1wIGRpciB0byBhdm9pZCBsb3NpbmcgZGF0YSBhbmQgYXBwIHdoZW4gY29tcHV0ZXIgaXNcbiAgICAvLyByZXN0YXJ0ZWRcbiAgICB0aGlzLm9wdHMudG1wRGlyID0gdGhpcy5vcHRzLnRtcERpciB8fFxuICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5BUFBJVU1fVE1QX0RJUiB8fFxuICAgICAgICAgICAgICAgICAgICAgICBvcy50bXBkaXIoKTtcblxuICAgIC8vIGJhc2UtZHJpdmVyIGludGVybmFsc1xuICAgIHRoaXMuY3VyQ29tbWFuZCA9IG5ldyBCKChyKSA9PiB7IHIoKTsgfSk7IC8vIHNlZSBub3RlIGluIGV4ZWN1dGVcbiAgICB0aGlzLmN1ckNvbW1hbmRDYW5jZWxsYWJsZSA9IG5ldyBCKChyKSA9PiB7IHIoKTsgfSk7IC8vIHNlZSBub3RlIGluIGV4ZWN1dGVcbiAgICB0aGlzLnNodXRkb3duVW5leHBlY3RlZGx5ID0gZmFsc2U7XG4gICAgdGhpcy5ub0NvbW1hbmRUaW1lciA9IG51bGw7XG4gICAgdGhpcy5zaG91bGRWYWxpZGF0ZUNhcHMgPSBzaG91bGRWYWxpZGF0ZUNhcHM7XG5cbiAgICAvLyBzZXR0aW5ncyBzaG91bGQgYmUgaW5zdGFudGlhdGVkIGJ5IGRyaXZlcnMgd2hpY2ggZXh0ZW5kIEJhc2VEcml2ZXIsIGJ1dFxuICAgIC8vIHdlIHNldCBpdCB0byBhbiBlbXB0eSBEZXZpY2VTZXR0aW5ncyBpbnN0YW5jZSBoZXJlIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZVxuICAgIC8vIGRlZmF1bHQgc2V0dGluZ3MgYXJlIGFwcGxpZWQgZXZlbiBpZiBhbiBleHRlbmRpbmcgZHJpdmVyIGRvZXNuJ3QgdXRpbGl6ZVxuICAgIC8vIHRoZSBzZXR0aW5ncyBmdW5jdGlvbmFsaXR5IGl0c2VsZlxuICAgIHRoaXMuc2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3Moe30sIF8ubm9vcCk7XG5cbiAgICB0aGlzLnJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24oKTtcblxuICAgIC8vIGtlZXBpbmcgdHJhY2sgb2YgaW5pdGlhbCBvcHRzXG4gICAgdGhpcy5pbml0aWFsT3B0cyA9IF8uY2xvbmVEZWVwKHRoaXMub3B0cyk7XG5cbiAgICAvLyBhbGxvdyBzdWJjbGFzc2VzIHRvIGhhdmUgaW50ZXJuYWwgZHJpdmVyc1xuICAgIHRoaXMubWFuYWdlZERyaXZlcnMgPSBbXTtcblxuICAgIC8vIHN0b3JlIGV2ZW50IHRpbWluZ3NcbiAgICB0aGlzLl9ldmVudEhpc3RvcnkgPSB7XG4gICAgICBjb21tYW5kczogW10gLy8gY29tbWFuZHMgZ2V0IGEgc3BlY2lhbCBwbGFjZVxuICAgIH07XG5cbiAgICAvLyBjYWNoZSB0aGUgaW1hZ2UgZWxlbWVudHNcbiAgICB0aGlzLl9pbWdFbENhY2hlID0gbWFrZUltYWdlRWxlbWVudENhY2hlKCk7XG5cbiAgICB0aGlzLnByb3RvY29sID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIHByb3BlcnR5IGlzIHVzZWQgYnkgQXBwaXVtRHJpdmVyIHRvIHN0b3JlIHRoZSBkYXRhIG9mIHRoZVxuICAgKiBzcGVjaWZpYyBkcml2ZXIgc2Vzc2lvbnMuIFRoaXMgZGF0YSBjYW4gYmUgbGF0ZXIgdXNlZCB0byBhZGp1c3RcbiAgICogcHJvcGVydGllcyBmb3IgZHJpdmVyIGluc3RhbmNlcyBydW5uaW5nIGluIHBhcmFsbGVsLlxuICAgKiBPdmVycmlkZSBpdCBpbiBpbmhlcml0ZWQgZHJpdmVyIGNsYXNzZXMgaWYgbmVjZXNzYXJ5LlxuICAgKlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IERyaXZlciBwcm9wZXJ0aWVzIG1hcHBpbmdcbiAgICovXG4gIGdldCBkcml2ZXJEYXRhICgpIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBjb250cm9scyB0aGUgd2F5IHsjZXhlY3V0ZUNvbW1hbmR9IG1ldGhvZFxuICAgKiBoYW5kbGVzIG5ldyBkcml2ZXIgY29tbWFuZHMgcmVjZWl2ZWQgZnJvbSB0aGUgY2xpZW50LlxuICAgKiBPdmVycmlkZSBpdCBmb3IgaW5oZXJpdGVkIGNsYXNzZXMgb25seSBpbiBzcGVjaWFsIGNhc2VzLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBJZiB0aGUgcmV0dXJuZWQgdmFsdWUgaXMgdHJ1ZSAoZGVmYXVsdCkgdGhlbiBhbGwgdGhlIGNvbW1hbmRzXG4gICAqICAgcmVjZWl2ZWQgYnkgdGhlIHBhcnRpY3VsYXIgZHJpdmVyIGluc3RhbmNlIGFyZSBnb2luZyB0byBiZSBwdXQgaW50byB0aGUgcXVldWUsXG4gICAqICAgc28gZWFjaCBmb2xsb3dpbmcgY29tbWFuZCB3aWxsIG5vdCBiZSBleGVjdXRlZCB1bnRpbCB0aGUgcHJldmlvdXMgY29tbWFuZFxuICAgKiAgIGV4ZWN1dGlvbiBpcyBjb21wbGV0ZWQuIEZhbHNlIHZhbHVlIGRpc2FibGVzIHRoYXQgcXVldWUsIHNvIGVhY2ggZHJpdmVyIGNvbW1hbmRcbiAgICogICBpcyBleGVjdXRlZCBpbmRlcGVuZGVudGx5IGFuZCBkb2VzIG5vdCB3YWl0IGZvciBhbnl0aGluZy5cbiAgICovXG4gIGdldCBpc0NvbW1hbmRzUXVldWVFbmFibGVkICgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qXG4gICAqIG1ha2UgZXZlbnRIaXN0b3J5IGEgcHJvcGVydHkgYW5kIHJldHVybiBhIGNsb25lZCBvYmplY3Qgc28gYSBjb25zdW1lciBjYW4ndFxuICAgKiBpbmFkdmVydGVudGx5IGNoYW5nZSBkYXRhIG91dHNpZGUgb2YgbG9nRXZlbnRcbiAgICovXG4gIGdldCBldmVudEhpc3RvcnkgKCkge1xuICAgIHJldHVybiBfLmNsb25lRGVlcCh0aGlzLl9ldmVudEhpc3RvcnkpO1xuICB9XG5cbiAgLypcbiAgICogQVBJIG1ldGhvZCBmb3IgZHJpdmVyIGRldmVsb3BlcnMgdG8gbG9nIHRpbWluZ3MgZm9yIGltcG9ydGFudCBldmVudHNcbiAgICovXG4gIGxvZ0V2ZW50IChldmVudE5hbWUpIHtcbiAgICBpZiAoZXZlbnROYW1lID09PSBcImNvbW1hbmRzXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBsb2cgY29tbWFuZHMgZGlyZWN0bHlcIik7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZXZlbnROYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZXZlbnROYW1lICR7ZXZlbnROYW1lfWApO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuX2V2ZW50SGlzdG9yeVtldmVudE5hbWVdKSB7XG4gICAgICB0aGlzLl9ldmVudEhpc3RvcnlbZXZlbnROYW1lXSA9IFtdO1xuICAgIH1cbiAgICBsZXQgdHMgPSBEYXRlLm5vdygpO1xuICAgIGxldCBsb2dUaW1lID0gKG5ldyBEYXRlKHRzKSkudG9UaW1lU3RyaW5nKCk7XG4gICAgdGhpcy5fZXZlbnRIaXN0b3J5W2V2ZW50TmFtZV0ucHVzaCh0cyk7XG4gICAgbG9nLmRlYnVnKGBFdmVudCAnJHtldmVudE5hbWV9JyBsb2dnZWQgYXQgJHt0c30gKCR7bG9nVGltZX0pYCk7XG4gIH1cblxuICAvKlxuICAgKiBPdmVycmlkZGVuIGluIGFwcGl1bSBkcml2ZXIsIGJ1dCBoZXJlIHNvIHRoYXQgaW5kaXZpZHVhbCBkcml2ZXJzIGNhbiBiZVxuICAgKiB0ZXN0ZWQgd2l0aCBjbGllbnRzIHRoYXQgcG9sbFxuICAgKi9cbiAgYXN5bmMgZ2V0U3RhdHVzICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgLypcbiAgICogSW5pdGlhbGl6ZSBhIG5ldyBvblVuZXhwZWN0ZWRTaHV0ZG93biBwcm9taXNlLCBjYW5jZWxsaW5nIGV4aXN0aW5nIG9uZS5cbiAgICovXG4gIHJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24gKCkge1xuICAgIGlmICh0aGlzLm9uVW5leHBlY3RlZFNodXRkb3duICYmICF0aGlzLm9uVW5leHBlY3RlZFNodXRkb3duLmlzRnVsZmlsbGVkKCkpIHtcbiAgICAgIHRoaXMub25VbmV4cGVjdGVkU2h1dGRvd24uY2FuY2VsKCk7XG4gICAgfVxuICAgIHRoaXMub25VbmV4cGVjdGVkU2h1dGRvd24gPSBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLnVuZXhwZWN0ZWRTaHV0ZG93bkRlZmVycmVkID0ge3Jlc29sdmUsIHJlamVjdH07XG4gICAgfSkuY2FuY2VsbGFibGUoKTtcbiAgICAvLyBub29wIGhhbmRsZXIgdG8gYXZvaWQgd2FybmluZy5cbiAgICB0aGlzLm9uVW5leHBlY3RlZFNodXRkb3duLmNhdGNoKCgpID0+IHt9KTtcbiAgfVxuXG4gIC8vIHdlIG9ubHkgd2FudCBzdWJjbGFzc2VzIHRvIGV2ZXIgZXh0ZW5kIHRoZSBjb250cmFpbnRzXG4gIHNldCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgKGNvbnN0cmFpbnRzKSB7XG4gICAgdGhpcy5fY29uc3RyYWludHMgPSBPYmplY3QuYXNzaWduKHRoaXMuX2NvbnN0cmFpbnRzLCBjb25zdHJhaW50cyk7XG4gICAgLy8gJ3ByZXNlbmNlJyBtZWFucyBkaWZmZXJlbnQgdGhpbmdzIGluIGRpZmZlcmVudCB2ZXJzaW9ucyBvZiB0aGUgdmFsaWRhdG9yLFxuICAgIC8vIHdoZW4gd2Ugc2F5ICd0cnVlJyB3ZSBtZWFuIHRoYXQgaXQgc2hvdWxkIG5vdCBiZSBhYmxlIHRvIGJlIGVtcHR5XG4gICAgZm9yIChjb25zdCBbLCB2YWx1ZV0gb2YgXy50b1BhaXJzKHRoaXMuX2NvbnN0cmFpbnRzKSkge1xuICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnByZXNlbmNlID09PSB0cnVlKSB7XG4gICAgICAgIHZhbHVlLnByZXNlbmNlID0ge1xuICAgICAgICAgIGFsbG93RW1wdHk6IGZhbHNlLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25zdHJhaW50cztcbiAgfVxuXG4gIC8vIG1ldGhvZCByZXF1aXJlZCBieSBNSlNPTldQIGluIG9yZGVyIHRvIGRldGVybWluZSB3aGV0aGVyIGl0IHNob3VsZFxuICAvLyByZXNwb25kIHdpdGggYW4gaW52YWxpZCBzZXNzaW9uIHJlc3BvbnNlXG4gIHNlc3Npb25FeGlzdHMgKHNlc3Npb25JZCkge1xuICAgIGlmICghc2Vzc2lvbklkKSByZXR1cm4gZmFsc2U7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICByZXR1cm4gc2Vzc2lvbklkID09PSB0aGlzLnNlc3Npb25JZDtcbiAgfVxuXG4gIC8vIG1ldGhvZCByZXF1aXJlZCBieSBNSlNPTldQIGluIG9yZGVyIHRvIGRldGVybWluZSBpZiB0aGUgY29tbWFuZCBzaG91bGRcbiAgLy8gYmUgcHJveGllZCBkaXJlY3RseSB0byB0aGUgZHJpdmVyXG4gIGRyaXZlckZvclNlc3Npb24gKC8qc2Vzc2lvbklkKi8pIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGxvZ0V4dHJhQ2FwcyAoY2Fwcykge1xuICAgIGxldCBleHRyYUNhcHMgPSBfLmRpZmZlcmVuY2UoXy5rZXlzKGNhcHMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5rZXlzKHRoaXMuX2NvbnN0cmFpbnRzKSk7XG4gICAgaWYgKGV4dHJhQ2Fwcy5sZW5ndGgpIHtcbiAgICAgIGxvZy53YXJuKGBUaGUgZm9sbG93aW5nIGNhcGFiaWxpdGllcyB3ZXJlIHByb3ZpZGVkLCBidXQgYXJlIG5vdCBgICtcbiAgICAgICAgICAgICAgIGByZWNvZ25pemVkIGJ5IGFwcGl1bTogJHtleHRyYUNhcHMuam9pbignLCAnKX0uYCk7XG4gICAgfVxuICB9XG5cbiAgdmFsaWRhdGVEZXNpcmVkQ2FwcyAoY2Fwcykge1xuICAgIGlmICghdGhpcy5zaG91bGRWYWxpZGF0ZUNhcHMpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICB2YWxpZGF0ZUNhcHMoY2FwcywgdGhpcy5fY29uc3RyYWludHMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KG5ldyBlcnJvcnMuU2Vzc2lvbk5vdENyZWF0ZWRFcnJvcihgVGhlIGRlc2lyZWRDYXBhYmlsaXRpZXMgb2JqZWN0IHdhcyBub3QgdmFsaWQgZm9yIHRoZSBgICtcbiAgICAgICAgICAgICAgICAgICAgYGZvbGxvd2luZyByZWFzb24ocyk6ICR7ZS5tZXNzYWdlfWApKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZ0V4dHJhQ2FwcyhjYXBzKTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgc3RhdGljIERSSVZFUl9QUk9UT0NPTCA9IHtcbiAgICBXM0M6ICdXM0MnLFxuICAgIE1KU09OV1A6ICdNSlNPTldQJyxcbiAgfTtcblxuICBpc01qc29ud3BQcm90b2NvbCAoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvdG9jb2wgPT09IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLk1KU09OV1A7XG4gIH1cblxuICBpc1czQ1Byb3RvY29sICgpIHtcbiAgICByZXR1cm4gdGhpcy5wcm90b2NvbCA9PT0gQmFzZURyaXZlci5EUklWRVJfUFJPVE9DT0wuVzNDO1xuICB9XG5cbiAgc2V0UHJvdG9jb2xNSlNPTldQICgpIHtcbiAgICB0aGlzLnByb3RvY29sID0gQmFzZURyaXZlci5EUklWRVJfUFJPVE9DT0wuTUpTT05XUDtcbiAgfVxuXG4gIHNldFByb3RvY29sVzNDICgpIHtcbiAgICB0aGlzLnByb3RvY29sID0gQmFzZURyaXZlci5EUklWRVJfUFJPVE9DT0wuVzNDO1xuICB9XG5cbiAgLyoqXG4gICAqIFRlc3QgY3JlYXRlU2Vzc2lvbiBpbnB1dHMgdG8gc2VlIGlmIHRoaXMgaXMgYSBXM0MgU2Vzc2lvbiBvciBhIE1KU09OV1AgU2Vzc2lvblxuICAgKi9cbiAgc3RhdGljIGRldGVybWluZVByb3RvY29sIChkZXNpcmVkQ2FwYWJpbGl0aWVzLCByZXF1aXJlZENhcGFiaWxpdGllcywgY2FwYWJpbGl0aWVzKSB7XG4gICAgcmV0dXJuIF8uaXNQbGFpbk9iamVjdChjYXBhYmlsaXRpZXMpID9cbiAgICAgIEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLlczQyA6XG4gICAgICBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5NSlNPTldQO1xuICB9XG5cbiAgLy8gVGhpcyBpcyB0aGUgbWFpbiBjb21tYW5kIGhhbmRsZXIgZm9yIHRoZSBkcml2ZXIuIEl0IHdyYXBzIGNvbW1hbmRcbiAgLy8gZXhlY3V0aW9uIHdpdGggdGltZW91dCBsb2dpYywgY2hlY2tpbmcgdGhhdCB3ZSBoYXZlIGEgdmFsaWQgc2Vzc2lvbixcbiAgLy8gYW5kIGVuc3VyaW5nIHRoYXQgd2UgZXhlY3V0ZSBjb21tYW5kcyBvbmUgYXQgYSB0aW1lLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWRcbiAgLy8gYnkgTUpTT05XUCdzIGV4cHJlc3Mgcm91dGVyLlxuICBhc3luYyBleGVjdXRlQ29tbWFuZCAoY21kLCAuLi5hcmdzKSB7XG4gICAgLy8gZ2V0IHN0YXJ0IHRpbWUgZm9yIHRoaXMgY29tbWFuZCwgYW5kIGxvZyBpbiBzcGVjaWFsIGNhc2VzXG4gICAgbGV0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgaWYgKGNtZCA9PT0gJ2NyZWF0ZVNlc3Npb24nKSB7XG4gICAgICAvLyBJZiBjcmVhdGluZyBhIHNlc3Npb24gZGV0ZXJtaW5lIGlmIFczQyBvciBNSlNPTldQIHByb3RvY29sIHdhcyByZXF1ZXN0ZWQgYW5kIHJlbWVtYmVyIHRoZSBjaG9pY2VcbiAgICAgIHRoaXMucHJvdG9jb2wgPSBCYXNlRHJpdmVyLmRldGVybWluZVByb3RvY29sKC4uLmFyZ3MpO1xuICAgICAgdGhpcy5sb2dFdmVudChFVkVOVF9TRVNTSU9OX0lOSVQpO1xuICAgIH0gZWxzZSBpZiAoY21kID09PSAnZGVsZXRlU2Vzc2lvbicpIHtcbiAgICAgIHRoaXMubG9nRXZlbnQoRVZFTlRfU0VTU0lPTl9RVUlUX1NUQVJUKTtcbiAgICB9XG5cbiAgICAvLyBpZiB3ZSBoYWQgYSBjb21tYW5kIHRpbWVyIHJ1bm5pbmcsIGNsZWFyIGl0IG5vdyB0aGF0IHdlJ3JlIHN0YXJ0aW5nXG4gICAgLy8gYSBuZXcgY29tbWFuZCBhbmQgc28gZG9uJ3Qgd2FudCB0byB0aW1lIG91dFxuICAgIHRoaXMuY2xlYXJOZXdDb21tYW5kVGltZW91dCgpO1xuXG4gICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSB0aGlzIGNvbW1hbmQsIGl0IG11c3Qgbm90IGJlIGltcGxlbWVudGVkXG4gICAgLy8gSWYgdGhlIHRhcmdldCBlbGVtZW50IGlzIEltYWdlRWxlbWVudCwgd2UgbXVzdCB0cnkgdG8gY2FsbCBgSW1hZ2VFbGVtZW50LmV4ZWN1dGVgIHdoaWNoIGV4aXN0IGZvbGxvd2luZyBsaW5lc1xuICAgIC8vIHNpbmNlIEltYWdlRWxlbWVudCBzdXBwb3J0cyBmZXcgY29tbWFuZHMgYnkgaXRzZWxmXG4gICAgY29uc3QgaW1nRWxJZCA9IGdldEltZ0VsRnJvbUFyZ3MoYXJncyk7XG4gICAgaWYgKCF0aGlzW2NtZF0gJiYgIWltZ0VsSWQpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcigpO1xuICAgIH1cblxuICAgIGxldCByZXM7XG4gICAgaWYgKHRoaXMuaXNDb21tYW5kc1F1ZXVlRW5hYmxlZCkge1xuICAgICAgLy8gV2hhdCB3ZSdyZSBkb2luZyBoZXJlIGlzIHByZXR0eSBjbGV2ZXIuIHRoaXMuY3VyQ29tbWFuZCBpcyBhbHdheXNcbiAgICAgIC8vIGEgcHJvbWlzZSByZXByZXNlbnRpbmcgdGhlIGNvbW1hbmQgY3VycmVudGx5IGJlaW5nIGV4ZWN1dGVkIGJ5IHRoZVxuICAgICAgLy8gZHJpdmVyLCBvciB0aGUgbGFzdCBjb21tYW5kIGV4ZWN1dGVkIGJ5IHRoZSBkcml2ZXIgKGl0IHN0YXJ0cyBvZmYgYXNcbiAgICAgIC8vIGVzc2VudGlhbGx5IGEgcHJlLXJlc29sdmVkIHByb21pc2UpLiBXaGVuIGEgY29tbWFuZCBjb21lcyBpbiwgd2UgdGFjayBpdFxuICAgICAgLy8gdG8gdGhlIGVuZCBvZiB0aGlzLmN1ckNvbW1hbmQsIGVzc2VudGlhbGx5IHNheWluZyB3ZSB3YW50IHRvIGV4ZWN1dGUgaXRcbiAgICAgIC8vIHdoZW5ldmVyIHRoaXMuY3VyQ29tbWFuZCBpcyBkb25lLiBXZSBjYWxsIHRoaXMgbmV3IHByb21pc2UgbmV4dENvbW1hbmQsXG4gICAgICAvLyBhbmQgaXRzIHJlc29sdXRpb24gaXMgd2hhdCB3ZSB1bHRpbWF0ZWx5IHdpbGwgcmV0dXJuIHRvIHdob21ldmVyIGNhbGxlZFxuICAgICAgLy8gdXMuIE1lYW53aGlsZSwgd2UgcmVzZXQgdGhpcy5jdXJDb21tYW5kIHRvIF9iZV8gbmV4dENvbW1hbmQgKGJ1dFxuICAgICAgLy8gaWdub3JpbmcgYW55IHJlamVjdGlvbnMpLCBzbyB0aGF0IGlmIGFub3RoZXIgY29tbWFuZCBjb21lcyBpbnRvIHRoZVxuICAgICAgLy8gc2VydmVyLCBpdCBnZXRzIHRhY2tlZCBvbiB0byB0aGUgZW5kIG9mIG5leHRDb21tYW5kLiBUaHVzIHdlIGNyZWF0ZVxuICAgICAgLy8gYSBjaGFpbiBvZiBwcm9taXNlcyB0aGF0IGFjdHMgYXMgYSBxdWV1ZSB3aXRoIHNpbmdsZSBjb25jdXJyZW5jeS5cbiAgICAgIGxldCBuZXh0Q29tbWFuZCA9IHRoaXMuY3VyQ29tbWFuZC50aGVuKCgpID0+IHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG4gICAgICAgIC8vIGlmIHdlIHVuZXhwZWN0ZWRseSBzaHV0IGRvd24sIHdlIG5lZWQgdG8gcmVqZWN0IGV2ZXJ5IGNvbW1hbmQgaW5cbiAgICAgICAgLy8gdGhlIHF1ZXVlIGJlZm9yZSB3ZSBhY3R1YWxseSB0cnkgdG8gcnVuIGl0XG4gICAgICAgIGlmICh0aGlzLnNodXRkb3duVW5leHBlY3RlZGx5KSB7XG4gICAgICAgICAgcmV0dXJuIEIucmVqZWN0KG5ldyBlcnJvcnMuTm9TdWNoRHJpdmVyRXJyb3IoJ1RoZSBkcml2ZXIgd2FzIHVuZXhwZWN0ZWRseSBzaHV0IGRvd24hJykpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGFsc28gbmVlZCB0byB0dXJuIHRoZSBjb21tYW5kIGludG8gYSBjYW5jZWxsYWJsZSBwcm9taXNlIHNvIGlmIHdlXG4gICAgICAgIC8vIGhhdmUgYW4gdW5leHBlY3RlZCBzaHV0ZG93biBldmVudCwgZm9yIGV4YW1wbGUsIHdlIGNhbiBjYW5jZWwgaXQgZnJvbVxuICAgICAgICAvLyBvdXRzaWRlLCByZWplY3RpbmcgdGhlIGN1cnJlbnQgY29tbWFuZCBpbW1lZGlhdGVseVxuICAgICAgICB0aGlzLmN1ckNvbW1hbmRDYW5jZWxsYWJsZSA9IEIucmVzb2x2ZSgpLnRoZW4oKCkgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cbiAgICAgICAgICAvLyBpZiBvbmUgb2YgdGhlIGFyZ3MgaXMgYW4gaW1hZ2UgZWxlbWVudCwgaGFuZGxlIGl0IHNlcGFyYXRlbHlcbiAgICAgICAgICBpZiAoaW1nRWxJZCkge1xuICAgICAgICAgICAgcmV0dXJuIEltYWdlRWxlbWVudC5leGVjdXRlKHRoaXMsIGNtZCwgaW1nRWxJZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0aGlzW2NtZF0oLi4uYXJncyk7XG4gICAgICAgIH0pLmNhbmNlbGxhYmxlKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmN1ckNvbW1hbmRDYW5jZWxsYWJsZTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jdXJDb21tYW5kID0gbmV4dENvbW1hbmQuY2F0Y2goKCkgPT4ge30pO1xuICAgICAgcmVzID0gYXdhaXQgbmV4dENvbW1hbmQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLnNodXRkb3duVW5leHBlY3RlZGx5KSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRHJpdmVyRXJyb3IoJ1RoZSBkcml2ZXIgd2FzIHVuZXhwZWN0ZWRseSBzaHV0IGRvd24hJyk7XG4gICAgICB9XG4gICAgICByZXMgPSBhd2FpdCB0aGlzW2NtZF0oLi4uYXJncyk7XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgaGF2ZSBzZXQgYSBuZXcgY29tbWFuZCB0aW1lb3V0ICh3aGljaCBpcyB0aGUgZGVmYXVsdCksIHN0YXJ0IGFcbiAgICAvLyB0aW1lciBvbmNlIHdlJ3ZlIGZpbmlzaGVkIGV4ZWN1dGluZyB0aGlzIGNvbW1hbmQuIElmIHdlIGRvbid0IGNsZWFyXG4gICAgLy8gdGhlIHRpbWVyICh3aGljaCBpcyBkb25lIHdoZW4gYSBuZXcgY29tbWFuZCBjb21lcyBpbiksIHdlIHdpbGwgdHJpZ2dlclxuICAgIC8vIGF1dG9tYXRpYyBzZXNzaW9uIGRlbGV0aW9uIGluIHRoaXMub25Db21tYW5kVGltZW91dC4gT2YgY291cnNlIHdlIGRvbid0XG4gICAgLy8gd2FudCB0byB0cmlnZ2VyIHRoZSB0aW1lciB3aGVuIHRoZSB1c2VyIGlzIHNodXR0aW5nIGRvd24gdGhlIHNlc3Npb25cbiAgICAvLyBpbnRlbnRpb25hbGx5XG4gICAgaWYgKGNtZCAhPT0gJ2RlbGV0ZVNlc3Npb24nKSB7XG4gICAgICAvLyByZXNldGluZyBleGlzdGluZyB0aW1lb3V0XG4gICAgICB0aGlzLnN0YXJ0TmV3Q29tbWFuZFRpbWVvdXQoKTtcbiAgICB9XG5cbiAgICAvLyBsb2cgdGltaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgY29tbWFuZFxuICAgIGxldCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB0aGlzLl9ldmVudEhpc3RvcnkuY29tbWFuZHMucHVzaCh7Y21kLCBzdGFydFRpbWUsIGVuZFRpbWV9KTtcbiAgICBpZiAoY21kID09PSAnY3JlYXRlU2Vzc2lvbicpIHtcbiAgICAgIHRoaXMubG9nRXZlbnQoRVZFTlRfU0VTU0lPTl9TVEFSVCk7XG4gICAgfSBlbHNlIGlmIChjbWQgPT09ICdkZWxldGVTZXNzaW9uJykge1xuICAgICAgdGhpcy5sb2dFdmVudChFVkVOVF9TRVNTSU9OX1FVSVRfRE9ORSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0VW5leHBlY3RlZFNodXRkb3duIChlcnIgPSBuZXcgZXJyb3JzLk5vU3VjaERyaXZlckVycm9yKCdUaGUgZHJpdmVyIHdhcyB1bmV4cGVjdGVkbHkgc2h1dCBkb3duIScpKSB7XG4gICAgdGhpcy51bmV4cGVjdGVkU2h1dGRvd25EZWZlcnJlZC5yZWplY3QoZXJyKTsgLy8gYWxsb3cgb3RoZXJzIHRvIGxpc3RlbiBmb3IgdGhpc1xuICAgIHRoaXMuc2h1dGRvd25VbmV4cGVjdGVkbHkgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMuZGVsZXRlU2Vzc2lvbih0aGlzLnNlc3Npb25JZCk7XG4gICAgdGhpcy5zaHV0ZG93blVuZXhwZWN0ZWRseSA9IGZhbHNlO1xuICAgIHRoaXMuY3VyQ29tbWFuZENhbmNlbGxhYmxlLmNhbmNlbChlcnIpO1xuICB9XG5cbiAgdmFsaWRhdGVMb2NhdG9yU3RyYXRlZ3kgKHN0cmF0ZWd5LCB3ZWJDb250ZXh0ID0gZmFsc2UpIHtcbiAgICBsZXQgdmFsaWRTdHJhdGVnaWVzID0gdGhpcy5sb2NhdG9yU3RyYXRlZ2llcztcbiAgICBsb2cuZGVidWcoYFZhbGlkIGxvY2F0b3Igc3RyYXRlZ2llcyBmb3IgdGhpcyByZXF1ZXN0OiAke3ZhbGlkU3RyYXRlZ2llcy5qb2luKCcsICcpfWApO1xuXG4gICAgaWYgKHdlYkNvbnRleHQpIHtcbiAgICAgIHZhbGlkU3RyYXRlZ2llcyA9IHZhbGlkU3RyYXRlZ2llcy5jb25jYXQodGhpcy53ZWJMb2NhdG9yU3RyYXRlZ2llcyk7XG4gICAgfVxuXG4gICAgaWYgKCFfLmluY2x1ZGVzKHZhbGlkU3RyYXRlZ2llcywgc3RyYXRlZ3kpKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRTZWxlY3RvckVycm9yKGBMb2NhdG9yIFN0cmF0ZWd5ICcke3N0cmF0ZWd5fScgaXMgbm90IHN1cHBvcnRlZCBmb3IgdGhpcyBzZXNzaW9uYCk7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogUmVzdGFydCB0aGUgc2Vzc2lvbiB3aXRoIHRoZSBvcmlnaW5hbCBjYXBzLFxuICAgKiBwcmVzZXJ2aW5nIHRoZSB0aW1lb3V0IGNvbmZpZy5cbiAgICovXG4gIGFzeW5jIHJlc2V0ICgpIHtcbiAgICBsb2cuZGVidWcoJ1Jlc2V0dGluZyBhcHAgbWlkLXNlc3Npb24nKTtcbiAgICBsb2cuZGVidWcoJ1J1bm5pbmcgZ2VuZXJpYyBmdWxsIHJlc2V0Jyk7XG5cbiAgICAvLyBwcmVzZXJ2aW5nIHN0YXRlXG4gICAgbGV0IGN1cnJlbnRDb25maWcgPSB7fTtcbiAgICBmb3IgKGxldCBwcm9wZXJ0eSBvZiBbJ2ltcGxpY2l0V2FpdE1zJywgJ25ld0NvbW1hbmRUaW1lb3V0TXMnLCAnc2Vzc2lvbklkJywgJ3Jlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24nXSkge1xuICAgICAgY3VycmVudENvbmZpZ1twcm9wZXJ0eV0gPSB0aGlzW3Byb3BlcnR5XTtcbiAgICB9XG5cbiAgICAvLyBXZSBhbHNvIG5lZWQgdG8gcHJlc2VydmUgdGhlIHVuZXhwZWN0ZWQgc2h1dGRvd24sIGFuZCBtYWtlIHN1cmUgaXQgaXMgbm90IGNhbmNlbGxlZCBkdXJpbmcgcmVzZXQuXG4gICAgdGhpcy5yZXNldE9uVW5leHBlY3RlZFNodXRkb3duID0gKCkgPT4ge307XG5cbiAgICAvLyBDb25zdHJ1Y3QgdGhlIGFyZ3VtZW50cyBmb3IgY3JlYXRlU2Vzc2lvbiBkZXBlbmRpbmcgb24gdGhlIHByb3RvY29sIHR5cGVcbiAgICBjb25zdCBhcmdzID0gdGhpcy5wcm90b2NvbCA9PT0gQmFzZURyaXZlci5EUklWRVJfUFJPVE9DT0wuVzNDID9cbiAgICAgIFt1bmRlZmluZWQsIHVuZGVmaW5lZCwge2Fsd2F5c01hdGNoOiB0aGlzLmNhcHMsIGZpcnN0TWF0Y2g6IFt7fV19XSA6XG4gICAgICBbdGhpcy5jYXBzXTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmRlbGV0ZVNlc3Npb24odGhpcy5zZXNzaW9uSWQpO1xuICAgICAgbG9nLmRlYnVnKCdSZXN0YXJ0aW5nIGFwcCcpO1xuICAgICAgYXdhaXQgdGhpcy5jcmVhdGVTZXNzaW9uKC4uLmFyZ3MpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAvLyBhbHdheXMgcmVzdG9yZSBzdGF0ZS5cbiAgICAgIGZvciAobGV0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMoY3VycmVudENvbmZpZykpIHtcbiAgICAgICAgdGhpc1trZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuY2xlYXJOZXdDb21tYW5kVGltZW91dCgpO1xuICB9XG5cbiAgYXN5bmMgZ2V0U3dpcGVPcHRpb25zIChnZXN0dXJlcywgdG91Y2hDb3VudCA9IDEpIHtcbiAgICBsZXQgc3RhcnRYID0gdGhpcy5oZWxwZXJzLmdldENvb3JkRGVmYXVsdChnZXN0dXJlc1swXS5vcHRpb25zLngpLFxuICAgICAgICBzdGFydFkgPSB0aGlzLmhlbHBlcnMuZ2V0Q29vcmREZWZhdWx0KGdlc3R1cmVzWzBdLm9wdGlvbnMueSksXG4gICAgICAgIGVuZFggPSB0aGlzLmhlbHBlcnMuZ2V0Q29vcmREZWZhdWx0KGdlc3R1cmVzWzJdLm9wdGlvbnMueCksXG4gICAgICAgIGVuZFkgPSB0aGlzLmhlbHBlcnMuZ2V0Q29vcmREZWZhdWx0KGdlc3R1cmVzWzJdLm9wdGlvbnMueSksXG4gICAgICAgIGR1cmF0aW9uID0gdGhpcy5oZWxwZXJzLmdldFN3aXBlVG91Y2hEdXJhdGlvbihnZXN0dXJlc1sxXSksXG4gICAgICAgIGVsZW1lbnQgPSBnZXN0dXJlc1swXS5vcHRpb25zLmVsZW1lbnQsXG4gICAgICAgIGRlc3RFbGVtZW50ID0gZ2VzdHVyZXNbMl0ub3B0aW9ucy5lbGVtZW50IHx8IGdlc3R1cmVzWzBdLm9wdGlvbnMuZWxlbWVudDtcblxuICAgIC8vIHRoZXJlJ3Mgbm8gZGVzdGluYXRpb24gZWxlbWVudCBoYW5kbGluZyBpbiBib290c3RyYXAgYW5kIHNpbmNlIGl0IGFwcGxpZXMgdG8gYWxsIHBsYXRmb3Jtcywgd2UgaGFuZGxlIGl0IGhlcmVcbiAgICBpZiAodXRpbC5oYXNWYWx1ZShkZXN0RWxlbWVudCkpIHtcbiAgICAgIGxldCBsb2NSZXN1bHQgPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uSW5WaWV3KGRlc3RFbGVtZW50KTtcbiAgICAgIGxldCBzaXplUmVzdWx0ID0gYXdhaXQgdGhpcy5nZXRTaXplKGRlc3RFbGVtZW50KTtcbiAgICAgIGxldCBvZmZzZXRYID0gKE1hdGguYWJzKGVuZFgpIDwgMSAmJiBNYXRoLmFicyhlbmRYKSA+IDApID8gc2l6ZVJlc3VsdC53aWR0aCAqIGVuZFggOiBlbmRYO1xuICAgICAgbGV0IG9mZnNldFkgPSAoTWF0aC5hYnMoZW5kWSkgPCAxICYmIE1hdGguYWJzKGVuZFkpID4gMCkgPyBzaXplUmVzdWx0LmhlaWdodCAqIGVuZFkgOiBlbmRZO1xuICAgICAgZW5kWCA9IGxvY1Jlc3VsdC54ICsgb2Zmc2V0WDtcbiAgICAgIGVuZFkgPSBsb2NSZXN1bHQueSArIG9mZnNldFk7XG4gICAgICAvLyBpZiB0aGUgdGFyZ2V0IGVsZW1lbnQgd2FzIHByb3ZpZGVkLCB0aGUgY29vcmRpbmF0ZXMgZm9yIHRoZSBkZXN0aW5hdGlvbiBuZWVkIHRvIGJlIHJlbGF0aXZlIHRvIGl0LlxuICAgICAgaWYgKHV0aWwuaGFzVmFsdWUoZWxlbWVudCkpIHtcbiAgICAgICAgbGV0IGZpcnN0RWxMb2NhdGlvbiA9IGF3YWl0IHRoaXMuZ2V0TG9jYXRpb25JblZpZXcoZWxlbWVudCk7XG4gICAgICAgIGVuZFggLT0gZmlyc3RFbExvY2F0aW9uLng7XG4gICAgICAgIGVuZFkgLT0gZmlyc3RFbExvY2F0aW9uLnk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIGNsaWVudHMgYXJlIHJlc3BvbnNpYmxlIHRvIHVzZSB0aGVzZSBvcHRpb25zIGNvcnJlY3RseVxuICAgIHJldHVybiB7c3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksIGR1cmF0aW9uLCB0b3VjaENvdW50LCBlbGVtZW50fTtcbiAgfVxuXG4gIHByb3h5QWN0aXZlICgvKiBzZXNzaW9uSWQgKi8pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnZXRQcm94eUF2b2lkTGlzdCAoLyogc2Vzc2lvbklkICovKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgY2FuUHJveHkgKC8qIHNlc3Npb25JZCAqLykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgZ2l2ZW4gY29tbWFuZCByb3V0ZSAoZXhwcmVzc2VkIGFzIG1ldGhvZCBhbmQgdXJsKSBzaG91bGQgbm90IGJlXG4gICAqIHByb3hpZWQgYWNjb3JkaW5nIHRvIHRoaXMgZHJpdmVyXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXNzaW9uSWQgLSB0aGUgY3VycmVudCBzZXNzaW9uSWQgKGluIGNhc2UgdGhlIGRyaXZlciBydW5zXG4gICAqIG11bHRpcGxlIHNlc3Npb24gaWRzIGFuZCByZXF1aXJlcyBpdCkuIFRoaXMgaXMgbm90IHVzZWQgaW4gdGhpcyBtZXRob2QgYnV0XG4gICAqIHNob3VsZCBiZSBtYWRlIGF2YWlsYWJsZSB0byBvdmVycmlkZGVuIG1ldGhvZHMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2QgLSBIVFRQIG1ldGhvZCBvZiB0aGUgcm91dGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIHVybCBvZiB0aGUgcm91dGVcbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IC0gd2hldGhlciB0aGUgcm91dGUgc2hvdWxkIGJlIGF2b2lkZWRcbiAgICovXG4gIHByb3h5Um91dGVJc0F2b2lkZWQgKHNlc3Npb25JZCwgbWV0aG9kLCB1cmwpIHtcbiAgICBmb3IgKGxldCBhdm9pZFNjaGVtYSBvZiB0aGlzLmdldFByb3h5QXZvaWRMaXN0KHNlc3Npb25JZCkpIHtcbiAgICAgIGlmICghXy5pc0FycmF5KGF2b2lkU2NoZW1hKSB8fCBhdm9pZFNjaGVtYS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcm94eSBhdm9pZGFuY2UgbXVzdCBiZSBhIGxpc3Qgb2YgcGFpcnMnKTtcbiAgICAgIH1cbiAgICAgIGxldCBbYXZvaWRNZXRob2QsIGF2b2lkUGF0aFJlZ2V4XSA9IGF2b2lkU2NoZW1hO1xuICAgICAgaWYgKCFfLmluY2x1ZGVzKFsnR0VUJywgJ1BPU1QnLCAnREVMRVRFJ10sIGF2b2lkTWV0aG9kKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVucmVjb2duaXplZCBwcm94eSBhdm9pZGFuY2UgbWV0aG9kICcke2F2b2lkTWV0aG9kfSdgKTtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc1JlZ0V4cChhdm9pZFBhdGhSZWdleCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcm94eSBhdm9pZGFuY2UgcGF0aCBtdXN0IGJlIGEgcmVndWxhciBleHByZXNzaW9uJyk7XG4gICAgICB9XG4gICAgICBsZXQgbm9ybWFsaXplZFVybCA9IHVybC5yZXBsYWNlKC9eXFwvd2RcXC9odWIvLCAnJyk7XG4gICAgICBpZiAoYXZvaWRNZXRob2QgPT09IG1ldGhvZCAmJiBhdm9pZFBhdGhSZWdleC50ZXN0KG5vcm1hbGl6ZWRVcmwpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBhZGRNYW5hZ2VkRHJpdmVyIChkcml2ZXIpIHtcbiAgICB0aGlzLm1hbmFnZWREcml2ZXJzLnB1c2goZHJpdmVyKTtcbiAgfVxuXG4gIGdldE1hbmFnZWREcml2ZXJzICgpIHtcbiAgICByZXR1cm4gdGhpcy5tYW5hZ2VkRHJpdmVycztcbiAgfVxufVxuXG5mb3IgKGxldCBbY21kLCBmbl0gb2YgXy50b1BhaXJzKGNvbW1hbmRzKSkge1xuICBCYXNlRHJpdmVyLnByb3RvdHlwZVtjbWRdID0gZm47XG59XG5cbmV4cG9ydCB7IEJhc2VEcml2ZXIgfTtcbmV4cG9ydCBkZWZhdWx0IEJhc2VEcml2ZXI7XG4iXSwiZmlsZSI6ImxpYi9iYXNlZHJpdmVyL2RyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
